<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Creating a constraint programming model &mdash; DOcplex.CP: Constraint Programming Modeling for Python V1.0 documentation</title>
    
    <link rel="stylesheet" href="_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     'V1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  false
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="DOcplex.CP: Constraint Programming Modeling for Python V1.0 documentation" href="index.html" />
    <link rel="next" title="Examples of constraint programming" href="samples.html" />
    <link rel="prev" title="Getting started with constraint programming in DOcplex" href="getting_started.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="samples.html" title="Examples of constraint programming"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="getting_started.html" title="Getting started with constraint programming in DOcplex"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">DOcplex.CP: Constraint Programming Modeling for Python V1.0 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="creating-a-constraint-programming-model">
<h1>Creating a constraint programming model<a class="headerlink" href="#creating-a-constraint-programming-model" title="Permalink to this headline">¶</a></h1>
<p>Building a model requires:</p>
<blockquote>
<div><ul class="simple">
<li>building unitary model expressions and</li>
<li>assembling them into a model.</li>
</ul>
</div></blockquote>
<p>The <a class="reference internal" href="samples.html"><em>examples</em></a> can be used as starting point to create a new model.</p>
<p>The detailed documentation of the Python API for DOcplex.CP is available <a class="reference internal" href="refman.html"><em>here</em></a>.</p>
<div class="section" id="build-model-expressions">
<h2>Build model expressions<a class="headerlink" href="#build-model-expressions" title="Permalink to this headline">¶</a></h2>
<p>The CP Optimizer (DOcplex.CP) expression elements are implemented in the Python modules located in <code class="docutils literal"><span class="pre">docplex/cp</span></code>.
Basic elements are described in the module <a class="reference internal" href="docplex.cp.expression.py.html"><em>expression.py</em></a>, which contains:</p>
<blockquote>
<div><ul class="simple">
<li>the class <em>CpoExpr</em> that is the root class for all DOcplex.CP expressions,</li>
<li>one class for each type of variable (<em>CpoIntVar</em>, <em>CpoIntervalVar</em>, <em>CpoSequenceVar</em>), and</li>
<li>one class per each other object type (<em>CpoTupleSet</em>, <em>CpoTransitionMatrix</em>).</li>
</ul>
</div></blockquote>
<p>An auxiliary module, <a class="reference internal" href="docplex.cp.function.py.html"><em>function.py</em></a>, contains classes that represent functions (<em>CpoStepFunction</em>, <em>CpoSegmentFunction</em>).</p>
<p>These classes should not be used directly to create expression objects. Instead, the
constructor functions should be used, which create, for example, an array or a dictionary of variables in one call:</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="41%" />
<col width="59%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Function</th>
<th class="head">Creates</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><em>integer_var()</em></td>
<td>Single integer variable</td>
</tr>
<tr class="row-odd"><td><em>integer_var_list()</em></td>
<td>List of integer variables</td>
</tr>
<tr class="row-even"><td><em>integer_var_dict()</em></td>
<td>Dictionary  of integer variables</td>
</tr>
<tr class="row-odd"><td><em>interval_var()</em></td>
<td>Single interval variable</td>
</tr>
<tr class="row-even"><td><em>interval_var_list()</em></td>
<td>Array of interval variables</td>
</tr>
<tr class="row-odd"><td><em>sequence_var()</em></td>
<td>Sequence variable</td>
</tr>
<tr class="row-even"><td><em>transition_matrix()</em></td>
<td>Empty transition matrix</td>
</tr>
<tr class="row-odd"><td><em>tuple_set()</em></td>
<td>Tuple set</td>
</tr>
<tr class="row-even"><td><em>state_function()</em></td>
<td>State function</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>The DOcplex.CP functions for building operations between expressions are available in the module <a class="reference internal" href="docplex.cp.modeler.py.html"><em>modeler.py</em></a>,
which contains approximately 150 specialized functions. See details of these functions in the API documentation.</p>
<p>Arrays of expressions are represented directly by using their Python equivalent <em>lists</em> or <em>tuples</em>.</p>
<div class="section" id="special-function-renaming">
<h3>Special function renaming<a class="headerlink" href="#special-function-renaming" title="Permalink to this headline">¶</a></h3>
<p>The  modeling functions are identified with the same names in the Python API as in the CPO file format, the C++ API, and the Java API.
However, there is an exception for the Boolean operators <em>and</em>, <em>or</em>, and <em>not</em> that are predefined symbols in Python
and cannot be overloaded or used as function names. They are renamed as follows:</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="31%" />
<col width="69%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">CPO</th>
<th class="head">Python</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>and</td>
<td>logical_and</td>
</tr>
<tr class="row-odd"><td>or</td>
<td>logical_or</td>
</tr>
<tr class="row-even"><td>not</td>
<td>logical_not</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>Functions that correspond to built-in Python functions <em>abs</em>, <em>min</em>, <em>max</em>, <em>range</em>, <em>round</em>, and <em>sum</em> are
overwritten in a safe way that calls the built-in implementation if none of the
parameters are expressions.</p>
</div>
<div class="section" id="operator-overloading">
<h3>Operator overloading<a class="headerlink" href="#operator-overloading" title="Permalink to this headline">¶</a></h3>
<p>To simplify the writing of a model, Python operators are overloaded to match CP Optimizer operator creation functions.
The following table indicates which function is assigned to which operator.</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="80%" />
<col width="20%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Operation</th>
<th class="head"></th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>plus</td>
<td>+</td>
</tr>
<tr class="row-odd"><td>minus</td>
<td>-</td>
</tr>
<tr class="row-even"><td>unary_minus</td>
<td>-</td>
</tr>
<tr class="row-odd"><td>times</td>
<td>*</td>
</tr>
<tr class="row-even"><td>mod</td>
<td>%</td>
</tr>
<tr class="row-odd"><td>int_div</td>
<td>//</td>
</tr>
<tr class="row-even"><td>float_div</td>
<td>/</td>
</tr>
<tr class="row-odd"><td>power</td>
<td>**</td>
</tr>
<tr class="row-even"><td>equal</td>
<td>==</td>
</tr>
<tr class="row-odd"><td>diff</td>
<td>!=</td>
</tr>
<tr class="row-even"><td>greater_or_equal</td>
<td>&gt;=</td>
</tr>
<tr class="row-odd"><td>less_or_equal</td>
<td>&lt;=</td>
</tr>
<tr class="row-even"><td>greater</td>
<td>&gt;</td>
</tr>
<tr class="row-odd"><td>less</td>
<td>&lt;</td>
</tr>
<tr class="row-even"><td>logical_or</td>
<td>|</td>
</tr>
<tr class="row-odd"><td>logical_and</td>
<td>&amp;</td>
</tr>
<tr class="row-even"><td>logical_not</td>
<td>~</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p><strong>Caution</strong>: Logical operations <em>and</em>, <em>or</em>, and <em>not</em> are overloaded by using Python <em>binary</em> operators.
These operators have a different priority than usual logical operators.
Make sure to always use parenthesis to avoid any ambiguity.</p>
</div>
</div>
<div class="section" id="build-a-model">
<h2>Build a model<a class="headerlink" href="#build-a-model" title="Permalink to this headline">¶</a></h2>
<p>The model is represented by the class <em>CpoModel</em> implemented in the module <a class="reference internal" href="docplex.cp.model.py.html"><em>model.py</em></a>.</p>
<p>An expression is added to the model by calling the method <em>add()</em> with the expression as the parameter.</p>
<div class="section" id="import-necessary-modules">
<h3>Import necessary modules<a class="headerlink" href="#import-necessary-modules" title="Permalink to this headline">¶</a></h3>
<p>Following is a condensed example of the NQueen problem that uses the default import policy.
More comments are available in the files in the directory <em>docplex/cp/examples</em>.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">docplex.cp.model</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">NB_QUEEN</span> <span class="o">=</span> <span class="mi">8</span>
<span class="n">mdl</span> <span class="o">=</span> <span class="n">CpoModel</span><span class="p">()</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">integer_var_list</span><span class="p">(</span><span class="n">NB_QUEEN</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">NB_QUEEN</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;X&quot;</span><span class="p">)</span>
<span class="n">mdl</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">all_diff</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="n">mdl</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">all_diff</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">NB_QUEEN</span><span class="p">)]))</span>
<span class="n">mdl</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">all_diff</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">NB_QUEEN</span><span class="p">)]))</span>
</pre></div>
</div>
<p>In case a modeling program requires the use of another module that contains functions potentially
conflicting with those proposed by DOcplex.CP, the modeling program can be written in the following way:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">docplex.cp.model</span> <span class="kn">as</span> <span class="nn">cp</span>
<span class="n">NB_QUEEN</span> <span class="o">=</span> <span class="mi">8</span>
<span class="n">mdl</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">CpoModel</span><span class="p">()</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">integer_var_list</span><span class="p">(</span><span class="n">NB_QUEEN</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">NB_QUEEN</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;X&quot;</span><span class="p">)</span>
<span class="n">mdl</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">cp</span><span class="o">.</span><span class="n">all_diff</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="n">mdl</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">cp</span><span class="o">.</span><span class="n">all_diff</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">NB_QUEEN</span><span class="p">)]))</span>
<span class="n">mdl</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">cp</span><span class="o">.</span><span class="n">all_diff</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">NB_QUEEN</span><span class="p">)]))</span>
</pre></div>
</div>
<p>Note that importing <a class="reference internal" href="docplex.cp.model.py.html"><em>model.py</em></a> also indirectly imports
<a class="reference internal" href="docplex.cp.expression.py.html"><em>expression.py</em></a>, <a class="reference internal" href="docplex.cp.modeler.py.html"><em>modeler.py</em></a>,
<a class="reference internal" href="docplex.cp.function.py.html"><em>function.py</em></a> and <a class="reference internal" href="docplex.cp.parameters.py.html"><em>parameters.py</em></a>.</p>
</div>
</div>
</div>
<div class="section" id="solving-a-model">
<h1>Solving a model<a class="headerlink" href="#solving-a-model" title="Permalink to this headline">¶</a></h1>
<p>Solving a model can be done in multiple ways:</p>
<blockquote>
<div><ul class="simple">
<li>Automatically submit the model to the DOcloud solving service.
In this case, the transformation into CPO file format, the submission for solving, and the retrieval of results is done automatically.</li>
<li>Transform the model into CPO file format to drop it manually on the DropSolve application.
A description of how a model in CPO file format can be generated from the model is described in section <cite>Generate CPO file</cite>.</li>
</ul>
</div></blockquote>
<div class="section" id="solve-a-model-with-docloud">
<h2>Solve a model with DOcloud<a class="headerlink" href="#solve-a-model-with-docloud" title="Permalink to this headline">¶</a></h2>
<p>A model can be solved directly and transparently on the cloud, if credentials were initialized properly as
described in the installation topic.</p>
<div class="highlight-python"><div class="highlight"><pre>mdl = cp.CpoModel()
. . . . .
&lt;Construction of the model&gt;
. . . . .
print(&quot;Solving model....&quot;)
msol = mdl.solve()
msol.print_solution()
</pre></div>
</div>
<p>In case you need to explicitly give DOcloud credentials,
they can be passed as arguments of the <em>solve()</em> method as follows:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">msol</span> <span class="o">=</span> <span class="n">mdl</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">url</span><span class="o">=...</span><span class="p">,</span> <span class="n">key</span><span class="o">=...</span><span class="p">)</span>
</pre></div>
</div>
<p>The <em>solve()</em> method returns an object of class <em>CpoModelSolution</em> that contains the result of solving.
This object is described in the section &#8220;Retrieve results&#8221;.</p>
<p>The method <em>print_solution()</em> prints a default view of the status of the solve and the values of all variables.
The object <em>CpoModelSolution</em> contains all the necessary accessors to create a customized solution output.</p>
<div class="section" id="solving-options">
<h3>Solving options<a class="headerlink" href="#solving-options" title="Permalink to this headline">¶</a></h3>
<p>The method <em>solve()</em> accepts a variable list of optional named arguments for configuring the solving. For example:</p>
<blockquote>
<div><ul class="simple">
<li><em>url=&lt;DOcloud server url&gt;</em>. Overwrites the default configuration parameter <em>context.solver.docloud.url</em>
that is used to handle the URL of the DOcloud service.</li>
<li><em>key=&lt;DOcloud authentication key&gt;</em>. Overwrites the default configuration parameter <em>context.solver.docloud.key</em>
that is used to handle the DOcloud service access key.</li>
<li><em>params=&lt;solving parameters&gt;</em>: Object of class <em>CpoParameters</em> that contains a complete set of solving parameters
(see the section &#8220;Solving parameters&#8221; for more details).</li>
</ul>
</div></blockquote>
<p>The list of arguments is not limited. Each named argument is used to replace the leaf attribute that has the same name
in the global configuration initialized in the module <em>config.py</em> and its specializations.</p>
<p>If the attribute is not found as an existing attribute, it is then used as a solving parameter set in the <em>params</em> subcontext.</p>
<p>See the section <em>Advanced configuration</em> for more details on configuration.</p>
</div>
<div class="section" id="solving-parameters">
<h3>Solving parameters<a class="headerlink" href="#solving-parameters" title="Permalink to this headline">¶</a></h3>
<p>Solving parameters can be passed to the solve method either:</p>
<blockquote>
<div><ul class="simple">
<li>with an object of class <em>CpoParameters</em> assigned to the argument <em>params</em> as indicated in the previous section, or</li>
<li>directly as individual parameters.
The names of the parameters are the same as the property exposed in the class <em>CpoParameters</em>
declared in the module <a class="reference internal" href="docplex.cp.parameters.py.html"><em>parameters.py</em></a>.</li>
</ul>
</div></blockquote>
<p>For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">msol</span> <span class="o">=</span> <span class="n">mdl</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">TimeLimit</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span> <span class="n">LogPeriod</span><span class="o">=</span><span class="mi">5000</span><span class="p">)</span>
</pre></div>
</div>
<p>is equivalent to:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">params</span> <span class="o">=</span> <span class="n">CpoParameters</span><span class="p">()</span>
<span class="n">params</span><span class="o">.</span><span class="n">TimeLimit</span> <span class="o">=</span> <span class="mi">80</span>
<span class="n">params</span><span class="o">.</span><span class="n">LogPeriod</span> <span class="o">=</span> <span class="mi">5000</span>
<span class="n">msol</span> <span class="o">=</span> <span class="n">mdl</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="retrieve-results">
<h2>Retrieve results<a class="headerlink" href="#retrieve-results" title="Permalink to this headline">¶</a></h2>
<p>Results from the solve are returned in a data structure of the class <em>CpoModelSolution</em>, implemented in the module <a class="reference internal" href="docplex.cp.solution.py.html"><em>solution.py</em></a>.
This object contains:</p>
<blockquote>
<div><ul>
<li><p class="first">global model information, such as status of the search, value of the objective(s), and solve time, and</p>
</li>
<li><p class="first">the value of each variable, by using dedicated objects classes:</p>
<blockquote>
<div><ul class="simple">
<li><em>CpoIntVarSolution</em> for single integer variables,</li>
<li><em>CpoIntervalVarSolution</em> for interval variables,</li>
<li><em>CpoSequenceVarSolution</em> for sequence variables, and</li>
<li><em>CpoStateFunction</em> for state functions.</li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
<p>Look at <a class="reference internal" href="docplex.cp.solution.py.html"><em>solution.py</em></a> in the reference manual for details on what methods are available for each object.</p>
<p>Many shortcuts are available to write simpler code.</p>
<blockquote>
<div><ul>
<li><p class="first">The model solution object implements the method <em>__nonzero__()</em> and <em>__bool__()</em> (for Python 2 and 3) which makes it possible to
test directly if a solution is present.</p>
</li>
<li><p class="first">A simplified Python value for each object is directly accessible by using square brackets (<em>msol[vname]</em>). The result is:</p>
<blockquote>
<div><ul class="simple">
<li>an integer for integer variables,</li>
<li>a tuple (start, end, size) for interval variables or empty tuple () if it is absent,</li>
<li>a list of variable solutions for a sequence variable (each element is a <em>CpoIntervalVarSolution</em>), and</li>
<li>a list of tuples (start, end, value) for state functions.</li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
<p>The following code is an example of solution printing for the NQueen example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">sys</span> <span class="kn">import</span> <span class="n">stdout</span>
<span class="k">if</span> <span class="n">msol</span><span class="p">:</span>
    <span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Solution:&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">x</span><span class="p">:</span>
        <span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">msol</span><span class="p">[</span><span class="n">v</span><span class="p">]))</span>
    <span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Solve status: &quot;</span> <span class="o">+</span> <span class="n">msol</span><span class="o">.</span><span class="n">get_solve_status</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The different solution elements can be accessed directly by using the following attributes instead of the dedicated methods:</p>
<blockquote>
<div><ul class="simple">
<li><em>vars</em>: Dictionary of solutions of all variables. Key is a variable name, and value is either <cite>CpoIntVarSolution</cite>, <cite>CpoIntervalVarSolution</cite>, <cite>CpoSequenceVarSolution</cite>, or <cite>CpoStateFunctionSolution</cite>.</li>
<li><em>parameters</em>: Map of solving parameters. Key is a parameter name, and value is a string, int, or float (not available when solving on DOcloud).</li>
<li><em>infos</em>: Map of solving information. Key is an attribute name, and value is a string, int, or float. (not available when solving on DOcloud).</li>
</ul>
</div></blockquote>
<p>Note: The attributes <em>parameters</em> and <em>infos</em> are not yet available in responses that come from DOcloud.</p>
</div>
</div>
<div class="section" id="other-features">
<h1>Other features<a class="headerlink" href="#other-features" title="Permalink to this headline">¶</a></h1>
<div class="section" id="generate-cpo-file">
<h2>Generate CPO file<a class="headerlink" href="#generate-cpo-file" title="Permalink to this headline">¶</a></h2>
<p>The generation of the CPO file corresponding to a model is made available by calling the method <em>export_as_cpo()</em>,
as demonstrated in the following example:</p>
<div class="highlight-python"><div class="highlight"><pre>mdl = CpoModel()
. . . . .
&lt;Construction of the model&gt;
. . . . .
mdl.export_as_cpo()
</pre></div>
</div>
<p>Following is the CPO format generated from the NQueen example:</p>
<div class="highlight-python"><div class="highlight"><pre>///////////////////////////////////////////////////////////////////////////////
// CPO file generated from:
// C:\CPO\Tests\Workspace\CpoPython\Examples\NQueen.py
///////////////////////////////////////////////////////////////////////////////

//--- Variables ---
X7 = int_var(0..7);
X6 = int_var(0..7);
X5 = int_var(0..7);
X4 = int_var(0..7);
X3 = int_var(0..7);
X2 = int_var(0..7);
X1 = int_var(0..7);
X0 = int_var(0..7);

//--- Expressions ---
alldiff([X0, X1, X2, X3, X4, X5, X6, X7]);
alldiff([X0 + 0, X1 + 1, X2 + 2, X3 + 3, X4 + 4, X5 + 5, X6 + 6, X7 + 7]);
alldiff([X0 - 0, X1 - 1, X2 - 2, X3 - 3, X4 - 4, X5 - 5, X6 - 6, X7 - 7]);

//--- Parameters ---
// None
</pre></div>
</div>
<div class="section" id="generation-options">
<h3>Generation options<a class="headerlink" href="#generation-options" title="Permalink to this headline">¶</a></h3>
<p>There are two optional parameters to the method <em>export_as_cpo()</em>:</p>
<blockquote>
<div><ul class="simple">
<li><cite>out</cite>: To specify an output file or stream instead of <cite>stdout</cite>.</li>
<li><cite>srcloc</cite>: To indicate to add source location information in the generated file.</li>
</ul>
</div></blockquote>
<p>This last option adds location comments to the generated file, as follows:</p>
<div class="highlight-python"><div class="highlight"><pre>//--- Expressions ---
#line 32 &quot;C:\CPO\Tests\Workspace\CpoPython\Examples\NQueen.py&quot;
alldiff([X0, X1]);
#line 35
alldiff([X0 + 0, X1 + 1]);
</pre></div>
</div>
</div>
<div class="section" id="get-the-cp-optimizer-model-as-a-string">
<h3>Get the CP Optimizer model as a string<a class="headerlink" href="#get-the-cp-optimizer-model-as-a-string" title="Permalink to this headline">¶</a></h3>
<p>The CPO formatted model can also be retrieved as a string by using the method <em>get_cpo_string()</em>.</p>
</div>
</div>
<div class="section" id="advanced-configuration">
<h2>Advanced configuration<a class="headerlink" href="#advanced-configuration" title="Permalink to this headline">¶</a></h2>
<p>The configuration parameters of DOcplex.CP are based on the class <em>Context</em>,
which allows the user to set and retrieve any number of values, that may be atomic or other subcontexts organized as a tree.</p>
<p>An object of the class <em>Context</em> has the following characteristics:</p>
<blockquote>
<div><ul class="simple">
<li>It can contain an unlimited number of attributes that can be easily addressed directly with the Python &#8216;.&#8217; operator.</li>
<li>When an attribute does not exist, it is inherited from the parent context, if any.</li>
<li>If an attribute is not found, the value None is returned.</li>
</ul>
</div></blockquote>
<div class="section" id="api-configuration">
<h3>API configuration<a class="headerlink" href="#api-configuration" title="Permalink to this headline">¶</a></h3>
<p>The configuration of DOcplex.CP is described by using a <em>Context</em> that is comprised of the following
tree of contexts:</p>
<div class="highlight-python"><div class="highlight"><pre>context            # General parameters
   model           # Parameters related to model file generation
   params          # Solving parameters (of type *CpoParameters*, subclass of *Context*)
   solver          # Parameters of the solving in general
      docloud      # Parameters related to solving on DOcloud
</pre></div>
</div>
<p>The default context of DOcplex.CP is accessible by the variable <em>context</em>, which is initialized
in the module <a class="reference internal" href="docplex.cp.config.py.html"><em>config.py</em></a>.</p>
<p><strong>This module should not be edited directly</strong>.
Use the procedure in the next section to change configuration parameters.</p>
</div>
<div class="section" id="change-the-default-configuration">
<h3>Change the default configuration<a class="headerlink" href="#change-the-default-configuration" title="Permalink to this headline">¶</a></h3>
<p>To change configuration values, set them in one of the following Python modules that you can create at any place
visible in your <code class="docutils literal"><span class="pre">PYTHONPATH</span></code> (for example with your modeling sources):</p>
<blockquote>
<div><ul class="simple">
<li><cite>cpo_config.py</cite></li>
<li><cite>cpo_config_&lt;your hostname&gt;.py</cite></li>
<li><cite>docloud_config.py</cite> (also used in DOcplex.MP config, to share the same DOcloud parameters)</li>
</ul>
</div></blockquote>
<p>If present, these modules are loaded in the order above to overwrite the default configuration values.</p>
<p>To change the value of an attribute of the default configuration, set it using its full path:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">context</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">docloud</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;...&quot;</span>
<span class="n">context</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">docloud</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;...&quot;</span>
<span class="n">context</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">trace_cpo</span> <span class="o">=</span> <span class="bp">True</span>
</pre></div>
</div>
<p>Note that these files are evaluated inside the <em>config.py</em> context. You must not add any import statement
to <cite>docplex.cp.config</cite> inside them.
This is not the case if you want to change a context value outside a configuration file, for example directly in your
modeling source code.</p>
</div>
<div class="section" id="display-current-configuration">
<h3>Display current configuration<a class="headerlink" href="#display-current-configuration" title="Permalink to this headline">¶</a></h3>
<p>To display the configuration that includes all the updates that made by using specialized modules,
run the module <em>config.py</em>. The configuration details are printed on standard output.</p>
<p>Example:</p>
<div class="highlight-python"><div class="highlight"><pre>&gt; python config.py

log_output = &lt;open file &#39;&lt;stdout&gt;&#39;, mode &#39;w&#39; at 0x00000000023B20C0&gt;
visu_enabled = True
model =
   add_source_location = True
   dump_directory = /Tmp/cpo
   trace_cpo = False
params =
solver =
   add_log_to_solution = True
   agent = docloud
   solve_timeout = 100
   docloud =
      always_close_connection = False
      clean_job_after_solve = True
      key = Put your key here
      request_timeout = 30
      result_wait_extra_time = 60
      secret = None
      trace_response = False
      url = https://api-oaas.docloud.ibmcloud.com/job_manager/rest/v1/
      verify_ssl = True
</pre></div>
</div>
</div>
<div class="section" id="default-configuration-attributes">
<h3>Default configuration attributes<a class="headerlink" href="#default-configuration-attributes" title="Permalink to this headline">¶</a></h3>
<p>The following list gives a detailed definition of the most important configuration parameters.
The complete list of parameters is given in the module <a class="reference internal" href="docplex.cp.config.py.html"><em>config.py</em></a>, which should not be changed directly.</p>
<div class="section" id="general-parameters">
<h4>General parameters<a class="headerlink" href="#general-parameters" title="Permalink to this headline">¶</a></h4>
<dl class="docutils">
<dt><em>context.log_output = sys.stdout</em></dt>
<dd>This parameter contains the default log stream.
By default it is set to the standard output. A value of None can be used to disable all logs.</dd>
<dt><em>context.model.add_source_location = True</em></dt>
<dd>This parameter indicates that when the model is transformed into CPO format, additional information is added
to correlate expressions with the Python file and line where it has been generated.
If any error is raised by the solver during the solve, this information is provided in the
error description, which allows for easier debugging.</dd>
<dt><em>context.model.length_for_alias = None</em></dt>
<dd>This parameter enables the replacement of very long variable names by a shorter alias in the generated CPO format.
It is useful only when variable names are, for example, generated automatically, resulting in names longer than 20 characters.
By default, the value is None, which indicates to keep original variable names.</dd>
<dt><em>context.model.dump_directory = None</em></dt>
<dd><p class="first">This parameter gives the name of a directory where the CPO files that are generated for solving models are stored
for logging purpose.</p>
<p class="last">If not None, the directory is created and generated models are stored in files named <cite>&lt;model_name&gt;.cpo</cite>.</p>
</dd>
<dt><em>context.params.*</em></dt>
<dd><p class="first">The parameter <cite>context.params</cite> is an instance of the class <cite>CpoParameters</cite> (in <a class="reference internal" href="docplex.cp.parameters.py.html"><em>parameters.py</em></a>),
which describes all of the public solver parameters as properties and is an extension of the base class <em>Context</em>.</p>
<p>The default configuration limits the solving time to 100 seconds by using following settings:</p>
<div class="last highlight-python"><div class="highlight"><pre><span class="n">context</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">TimeMode</span> <span class="o">=</span> <span class="s2">&quot;ElapsedTime&quot;</span>
<span class="n">context</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">TimeLimit</span> <span class="o">=</span> <span class="mi">100</span>
</pre></div>
</div>
</dd>
</dl>
</div>
<div class="section" id="configuration-of-the-model-solving">
<h4>Configuration of the model solving<a class="headerlink" href="#configuration-of-the-model-solving" title="Permalink to this headline">¶</a></h4>
<dl class="docutils">
<dt><em>context.solver.trace_cpo = False</em></dt>
<dd>This parameter indicates to trace the CPO model that is generated before submitting it for solving.
The model is printed on the <cite>context.log_output stream</cite>, if given.</dd>
<dt><em>context.solver.trace_log = False</em></dt>
<dd>This parameter indicates to trace the log generated by the solver when solving the CPO model.
The log is printed on the <cite>context.log_output stream</cite>, if given.</dd>
<dt><em>context.solver.add_log_to_solution = True</em></dt>
<dd>This parameter indicates to add the solver log content to the solution object.
By default, this parameter is True but it can be set to False if the log is very big or of no interest.</dd>
<dt><em>context.solver.agent = &#8216;docloud&#8217;</em></dt>
<dd><p class="first">This parameter specifies the name of the solver agent that is used to solve the model.
The value of this parameter is the name of a child context of <cite>context.solver</cite>, which contains necessary attributes
that allow to create and run the required agent.</p>
<dl class="last docutils">
<dt>There is only one agent described in the default configuration file:</dt>
<dd><ul class="first last simple">
<li><cite>docloud</cite>, the default agent, for solving a CPO model using the DOcloud service.</li>
</ul>
</dd>
</dl>
</dd>
</dl>
</div>
<div class="section" id="configuration-of-the-docloud-solving-agent">
<h4>Configuration of the <cite>docloud</cite> solving agent<a class="headerlink" href="#configuration-of-the-docloud-solving-agent" title="Permalink to this headline">¶</a></h4>
<dl class="docutils">
<dt><em>context.solver.docloud.url = &#8220;https://api-oaas.docloud.ibmcloud.com/job_manager/rest/v1/&#8221;</em></dt>
<dd>This parameter is used to specify the URL of the DOcloud service.</dd>
<dt><em>context.solver.docloud.key = &#8220;&#8216;Set your key in docloud_config.py&#8217;&#8221;</em></dt>
<dd><p class="first">This parameter contains the personal key for authorizing access to the DOcloud service.</p>
<p>Access credentials (base URL and access key) can be retrieved after registration from <a class="reference external" href="http://developer.ibm.com/docloud/docs/api-key/">http://developer.ibm.com/docloud/docs/api-key/</a>.</p>
<p class="last">These two parameters can be set in the <em>docloud_config.py</em> file.</p>
</dd>
<dt><em>context.solver.docloud.request_timeout = 30</em></dt>
<dd>This parameter contains the maximum time, in seconds, that a response is waited for after a unitary request to DOcloud server.</dd>
<dt><em>context.solver.docloud.result_wait_extra_time = 60</em></dt>
<dd>This parameter is a time in seconds added to the expected solve time to compute the total result waiting timeout.</dd>
<dt><em>context.solver.docloud.clean_job_after_solve = True</em></dt>
<dd>This parameter indicates whether the job is automatically cleaned after the model is solved.
If not set to True, the model stays on the DOcloud server and is visible from its DropSolve interface.
Note that the server may block future solving requests if there are too many jobs waiting.</dd>
</dl>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Creating a constraint programming model</a><ul>
<li><a class="reference internal" href="#build-model-expressions">Build model expressions</a><ul>
<li><a class="reference internal" href="#special-function-renaming">Special function renaming</a></li>
<li><a class="reference internal" href="#operator-overloading">Operator overloading</a></li>
</ul>
</li>
<li><a class="reference internal" href="#build-a-model">Build a model</a><ul>
<li><a class="reference internal" href="#import-necessary-modules">Import necessary modules</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#solving-a-model">Solving a model</a><ul>
<li><a class="reference internal" href="#solve-a-model-with-docloud">Solve a model with DOcloud</a><ul>
<li><a class="reference internal" href="#solving-options">Solving options</a></li>
<li><a class="reference internal" href="#solving-parameters">Solving parameters</a></li>
</ul>
</li>
<li><a class="reference internal" href="#retrieve-results">Retrieve results</a></li>
</ul>
</li>
<li><a class="reference internal" href="#other-features">Other features</a><ul>
<li><a class="reference internal" href="#generate-cpo-file">Generate CPO file</a><ul>
<li><a class="reference internal" href="#generation-options">Generation options</a></li>
<li><a class="reference internal" href="#get-the-cp-optimizer-model-as-a-string">Get the CP Optimizer model as a string</a></li>
</ul>
</li>
<li><a class="reference internal" href="#advanced-configuration">Advanced configuration</a><ul>
<li><a class="reference internal" href="#api-configuration">API configuration</a></li>
<li><a class="reference internal" href="#change-the-default-configuration">Change the default configuration</a></li>
<li><a class="reference internal" href="#display-current-configuration">Display current configuration</a></li>
<li><a class="reference internal" href="#default-configuration-attributes">Default configuration attributes</a><ul>
<li><a class="reference internal" href="#general-parameters">General parameters</a></li>
<li><a class="reference internal" href="#configuration-of-the-model-solving">Configuration of the model solving</a></li>
<li><a class="reference internal" href="#configuration-of-the-docloud-solving-agent">Configuration of the <cite>docloud</cite> solving agent</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="getting_started.html"
                        title="previous chapter">Getting started with constraint programming in DOcplex</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="samples.html"
                        title="next chapter">Examples of constraint programming</a></p>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="samples.html" title="Examples of constraint programming"
             >next</a> |</li>
        <li class="right" >
          <a href="getting_started.html" title="Getting started with constraint programming in DOcplex"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">DOcplex.CP: Constraint Programming Modeling for Python V1.0 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2016, IBM.
    </div>
  </body>
</html>