

<!doctype html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
    <title>docplex.cp.expression &#8212; DOcplex.CP: Constraint Programming Modeling for Python V2.18 documentation</title>
    <link rel="stylesheet" href="../../../_static/bizstyle.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../_static/language_data.js"></script>
    <script type="text/javascript" src="../../../_static/bizstyle.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <!--[if lt IE 9]>
    <script type="text/javascript" src="_static/css3-mediaqueries.js"></script>
    <![endif]-->
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">DOcplex.CP: Constraint Programming Modeling for Python V2.18 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for docplex.cp.expression</h1><div class="highlight"><pre>
<span></span><span class="c1"># --------------------------------------------------------------------------</span>
<span class="c1"># Source file provided under Apache License, Version 2.0, January 2004,</span>
<span class="c1"># http://www.apache.org/licenses/</span>
<span class="c1"># (c) Copyright IBM Corp. 2015, 2016, 2017, 2018</span>
<span class="c1"># --------------------------------------------------------------------------</span>
<span class="c1"># Author: Olivier OUDOT, IBM Analytics, France Lab, Sophia-Antipolis</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">This module contains the basic classes representing the expressions required to</span>
<span class="sd">describe a constraint programming model.</span>

<span class="sd">In particular, it defines the following classes:</span>

<span class="sd"> * :class:`CpoExpr`: the root class of each model expression node,</span>
<span class="sd"> * :class:`CpoIntVar`: representation of an integer variable,</span>
<span class="sd"> * :class:`CpoIntervalVar`: representation of an interval variable,</span>
<span class="sd"> * :class:`CpoSequenceVar`: representation of a sequence variable,</span>
<span class="sd"> * :class:`CpoTransitionMatrix`: representation of a transition matrix,</span>
<span class="sd"> * :class:`CpoStateFunction`: representation of a state function.</span>

<span class="sd">**None of these classes should be created explicitly.**</span>
<span class="sd">There are various factory functions to do so, such as:</span>

<span class="sd"> * :meth:`integer_var`, :meth:`integer_var_list`, :meth:`integer_var_dict` to create integer variable(s),</span>
<span class="sd"> * :meth:`binary_var`, :meth:`binary_var_list`, :meth:`binary_var_dict` to create integer variable(s) with value in [0..1],</span>
<span class="sd"> * :meth:`interval_var`, :meth:`interval_var_list`, :meth:`interval_var_dict` to create interval variable(s),</span>
<span class="sd"> * :meth:`sequence_var` to create a sequence variable,</span>
<span class="sd"> * :meth:`transition_matrix` to create a transition matrix,</span>
<span class="sd"> * :meth:`tuple_set` to create a tuple set,</span>
<span class="sd"> * :meth:`state_function` to create a state function.</span>

<span class="sd">Moreover, some automatic conversions are also provided to generate CP Optimizer objects from Python objects.</span>
<span class="sd">For example:</span>

<span class="sd"> * an integer is converted into CP constant,</span>
<span class="sd"> * an iterator of objects is converted in CP array of objects of the corresponding type,</span>
<span class="sd"> * a tuple of tuples is converted into tuple set.</span>


<span class="sd">Detailed description</span>
<span class="sd">--------------------</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">docplex.cp.utils</span> <span class="k">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">docplex.cp.catalog</span> <span class="k">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">docplex.cp.config</span> <span class="k">import</span> <span class="n">context</span>

<span class="kn">import</span> <span class="nn">threading</span>
<span class="kn">import</span> <span class="nn">warnings</span>


<span class="c1">#==============================================================================</span>
<span class="c1"># Constants</span>
<span class="c1">#==============================================================================</span>

<span class="n">INT_MAX</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="mi">53</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># (2^53 - 1) for 64 bits, (2^31 - 1) for 32 bits</span>
<span class="sd">&quot;&quot;&quot; Maximum integer value. &quot;&quot;&quot;</span>

<span class="n">INT_MIN</span> <span class="o">=</span> <span class="o">-</span><span class="n">INT_MAX</span>
<span class="sd">&quot;&quot;&quot; Minimum integer value. &quot;&quot;&quot;</span>

<span class="n">DEFAULT_INTEGER_VARIABLE_DOMAIN</span> <span class="o">=</span> <span class="p">((</span><span class="n">INT_MIN</span><span class="p">,</span> <span class="n">INT_MAX</span><span class="p">),)</span>
<span class="sd">&quot;&quot;&quot; Default integer variable domain &quot;&quot;&quot;</span>

<span class="c1"># Domain for binary variables</span>
<span class="n">BINARY_DOMAIN</span> <span class="o">=</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),)</span>

<span class="c1"># Floating point precision to verify equality of floats</span>
<span class="n">_FLOATING_POINT_PRECISION</span> <span class="o">=</span> <span class="mf">1e-9</span>


<span class="c1">#==============================================================================</span>
<span class="c1"># Utility classes</span>
<span class="c1">#==============================================================================</span>

<div class="viewcode-block" id="IntegerDomain"><a class="viewcode-back" href="../../../docplex.cp.expression.py.html#docplex.cp.expression.IntegerDomain">[docs]</a><span class="k">class</span> <span class="nc">IntegerDomain</span><span class="p">(</span><span class="nb">tuple</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Class representing the domain of an integer variable.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Do not implement constructor, not supported in Python 3 (not investigated)</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Build a string representing this domain, using mathematical convention &quot;&quot;&quot;</span>
        <span class="c1"># Check fixed domain</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">cout</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;{&quot;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">cout</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;, &quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
                <span class="n">cout</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;..&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cout</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">d</span><span class="p">))</span>
        <span class="n">cout</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;}&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="sa">u</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cout</span><span class="p">)</span></div>


<span class="c1">#==============================================================================</span>
<span class="c1"># Public expression classes</span>
<span class="c1">#==============================================================================</span>


<div class="viewcode-block" id="CpoExpr"><a class="viewcode-back" href="../../../docplex.cp.expression.py.html#docplex.cp.expression.CpoExpr">[docs]</a><span class="k">class</span> <span class="nc">CpoExpr</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; This class is an abstract class that represents any CPO expression node.</span>

<span class="sd">    It does not contain links to children expressions that are implemented in extending classes.</span>
<span class="sd">    However, method allowing to access to children is provided with default return value.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">,</span>             <span class="c1"># Expression result type</span>
                 <span class="s1">&#39;name&#39;</span><span class="p">,</span>             <span class="c1"># Name of the expression (None if none)</span>
                 <span class="s1">&#39;priority&#39;</span><span class="p">,</span>         <span class="c1"># Operation priority</span>
                 <span class="s1">&#39;children&#39;</span><span class="p">,</span>         <span class="c1"># List of children, empty tuple if none</span>
                <span class="p">)</span>

    <span class="c1"># To force possible numpy operators overloading to get CPO expressions as main operand</span>
    <span class="n">__array_priority__</span> <span class="o">=</span> <span class="mi">100</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">type</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Constructor:</span>

<span class="sd">        Args:</span>
<span class="sd">            type:   Expression type, object of class CpoType.</span>
<span class="sd">            name:   Expression name.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">CpoExpr</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">priority</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">children</span> <span class="o">=</span> <span class="p">()</span>


    <span class="k">def</span> <span class="nf">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Redefinition of hash function (mandatory for Python 3)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">/</span> <span class="mi">16</span><span class="p">)</span>


    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    # These functions are required with standard &#39;pickle&#39;</span>
<span class="sd">    # But DO NOT activate them with cloudpickle</span>
<span class="sd">    def __getstate__(self):</span>
<span class="sd">        &quot;&quot;&quot; Build a picklable object from this object</span>
<span class="sd">        &quot;&quot;&quot;</span>
<span class="sd">        return dict((k, getattr(self, k, None)) for k in self.__slots__)</span>

<span class="sd">    def __setstate__(self, data):</span>
<span class="sd">        &quot;&quot;&quot; Fill object from its pickle form</span>
<span class="sd">        &quot;&quot;&quot;</span>
<span class="sd">        for (k, v) in data.iteritems():</span>
<span class="sd">            setattr(self, k, v)</span>
<span class="sd">    &#39;&#39;&#39;</span>


<div class="viewcode-block" id="CpoExpr.set_name"><a class="viewcode-back" href="../../../docplex.cp.expression.py.html#docplex.cp.expression.CpoExpr.set_name">[docs]</a>    <span class="k">def</span> <span class="nf">set_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Set the name of the expression.</span>

<span class="sd">        This method returns this expression. It enables fluent calls such as: mdl.add((a + b == 1).set_name(&quot;myname&quot;))</span>

<span class="sd">        Args:</span>
<span class="sd">            name: Expression name, possibly None.</span>
<span class="sd">        Returns:</span>
<span class="sd">            This expression</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="p">(</span><span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="n">is_string</span><span class="p">(</span><span class="n">name</span><span class="p">),</span> <span class="s2">&quot;Argument &#39;name&#39; should be a string or None, not &#39;</span><span class="si">{}</span><span class="s2">&#39; of type </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">make_unicode</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="k">return</span> <span class="bp">self</span></div>


<div class="viewcode-block" id="CpoExpr.get_name"><a class="viewcode-back" href="../../../docplex.cp.expression.py.html#docplex.cp.expression.CpoExpr.get_name">[docs]</a>    <span class="k">def</span> <span class="nf">get_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Get the name of the expression.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Name of the expression, None if not defined</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span></div>


<div class="viewcode-block" id="CpoExpr.has_name"><a class="viewcode-back" href="../../../docplex.cp.expression.py.html#docplex.cp.expression.CpoExpr.has_name">[docs]</a>    <span class="k">def</span> <span class="nf">has_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Check if this expression has a name</span>

<span class="sd">        Returns:</span>
<span class="sd">            True if this expression has a name, False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="CpoExpr.is_type"><a class="viewcode-back" href="../../../docplex.cp.expression.py.html#docplex.cp.expression.CpoExpr.is_type">[docs]</a>    <span class="k">def</span> <span class="nf">is_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xtyp</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Check if the type of this expression is a given one</span>

<span class="sd">        Args:</span>
<span class="sd">            xtyp:  Expected type</span>
<span class="sd">        Returns:</span>
<span class="sd">            True if expression type is the expected one</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">xtyp</span></div>


<div class="viewcode-block" id="CpoExpr.is_kind_of"><a class="viewcode-back" href="../../../docplex.cp.expression.py.html#docplex.cp.expression.CpoExpr.is_kind_of">[docs]</a>    <span class="k">def</span> <span class="nf">is_kind_of</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tp</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Checks if the type of this expression type is compatible with another type.</span>

<span class="sd">        Args:</span>
<span class="sd">            tp: Other type to check.</span>
<span class="sd">        Returns:</span>
<span class="sd">           True if this expression type is a kind of tp.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Check if required type is the same</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">is_kind_of</span><span class="p">(</span><span class="n">tp</span><span class="p">)</span></div>


<div class="viewcode-block" id="CpoExpr.is_variable"><a class="viewcode-back" href="../../../docplex.cp.expression.py.html#docplex.cp.expression.CpoExpr.is_variable">[docs]</a>    <span class="k">def</span> <span class="nf">is_variable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Check if this expression is a variable</span>

<span class="sd">        Returns:</span>
<span class="sd">            True if this expression is a variable</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="CpoExpr.get_max_depth"><a class="viewcode-back" href="../../../docplex.cp.expression.py.html#docplex.cp.expression.CpoExpr.get_max_depth">[docs]</a>    <span class="k">def</span> <span class="nf">get_max_depth</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Gets the maximum expression depth.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Max expression depth.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">depth</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">stack</span> <span class="o">=</span> <span class="p">[[</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
        <span class="k">while</span> <span class="n">stack</span><span class="p">:</span>
            <span class="n">selem</span> <span class="o">=</span> <span class="n">stack</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">expr</span> <span class="o">=</span> <span class="n">selem</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">CpoExpr</span><span class="p">):</span>
                <span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">chlds</span> <span class="o">=</span> <span class="n">expr</span><span class="o">.</span><span class="n">children</span>
                <span class="n">cnx</span> <span class="o">=</span> <span class="n">selem</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">cnx</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">chlds</span><span class="p">):</span>
                    <span class="n">depth</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">depth</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">stack</span><span class="p">))</span>
                    <span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">selem</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">cnx</span>
                    <span class="n">stack</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">chlds</span><span class="p">[</span><span class="n">cnx</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">depth</span></div>


<div class="viewcode-block" id="CpoExpr.get_node_count"><a class="viewcode-back" href="../../../docplex.cp.expression.py.html#docplex.cp.expression.CpoExpr.get_node_count">[docs]</a>    <span class="k">def</span> <span class="nf">get_node_count</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Gets the total expression node count.</span>

<span class="sd">        Node count is the total number of function calls and atoms in this expression.</span>
<span class="sd">        If a sub-expression is present multiple times, it is counted only once.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Expression node count</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">get_node_count</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>


<div class="viewcode-block" id="CpoExpr.pretty_print"><a class="viewcode-back" href="../../../docplex.cp.expression.py.html#docplex.cp.expression.CpoExpr.pretty_print">[docs]</a>    <span class="k">def</span> <span class="nf">pretty_print</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mxdepth</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mxargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">adsize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">curdepth</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Pretty print expression in a way that shows its structure.</span>

<span class="sd">        Args:</span>
<span class="sd">            out:      (optional) Print output (stream or file name, None for stdout)</span>
<span class="sd">            mxdepth:  (optional) Max print depth. Default is None (no limit)</span>
<span class="sd">            mxargs:   (optional) Max number of function or array arguments. Default is None (no limit)</span>
<span class="sd">            adsize:   (optional) Add size of expressions in  nodes</span>
<span class="sd">            indent:   (optional) Indentation string</span>
<span class="sd">            curdepth: (internal) Current print depth</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pretty_print</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">mxdepth</span><span class="p">,</span> <span class="n">mxargs</span><span class="p">,</span> <span class="n">adsize</span><span class="p">,</span> <span class="n">indent</span><span class="p">,</span> <span class="n">curdepth</span><span class="p">)</span></div>


    <span class="k">def</span> <span class="nf">__nonzero__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Safe function to protect for use of CpoExpr as boolean.</span>

<span class="sd">        This may occur when using comparison operators that create a CpoExpr instead of actually compare with</span>
<span class="sd">        another expression.</span>

<span class="sd">        Raises:</span>
<span class="sd">            CpoException as CpoExpr should not be used as boolean.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="n">CpoException</span><span class="p">(</span><span class="s2">&quot;CPO expression can not be used as boolean.&quot;</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">__bool__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Safe function to protect for use of CpoExpr as boolean.</span>

<span class="sd">        This may occur when using comparison operators that create a CpoExpr instead of actually compare with</span>
<span class="sd">        another expression.</span>

<span class="sd">        Equivalent to __nonzero__ for Python 3</span>

<span class="sd">        Raises:</span>
<span class="sd">            CpoException as CpoExpr should not be used as boolean.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="n">CpoException</span><span class="p">(</span><span class="s2">&quot;CPO expression can not be used as boolean.&quot;</span><span class="p">)</span>


<div class="viewcode-block" id="CpoExpr.equals"><a class="viewcode-back" href="../../../docplex.cp.expression.py.html#docplex.cp.expression.CpoExpr.equals">[docs]</a>    <span class="k">def</span> <span class="nf">equals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Checks the equality of this expression with another object.</span>

<span class="sd">        Implementation is required with a different name than __eq__ name because this function is already</span>
<span class="sd">        overloaded to construct model expression with operator &#39;==&#39;.</span>

<span class="sd">        Args:</span>
<span class="sd">            other: Other object to compare with.</span>
<span class="sd">        Return:</span>
<span class="sd">            True if &#39;other&#39; is equal to this object, False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">_is_equal_expressions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span></div>


    <span class="k">def</span> <span class="nf">_equals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Checks the equality of this expression with another object.</span>

<span class="sd">        This particular method just checks local attributes, but does not check recursively children if any.</span>
<span class="sd">        Recursion is implemented by method equals() that uses a self-managed stack to avoid too many</span>
<span class="sd">        recursive calls that may lead to an exception &#39;RuntimeError: maximum recursion depth exceeded&#39;.</span>

<span class="sd">        Args:</span>
<span class="sd">            other: Other object to compare with.</span>
<span class="sd">        Return:</span>
<span class="sd">            True if &#39;other&#39; is equal to this object, False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">==</span> <span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">))</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">type</span><span class="p">)</span>


<div class="viewcode-block" id="CpoExpr.compare"><a class="viewcode-back" href="../../../docplex.cp.expression.py.html#docplex.cp.expression.CpoExpr.compare">[docs]</a>    <span class="k">def</span> <span class="nf">compare</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Compare this expression with another.</span>

<span class="sd">        Args:</span>
<span class="sd">            other: Other CpoExpr to compare with.</span>
<span class="sd">        Returns:</span>
<span class="sd">            integer &lt;0 if self &lt; other, 0 if self == other, &gt;0 if self &gt; other</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">type</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">id</span> <span class="o">-</span> <span class="n">other</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">id</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">id</span> <span class="o">-</span> <span class="n">other</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">id</span>
        <span class="n">sclen</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">)</span>
        <span class="n">oclen</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">children</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">sclen</span> <span class="o">!=</span> <span class="n">oclen</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">sclen</span> <span class="o">-</span> <span class="n">oclen</span>
        <span class="k">for</span> <span class="n">sc</span><span class="p">,</span> <span class="n">oc</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">children</span><span class="p">):</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">compare</span><span class="p">(</span><span class="n">oc</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">r</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">r</span>
        <span class="k">return</span> <span class="mi">0</span></div>


    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Convert this expression into a string &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">is_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">to_printable_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; = &quot;</span> <span class="o">+</span> <span class="n">_to_string</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">_to_string</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="c1"># Operators overloading</span>

    <span class="k">def</span> <span class="nf">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Not equal &quot;&quot;&quot;</span>
        <span class="n">other</span> <span class="o">=</span> <span class="n">build_cpo_expr</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_kind_of</span><span class="p">(</span><span class="n">Type_FloatExpr</span><span class="p">)</span> <span class="ow">and</span> <span class="n">other</span><span class="o">.</span><span class="n">is_kind_of</span><span class="p">(</span><span class="n">Type_FloatExpr</span><span class="p">),</span> <span class="s2">&quot;Operands of != should be integer or float expressions&quot;</span>
        <span class="k">return</span> <span class="n">CpoFunctionCall</span><span class="p">(</span><span class="n">Oper_diff</span><span class="p">,</span> <span class="n">Type_BoolExpr</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Equal &quot;&quot;&quot;</span>
        <span class="n">other</span> <span class="o">=</span> <span class="n">build_cpo_expr</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_kind_of</span><span class="p">(</span><span class="n">Type_FloatExpr</span><span class="p">)</span> <span class="ow">and</span> <span class="n">other</span><span class="o">.</span><span class="n">is_kind_of</span><span class="p">(</span><span class="n">Type_FloatExpr</span><span class="p">),</span> <span class="s2">&quot;Operands of == should be integer or float expressions&quot;</span>
        <span class="k">return</span> <span class="n">CpoFunctionCall</span><span class="p">(</span><span class="n">Oper_equal</span><span class="p">,</span> <span class="n">Type_BoolExpr</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__gt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Greater &quot;&quot;&quot;</span>
        <span class="n">other</span> <span class="o">=</span> <span class="n">build_cpo_expr</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_kind_of</span><span class="p">(</span><span class="n">Type_FloatExpr</span><span class="p">)</span> <span class="ow">and</span> <span class="n">other</span><span class="o">.</span><span class="n">is_kind_of</span><span class="p">(</span><span class="n">Type_FloatExpr</span><span class="p">),</span> <span class="s2">&quot;Operands of &gt; should be integer or float expressions&quot;</span>
        <span class="k">return</span> <span class="n">CpoFunctionCall</span><span class="p">(</span><span class="n">Oper_greater</span><span class="p">,</span> <span class="n">Type_BoolExpr</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__ge__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Greater or equal &quot;&quot;&quot;</span>
        <span class="n">other</span> <span class="o">=</span> <span class="n">build_cpo_expr</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_kind_of</span><span class="p">(</span><span class="n">Type_IntExpr</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">other</span><span class="o">.</span><span class="n">is_kind_of</span><span class="p">(</span><span class="n">Type_FloatExpr</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">CpoFunctionCall</span><span class="p">(</span><span class="n">Oper_greater_or_equal</span><span class="p">,</span> <span class="n">Type_BoolExpr</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">))</span>
            <span class="k">assert</span> <span class="n">other</span><span class="o">.</span><span class="n">is_kind_of</span><span class="p">(</span><span class="n">Type_CumulExpr</span><span class="p">),</span> <span class="s2">&quot;Operands of &gt;= should be integer, float or cumul expressions&quot;</span>
            <span class="k">return</span> <span class="n">CpoFunctionCall</span><span class="p">(</span><span class="n">Oper_greater_or_equal</span><span class="p">,</span> <span class="n">Type_Constraint</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_kind_of</span><span class="p">(</span><span class="n">Type_FloatExpr</span><span class="p">):</span>
            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_kind_of</span><span class="p">(</span><span class="n">Type_FloatExpr</span><span class="p">),</span> <span class="s2">&quot;Operands of &gt;= should be integer, float or cumul expressions&quot;</span>
            <span class="k">return</span> <span class="n">CpoFunctionCall</span><span class="p">(</span><span class="n">Oper_greater_or_equal</span><span class="p">,</span> <span class="n">Type_BoolExpr</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">))</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_kind_of</span><span class="p">(</span><span class="n">Type_CumulExpr</span><span class="p">)</span> <span class="ow">and</span> <span class="n">other</span><span class="o">.</span><span class="n">is_kind_of</span><span class="p">(</span><span class="n">Type_IntExpr</span><span class="p">),</span> <span class="s2">&quot;Operands of &gt;= should be integer, float or cumul expressions&quot;</span>
        <span class="k">return</span> <span class="n">CpoFunctionCall</span><span class="p">(</span><span class="n">Oper_greater_or_equal</span><span class="p">,</span> <span class="n">Type_Constraint</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Less &quot;&quot;&quot;</span>
        <span class="n">other</span> <span class="o">=</span> <span class="n">build_cpo_expr</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_kind_of</span><span class="p">(</span><span class="n">Type_FloatExpr</span><span class="p">)</span> <span class="ow">and</span> <span class="n">other</span><span class="o">.</span><span class="n">is_kind_of</span><span class="p">(</span><span class="n">Type_FloatExpr</span><span class="p">),</span> <span class="s2">&quot;Operands of &lt; should be integer or float expressions&quot;</span>
        <span class="k">return</span> <span class="n">CpoFunctionCall</span><span class="p">(</span><span class="n">Oper_less</span><span class="p">,</span> <span class="n">Type_BoolExpr</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__le__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Less or equal &quot;&quot;&quot;</span>
        <span class="n">other</span> <span class="o">=</span> <span class="n">build_cpo_expr</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_kind_of</span><span class="p">(</span><span class="n">Type_IntExpr</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">other</span><span class="o">.</span><span class="n">is_kind_of</span><span class="p">(</span><span class="n">Type_FloatExpr</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">CpoFunctionCall</span><span class="p">(</span><span class="n">Oper_less_or_equal</span><span class="p">,</span> <span class="n">Type_BoolExpr</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">))</span>
            <span class="k">assert</span> <span class="n">other</span><span class="o">.</span><span class="n">is_kind_of</span><span class="p">(</span><span class="n">Type_CumulExpr</span><span class="p">),</span> <span class="s2">&quot;Operands of &lt;= should be integer, float or cumul expressions&quot;</span>
            <span class="k">return</span> <span class="n">CpoFunctionCall</span><span class="p">(</span><span class="n">Oper_less_or_equal</span><span class="p">,</span> <span class="n">Type_Constraint</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_kind_of</span><span class="p">(</span><span class="n">Type_FloatExpr</span><span class="p">):</span>
            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_kind_of</span><span class="p">(</span><span class="n">Type_FloatExpr</span><span class="p">),</span> <span class="s2">&quot;Operands of &lt;= should be integer, float or cumul expressions&quot;</span>
            <span class="k">return</span> <span class="n">CpoFunctionCall</span><span class="p">(</span><span class="n">Oper_less_or_equal</span><span class="p">,</span> <span class="n">Type_BoolExpr</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">))</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_kind_of</span><span class="p">(</span><span class="n">Type_CumulExpr</span><span class="p">)</span> <span class="ow">and</span> <span class="n">other</span><span class="o">.</span><span class="n">is_kind_of</span><span class="p">(</span><span class="n">Type_IntExpr</span><span class="p">),</span> <span class="s2">&quot;Operands of &lt;= should be integer, float or cumul expressions&quot;</span>
        <span class="k">return</span> <span class="n">CpoFunctionCall</span><span class="p">(</span><span class="n">Oper_less_or_equal</span><span class="p">,</span> <span class="n">Type_Constraint</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Plus &quot;&quot;&quot;</span>
        <span class="n">other</span> <span class="o">=</span> <span class="n">build_cpo_expr</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="c1"># Check integer expression</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_kind_of</span><span class="p">(</span><span class="n">Type_IntExpr</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">other</span><span class="o">.</span><span class="n">is_kind_of</span><span class="p">(</span><span class="n">Type_IntExpr</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">CpoFunctionCall</span><span class="p">(</span><span class="n">Oper_plus</span><span class="p">,</span> <span class="n">Type_IntExpr</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">other</span><span class="o">.</span><span class="n">is_kind_of</span><span class="p">(</span><span class="n">Type_FloatExpr</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">CpoFunctionCall</span><span class="p">(</span><span class="n">Oper_plus</span><span class="p">,</span> <span class="n">Type_FloatExpr</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">))</span>
            <span class="c1"># Check special case for CumulExpr</span>
            <span class="k">if</span> <span class="n">other</span><span class="o">.</span><span class="n">is_kind_of</span><span class="p">(</span><span class="n">Type_CumulExpr</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="ow">is</span> <span class="n">CpoValue</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
                    <span class="k">return</span> <span class="n">other</span>
        <span class="c1"># Check float expression</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_kind_of</span><span class="p">(</span><span class="n">Type_FloatExpr</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">other</span><span class="o">.</span><span class="n">is_kind_of</span><span class="p">(</span><span class="n">Type_FloatExpr</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">CpoFunctionCall</span><span class="p">(</span><span class="n">Oper_plus</span><span class="p">,</span> <span class="n">Type_FloatExpr</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">))</span>
        <span class="c1"># Check cumul expressions</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_kind_of</span><span class="p">(</span><span class="n">Type_CumulExpr</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">other</span><span class="o">.</span><span class="n">is_kind_of</span><span class="p">(</span><span class="n">Type_CumulExpr</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">CpoFunctionCall</span><span class="p">(</span><span class="n">Oper_plus</span><span class="p">,</span> <span class="n">Type_CumulExpr</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">))</span>
            <span class="c1"># Check special value zero</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="ow">is</span> <span class="n">CpoValue</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">self</span>
        <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="s2">&quot;Operands of + should be integer, float or cumul expressions&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__radd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Plus (right) &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">build_cpo_expr</span><span class="p">(</span><span class="n">other</span><span class="p">)</span><span class="o">.</span><span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__pos__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Unary plus &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Minus &quot;&quot;&quot;</span>
        <span class="n">other</span> <span class="o">=</span> <span class="n">build_cpo_expr</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_kind_of</span><span class="p">(</span><span class="n">Type_IntExpr</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">other</span><span class="o">.</span><span class="n">is_kind_of</span><span class="p">(</span><span class="n">Type_IntExpr</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">CpoFunctionCall</span><span class="p">(</span><span class="n">Oper_minus</span><span class="p">,</span> <span class="n">Type_IntExpr</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">))</span>
            <span class="k">assert</span> <span class="n">other</span><span class="o">.</span><span class="n">is_kind_of</span><span class="p">(</span><span class="n">Type_FloatExpr</span><span class="p">),</span> <span class="s2">&quot;Operands of - should be integer, float or cumul&quot;</span>
            <span class="k">return</span> <span class="n">CpoFunctionCall</span><span class="p">(</span><span class="n">Oper_minus</span><span class="p">,</span> <span class="n">Type_FloatExpr</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">))</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_kind_of</span><span class="p">(</span><span class="n">Type_FloatExpr</span><span class="p">):</span>
            <span class="k">assert</span> <span class="n">other</span><span class="o">.</span><span class="n">is_kind_of</span><span class="p">(</span><span class="n">Type_FloatExpr</span><span class="p">),</span> <span class="s2">&quot;Operands of - should be integer, float or cumul&quot;</span>
            <span class="k">return</span> <span class="n">CpoFunctionCall</span><span class="p">(</span><span class="n">Oper_minus</span><span class="p">,</span> <span class="n">Type_FloatExpr</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">))</span>
        <span class="c1"># Cumul expressions</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_kind_of</span><span class="p">(</span><span class="n">Type_CumulExpr</span><span class="p">)</span> <span class="ow">and</span> <span class="n">other</span><span class="o">.</span><span class="n">is_kind_of</span><span class="p">(</span><span class="n">Type_CumulExpr</span><span class="p">),</span> <span class="s2">&quot;Operands of - should be integer, float or cumul&quot;</span>
        <span class="k">return</span> <span class="n">CpoFunctionCall</span><span class="p">(</span><span class="n">Oper_minus</span><span class="p">,</span> <span class="n">Type_CumulExpr</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__rsub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Minus (right) &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">build_cpo_expr</span><span class="p">(</span><span class="n">other</span><span class="p">)</span><span class="o">.</span><span class="fm">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__neg__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Unary minus &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_kind_of</span><span class="p">(</span><span class="n">Type_IntExpr</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">CpoFunctionCall</span><span class="p">(</span><span class="n">Oper_minus</span><span class="p">,</span> <span class="n">Type_IntExpr</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="p">,))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_kind_of</span><span class="p">(</span><span class="n">Type_FloatExpr</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">CpoFunctionCall</span><span class="p">(</span><span class="n">Oper_minus</span><span class="p">,</span> <span class="n">Type_FloatExpr</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="p">,))</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_kind_of</span><span class="p">(</span><span class="n">Type_CumulExpr</span><span class="p">),</span> <span class="s2">&quot;Operands of - should be integer, float or cumul&quot;</span>
        <span class="k">return</span> <span class="n">CpoFunctionCall</span><span class="p">(</span><span class="n">Oper_minus</span><span class="p">,</span> <span class="n">Type_CumulExpr</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="p">,))</span>

    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Multiply &quot;&quot;&quot;</span>
        <span class="n">other</span> <span class="o">=</span> <span class="n">build_cpo_expr</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_kind_of</span><span class="p">(</span><span class="n">Type_IntExpr</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">other</span><span class="o">.</span><span class="n">is_kind_of</span><span class="p">(</span><span class="n">Type_IntExpr</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">CpoFunctionCall</span><span class="p">(</span><span class="n">Oper_times</span><span class="p">,</span> <span class="n">Type_IntExpr</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">))</span>
            <span class="k">assert</span> <span class="n">other</span><span class="o">.</span><span class="n">is_kind_of</span><span class="p">(</span><span class="n">Type_FloatExpr</span><span class="p">),</span> <span class="s2">&quot;Operands of * should be integer or float&quot;</span>
            <span class="k">return</span> <span class="n">CpoFunctionCall</span><span class="p">(</span><span class="n">Oper_times</span><span class="p">,</span> <span class="n">Type_FloatExpr</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">))</span>
        <span class="k">assert</span> <span class="n">other</span><span class="o">.</span><span class="n">is_kind_of</span><span class="p">(</span><span class="n">Type_FloatExpr</span><span class="p">),</span> <span class="s2">&quot;Operands of * should be integer or float&quot;</span>
        <span class="k">return</span> <span class="n">CpoFunctionCall</span><span class="p">(</span><span class="n">Oper_times</span><span class="p">,</span> <span class="n">Type_FloatExpr</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__rmul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Multiply (right) &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">build_cpo_expr</span><span class="p">(</span><span class="n">other</span><span class="p">)</span><span class="o">.</span><span class="fm">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__div__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Float divide &quot;&quot;&quot;</span>
        <span class="n">other</span> <span class="o">=</span> <span class="n">build_cpo_expr</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_kind_of</span><span class="p">(</span><span class="n">Type_FloatExpr</span><span class="p">)</span> <span class="ow">and</span> <span class="n">other</span><span class="o">.</span><span class="n">is_kind_of</span><span class="p">(</span><span class="n">Type_FloatExpr</span><span class="p">),</span> <span class="s2">&quot;Operands of / should be float or integer expressions&quot;</span>
        <span class="k">return</span> <span class="n">CpoFunctionCall</span><span class="p">(</span><span class="n">Oper_float_div</span><span class="p">,</span> <span class="n">Type_FloatExpr</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__rdiv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Float divide (right) &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">build_cpo_expr</span><span class="p">(</span><span class="n">other</span><span class="p">)</span><span class="o">.</span><span class="n">__div__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__truediv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Float divide (Python 3) &quot;&quot;&quot;</span>
        <span class="n">other</span> <span class="o">=</span> <span class="n">build_cpo_expr</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_kind_of</span><span class="p">(</span><span class="n">Type_FloatExpr</span><span class="p">)</span> <span class="ow">and</span> <span class="n">other</span><span class="o">.</span><span class="n">is_kind_of</span><span class="p">(</span><span class="n">Type_FloatExpr</span><span class="p">),</span> <span class="s2">&quot;Operands of / should be float or integer expressions&quot;</span>
        <span class="k">return</span> <span class="n">CpoFunctionCall</span><span class="p">(</span><span class="n">Oper_float_div</span><span class="p">,</span> <span class="n">Type_FloatExpr</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__rtruediv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Float divide (right) (Python 3) &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">build_cpo_expr</span><span class="p">(</span><span class="n">other</span><span class="p">)</span><span class="o">.</span><span class="fm">__truediv__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__floordiv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Integer divide (Python 3) &quot;&quot;&quot;</span>
        <span class="n">other</span> <span class="o">=</span> <span class="n">build_cpo_expr</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_kind_of</span><span class="p">(</span><span class="n">Type_IntExpr</span><span class="p">)</span> <span class="ow">and</span> <span class="n">other</span><span class="o">.</span><span class="n">is_kind_of</span><span class="p">(</span><span class="n">Type_IntExpr</span><span class="p">),</span> <span class="s2">&quot;Operands of // should be integer expressions&quot;</span>
        <span class="k">return</span> <span class="n">CpoFunctionCall</span><span class="p">(</span><span class="n">Oper_int_div</span><span class="p">,</span> <span class="n">Type_IntExpr</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__rfloordiv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Integer divide (right) (Python 3) &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">build_cpo_expr</span><span class="p">(</span><span class="n">other</span><span class="p">)</span><span class="o">.</span><span class="fm">__floordiv__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__mod__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Modulo &quot;&quot;&quot;</span>
        <span class="n">other</span> <span class="o">=</span> <span class="n">build_cpo_expr</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_kind_of</span><span class="p">(</span><span class="n">Type_IntExpr</span><span class="p">)</span> <span class="ow">and</span> <span class="n">other</span><span class="o">.</span><span class="n">is_kind_of</span><span class="p">(</span><span class="n">Type_IntExpr</span><span class="p">),</span> <span class="s2">&quot;Operands of </span><span class="si">% s</span><span class="s2">hould be integer expressions&quot;</span>
        <span class="k">return</span> <span class="n">CpoFunctionCall</span><span class="p">(</span><span class="n">Oper_mod</span><span class="p">,</span> <span class="n">Type_IntExpr</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__rmod__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Power (right) &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">build_cpo_expr</span><span class="p">(</span><span class="n">other</span><span class="p">)</span><span class="o">.</span><span class="fm">__mod__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__pow__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Power &quot;&quot;&quot;</span>
        <span class="n">other</span> <span class="o">=</span> <span class="n">build_cpo_expr</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_kind_of</span><span class="p">(</span><span class="n">Type_FloatExpr</span><span class="p">)</span> <span class="ow">and</span> <span class="n">other</span><span class="o">.</span><span class="n">is_kind_of</span><span class="p">(</span><span class="n">Type_FloatExpr</span><span class="p">),</span> <span class="s2">&quot;Operands of ** (power) should be float expressions&quot;</span>
        <span class="k">return</span> <span class="n">CpoFunctionCall</span><span class="p">(</span><span class="n">Oper_power</span><span class="p">,</span> <span class="n">Type_FloatExpr</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__rpow__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Power (right) &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">build_cpo_expr</span><span class="p">(</span><span class="n">other</span><span class="p">)</span><span class="o">.</span><span class="fm">__pow__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__and__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Binary and used to represent logical and &quot;&quot;&quot;</span>
        <span class="c1"># if other is True:  # Do not use == because it is overloaded</span>
        <span class="c1">#     return self</span>
        <span class="c1"># if other is False:  # Do not use == because it is overloaded</span>
        <span class="c1">#     return False</span>
        <span class="n">other</span> <span class="o">=</span> <span class="n">build_cpo_expr</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_kind_of</span><span class="p">(</span><span class="n">Type_BoolExpr</span><span class="p">)</span> <span class="ow">and</span> <span class="n">other</span><span class="o">.</span><span class="n">is_kind_of</span><span class="p">(</span><span class="n">Type_BoolExpr</span><span class="p">),</span> <span class="s2">&quot;Operands of &amp; (logical and) should be boolean expressions&quot;</span>
        <span class="k">return</span> <span class="n">CpoFunctionCall</span><span class="p">(</span><span class="n">Oper_logical_and</span><span class="p">,</span> <span class="n">Type_BoolExpr</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__rand__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Binary and used to represent logical and (right) &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">build_cpo_expr</span><span class="p">(</span><span class="n">other</span><span class="p">)</span><span class="o">.</span><span class="fm">__and__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__or__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Binary or used to represent logical or &quot;&quot;&quot;</span>
        <span class="c1"># if other is False:  # Do not use == because it is overloaded</span>
        <span class="c1">#     return self</span>
        <span class="c1"># if other is True:  # Do not use == because it is overloaded</span>
        <span class="c1">#     return True</span>
        <span class="n">other</span> <span class="o">=</span> <span class="n">build_cpo_expr</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_kind_of</span><span class="p">(</span><span class="n">Type_BoolExpr</span><span class="p">)</span> <span class="ow">and</span> <span class="n">other</span><span class="o">.</span><span class="n">is_kind_of</span><span class="p">(</span><span class="n">Type_BoolExpr</span><span class="p">),</span> <span class="s2">&quot;Operands of | (logical or) should be boolean expressions&quot;</span>
        <span class="k">return</span> <span class="n">CpoFunctionCall</span><span class="p">(</span><span class="n">Oper_logical_or</span><span class="p">,</span> <span class="n">Type_BoolExpr</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__ror__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Binary or used to represent logical or (right) &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">build_cpo_expr</span><span class="p">(</span><span class="n">other</span><span class="p">)</span><span class="o">.</span><span class="fm">__or__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__invert__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Binary not used to represent logical not (right) &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_kind_of</span><span class="p">(</span><span class="n">Type_BoolExpr</span><span class="p">),</span> <span class="s2">&quot;Operands of ~ (logical not) should be a boolean expression&quot;</span>
        <span class="k">return</span> <span class="n">CpoFunctionCall</span><span class="p">(</span><span class="n">Oper_logical_not</span><span class="p">,</span> <span class="n">Type_BoolExpr</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="p">,))</span></div>



<div class="viewcode-block" id="CpoValue"><a class="viewcode-back" href="../../../docplex.cp.expression.py.html#docplex.cp.expression.CpoValue">[docs]</a><span class="k">class</span> <span class="nc">CpoValue</span><span class="p">(</span><span class="n">CpoExpr</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; CPO model expression representing a constant value. &quot;&quot;&quot;</span>
    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">,</span>  <span class="c1"># Python value of the constant</span>
                <span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="nb">type</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Constructor</span>

<span class="sd">        Args:</span>
<span class="sd">            value:  Constant value.</span>
<span class="sd">            type :  Value type.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">type</span><span class="p">,</span> <span class="n">CpoType</span><span class="p">),</span> <span class="s2">&quot;Argument &#39;type&#39; should be a CpoType&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">CpoValue</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="nb">type</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">type</span><span class="o">.</span><span class="n">is_array_of_expr</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">children</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">_equals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Checks the equality of this expression with another object.</span>

<span class="sd">        This particular method just checks local attributes, but does not check recursively children if any.</span>
<span class="sd">        Recursion is implemented by method equals() that uses a self-managed stack to avoid too many</span>
<span class="sd">        recursive calls that may lead to an exception &#39;RuntimeError: maximum recursion depth exceeded&#39;.</span>

<span class="sd">        Args:</span>
<span class="sd">            other: Other object to compare with.</span>
<span class="sd">        Returns:</span>
<span class="sd">            True if &#39;other&#39; is semantically identical to this object, False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Call super</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">super</span><span class="p">(</span><span class="n">CpoValue</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">_equals</span><span class="p">(</span><span class="n">other</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="c1"># For array of expr, already managed as a recursive call by _equals_expressions() called in super.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">is_array_of_expr</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="c1"># Check value</span>
        <span class="k">return</span> <span class="n">_is_equal_values</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">value</span><span class="p">)</span></div>


<div class="viewcode-block" id="CpoAlias"><a class="viewcode-back" href="../../../docplex.cp.expression.py.html#docplex.cp.expression.CpoAlias">[docs]</a><span class="k">class</span> <span class="nc">CpoAlias</span><span class="p">(</span><span class="n">CpoExpr</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; CPO model expression representing a symbolic alias on an expression. &quot;&quot;&quot;</span>
    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;expr&#39;</span><span class="p">,</span>  <span class="c1"># Target expression</span>
                <span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Constructor</span>

<span class="sd">        Args:</span>
<span class="sd">            expr:  Target expression</span>
<span class="sd">            name:  Name of the alias</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">CpoExpr</span><span class="p">),</span> <span class="s2">&quot;Argument &#39;expr&#39; must be a CpoExpr&quot;</span>
        <span class="k">assert</span> <span class="n">is_string</span><span class="p">(</span><span class="n">name</span><span class="p">),</span> <span class="s2">&quot;Argument &#39;name&#39; must be a string&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">CpoAlias</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">expr</span> <span class="o">=</span> <span class="n">expr</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">children</span> <span class="o">=</span> <span class="p">(</span><span class="n">expr</span><span class="p">,)</span></div>


<div class="viewcode-block" id="CpoFunctionCall"><a class="viewcode-back" href="../../../docplex.cp.expression.py.html#docplex.cp.expression.CpoFunctionCall">[docs]</a><span class="k">class</span> <span class="nc">CpoFunctionCall</span><span class="p">(</span><span class="n">CpoExpr</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; This class represent all model expression nodes that call a predefined modeler function.</span>

<span class="sd">    All modeling functions are available in module :mod:`docplex.cp.modeler`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;operation&#39;</span><span class="p">,</span>  <span class="c1"># Operation descriptor</span>
                <span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">oper</span><span class="p">,</span> <span class="n">rtype</span><span class="p">,</span> <span class="n">oprnds</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Constructor</span>
<span class="sd">        Args:</span>
<span class="sd">            oper:   Operation descriptor</span>
<span class="sd">            rtype:  Returned type</span>
<span class="sd">            oprnds: List of operand expressions.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">oper</span><span class="p">,</span> <span class="n">CpoOperation</span><span class="p">),</span> <span class="s2">&quot;Argument &#39;oper&#39; should be a CpoOperation&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">CpoFunctionCall</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">rtype</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">operation</span> <span class="o">=</span> <span class="n">oper</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">priority</span> <span class="o">=</span> <span class="n">oper</span><span class="o">.</span><span class="n">priority</span>

        <span class="c1"># Check no toplevel constraints</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">oprnds</span><span class="p">:</span>
            <span class="k">assert</span> <span class="ow">not</span> <span class="n">e</span><span class="o">.</span><span class="n">is_type</span><span class="p">(</span><span class="n">Type_Constraint</span><span class="p">),</span> <span class="s2">&quot;A constraint can not be operand of an expression.&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">children</span> <span class="o">=</span> <span class="n">oprnds</span>

    <span class="k">def</span> <span class="nf">_equals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Checks the equality of this expression with another object.</span>

<span class="sd">        This particular method just checks local attributes, but does not check recursively children if any.</span>
<span class="sd">        Recursion is implemented by method equals() that uses a self-managed stack to avoid too many</span>
<span class="sd">        recursive calls that may lead to an exception &#39;RuntimeError: maximum recursion depth exceeded&#39;.</span>

<span class="sd">        Args:</span>
<span class="sd">            other: Other object to compare with.</span>
<span class="sd">        Returns:</span>
<span class="sd">            True if &#39;other&#39; is semantically identical to this object, False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">CpoFunctionCall</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">_equals</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">operation</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">operation</span><span class="p">)</span></div>


<div class="viewcode-block" id="CpoVariable"><a class="viewcode-back" href="../../../docplex.cp.expression.py.html#docplex.cp.expression.CpoVariable">[docs]</a><span class="k">class</span> <span class="nc">CpoVariable</span><span class="p">(</span><span class="n">CpoExpr</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; This class is an abstract class extended by all expression nodes that represent a CPO variable.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">()</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">type</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Constructor:</span>

<span class="sd">        Args:</span>
<span class="sd">            type:   Expression type.</span>
<span class="sd">            name:   Variable name.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">CpoVariable</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="nb">type</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

<div class="viewcode-block" id="CpoVariable.is_variable"><a class="viewcode-back" href="../../../docplex.cp.expression.py.html#docplex.cp.expression.CpoVariable.is_variable">[docs]</a>    <span class="k">def</span> <span class="nf">is_variable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Check if this expression is a variable</span>

<span class="sd">        Returns:</span>
<span class="sd">            True if this expression is a variable</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">True</span></div></div>


<div class="viewcode-block" id="CpoIntVar"><a class="viewcode-back" href="../../../docplex.cp.expression.py.html#docplex.cp.expression.CpoIntVar">[docs]</a><span class="k">class</span> <span class="nc">CpoIntVar</span><span class="p">(</span><span class="n">CpoVariable</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; This class represents an *integer variable* that can be used in a CPO model.</span>

<span class="sd">    This object should not be created explicitly, but using one of the following factory method:</span>

<span class="sd">    * :meth:`integer_var`, :meth:`integer_var_list`, :meth:`integer_var_dict` to create integer variable(s),</span>
<span class="sd">    * :meth:`binary_var`, :meth:`binary_var_list`, :meth:`binary_var_dict` to create integer variable(s)</span>
<span class="sd">      with value in [0..1],</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;domain&#39;</span><span class="p">,</span>  <span class="c1"># Variable domain</span>
                 <span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dom</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1"># Private constructor</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">CpoIntVar</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">Type_IntVar</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">domain</span> <span class="o">=</span> <span class="n">dom</span>

<div class="viewcode-block" id="CpoIntVar.set_domain"><a class="viewcode-back" href="../../../docplex.cp.expression.py.html#docplex.cp.expression.CpoIntVar.set_domain">[docs]</a>    <span class="k">def</span> <span class="nf">set_domain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Sets the domain of the variable.</span>

<span class="sd">        The domain of the variable is a list or tuple of:</span>

<span class="sd">           * discrete integer values,</span>
<span class="sd">           * list or tuple of 2 integers representing an interval.</span>

<span class="sd">        For example, here are valid domain definitions:</span>

<span class="sd">           set_domain([1, 3, 4, 5, 9])</span>
<span class="sd">           set_domain([1, (3, 5), 9])</span>

<span class="sd">        Args:</span>
<span class="sd">            domain: List of integers or interval tuples representing the variable domain.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">domain</span> <span class="o">=</span> <span class="n">_build_int_var_domain</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">domain</span><span class="p">)</span></div>

<div class="viewcode-block" id="CpoIntVar.get_domain"><a class="viewcode-back" href="../../../docplex.cp.expression.py.html#docplex.cp.expression.CpoIntVar.get_domain">[docs]</a>    <span class="k">def</span> <span class="nf">get_domain</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Gets the domain of the variable.</span>

<span class="sd">        The domain of the variable can be:</span>

<span class="sd">         * A single integer value if the variable is fixed,</span>
<span class="sd">         * A list or a tuple of:</span>

<span class="sd">             - single integer values,</span>
<span class="sd">             - tuple of 2 integers representing an interval, bounds included</span>

<span class="sd">        Returns:</span>
<span class="sd">            Domain of the variable.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">domain</span></div>

<div class="viewcode-block" id="CpoIntVar.get_domain_min"><a class="viewcode-back" href="../../../docplex.cp.expression.py.html#docplex.cp.expression.CpoIntVar.get_domain_min">[docs]</a>    <span class="k">def</span> <span class="nf">get_domain_min</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Gets the domain lower bound.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Domain lower bound.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">_domain_min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">domain</span><span class="p">)</span></div>

<div class="viewcode-block" id="CpoIntVar.get_domain_max"><a class="viewcode-back" href="../../../docplex.cp.expression.py.html#docplex.cp.expression.CpoIntVar.get_domain_max">[docs]</a>    <span class="k">def</span> <span class="nf">get_domain_max</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Gets the domain upper bound.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Domain upper bound.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">_domain_max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">domain</span><span class="p">)</span></div>

<div class="viewcode-block" id="CpoIntVar.domain_iterator"><a class="viewcode-back" href="../../../docplex.cp.expression.py.html#docplex.cp.expression.CpoIntVar.domain_iterator">[docs]</a>    <span class="k">def</span> <span class="nf">domain_iterator</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Iterator on the individual values of an integer variable domain.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Value iterator on the domain of this variable.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">_domain_iterator</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">domain</span><span class="p">)</span></div>

<div class="viewcode-block" id="CpoIntVar.domain_contains"><a class="viewcode-back" href="../../../docplex.cp.expression.py.html#docplex.cp.expression.CpoIntVar.domain_contains">[docs]</a>    <span class="k">def</span> <span class="nf">domain_contains</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Check whether a given value is in the domain of the variable</span>

<span class="sd">        Args:</span>
<span class="sd">            val: Value to check</span>
<span class="sd">        Returns:</span>
<span class="sd">            True if the value is in the domain, False otherwise</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">_domain_contains</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">domain</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">lb</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; This property is used to get lower bound of the variable domain.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_domain_min</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">ub</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; This property is used to get upper bound of the variable domain.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_domain_max</span><span class="p">()</span>

<div class="viewcode-block" id="CpoIntVar.is_bool_var"><a class="viewcode-back" href="../../../docplex.cp.expression.py.html#docplex.cp.expression.CpoIntVar.is_bool_var">[docs]</a>    <span class="k">def</span> <span class="nf">is_bool_var</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Check if the domain of this variable is reduced to boolean, 0, 1</span>

<span class="sd">        Returns:</span>
<span class="sd">            True if this variable is a boolean variable</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">domain</span> <span class="o">==</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">domain</span> <span class="o">==</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),)</span></div>

<div class="viewcode-block" id="CpoIntVar.is_binary"><a class="viewcode-back" href="../../../docplex.cp.expression.py.html#docplex.cp.expression.CpoIntVar.is_binary">[docs]</a>    <span class="k">def</span> <span class="nf">is_binary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Check if the domain of this variable is reduced to boolean, 0, 1</span>

<span class="sd">        Returns:</span>
<span class="sd">            True if this variable is a boolean variable</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">domain</span> <span class="o">==</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">domain</span> <span class="o">==</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),)</span></div>

<div class="viewcode-block" id="CpoIntVar.equals"><a class="viewcode-back" href="../../../docplex.cp.expression.py.html#docplex.cp.expression.CpoIntVar.equals">[docs]</a>    <span class="k">def</span> <span class="nf">equals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Checks if this expression is equivalent to another</span>

<span class="sd">        Args:</span>
<span class="sd">            other: Other object to compare with.</span>
<span class="sd">        Return:</span>
<span class="sd">            True if &#39;other&#39; is semantically identical to this object, False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">CpoIntVar</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">domain</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">domain</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="CpoBoolVar"><a class="viewcode-back" href="../../../docplex.cp.expression.py.html#docplex.cp.expression.CpoBoolVar">[docs]</a><span class="k">class</span> <span class="nc">CpoBoolVar</span><span class="p">(</span><span class="n">CpoIntVar</span><span class="p">):</span>
    <span class="c1"># Currently internal</span>
    <span class="c1"># &quot;&quot;&quot; This class represents a *boolean variable* that can be used in a CPO model.</span>
    <span class="c1">#</span>
    <span class="c1"># This object should not be created explicitly, but using one of the following factory method:</span>
    <span class="c1">#</span>
    <span class="c1"># * :meth:`binary_var`, :meth:`binary_var_list`, :meth:`binary_var_dict` to create integer variable(s)</span>
    <span class="c1">#   with value in [0..1],</span>
    <span class="c1"># &quot;&quot;&quot;</span>
    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;domain&#39;</span><span class="p">,</span>  <span class="c1"># Variable domain</span>
                 <span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dom</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1"># Private constructor</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">CpoBoolVar</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">dom</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">Type_BoolVar</span>

<div class="viewcode-block" id="CpoBoolVar.is_bool_var"><a class="viewcode-back" href="../../../docplex.cp.expression.py.html#docplex.cp.expression.CpoBoolVar.is_bool_var">[docs]</a>    <span class="k">def</span> <span class="nf">is_bool_var</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Check if the domain of this variable is reduced to boolean, 0, 1</span>

<span class="sd">        Returns:</span>
<span class="sd">            True if this variable is a boolean variable</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="CpoBoolVar.is_binary"><a class="viewcode-back" href="../../../docplex.cp.expression.py.html#docplex.cp.expression.CpoBoolVar.is_binary">[docs]</a>    <span class="k">def</span> <span class="nf">is_binary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Check if the domain of this variable is reduced to boolean, 0, 1</span>

<span class="sd">        Returns:</span>
<span class="sd">            True if this variable is a boolean variable</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">True</span></div></div>


<div class="viewcode-block" id="CpoFloatVar"><a class="viewcode-back" href="../../../docplex.cp.expression.py.html#docplex.cp.expression.CpoFloatVar">[docs]</a><span class="k">class</span> <span class="nc">CpoFloatVar</span><span class="p">(</span><span class="n">CpoVariable</span><span class="p">):</span>
    <span class="c1"># &quot;&quot;&quot; This class represents a *float variable* that can be used in a CPO model.</span>
    <span class="c1"># &quot;&quot;&quot;</span>
    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;min&#39;</span><span class="p">,</span>  <span class="c1"># Domain min value</span>
                 <span class="s1">&#39;max&#39;</span><span class="p">,</span>  <span class="c1"># Domain max value</span>
                 <span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">min</span><span class="p">,</span> <span class="nb">max</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1"># Private constructor</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">CpoFloatVar</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">Type_FloatVar</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min</span> <span class="o">=</span> <span class="nb">min</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max</span> <span class="o">=</span> <span class="nb">max</span>


    <span class="k">def</span> <span class="nf">get_domain_min</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># &quot;&quot;&quot; Gets the domain lower bound.</span>
        <span class="c1">#</span>
        <span class="c1"># Returns:</span>
        <span class="c1">#     Domain lower bound.</span>
        <span class="c1"># &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">min</span>


    <span class="k">def</span> <span class="nf">get_domain_max</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># &quot;&quot;&quot; Gets the domain upper bound.</span>
        <span class="c1">#</span>
        <span class="c1"># Returns:</span>
        <span class="c1">#     Domain upper bound.</span>
        <span class="c1"># &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">max</span>


    <span class="k">def</span> <span class="nf">get_domain</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># &quot;&quot;&quot; Gets the variable domain as a tuple (min, max)</span>
        <span class="c1">#</span>
        <span class="c1"># Returns:</span>
        <span class="c1">#     Variable domain as a tuple (min, max)</span>
        <span class="c1"># &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">min</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max</span><span class="p">,)</span>


<div class="viewcode-block" id="CpoFloatVar.equals"><a class="viewcode-back" href="../../../docplex.cp.expression.py.html#docplex.cp.expression.CpoFloatVar.equals">[docs]</a>    <span class="k">def</span> <span class="nf">equals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="c1"># &quot;&quot;&quot; Checks if this expression is equivalent to another</span>
        <span class="c1">#</span>
        <span class="c1"># Args:</span>
        <span class="c1">#     other: Other object to compare with.</span>
        <span class="c1"># Return:</span>
        <span class="c1">#     True if &#39;other&#39; is semantically identical to this object, False otherwise.</span>
        <span class="c1"># &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">CpoFloatVar</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">min</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">min</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">max</span><span class="p">)</span></div></div>


<span class="c1">###############################################################################</span>
<span class="c1">## Scheduling expressions</span>
<span class="c1">###############################################################################</span>

<span class="n">INTERVAL_MAX</span> <span class="o">=</span> <span class="p">(</span><span class="n">INT_MAX</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
<span class="sd">&quot;&quot;&quot; Maximum interval variable range value &quot;&quot;&quot;</span>

<span class="n">INTERVAL_MIN</span> <span class="o">=</span> <span class="o">-</span><span class="n">INTERVAL_MAX</span>
<span class="sd">&quot;&quot;&quot; Minimum interval variable range value &quot;&quot;&quot;</span>

<span class="n">INFINITY</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">)</span>
<span class="sd">&quot;&quot;&quot; Infinity &quot;&quot;&quot;</span>

<span class="n">POSITIVE_INFINITY</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">)</span>
<span class="sd">&quot;&quot;&quot; Positive infinity &quot;&quot;&quot;</span>

<span class="n">NEGATIVE_INFINITY</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;-inf&#39;</span><span class="p">)</span>
<span class="sd">&quot;&quot;&quot; Negative infinity &quot;&quot;&quot;</span>

<span class="n">DEFAULT_INTERVAL</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">INTERVAL_MAX</span><span class="p">)</span>
<span class="sd">&quot;&quot;&quot; Default interval. &quot;&quot;&quot;</span>

<span class="c1"># Different interval variable presence states</span>
<span class="n">_PRES_PRESENT</span>   <span class="o">=</span> <span class="s2">&quot;present&quot;</span>   <span class="c1"># Always present</span>
<span class="n">_PRES_ABSENT</span>    <span class="o">=</span> <span class="s2">&quot;absent&quot;</span>    <span class="c1"># Always absent</span>
<span class="n">_PRES_OPTIONAL</span>  <span class="o">=</span> <span class="s2">&quot;optional&quot;</span>  <span class="c1"># Present or absent, choice made by the solver</span>


<div class="viewcode-block" id="CpoIntervalVar"><a class="viewcode-back" href="../../../docplex.cp.expression.py.html#docplex.cp.expression.CpoIntervalVar">[docs]</a><span class="k">class</span> <span class="nc">CpoIntervalVar</span><span class="p">(</span><span class="n">CpoVariable</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; This class represents an *interval variable* that can be used in a CPO model.</span>

<span class="sd">    This object should not be created explicitly, but using one of the following factory method</span>
<span class="sd">    :meth:`interval_var`, :meth:`interval_var_list`, or :meth:`interval_var_dict`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;start&#39;</span><span class="p">,</span>        <span class="c1"># Start domain</span>
                 <span class="s1">&#39;end&#39;</span><span class="p">,</span>          <span class="c1"># End domain</span>
                 <span class="s1">&#39;length&#39;</span><span class="p">,</span>       <span class="c1"># Length domain</span>
                 <span class="s1">&#39;size&#39;</span><span class="p">,</span>         <span class="c1"># Size domain</span>
                 <span class="s1">&#39;intensity&#39;</span><span class="p">,</span>    <span class="c1"># Specifies relation between size and length of the interval.</span>
                 <span class="s1">&#39;granularity&#39;</span><span class="p">,</span>  <span class="c1"># Scale of the intensity function (int)</span>
                 <span class="s1">&#39;presence&#39;</span><span class="p">,</span>     <span class="c1"># Presence requirement (in _PRES_*)</span>
                 <span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">intensity</span><span class="p">,</span> <span class="n">granularity</span><span class="p">,</span> <span class="n">presence</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1"># Private constructor</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">CpoIntervalVar</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">Type_IntervalVar</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start</span>   <span class="o">=</span> <span class="n">start</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end</span>     <span class="o">=</span> <span class="n">end</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">length</span>  <span class="o">=</span> <span class="n">length</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size</span>    <span class="o">=</span> <span class="n">size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">presence</span> <span class="o">=</span> <span class="n">presence</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">granularity</span> <span class="o">=</span> <span class="n">granularity</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">intensity</span> <span class="o">=</span> <span class="n">intensity</span>
        <span class="k">if</span> <span class="n">intensity</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">children</span> <span class="o">=</span> <span class="p">(</span><span class="n">intensity</span><span class="p">,)</span>

<div class="viewcode-block" id="CpoIntervalVar.set_start"><a class="viewcode-back" href="../../../docplex.cp.expression.py.html#docplex.cp.expression.CpoIntervalVar.set_start">[docs]</a>    <span class="k">def</span> <span class="nf">set_start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">intv</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Sets the start interval.</span>

<span class="sd">        Args:</span>
<span class="sd">            intv: Start of the interval (single integer or interval expressed as a tuple of 2 integers).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">_check_arg_interval</span><span class="p">(</span><span class="n">intv</span><span class="p">,</span> <span class="s2">&quot;intv&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="CpoIntervalVar.get_start"><a class="viewcode-back" href="../../../docplex.cp.expression.py.html#docplex.cp.expression.CpoIntervalVar.get_start">[docs]</a>    <span class="k">def</span> <span class="nf">get_start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Gets the start of the interval.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Start of the interval (interval expressed as a tuple of 2 integers).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span></div>

<div class="viewcode-block" id="CpoIntervalVar.set_start_min"><a class="viewcode-back" href="../../../docplex.cp.expression.py.html#docplex.cp.expression.CpoIntervalVar.set_start_min">[docs]</a>    <span class="k">def</span> <span class="nf">set_start_min</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mn</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Sets the minimum value of the start interval.</span>

<span class="sd">        Args:</span>
<span class="sd">            mn: Min value of the start of the interval.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="n">_is_cpo_interval_value</span><span class="p">(</span><span class="n">mn</span><span class="p">),</span> <span class="s2">&quot;Interval min should be an integer in [INTERVAL_MIN , INTERVAL_MAX]&quot;</span>
        <span class="k">assert</span> <span class="n">mn</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;Interval min should be lower or equal to interval max&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">=</span> <span class="p">(</span><span class="n">mn</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span></div>

<div class="viewcode-block" id="CpoIntervalVar.set_start_max"><a class="viewcode-back" href="../../../docplex.cp.expression.py.html#docplex.cp.expression.CpoIntervalVar.set_start_max">[docs]</a>    <span class="k">def</span> <span class="nf">set_start_max</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mx</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Sets the maximum value of the start interval.</span>

<span class="sd">        Args:</span>
<span class="sd">            mx: Max value of the start of the interval.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="n">_is_cpo_interval_value</span><span class="p">(</span><span class="n">mx</span><span class="p">),</span> <span class="s2">&quot;Interval max should be an integer in [INTERVAL_MIN , INTERVAL_MAX]&quot;</span>
        <span class="k">assert</span> <span class="n">mx</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;Interval max should be lower or equal to interval max&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">mx</span><span class="p">)</span></div>

<div class="viewcode-block" id="CpoIntervalVar.set_end"><a class="viewcode-back" href="../../../docplex.cp.expression.py.html#docplex.cp.expression.CpoIntervalVar.set_end">[docs]</a>    <span class="k">def</span> <span class="nf">set_end</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">intv</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Sets the end of the interval.</span>

<span class="sd">        Args:</span>
<span class="sd">            intv: End of the interval (single integer or interval expressed as a tuple of 2 integers).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end</span> <span class="o">=</span> <span class="n">_check_arg_interval</span><span class="p">(</span><span class="n">intv</span><span class="p">,</span> <span class="s2">&quot;intv&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="CpoIntervalVar.get_end"><a class="viewcode-back" href="../../../docplex.cp.expression.py.html#docplex.cp.expression.CpoIntervalVar.get_end">[docs]</a>    <span class="k">def</span> <span class="nf">get_end</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Gets the end of the interval.</span>

<span class="sd">        Returns:</span>
<span class="sd">            End of the interval (interval expressed as a tuple of 2 integers)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">end</span></div>

<div class="viewcode-block" id="CpoIntervalVar.set_end_min"><a class="viewcode-back" href="../../../docplex.cp.expression.py.html#docplex.cp.expression.CpoIntervalVar.set_end_min">[docs]</a>    <span class="k">def</span> <span class="nf">set_end_min</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mn</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Sets the minimum value of the end interval.</span>

<span class="sd">        Args:</span>
<span class="sd">            mn: Min value of the end of the interval.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="n">_is_cpo_interval_value</span><span class="p">(</span><span class="n">mn</span><span class="p">),</span> <span class="s2">&quot;Interval min should be an integer in [INTERVAL_MIN , INTERVAL_MAX]&quot;</span>
        <span class="k">assert</span> <span class="n">mn</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">end</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;Interval min should be lower or equal to interval max&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end</span> <span class="o">=</span> <span class="p">(</span><span class="n">mn</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">end</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span></div>

<div class="viewcode-block" id="CpoIntervalVar.set_end_max"><a class="viewcode-back" href="../../../docplex.cp.expression.py.html#docplex.cp.expression.CpoIntervalVar.set_end_max">[docs]</a>    <span class="k">def</span> <span class="nf">set_end_max</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mx</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Sets the maximum value of the end of the interval.</span>

<span class="sd">        Args:</span>
<span class="sd">            mx: Max value of the end of the interval.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="n">_is_cpo_interval_value</span><span class="p">(</span><span class="n">mx</span><span class="p">),</span> <span class="s2">&quot;Interval min should be an integer in [INTERVAL_MIN , INTERVAL_MAX]&quot;</span>
        <span class="k">assert</span> <span class="n">mx</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">end</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;Interval max should be lower or equal to interval max&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">end</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">mx</span><span class="p">)</span></div>

<div class="viewcode-block" id="CpoIntervalVar.set_length"><a class="viewcode-back" href="../../../docplex.cp.expression.py.html#docplex.cp.expression.CpoIntervalVar.set_length">[docs]</a>    <span class="k">def</span> <span class="nf">set_length</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">intv</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Sets the length interval.</span>

<span class="sd">        Args:</span>
<span class="sd">            intv: Length of the interval (single integer or interval expressed as a tuple of 2 integers).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">length</span> <span class="o">=</span> <span class="n">_check_arg_interval</span><span class="p">(</span><span class="n">intv</span><span class="p">,</span> <span class="s2">&quot;intv&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="CpoIntervalVar.get_length"><a class="viewcode-back" href="../../../docplex.cp.expression.py.html#docplex.cp.expression.CpoIntervalVar.get_length">[docs]</a>    <span class="k">def</span> <span class="nf">get_length</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Gets the length interval.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Length of the interval (interval expressed as a tuple of 2 integers).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span></div>

<div class="viewcode-block" id="CpoIntervalVar.set_length_min"><a class="viewcode-back" href="../../../docplex.cp.expression.py.html#docplex.cp.expression.CpoIntervalVar.set_length_min">[docs]</a>    <span class="k">def</span> <span class="nf">set_length_min</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mn</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Sets the minimum value of the length interval.</span>

<span class="sd">        Args:</span>
<span class="sd">            mn: Min value of the length of the interval min value.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="n">_is_cpo_interval_value</span><span class="p">(</span><span class="n">mn</span><span class="p">),</span> <span class="s2">&quot;Interval min should be an integer in [INTERVAL_MIN , INTERVAL_MAX]&quot;</span>
        <span class="k">assert</span> <span class="n">mn</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;Interval min should be lower or equal to interval max&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">length</span> <span class="o">=</span> <span class="p">(</span><span class="n">mn</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span></div>

<div class="viewcode-block" id="CpoIntervalVar.set_length_max"><a class="viewcode-back" href="../../../docplex.cp.expression.py.html#docplex.cp.expression.CpoIntervalVar.set_length_max">[docs]</a>    <span class="k">def</span> <span class="nf">set_length_max</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mx</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Sets the maximum value of the length interval.</span>

<span class="sd">        Args:</span>
<span class="sd">            mx: Max value of the length of the interval.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="n">_is_cpo_interval_value</span><span class="p">(</span><span class="n">mx</span><span class="p">),</span> <span class="s2">&quot;Interval max should be an integer in [INTERVAL_MIN , INTERVAL_MAX]&quot;</span>
        <span class="k">assert</span> <span class="n">mx</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;Interval max should be lower or equal to interval max&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">length</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">length</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">mx</span><span class="p">)</span></div>

<div class="viewcode-block" id="CpoIntervalVar.set_size"><a class="viewcode-back" href="../../../docplex.cp.expression.py.html#docplex.cp.expression.CpoIntervalVar.set_size">[docs]</a>    <span class="k">def</span> <span class="nf">set_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">intv</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Sets the size of the interval.</span>

<span class="sd">        Args:</span>
<span class="sd">            intv: Size of the interval (single integer or interval expressed as a tuple of 2 integers).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="n">_check_arg_interval</span><span class="p">(</span><span class="n">intv</span><span class="p">,</span> <span class="s2">&quot;intv&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="CpoIntervalVar.get_size"><a class="viewcode-back" href="../../../docplex.cp.expression.py.html#docplex.cp.expression.CpoIntervalVar.get_size">[docs]</a>    <span class="k">def</span> <span class="nf">get_size</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Gets the size of the interval.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Size of the interval (interval expressed as a tuple of 2 integers).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span></div>

<div class="viewcode-block" id="CpoIntervalVar.set_size_min"><a class="viewcode-back" href="../../../docplex.cp.expression.py.html#docplex.cp.expression.CpoIntervalVar.set_size_min">[docs]</a>    <span class="k">def</span> <span class="nf">set_size_min</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mn</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Sets the minimum value of the size interval.</span>

<span class="sd">        Args:</span>
<span class="sd">            mn: Min value of the size of the interval.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="n">_is_cpo_interval_value</span><span class="p">(</span><span class="n">mn</span><span class="p">),</span> <span class="s2">&quot;Interval min should be an integer in [INTERVAL_MIN , INTERVAL_MAX]&quot;</span>
        <span class="k">assert</span> <span class="n">mn</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;Interval min should be lower or equal to interval max&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="p">(</span><span class="n">mn</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span></div>

<div class="viewcode-block" id="CpoIntervalVar.set_size_max"><a class="viewcode-back" href="../../../docplex.cp.expression.py.html#docplex.cp.expression.CpoIntervalVar.set_size_max">[docs]</a>    <span class="k">def</span> <span class="nf">set_size_max</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mx</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Sets the maximum value of the size interval.</span>

<span class="sd">        Args:</span>
<span class="sd">            mx: Max value of the size of the interval.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="n">_is_cpo_interval_value</span><span class="p">(</span><span class="n">mx</span><span class="p">),</span> <span class="s2">&quot;Interval max should be an integer in [INTERVAL_MIN , INTERVAL_MAX]&quot;</span>
        <span class="k">assert</span> <span class="n">mx</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;Interval max should be lower or equal to interval max&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">mx</span><span class="p">)</span></div>

<div class="viewcode-block" id="CpoIntervalVar.set_present"><a class="viewcode-back" href="../../../docplex.cp.expression.py.html#docplex.cp.expression.CpoIntervalVar.set_present">[docs]</a>    <span class="k">def</span> <span class="nf">set_present</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Specifies that this IntervalVar must be present. &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">presence</span> <span class="o">=</span> <span class="n">_PRES_PRESENT</span></div>

<div class="viewcode-block" id="CpoIntervalVar.is_present"><a class="viewcode-back" href="../../../docplex.cp.expression.py.html#docplex.cp.expression.CpoIntervalVar.is_present">[docs]</a>    <span class="k">def</span> <span class="nf">is_present</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Check if this interval variable must be present.</span>

<span class="sd">        Returns:</span>
<span class="sd">            True if this interval variable must be present, False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">presence</span> <span class="o">==</span> <span class="n">_PRES_PRESENT</span></div>

<div class="viewcode-block" id="CpoIntervalVar.set_absent"><a class="viewcode-back" href="../../../docplex.cp.expression.py.html#docplex.cp.expression.CpoIntervalVar.set_absent">[docs]</a>    <span class="k">def</span> <span class="nf">set_absent</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Specifies that this interval variable must be absent. &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">presence</span> <span class="o">=</span> <span class="n">_PRES_ABSENT</span></div>

<div class="viewcode-block" id="CpoIntervalVar.is_absent"><a class="viewcode-back" href="../../../docplex.cp.expression.py.html#docplex.cp.expression.CpoIntervalVar.is_absent">[docs]</a>    <span class="k">def</span> <span class="nf">is_absent</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Check if this interval variable must be absent.</span>

<span class="sd">        Returns:</span>
<span class="sd">            True if this interval variable must be absent, False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">presence</span> <span class="o">==</span> <span class="n">_PRES_ABSENT</span></div>

<div class="viewcode-block" id="CpoIntervalVar.set_optional"><a class="viewcode-back" href="../../../docplex.cp.expression.py.html#docplex.cp.expression.CpoIntervalVar.set_optional">[docs]</a>    <span class="k">def</span> <span class="nf">set_optional</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Specifies that this interval variable is optional. &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">presence</span> <span class="o">=</span> <span class="n">_PRES_OPTIONAL</span></div>

<div class="viewcode-block" id="CpoIntervalVar.is_optional"><a class="viewcode-back" href="../../../docplex.cp.expression.py.html#docplex.cp.expression.CpoIntervalVar.is_optional">[docs]</a>    <span class="k">def</span> <span class="nf">is_optional</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Check if this interval variable is optional.</span>

<span class="sd">        Returns:</span>
<span class="sd">            True if this interval variable is optional, False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">presence</span> <span class="o">==</span> <span class="n">_PRES_OPTIONAL</span></div>

<div class="viewcode-block" id="CpoIntervalVar.set_intensity"><a class="viewcode-back" href="../../../docplex.cp.expression.py.html#docplex.cp.expression.CpoIntervalVar.set_intensity">[docs]</a>    <span class="k">def</span> <span class="nf">set_intensity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">intensity</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Sets the intensity function of this interval var.</span>

<span class="sd">        Args:</span>
<span class="sd">           intensity:  Intensity function (None, or StepFunction).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_check_arg_intensity</span><span class="p">(</span><span class="n">intensity</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">granularity</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">intensity</span> <span class="o">=</span> <span class="n">intensity</span>
        <span class="k">if</span> <span class="n">intensity</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">children</span> <span class="o">=</span> <span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">children</span> <span class="o">=</span> <span class="p">(</span><span class="n">intensity</span><span class="p">,)</span></div>

<div class="viewcode-block" id="CpoIntervalVar.get_intensity"><a class="viewcode-back" href="../../../docplex.cp.expression.py.html#docplex.cp.expression.CpoIntervalVar.get_intensity">[docs]</a>    <span class="k">def</span> <span class="nf">get_intensity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Gets the intensity function of this interval var.</span>

<span class="sd">        Returns:</span>
<span class="sd">           Intensity function (None, or StepFunction).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">intensity</span></div>

<div class="viewcode-block" id="CpoIntervalVar.set_granularity"><a class="viewcode-back" href="../../../docplex.cp.expression.py.html#docplex.cp.expression.CpoIntervalVar.set_granularity">[docs]</a>    <span class="k">def</span> <span class="nf">set_granularity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">granularity</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Sets the scale of the intensity function.</span>

<span class="sd">        Args:</span>
<span class="sd">            granularity: Scale of the intensity function (integer).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="p">(</span><span class="n">granularity</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">is_int</span><span class="p">(</span><span class="n">granularity</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">granularity</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)),</span> <span class="s2">&quot;Argument &#39;granularity&#39; should be None or positive integer&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">granularity</span> <span class="o">=</span> <span class="n">granularity</span> </div>

<div class="viewcode-block" id="CpoIntervalVar.get_granularity"><a class="viewcode-back" href="../../../docplex.cp.expression.py.html#docplex.cp.expression.CpoIntervalVar.get_granularity">[docs]</a>    <span class="k">def</span> <span class="nf">get_granularity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Get the scale of the intensity function.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Scale of the intensity function, None for default (100)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">granularity</span></div>

    <span class="k">def</span> <span class="nf">_equals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Checks the equality of this expression with another object.</span>

<span class="sd">        This particular method just checks local attributes, but does not check recursively children if any.</span>
<span class="sd">        Recursion is implemented by method equals() that uses a self-managed stack to avoid too many</span>
<span class="sd">        recursive calls that may lead to an exception &#39;RuntimeError: maximum recursion depth exceeded&#39;.</span>

<span class="sd">        Args:</span>
<span class="sd">            other: Other object to compare with.</span>
<span class="sd">        Returns:</span>
<span class="sd">            True if &#39;other&#39; is semantically identical to this object, False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Call super</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">super</span><span class="p">(</span><span class="n">CpoIntervalVar</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">_equals</span><span class="p">(</span><span class="n">other</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># Check same attributes (intensity processed as a children)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">start</span> <span class="ow">and</span> \
               <span class="bp">self</span><span class="o">.</span><span class="n">end</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">end</span> <span class="ow">and</span> \
               <span class="bp">self</span><span class="o">.</span><span class="n">length</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">length</span> <span class="ow">and</span> \
               <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">size</span> <span class="ow">and</span> \
               <span class="bp">self</span><span class="o">.</span><span class="n">granularity</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">granularity</span> <span class="ow">and</span> \
               <span class="bp">self</span><span class="o">.</span><span class="n">presence</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">presence</span></div>


<div class="viewcode-block" id="CpoSequenceVar"><a class="viewcode-back" href="../../../docplex.cp.expression.py.html#docplex.cp.expression.CpoSequenceVar">[docs]</a><span class="k">class</span> <span class="nc">CpoSequenceVar</span><span class="p">(</span><span class="n">CpoVariable</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; This class represents an *sequence variable* that can be used in a CPO model.</span>

<span class="sd">    Variables are stored in &#39;children&#39; attribute</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;types&#39;</span><span class="p">,</span>  <span class="c1"># Variable types</span>
                <span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">vars</span><span class="p">,</span> <span class="n">types</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Creates a new sequence variable.</span>

<span class="sd">        This method creates an instance of sequence variable on the set of interval variables defined</span>
<span class="sd">        by the array &#39;vars&#39;.</span>
<span class="sd">        A list of non-negative integer types can be optionally specified.</span>
<span class="sd">        List of variables and types must be of the same size and interval variable vars[i] will have type types[i]</span>
<span class="sd">        in the sequence variable.</span>

<span class="sd">        Args:</span>
<span class="sd">            vars:  List of IntervalVars that constitute the sequence.</span>
<span class="sd">            types: List of variable types as integers, same size as vars, or None (default).</span>
<span class="sd">            name:  Name of the sequence, None for automatic naming.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Check  arguments</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">vars</span><span class="p">,</span> <span class="n">CpoValue</span><span class="p">):</span>
            <span class="k">assert</span> <span class="nb">vars</span><span class="o">.</span><span class="n">is_kind_of</span><span class="p">(</span><span class="n">Type_IntervalVarArray</span><span class="p">)</span>
            <span class="nb">vars</span> <span class="o">=</span> <span class="nb">vars</span><span class="o">.</span><span class="n">value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">is_array_of_type</span><span class="p">(</span><span class="nb">vars</span><span class="p">,</span> <span class="n">CpoIntervalVar</span><span class="p">),</span> <span class="s2">&quot;Argument &#39;vars&#39; should be an array of CpoIntervalVar&quot;</span>
        <span class="k">if</span> <span class="n">types</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">types</span><span class="p">,</span> <span class="n">CpoValue</span><span class="p">):</span>
                <span class="k">assert</span> <span class="n">types</span><span class="o">.</span><span class="n">is_kind_of</span><span class="p">(</span><span class="n">Type_IntArray</span><span class="p">)</span>
                <span class="n">types</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">value</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">types</span> <span class="o">=</span> <span class="n">_check_and_expand_interval_tuples</span><span class="p">(</span><span class="s1">&#39;types&#39;</span><span class="p">,</span> <span class="n">types</span><span class="p">)</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">types</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="nb">vars</span><span class="p">),</span> <span class="s2">&quot;The array of types should have the same length than the array of variables.&quot;</span>
        <span class="c1"># Store attributes</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">CpoSequenceVar</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">Type_SequenceVar</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">children</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">vars</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">types</span> <span class="o">=</span> <span class="n">types</span>

<div class="viewcode-block" id="CpoSequenceVar.get_interval_variables"><a class="viewcode-back" href="../../../docplex.cp.expression.py.html#docplex.cp.expression.CpoSequenceVar.get_interval_variables">[docs]</a>    <span class="k">def</span> <span class="nf">get_interval_variables</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Gets the array of variables.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Array of interval variables that are in the sequence.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span></div>
    
<div class="viewcode-block" id="CpoSequenceVar.get_vars"><a class="viewcode-back" href="../../../docplex.cp.expression.py.html#docplex.cp.expression.CpoSequenceVar.get_vars">[docs]</a>    <span class="k">def</span> <span class="nf">get_vars</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Gets the array of variables in this sequence variable.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Array of interval variables</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span></div>
    
<div class="viewcode-block" id="CpoSequenceVar.get_types"><a class="viewcode-back" href="../../../docplex.cp.expression.py.html#docplex.cp.expression.CpoSequenceVar.get_types">[docs]</a>    <span class="k">def</span> <span class="nf">get_types</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Gets the array of types.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Array of variable types (array of integers), None if no type defined.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">types</span></div>

    <span class="k">def</span> <span class="nf">_equals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Checks the equality of this expression with another object.</span>

<span class="sd">        This particular method just checks local attributes, but does not check recursively children if any.</span>
<span class="sd">        Recursion is implemented by method equals() that uses a self-managed stack to avoid too many</span>
<span class="sd">        recursive calls that may lead to an exception &#39;RuntimeError: maximum recursion depth exceeded&#39;.</span>

<span class="sd">        Args:</span>
<span class="sd">            other: Other object to compare with.</span>
<span class="sd">        Returns:</span>
<span class="sd">            True if &#39;other&#39; is semantically identical to this object, False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Call super</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">super</span><span class="p">(</span><span class="n">CpoSequenceVar</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">_equals</span><span class="p">(</span><span class="n">other</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="c1"># Check equality of types</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">types</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">types</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="c1"># List of variables is processed as expression children</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Get the length of the sequence variable (number of variables) &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">)</span></div>


<div class="viewcode-block" id="CpoTransitionMatrix"><a class="viewcode-back" href="../../../docplex.cp.expression.py.html#docplex.cp.expression.CpoTransitionMatrix">[docs]</a><span class="k">class</span> <span class="nc">CpoTransitionMatrix</span><span class="p">(</span><span class="n">CpoValue</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; This class represents a *transition matrix* that is used in CPO model to represent transition distances.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">()</span>  <span class="c1"># Matrix stored in value field</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Creates a new transition matrix (square matrix of integers).</span>

<span class="sd">        A transition matrix is a square matrix of non-negative integers that represents a minimal distance between</span>
<span class="sd">        two interval variables.</span>
<span class="sd">        An instance of transition matrix can be used in the no_overlap constraint and in state functions.</span>

<span class="sd">          * In a no_overlap constraint the transition matrix represents the minimal distance between two</span>
<span class="sd">            non-overlapping interval variables.</span>
<span class="sd">            The matrix is indexed using the integer types of interval variables in the sequence variable</span>
<span class="sd">            of the no_overlap constraint.</span>

<span class="sd">          * In a state function, the transition matrix represents the minimal distance between two integer</span>
<span class="sd">            states of the function.</span>

<span class="sd">        A transition matrix can be created:</span>

<span class="sd">          * Deprecated.</span>
<span class="sd">            Giving only its size. In this case, a transition matrix is created by this constructor with all</span>
<span class="sd">            values initialized to zero. Matrix values can then be set using :meth:`set_value` method.</span>

<span class="sd">          * Giving the matrix values as a list of rows, each row being a list of integers.</span>
<span class="sd">            Matrix values can not be changed after it has been created.</span>

<span class="sd">        Args:</span>
<span class="sd">            size (optional):   Matrix size (width and height),</span>
<span class="sd">            name (optional):   Name of the matrix. None by default.</span>
<span class="sd">            values (optional): Matrix values expressed as a list of rows.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">CpoTransitionMatrix</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">Type_TransitionMatrix</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">name</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_name</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

        <span class="c1"># Check type of argument</span>
        <span class="k">if</span> <span class="n">size</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">is_int</span><span class="p">(</span><span class="n">size</span><span class="p">)</span> <span class="ow">and</span> <span class="n">size</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Argument &#39;size&#39; should be a positive integer.&quot;</span>
            <span class="k">assert</span> <span class="n">values</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;Arguments &#39;size&#39; and &#39;values&#39; should not be given together.&quot;</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Creating editable transition matrix by size is deprecated since release 2.3.&quot;</span><span class="p">,</span>
                          <span class="ne">DeprecationWarning</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">size</span><span class="p">)]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">size</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">values</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                <span class="k">assert</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;Argument &#39;values&#39; should be an iterable of iterables of integers.&quot;</span>
            <span class="n">size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
            <span class="k">assert</span> <span class="nb">all</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="n">size</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">),</span> \
                <span class="s2">&quot;Matrix value should be squared (list of rows of the same size)&quot;</span>
            <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span><span class="nb">all</span><span class="p">(</span><span class="n">is_int</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="ow">and</span> <span class="n">v</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">r</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">),</span> \
                <span class="s2">&quot;All matrix values should be positive integers&quot;</span>

<div class="viewcode-block" id="CpoTransitionMatrix.get_size"><a class="viewcode-back" href="../../../docplex.cp.expression.py.html#docplex.cp.expression.CpoTransitionMatrix.get_size">[docs]</a>    <span class="k">def</span> <span class="nf">get_size</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns the size of the matrix.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Matrix size.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span></div>

<div class="viewcode-block" id="CpoTransitionMatrix.get_value"><a class="viewcode-back" href="../../../docplex.cp.expression.py.html#docplex.cp.expression.CpoTransitionMatrix.get_value">[docs]</a>    <span class="k">def</span> <span class="nf">get_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">from_state</span><span class="p">,</span> <span class="n">to_state</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns a value in the transition matrix.</span>

<span class="sd">        Args:</span>
<span class="sd">            from_state: Index of the from state.</span>
<span class="sd">            to_state:   Index of the to state.</span>
<span class="sd">        Returns:</span>
<span class="sd">            Transition value.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="n">from_state</span><span class="p">][</span><span class="n">to_state</span><span class="p">]</span></div>

<div class="viewcode-block" id="CpoTransitionMatrix.get_all_values"><a class="viewcode-back" href="../../../docplex.cp.expression.py.html#docplex.cp.expression.CpoTransitionMatrix.get_all_values">[docs]</a>    <span class="k">def</span> <span class="nf">get_all_values</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns an iterator on all matrix values, in row/column order</span>

<span class="sd">        Returns:</span>
<span class="sd">            Iterator on all values</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sizerg</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="n">f</span><span class="p">][</span><span class="n">t</span><span class="p">]</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">sizerg</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">sizerg</span><span class="p">)</span></div>

<div class="viewcode-block" id="CpoTransitionMatrix.get_matrix"><a class="viewcode-back" href="../../../docplex.cp.expression.py.html#docplex.cp.expression.CpoTransitionMatrix.get_matrix">[docs]</a>    <span class="k">def</span> <span class="nf">get_matrix</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns the complete transition matrix.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Transition matrix as a list of integers that is the concatenation of all matrix rows.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span></div>

<div class="viewcode-block" id="CpoTransitionMatrix.set_value"><a class="viewcode-back" href="../../../docplex.cp.expression.py.html#docplex.cp.expression.CpoTransitionMatrix.set_value">[docs]</a>    <span class="k">def</span> <span class="nf">set_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">from_state</span><span class="p">,</span> <span class="n">to_state</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Sets a value in the transition matrix.</span>

<span class="sd">        Args:</span>
<span class="sd">            from_state: Index of the from state.</span>
<span class="sd">            to_state:   Index of the to state.</span>
<span class="sd">            value:      Transition value.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="n">is_int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="ow">and</span> <span class="n">value</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Value should be a positive integer&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="n">from_state</span><span class="p">][</span><span class="n">to_state</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span></div></div>


<div class="viewcode-block" id="CpoStateFunction"><a class="viewcode-back" href="../../../docplex.cp.expression.py.html#docplex.cp.expression.CpoStateFunction">[docs]</a><span class="k">class</span> <span class="nc">CpoStateFunction</span><span class="p">(</span><span class="n">CpoVariable</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; This class represents a *state function* expression node.</span>

<span class="sd">    State functions are used by *interval variables* to represent the evolution of a state variable over time.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;trmtx&#39;</span><span class="p">,</span>  <span class="c1"># Transition matrix</span>
                <span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trmtx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Creates a new state function.</span>

<span class="sd">        Args:</span>
<span class="sd">            trmtx (optional): An optional transition matrix defining the transition distance between consecutive states</span>
<span class="sd">                              of the state function.</span>
<span class="sd">                              Transition matrix is given as a list of rows (iterable of iterables of positive integers),</span>
<span class="sd">                              or as the result of a call to the method :meth:`~docplex.cp.expression.transition_matrix`.</span>
<span class="sd">            name (optional):   Name of the state function.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Force name for state functions</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">CpoStateFunction</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">Type_StateFunction</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_transition_matrix</span><span class="p">(</span><span class="n">trmtx</span><span class="p">)</span>

<div class="viewcode-block" id="CpoStateFunction.set_transition_matrix"><a class="viewcode-back" href="../../../docplex.cp.expression.py.html#docplex.cp.expression.CpoStateFunction.set_transition_matrix">[docs]</a>    <span class="k">def</span> <span class="nf">set_transition_matrix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trmtx</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Sets the transition matrix.</span>

<span class="sd">        Args:</span>
<span class="sd">        trmtx : A transition matrix defining the transition distance between consecutive states of the state function.</span>
<span class="sd">                Transition matrix is given as a list of rows (iterable of iterables of positive integers),</span>
<span class="sd">                or as the result of a call to the method :meth:`~docplex.cp.expression.transition_matrix`.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">trmtx</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">trmtx</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">children</span> <span class="o">=</span> <span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">trmtx</span> <span class="o">=</span>  <span class="n">build_cpo_transition_matrix</span><span class="p">(</span><span class="n">trmtx</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">trmtx</span> <span class="o">=</span> <span class="n">trmtx</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">trmtx</span><span class="p">,</span> <span class="n">CpoTransitionMatrix</span><span class="p">),</span> <span class="s2">&quot;Argument &#39;trmtx&#39; should be a CpoTransitionMatrix&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">children</span> <span class="o">=</span> <span class="p">(</span><span class="n">trmtx</span><span class="p">,)</span></div>

<div class="viewcode-block" id="CpoStateFunction.get_transition_matrix"><a class="viewcode-back" href="../../../docplex.cp.expression.py.html#docplex.cp.expression.CpoStateFunction.get_transition_matrix">[docs]</a>    <span class="k">def</span> <span class="nf">get_transition_matrix</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns the transition matrix.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Transition matrix, None if none.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">trmtx</span></div>

    <span class="k">def</span> <span class="nf">_equals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Checks the equality of this expression with another object.</span>

<span class="sd">        This particular method just checks local attributes, but does not check recursively children if any.</span>
<span class="sd">        Recursion is implemented by method equals() that uses a self-managed stack to avoid too many</span>
<span class="sd">        recursive calls that may lead to an exception &#39;RuntimeError: maximum recursion depth exceeded&#39;.</span>

<span class="sd">        Args:</span>
<span class="sd">            other: Other object to compare with.</span>
<span class="sd">        Returns:</span>
<span class="sd">            True if &#39;other&#39; is semantically identical to this object, False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">CpoStateFunction</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">_equals</span><span class="p">(</span><span class="n">other</span><span class="p">)</span></div>
        <span class="c1"># Transition matrix is checked as children</span>



<span class="c1">###############################################################################</span>
<span class="c1">## Factory Functions</span>
<span class="c1">###############################################################################</span>

<div class="viewcode-block" id="integer_var"><a class="viewcode-back" href="../../../docplex.cp.expression.py.html#docplex.cp.expression.integer_var">[docs]</a><span class="k">def</span> <span class="nf">integer_var</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Creates an integer variable.</span>

<span class="sd">    An integer variable is a decision variable with a set of potential values called &#39;domain of the variable&#39;.</span>
<span class="sd">    This domain can be expressed either:</span>

<span class="sd">     * as a single interval, with a minimum and a maximum bounds included in the domain,</span>
<span class="sd">     * or as an extensive list of values and/or intervals.</span>

<span class="sd">    When the domain is given extensively, an interval of the domain is represented by a tuple (min, max).</span>
<span class="sd">    Examples of variable domains expressed extensively are:</span>

<span class="sd">     * (1, 2, 3, 4)</span>
<span class="sd">     * (1, 2, (3, 7), 9)</span>
<span class="sd">     * ((1, 2), (7, 9))</span>

<span class="sd">    Following integer variable declarations are equivalent:</span>

<span class="sd">     * v = integer_var(0, 9, &quot;X&quot;)</span>
<span class="sd">     * v = integer_var(domain=(0, 1, 2, 3, 4, 5, 6, 7, 8, 9), name=&quot;X&quot;)</span>
<span class="sd">     * v = integer_var(domain=(0, (1, 5), (6, 7), 8, 9), name=&quot;X&quot;)</span>
<span class="sd">     * v = integer_var(domain=((0, 9)), name=&quot;X&quot;)</span>

<span class="sd">    Args:</span>
<span class="sd">        min:    Domain min value. Optional if domain is given extensively.</span>
<span class="sd">        max:    Domain max value. Optional if domain is given extensively.</span>
<span class="sd">        name:   Optional variable name. If not given, a name is automatically generated.</span>
<span class="sd">        domain: Variable domain expressed as extensive list of values and/or intervals expressed as tuples of integers.</span>
<span class="sd">                Unused if min and max are provided.</span>
<span class="sd">    Returns:</span>
<span class="sd">        CpoIntVar expression</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">CpoIntVar</span><span class="p">(</span><span class="n">_build_int_var_domain</span><span class="p">(</span><span class="nb">min</span><span class="p">,</span> <span class="nb">max</span><span class="p">,</span> <span class="n">domain</span><span class="p">),</span> <span class="n">name</span><span class="p">)</span></div>


<div class="viewcode-block" id="integer_var_list"><a class="viewcode-back" href="../../../docplex.cp.expression.py.html#docplex.cp.expression.integer_var_list">[docs]</a><span class="k">def</span> <span class="nf">integer_var_list</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Creates a list of integer variables.</span>

<span class="sd">    This methods creates a list of integer variables whose size is given as first parameter.</span>
<span class="sd">    All other parameters are identical to those requested by the method integer_var()</span>
<span class="sd">    that allows to create a single integer variable.</span>
<span class="sd">    See the documentation of :meth:`integer_var` for details.</span>

<span class="sd">    If a name is given, each variable of the list is created with this</span>
<span class="sd">    name concatenated with the index of the variable in the list, starting by zero.</span>

<span class="sd">    Args:</span>
<span class="sd">        size:   Size of the list of variables</span>
<span class="sd">        min:    Domain min value. Optional if domain is given extensively.</span>
<span class="sd">        max:    Domain max value. Optional if domain is given extensively.</span>
<span class="sd">        name:   Optional variable name prefix.</span>
<span class="sd">        domain: Variable domain expressed as extensive list of values and/or intervals expressed as tuples of integers.</span>
<span class="sd">                Unused if min and max are provided.</span>
<span class="sd">    Returns:</span>
<span class="sd">        List of integer variables.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dom</span> <span class="o">=</span> <span class="n">_build_int_var_domain</span><span class="p">(</span><span class="nb">min</span><span class="p">,</span> <span class="nb">max</span><span class="p">,</span> <span class="n">domain</span><span class="p">)</span>
    <span class="n">res</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">size</span><span class="p">):</span>
            <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">CpoIntVar</span><span class="p">(</span><span class="n">dom</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">size</span><span class="p">):</span>
            <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">CpoIntVar</span><span class="p">(</span><span class="n">dom</span><span class="p">,</span> <span class="n">name</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)))</span>
    <span class="k">return</span> <span class="n">res</span></div>


<div class="viewcode-block" id="integer_var_dict"><a class="viewcode-back" href="../../../docplex.cp.expression.py.html#docplex.cp.expression.integer_var_dict">[docs]</a><span class="k">def</span> <span class="nf">integer_var_dict</span><span class="p">(</span><span class="n">keys</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Creates a dictionary of integer variables.</span>

<span class="sd">    This methods creates a dictionary of integer variables associated to a list of keys given as first parameter.</span>
<span class="sd">    All other parameters are identical to those requested by the method integer_var()</span>
<span class="sd">    that allows to create a single integer variable.</span>
<span class="sd">    See the documentation of :meth:`integer_var` for details.</span>

<span class="sd">    If a name is given, each variable of the list is created with this</span>
<span class="sd">    name concatenated with the string representation of the corresponding key.</span>
<span class="sd">    The parameter &#39;name&#39; can also be a function that is called to build the variable name</span>
<span class="sd">    with the variable key as parameter.</span>

<span class="sd">    Args:</span>
<span class="sd">        keys:   Iterable of variable keys.</span>
<span class="sd">        min:    Domain min value. Optional if domain is given extensively.</span>
<span class="sd">        max:    Domain max value. Optional if domain is given extensively.</span>
<span class="sd">        name:   Optional variable name. If not given, a name is automatically generated.</span>
<span class="sd">        domain: Variable domain expressed as extensive list of values and/or intervals expressed as tuples of integers.</span>
<span class="sd">                Unused if min and max are provided.</span>
<span class="sd">    Returns:</span>
<span class="sd">        Dictionary of CpoIntVar objects.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dom</span> <span class="o">=</span> <span class="n">_build_int_var_domain</span><span class="p">(</span><span class="nb">min</span><span class="p">,</span> <span class="nb">max</span><span class="p">,</span> <span class="n">domain</span><span class="p">)</span>

    <span class="n">res</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
            <span class="n">res</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">CpoIntVar</span><span class="p">(</span><span class="n">dom</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">is_string</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">keys</span><span class="p">):</span>
            <span class="n">res</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">CpoIntVar</span><span class="p">(</span><span class="n">dom</span><span class="p">,</span> <span class="n">name</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
            <span class="n">res</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">CpoIntVar</span><span class="p">(</span><span class="n">dom</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">(</span><span class="n">k</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">res</span></div>


<div class="viewcode-block" id="binary_var"><a class="viewcode-back" href="../../../docplex.cp.expression.py.html#docplex.cp.expression.binary_var">[docs]</a><span class="k">def</span> <span class="nf">binary_var</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Creates a binary integer variable.</span>

<span class="sd">    An binary variable is an integer variable with domain limited to 0 and 1</span>

<span class="sd">    Args:</span>
<span class="sd">        name (optional): Variable name, default is None for automatic name.</span>
<span class="sd">    Returns:</span>
<span class="sd">        CpoIntVar expression</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">CpoIntVar</span><span class="p">(</span><span class="n">BINARY_DOMAIN</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span></div>


<div class="viewcode-block" id="binary_var_list"><a class="viewcode-back" href="../../../docplex.cp.expression.py.html#docplex.cp.expression.binary_var_list">[docs]</a><span class="k">def</span> <span class="nf">binary_var_list</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Creates a list of binary variables.</span>

<span class="sd">    This methods creates a list of binary variables.</span>

<span class="sd">    If a name is given, each variable of the list is created with this</span>
<span class="sd">    name concatenated with the index of the variable in the list, starting by zero.</span>

<span class="sd">    Args:</span>
<span class="sd">        size: Size of the list of variables</span>
<span class="sd">        name (optional): Variable name prefix. If not given, a name prefix is generated automatically.</span>
<span class="sd">    Returns:</span>
<span class="sd">        List of binary integer variables.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">integer_var_list</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">BINARY_DOMAIN</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span></div>


<div class="viewcode-block" id="binary_var_dict"><a class="viewcode-back" href="../../../docplex.cp.expression.py.html#docplex.cp.expression.binary_var_dict">[docs]</a><span class="k">def</span> <span class="nf">binary_var_dict</span><span class="p">(</span><span class="n">keys</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Creates a dictionary of binary variables.</span>

<span class="sd">    This methods creates a dictionary of binary variables associated to a list of keys given as first parameter.</span>

<span class="sd">    If a name is given, each variable of the list is created with this</span>
<span class="sd">    name concatenated with the string representation of the corresponding key.</span>
<span class="sd">    The parameter &#39;name&#39; can also be a function that is called to build the variable name</span>
<span class="sd">    with the variable key as parameter.</span>

<span class="sd">    Args:</span>
<span class="sd">        keys: Iterable of variable keys.</span>
<span class="sd">        name (optional): Variable name prefix, or function to be called on dictionary key (example: str).</span>
<span class="sd">                         If not given, a name prefix is generated automatically.</span>
<span class="sd">    Returns:</span>
<span class="sd">        Dictionary of CpoIntVar objects (OrderedDict).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">integer_var_dict</span><span class="p">(</span><span class="n">keys</span><span class="p">,</span> <span class="n">BINARY_DOMAIN</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span></div>


<div class="viewcode-block" id="interval_var"><a class="viewcode-back" href="../../../docplex.cp.expression.py.html#docplex.cp.expression.interval_var">[docs]</a><span class="k">def</span> <span class="nf">interval_var</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">intensity</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">granularity</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Creates an interval variable.</span>

<span class="sd">    An interval decision variable represents an unknown of a scheduling problem, in particular an interval of time</span>
<span class="sd">    during which something happens (an activity is carried out) whose position in time is unknown.</span>
<span class="sd">    An interval is characterized by a start value, an end value and a size.</span>
<span class="sd">    The start and end of an interval variable must be in [INTERVAL_MIN..INTERVAL_MAX].</span>
<span class="sd">    An important feature of interval decision variables is that they can be optional, that is, it is possible</span>
<span class="sd">    to model that an interval variable can be absent from the solution schedule.</span>

<span class="sd">    Sometimes the intensity of work is not the same during the whole interval.</span>
<span class="sd">    For example, consider a worker who does not work during weekends (his work intensity during weekends is 0%)</span>
<span class="sd">    and on Friday he works only for half a day (his intensity during Friday is 50%).</span>
<span class="sd">    For this worker, 7 man-days work will span for longer than just 7 days.</span>
<span class="sd">    In this example 7 man-days represent what is called the size of the interval: that is, the length of the</span>
<span class="sd">    interval would be if the intensity function was always at 100%.</span>
<span class="sd">    To model such situations, a range for the size of an interval variable and an integer stepwise intensity</span>
<span class="sd">    function can be specified.</span>
<span class="sd">    The length of the interval will be at least long enough to cover the work requirements</span>
<span class="sd">    given by the interval size, taking into account the intensity function.</span>

<span class="sd">    More information is available</span>
<span class="sd">    `here &lt;https://www.ibm.com/support/knowledgecenter/SSSA5P_12.10.0/ilog.odms.cplex.help/refcppcplex/html/interval_variables.html&gt;`__.</span>

<span class="sd">    Args:</span>
<span class="sd">        start (optional):       Allowed range for the start of the interval (single integer or interval expressed as a tuple of 2 integers).</span>
<span class="sd">                                Default value is [0..INTERVAL_MAX].</span>
<span class="sd">        end (optional):         Allowed range for the end the interval (single integer or interval expressed as a tuple of 2 integers).</span>
<span class="sd">                                Default value is [0..INTERVAL_MAX].</span>
<span class="sd">        length (optional):      Allowed range for the length the interval (single integer or interval expressed as a tuple of 2 integers).</span>
<span class="sd">                                Default value is [0..INTERVAL_MAX].</span>
<span class="sd">        size (optional):        Allowed range for the size the interval (single integer or interval expressed as a tuple of 2 integers).</span>
<span class="sd">                                Default value is [0..INTERVAL_MAX].</span>
<span class="sd">        intensity (optional):   StepFunction that specifies relation between size and length of the interval.</span>
<span class="sd">        granularity (optional): Scale of the intensity function.</span>
<span class="sd">        optional (optional):    Optional presence indicator.</span>
<span class="sd">        name (optional):        Name of the variable. If not given, a name is generated automatically.</span>
<span class="sd">    Returns:</span>
<span class="sd">        IntervalVar expression.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">start</span>  <span class="o">=</span> <span class="n">_check_arg_interval</span><span class="p">(</span><span class="n">start</span><span class="p">,</span>  <span class="s2">&quot;start&quot;</span><span class="p">)</span>
    <span class="n">end</span>    <span class="o">=</span> <span class="n">_check_arg_interval</span><span class="p">(</span><span class="n">end</span><span class="p">,</span>    <span class="s2">&quot;end&quot;</span><span class="p">)</span>
    <span class="n">length</span> <span class="o">=</span> <span class="n">_check_arg_interval</span><span class="p">(</span><span class="n">length</span><span class="p">,</span> <span class="s2">&quot;length&quot;</span><span class="p">)</span>
    <span class="n">size</span>   <span class="o">=</span> <span class="n">_check_arg_interval</span><span class="p">(</span><span class="n">size</span><span class="p">,</span>   <span class="s2">&quot;size&quot;</span><span class="p">)</span>
    <span class="n">_check_arg_intensity</span><span class="p">(</span><span class="n">intensity</span><span class="p">,</span> <span class="n">granularity</span><span class="p">)</span>
    <span class="c1">#presence = _PRES_OPTIONAL if (_check_arg_boolean(optional, &quot;optional&quot;) or not present) else _PRES_PRESENT</span>
    <span class="n">presence</span> <span class="o">=</span> <span class="n">_PRES_OPTIONAL</span> <span class="k">if</span> <span class="p">(</span><span class="n">_check_arg_boolean</span><span class="p">(</span><span class="n">optional</span><span class="p">,</span> <span class="s2">&quot;optional&quot;</span><span class="p">))</span> <span class="k">else</span> <span class="n">_PRES_PRESENT</span>
    <span class="k">return</span> <span class="n">CpoIntervalVar</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">intensity</span><span class="p">,</span> <span class="n">granularity</span><span class="p">,</span> <span class="n">presence</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span></div>


<div class="viewcode-block" id="interval_var_list"><a class="viewcode-back" href="../../../docplex.cp.expression.py.html#docplex.cp.expression.interval_var_list">[docs]</a><span class="k">def</span> <span class="nf">interval_var_list</span><span class="p">(</span><span class="n">asize</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">intensity</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">granularity</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Creates a list of interval variables.</span>

<span class="sd">    If a name is given, each variable of the array is created with this</span>
<span class="sd">    name concatenated with the index of the variable in the list.</span>

<span class="sd">    Args:</span>
<span class="sd">        asize:                  Size of the list of variables</span>
<span class="sd">        start (optional):       Allowed range for the start of the interval (single integer or interval expressed as a tuple of 2 integers).</span>
<span class="sd">                                Default value is [0..INTERVAL_MAX].</span>
<span class="sd">        end (optional):         Allowed range for the end the interval (single integer or interval expressed as a tuple of 2 integers).</span>
<span class="sd">                                Default value is [0..INTERVAL_MAX].</span>
<span class="sd">        length (optional):      Allowed range for the length the interval (single integer or interval expressed as a tuple of 2 integers).</span>
<span class="sd">                                Default value is [0..INTERVAL_MAX].</span>
<span class="sd">        size (optional):        Allowed range for the size the interval (single integer or interval expressed as a tuple of 2 integers).</span>
<span class="sd">                                Default value is [0..INTERVAL_MAX].</span>
<span class="sd">        intensity (optional):   StepFunction that specifies relation between size and length of the interval.</span>
<span class="sd">        granularity (optional): Scale of the intensity function.</span>
<span class="sd">        optional (optional):    Optional presence indicator.</span>
<span class="sd">        name (optional):        Name of the variable. If not given, a name is generated automatically.</span>
<span class="sd">    Returns:</span>
<span class="sd">        List of interval variables.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">start</span>  <span class="o">=</span> <span class="n">_check_arg_interval</span><span class="p">(</span><span class="n">start</span><span class="p">,</span>  <span class="s2">&quot;start&quot;</span><span class="p">)</span>
    <span class="n">end</span>    <span class="o">=</span> <span class="n">_check_arg_interval</span><span class="p">(</span><span class="n">end</span><span class="p">,</span>    <span class="s2">&quot;end&quot;</span><span class="p">)</span>
    <span class="n">length</span> <span class="o">=</span> <span class="n">_check_arg_interval</span><span class="p">(</span><span class="n">length</span><span class="p">,</span> <span class="s2">&quot;length&quot;</span><span class="p">)</span>
    <span class="n">size</span>   <span class="o">=</span> <span class="n">_check_arg_interval</span><span class="p">(</span><span class="n">size</span><span class="p">,</span>   <span class="s2">&quot;size&quot;</span><span class="p">)</span>
    <span class="n">_check_arg_intensity</span><span class="p">(</span><span class="n">intensity</span><span class="p">,</span> <span class="n">granularity</span><span class="p">)</span>
    <span class="n">presence</span> <span class="o">=</span> <span class="n">_PRES_OPTIONAL</span> <span class="k">if</span> <span class="p">(</span><span class="n">_check_arg_boolean</span><span class="p">(</span><span class="n">optional</span><span class="p">,</span> <span class="s2">&quot;optional&quot;</span><span class="p">))</span> <span class="k">else</span> <span class="n">_PRES_PRESENT</span>

    <span class="n">res</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">asize</span><span class="p">):</span>
            <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">CpoIntervalVar</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">intensity</span><span class="p">,</span> <span class="n">granularity</span><span class="p">,</span> <span class="n">presence</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">asize</span><span class="p">):</span>
            <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">CpoIntervalVar</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">intensity</span><span class="p">,</span> <span class="n">granularity</span><span class="p">,</span> <span class="n">presence</span><span class="p">,</span> <span class="n">name</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)))</span>
    <span class="k">return</span> <span class="n">res</span></div>


<div class="viewcode-block" id="interval_var_dict"><a class="viewcode-back" href="../../../docplex.cp.expression.py.html#docplex.cp.expression.interval_var_dict">[docs]</a><span class="k">def</span> <span class="nf">interval_var_dict</span><span class="p">(</span><span class="n">keys</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">intensity</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">granularity</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Creates a list of interval variables.</span>

<span class="sd">    If a name is given, each variable of the array is created with this</span>
<span class="sd">    name concatenated with the index of the variable in the list.</span>

<span class="sd">    Args:</span>
<span class="sd">        keys:                   Iterable of variable keys.</span>
<span class="sd">        start (optional):       Allowed range for the start of the interval (single integer or interval expressed as a tuple of 2 integers).</span>
<span class="sd">                                Default value is [0..INTERVAL_MAX].</span>
<span class="sd">        end (optional):         Allowed range for the end the interval (single integer or interval expressed as a tuple of 2 integers).</span>
<span class="sd">                                Default value is [0..INTERVAL_MAX].</span>
<span class="sd">        length (optional):      Allowed range for the length the interval (single integer or interval expressed as a tuple of 2 integers).</span>
<span class="sd">                                Default value is [0..INTERVAL_MAX].</span>
<span class="sd">        size (optional):        Allowed range for the size the interval (single integer or interval expressed as a tuple of 2 integers).</span>
<span class="sd">                                Default value is [0..INTERVAL_MAX].</span>
<span class="sd">        intensity (optional):   StepFunction that specifies relation between size and length of the interval.</span>
<span class="sd">        granularity (optional): Scale of the intensity function.</span>
<span class="sd">        optional (optional):    Optional presence indicator.</span>
<span class="sd">        name (optional):        Variable name prefix, or function to be called on dictionary key (example: str).</span>
<span class="sd">                                If not given, a name prefix is generated automatically.</span>
<span class="sd">    Returns:</span>
<span class="sd">        Dictionary of CpoIntervalVar objects.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">start</span>  <span class="o">=</span> <span class="n">_check_arg_interval</span><span class="p">(</span><span class="n">start</span><span class="p">,</span>  <span class="s2">&quot;start&quot;</span><span class="p">)</span>
    <span class="n">end</span>    <span class="o">=</span> <span class="n">_check_arg_interval</span><span class="p">(</span><span class="n">end</span><span class="p">,</span>    <span class="s2">&quot;end&quot;</span><span class="p">)</span>
    <span class="n">length</span> <span class="o">=</span> <span class="n">_check_arg_interval</span><span class="p">(</span><span class="n">length</span><span class="p">,</span> <span class="s2">&quot;length&quot;</span><span class="p">)</span>
    <span class="n">size</span>   <span class="o">=</span> <span class="n">_check_arg_interval</span><span class="p">(</span><span class="n">size</span><span class="p">,</span>   <span class="s2">&quot;size&quot;</span><span class="p">)</span>
    <span class="n">_check_arg_intensity</span><span class="p">(</span><span class="n">intensity</span><span class="p">,</span> <span class="n">granularity</span><span class="p">)</span>
    <span class="n">presence</span> <span class="o">=</span> <span class="n">_PRES_OPTIONAL</span> <span class="k">if</span> <span class="p">(</span><span class="n">_check_arg_boolean</span><span class="p">(</span><span class="n">optional</span><span class="p">,</span> <span class="s2">&quot;optional&quot;</span><span class="p">))</span> <span class="k">else</span> <span class="n">_PRES_PRESENT</span>

    <span class="n">res</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
            <span class="n">res</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">CpoIntervalVar</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">intensity</span><span class="p">,</span> <span class="n">granularity</span><span class="p">,</span> <span class="n">presence</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">is_string</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">keys</span><span class="p">):</span>
            <span class="n">res</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">CpoIntervalVar</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">intensity</span><span class="p">,</span> <span class="n">granularity</span><span class="p">,</span> <span class="n">presence</span><span class="p">,</span> <span class="n">name</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
            <span class="n">res</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">CpoIntervalVar</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">intensity</span><span class="p">,</span> <span class="n">granularity</span><span class="p">,</span> <span class="n">presence</span><span class="p">,</span> <span class="n">name</span><span class="p">(</span><span class="n">k</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">res</span></div>


<div class="viewcode-block" id="sequence_var"><a class="viewcode-back" href="../../../docplex.cp.expression.py.html#docplex.cp.expression.sequence_var">[docs]</a><span class="k">def</span> <span class="nf">sequence_var</span><span class="p">(</span><span class="nb">vars</span><span class="p">,</span> <span class="n">types</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Creates a new sequence variable (list of interval variables).</span>

<span class="sd">    This method creates an instance of sequence variable on the set of interval variables defined</span>
<span class="sd">    by the array &#39;vars&#39;.</span>
<span class="sd">    A list of non-negative integer types can be optionally  specified.</span>
<span class="sd">    List of variables and types must be of the same size and interval variable vars[i] will have type types[i]</span>
<span class="sd">    in the sequence variable.</span>

<span class="sd">    Args:</span>
<span class="sd">        vars:  List of IntervalVars that constitute the sequence.</span>
<span class="sd">        types: List of variable types as integers, same size as vars, or None (default).</span>
<span class="sd">        name:  Name of the sequence, None for automatic naming.</span>
<span class="sd">    Returns:</span>
<span class="sd">        IntervalVar expression.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">CpoSequenceVar</span><span class="p">(</span><span class="nb">vars</span><span class="p">,</span> <span class="n">types</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span></div>


<span class="k">def</span> <span class="nf">float_var</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="n">NEGATIVE_INFINITY</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="n">POSITIVE_INFINITY</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="c1"># &quot;&quot;&quot; Creates a float variable.</span>
    <span class="c1">#</span>
    <span class="c1"># Args:</span>
    <span class="c1">#     min:   (Optional) Domain min value. Default value is negative infinity.</span>
    <span class="c1">#     max:   (Optional) Domain max value. Default value is positive infinity.</span>
    <span class="c1">#     name:  (Optional) Name of the variable</span>
    <span class="c1"># Returns:</span>
    <span class="c1">#     CpoFloatVar expression</span>
    <span class="c1"># &quot;&quot;&quot;</span>
    <span class="c1"># Check arguments</span>
    <span class="k">assert</span> <span class="n">is_number</span><span class="p">(</span><span class="nb">min</span><span class="p">)</span> <span class="ow">and</span> <span class="n">is_number</span><span class="p">(</span><span class="nb">max</span><span class="p">),</span> <span class="s2">&quot;Float var bounds should be numbers&quot;</span>
    <span class="k">assert</span> <span class="nb">min</span> <span class="o">&lt;=</span> <span class="nb">max</span><span class="p">,</span> <span class="s2">&quot;Float var lower bound should be lower than upper bound&quot;</span>

    <span class="k">return</span> <span class="n">CpoFloatVar</span><span class="p">(</span><span class="nb">min</span><span class="p">,</span> <span class="nb">max</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">float_var_list</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="n">NEGATIVE_INFINITY</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="n">POSITIVE_INFINITY</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="c1"># &quot;&quot;&quot; Creates a list of float variables.</span>
    <span class="c1">#</span>
    <span class="c1"># This methods creates a list of float variables whose size is given as first parameter.</span>
    <span class="c1"># All other parameters are identical to those requested by the method float_var()</span>
    <span class="c1"># that allows to create a single float variable.</span>
    <span class="c1"># See the documentation of :meth:`float_var` for details.</span>
    <span class="c1">#</span>
    <span class="c1"># If a name is given, each variable of the list is created with this</span>
    <span class="c1"># name concatenated with the index of the variable in the list, starting by zero.</span>
    <span class="c1">#</span>
    <span class="c1"># Args:</span>
    <span class="c1">#     size:   Size of the list of variables</span>
    <span class="c1">#     min:    (Optional) Domain min value. Default value is negative infinity.</span>
    <span class="c1">#     max:    (Optional) Domain max value. Default value is positive infinity.</span>
    <span class="c1">#     name:   (Optional) variable name prefix.</span>
    <span class="c1"># Returns:</span>
    <span class="c1">#     List of float variables (CpoFloatVar objects).</span>
    <span class="c1"># &quot;&quot;&quot;</span>
    <span class="c1"># Check arguments</span>
    <span class="k">assert</span> <span class="n">is_number</span><span class="p">(</span><span class="nb">min</span><span class="p">)</span> <span class="ow">and</span> <span class="n">is_number</span><span class="p">(</span><span class="nb">max</span><span class="p">),</span> <span class="s2">&quot;Float var bounds should be numbers&quot;</span>
    <span class="k">assert</span> <span class="nb">min</span> <span class="o">&lt;=</span> <span class="nb">max</span><span class="p">,</span> <span class="s2">&quot;Float var lower bound should be lower than upper bound&quot;</span>

    <span class="n">res</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">size</span><span class="p">):</span>
            <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">CpoFloatVar</span><span class="p">(</span><span class="nb">min</span><span class="p">,</span> <span class="nb">max</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">size</span><span class="p">):</span>
            <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">CpoFloatVar</span><span class="p">(</span><span class="nb">min</span><span class="p">,</span> <span class="nb">max</span><span class="p">,</span> <span class="n">name</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)))</span>
    <span class="k">return</span> <span class="n">res</span>


<span class="k">def</span> <span class="nf">float_var_dict</span><span class="p">(</span><span class="n">keys</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="c1"># &quot;&quot;&quot; Creates a dictionary of float variables.</span>
    <span class="c1">#</span>
    <span class="c1"># This methods creates a dictionary of float variables associated to a list of keys given as first parameter.</span>
    <span class="c1"># All other parameters are identical to those requested by the method float_var()</span>
    <span class="c1"># that allows to create a single float variable.</span>
    <span class="c1"># See the documentation of :meth:`float_var` for details.</span>
    <span class="c1">#</span>
    <span class="c1"># If a name is given, each variable of the list is created with this</span>
    <span class="c1"># name concatenated with the string representation of the corresponding key.</span>
    <span class="c1"># The parameter &#39;name&#39; can also be a function that is called to build the variable name</span>
    <span class="c1"># with the variable key as parameter.</span>
    <span class="c1">#</span>
    <span class="c1"># Args:</span>
    <span class="c1">#     keys:   Iterable of variable keys.</span>
    <span class="c1">#     min:    Domain min value. Optional if domain is given extensively.</span>
    <span class="c1">#     max:    Domain max value. Optional if domain is given extensively.</span>
    <span class="c1">#     name:   Optional variable name. If not given, a name is automatically generated.</span>
    <span class="c1"># Returns:</span>
    <span class="c1">#     Dictionary of float variables (CpoFloatVar objects).</span>
    <span class="c1"># &quot;&quot;&quot;</span>
    <span class="c1"># Check arguments</span>
    <span class="k">assert</span> <span class="n">is_number</span><span class="p">(</span><span class="nb">min</span><span class="p">)</span> <span class="ow">and</span> <span class="n">is_number</span><span class="p">(</span><span class="nb">max</span><span class="p">),</span> <span class="s2">&quot;Float var bounds should be numbers&quot;</span>
    <span class="k">assert</span> <span class="nb">min</span> <span class="o">&lt;=</span> <span class="nb">max</span><span class="p">,</span> <span class="s2">&quot;Float var lower bound should be lower than upper bound&quot;</span>

    <span class="n">res</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
            <span class="n">res</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">CpoFloatVar</span><span class="p">(</span><span class="nb">min</span><span class="p">,</span> <span class="nb">max</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">is_string</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">keys</span><span class="p">):</span>
            <span class="n">res</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">CpoFloatVar</span><span class="p">(</span><span class="nb">min</span><span class="p">,</span> <span class="nb">max</span><span class="p">,</span> <span class="n">name</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
            <span class="n">res</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">CpoFloatVar</span><span class="p">(</span><span class="nb">min</span><span class="p">,</span> <span class="nb">max</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">(</span><span class="n">k</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">res</span>


<div class="viewcode-block" id="transition_matrix"><a class="viewcode-back" href="../../../docplex.cp.expression.py.html#docplex.cp.expression.transition_matrix">[docs]</a><span class="k">def</span> <span class="nf">transition_matrix</span><span class="p">(</span><span class="n">szvals</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Creates a new transition matrix (square matrix of integers).</span>

<span class="sd">    A transition matrix is a square matrix of non-negative integers that represents a minimal distance between</span>
<span class="sd">    two interval variables.</span>
<span class="sd">    An instance of transition matrix can be used in the no_overlap constraint and in state functions.</span>

<span class="sd">      * In a no_overlap constraint the transition matrix represents the minimal distance between two</span>
<span class="sd">        non-overlapping interval variables.</span>
<span class="sd">        The matrix is indexed using the integer types of interval variables in the sequence variable</span>
<span class="sd">        of the no_overlap constraint.</span>

<span class="sd">      * In a state function, the transition matrix represents the minimal distance between two integer</span>
<span class="sd">        states of the function.</span>

<span class="sd">    A transition matrix can be created:</span>

<span class="sd">      * Deprecated.</span>
<span class="sd">        Giving only its size. In this case, a transition matrix is created by this constructor with all</span>
<span class="sd">        values initialized to zero. Matrix values can then be set using :meth:`set_value` method.</span>

<span class="sd">      * Giving the matrix values as a list of rows, each row being a list of integers.</span>
<span class="sd">        Matrix values can not be changed after it has been created.</span>

<span class="sd">    Args:</span>
<span class="sd">        szvals:  Matrix values expressed as a list of rows (iterable of iterables of positive integers).</span>
<span class="sd">        name (optional):  Name of the matrix. None by default.</span>
<span class="sd">    Returns:</span>
<span class="sd">        TransitionMatrix expression.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Check build of editable matrix (deprecated)</span>
    <span class="k">if</span> <span class="n">is_int</span><span class="p">(</span><span class="n">szvals</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">CpoTransitionMatrix</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">szvals</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>

    <span class="c1"># Build matrix checking from cache</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">build_cpo_transition_matrix</span><span class="p">(</span><span class="n">szvals</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">name</span><span class="p">:</span>
        <span class="n">res</span><span class="o">.</span><span class="n">set_name</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">res</span></div>


<div class="viewcode-block" id="tuple_set"><a class="viewcode-back" href="../../../docplex.cp.expression.py.html#docplex.cp.expression.tuple_set">[docs]</a><span class="k">def</span> <span class="nf">tuple_set</span><span class="p">(</span><span class="n">tset</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Create a tuple set.</span>

<span class="sd">    A tuple set is essentially a matrix of integers, but not necessarily square.</span>
<span class="sd">    Boolean expressions allowed_assignments() and forbidden_assignments() use a tuple set to express</span>
<span class="sd">    allowed/forbidden combinations of values for a collection of variables.</span>
<span class="sd">    Each allowed/forbidden combination is called a tuple and it is represented by a row in the tuple set matrix.</span>

<span class="sd">    Note that modeling methods allowed_assignments() and forbidden_assignments() automatically create a tuple_set</span>
<span class="sd">    object if given argument is an iterable of iterables.</span>
<span class="sd">    There is then no need to explicitly call this factory method to create a tuple set, except to assign a name to it.</span>

<span class="sd">    Args:</span>
<span class="sd">        tset:  List of tuples, as iterable of iterables of integers</span>
<span class="sd">        name:  Object name (default is None).</span>
<span class="sd">    Returns:</span>
<span class="sd">        TupleSet expression.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">build_cpo_tupleset</span><span class="p">(</span><span class="n">tset</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">name</span><span class="p">:</span>
        <span class="n">res</span><span class="o">.</span><span class="n">set_name</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">res</span></div>


<div class="viewcode-block" id="state_function"><a class="viewcode-back" href="../../../docplex.cp.expression.py.html#docplex.cp.expression.state_function">[docs]</a><span class="k">def</span> <span class="nf">state_function</span><span class="p">(</span><span class="n">trmtx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Create a new State Function</span>

<span class="sd">    Args:</span>
<span class="sd">        trmtx (optional): An optional transition matrix defining the transition distance between consecutive states</span>
<span class="sd">                          of the state function.</span>
<span class="sd">                          Transition matrix is given as a list of rows (iterable of iterables of positive integers),</span>
<span class="sd">                          or as the result of a call to the method :meth:`~docplex.cp.expression.transition_matrix`.</span>
<span class="sd">        name (optional):  Name of the state function</span>
<span class="sd">    Returns:</span>
<span class="sd">        CpoStateFunction expression</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">CpoStateFunction</span><span class="p">(</span><span class="n">trmtx</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span></div>


<span class="c1">###############################################################################</span>
<span class="c1">##  Public Functions</span>
<span class="c1">###############################################################################</span>

<div class="viewcode-block" id="is_cpo_expr"><a class="viewcode-back" href="../../../docplex.cp.expression.py.html#docplex.cp.expression.is_cpo_expr">[docs]</a><span class="k">def</span> <span class="nf">is_cpo_expr</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Check if an expression is a CPO model expression</span>

<span class="sd">    Args:</span>
<span class="sd">        expr:             Value to check</span>
<span class="sd">        type (optional):  Precise CPO type, in Type_*</span>
<span class="sd">    Returns:</span>
<span class="sd">        True if parameter is a CPO expression, of the expected type if given</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">CpoExpr</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">type</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">expr</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="nb">type</span><span class="p">)</span></div>


<div class="viewcode-block" id="get_node_count"><a class="viewcode-back" href="../../../docplex.cp.expression.py.html#docplex.cp.expression.get_node_count">[docs]</a><span class="k">def</span> <span class="nf">get_node_count</span><span class="p">(</span><span class="n">expr</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Get the number of model expression nodes in an expression or list of expressions</span>

<span class="sd">    Args:</span>
<span class="sd">        expr:   Expression or list of expressions</span>
<span class="sd">    Returns:</span>
<span class="sd">        Total number of nodes</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Initialize stack of expressions to parse</span>
    <span class="n">estack</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">estack</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">estack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span>
    <span class="n">doneset</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>  <span class="c1"># Set of ids of expressions already processed</span>

    <span class="c1"># Loop while expression stack is not empty</span>
    <span class="k">while</span> <span class="n">estack</span><span class="p">:</span>
        <span class="n">e</span> <span class="o">=</span> <span class="n">estack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
        <span class="n">eid</span> <span class="o">=</span> <span class="nb">id</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">eid</span> <span class="ow">in</span> <span class="n">doneset</span><span class="p">:</span>
            <span class="n">doneset</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">eid</span><span class="p">)</span>
            <span class="c1"># Stack children expressions</span>
            <span class="k">try</span><span class="p">:</span>
               <span class="n">estack</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">children</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>

    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">doneset</span><span class="p">)</span></div>


<div class="viewcode-block" id="pretty_print"><a class="viewcode-back" href="../../../docplex.cp.expression.py.html#docplex.cp.expression.pretty_print">[docs]</a><span class="k">def</span> <span class="nf">pretty_print</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mxdepth</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mxargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">adsize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">curdepth</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Pretty print expression in a way that shows its structure.</span>

<span class="sd">    Args:</span>
<span class="sd">        expr:     Expression to print</span>
<span class="sd">        out:      (optional) Print output (stream or file name, None for stdout)</span>
<span class="sd">        mxdepth:  (optional) Max print depth. Default is None (no limit)</span>
<span class="sd">        mxargs:   (optional) Max number of function or array arguments. Default is None (no limit)</span>
<span class="sd">        adsize:   (optional) Add size of expressions in nodes</span>
<span class="sd">        indent:   (optional) Indentation string</span>
<span class="sd">        curdepth: (internal) Current print depth</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Check file output</span>
    <span class="k">if</span> <span class="n">is_string</span><span class="p">(</span><span class="n">out</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">open_utf8</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">out</span><span class="p">),</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">pretty_print</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">mxdepth</span><span class="p">,</span> <span class="n">mxargs</span><span class="p">,</span> <span class="n">adsize</span><span class="p">,</span> <span class="n">indent</span><span class="p">,</span> <span class="n">curdepth</span><span class="p">)</span>
            <span class="k">return</span>
    <span class="c1"># Check default output</span>
    <span class="k">if</span> <span class="n">out</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span>

    <span class="c1"># Write start banner</span>
    <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">indent</span><span class="p">)</span>

    <span class="c1"># Check max depth reached</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">mxdepth</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">curdepth</span> <span class="o">&gt;=</span> <span class="n">mxdepth</span><span class="p">):</span>
        <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;...&quot;</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="c1"># Check if tuple</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
        <span class="n">_pretty_print_children</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">,</span> <span class="s1">&#39;)&#39;</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">mxdepth</span><span class="p">,</span> <span class="n">mxargs</span><span class="p">,</span> <span class="n">adsize</span><span class="p">,</span> <span class="n">indent</span><span class="p">,</span> <span class="n">curdepth</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="c1"># Check list</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="n">_pretty_print_children</span><span class="p">(</span><span class="s1">&#39;[&#39;</span><span class="p">,</span> <span class="s1">&#39;]&#39;</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">mxdepth</span><span class="p">,</span> <span class="n">mxargs</span><span class="p">,</span> <span class="n">adsize</span><span class="p">,</span> <span class="n">indent</span><span class="p">,</span> <span class="n">curdepth</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="c1"># Check if expression is not CpoExpr</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">CpoExpr</span><span class="p">):</span>
        <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">expr</span><span class="p">))</span>
        <span class="k">return</span>

    <span class="c1"># Check if expression has a name</span>
    <span class="k">if</span> <span class="n">expr</span><span class="o">.</span><span class="n">has_name</span><span class="p">():</span>
        <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">get_name</span><span class="p">())</span>
        <span class="k">return</span>

    <span class="c1"># Check expression type</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">expr</span><span class="o">.</span><span class="n">type</span>
    <span class="k">if</span> <span class="n">t</span><span class="o">.</span><span class="n">is_constant</span><span class="p">:</span>
        <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">expr</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">t</span><span class="o">.</span><span class="n">is_variable</span><span class="p">:</span>
        <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">expr</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">t</span><span class="o">.</span><span class="n">is_array</span><span class="p">:</span>
        <span class="n">_pretty_print_children</span><span class="p">(</span><span class="s1">&#39;[&#39;</span><span class="p">,</span> <span class="s1">&#39;]&#39;</span><span class="p">,</span> <span class="n">expr</span><span class="o">.</span><span class="n">children</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">mxdepth</span><span class="p">,</span> <span class="n">mxargs</span><span class="p">,</span> <span class="n">adsize</span><span class="p">,</span> <span class="n">indent</span><span class="p">,</span> <span class="n">curdepth</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">_pretty_print_children</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">operation</span><span class="o">.</span><span class="n">cpo_name</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;(&#39;</span><span class="p">,</span> <span class="s1">&#39;)&#39;</span><span class="p">,</span> <span class="n">expr</span><span class="o">.</span><span class="n">children</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">mxdepth</span><span class="p">,</span> <span class="n">mxargs</span><span class="p">,</span> <span class="n">adsize</span><span class="p">,</span> <span class="n">indent</span><span class="p">,</span> <span class="n">curdepth</span><span class="p">)</span></div>


<span class="k">def</span> <span class="nf">_pretty_print_children</span><span class="p">(</span><span class="n">lstart</span><span class="p">,</span> <span class="n">lend</span><span class="p">,</span> <span class="n">lexpr</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">mxdepth</span><span class="p">,</span> <span class="n">mxargs</span><span class="p">,</span> <span class="n">adsize</span><span class="p">,</span> <span class="n">indent</span><span class="p">,</span> <span class="n">curdepth</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Pretty print list of expression</span>

<span class="sd">    Args:</span>
<span class="sd">        lstart:   List start banner</span>
<span class="sd">        lend:     List end banner</span>
<span class="sd">        lexpr:    List of expression to take children from</span>
<span class="sd">        out:      Print output (stream or file name, None for stdout)</span>
<span class="sd">        mxdepth:  Max print depth. Default is None (no limit)</span>
<span class="sd">        mxargs:   Max number of function or array arguments. Default is None (no limit)</span>
<span class="sd">        adsize:   Add size of expressions in nodes</span>
<span class="sd">        indent:   Indentation string</span>
<span class="sd">        curdepth: Current print depth</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Write start banner</span>
    <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">lstart</span><span class="p">)</span>
    <span class="n">nindent</span> <span class="o">=</span> <span class="n">indent</span> <span class="o">+</span> <span class="s2">&quot; | &quot;</span>
    <span class="k">if</span> <span class="n">adsize</span><span class="p">:</span>
        <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot; size:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">get_node_count</span><span class="p">(</span><span class="n">lexpr</span><span class="p">)))</span>

    <span class="c1"># Write expressions</span>
    <span class="n">nbargs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lexpr</span><span class="p">)</span>
    <span class="n">curdepth</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">mxargs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">nbargs</span> <span class="o">&lt;=</span> <span class="n">mxargs</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">lexpr</span><span class="p">:</span>
            <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">pretty_print</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">mxdepth</span><span class="p">,</span> <span class="n">mxargs</span><span class="p">,</span> <span class="n">adsize</span><span class="p">,</span> <span class="n">nindent</span><span class="p">,</span> <span class="n">curdepth</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">eargs</span> <span class="o">=</span> <span class="n">mxargs</span> <span class="o">//</span> <span class="mi">2</span>
        <span class="n">bargs</span> <span class="o">=</span> <span class="n">mxargs</span> <span class="o">-</span> <span class="n">eargs</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">lexpr</span><span class="p">[:</span><span class="n">bargs</span><span class="p">]:</span>
            <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">pretty_print</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">mxdepth</span><span class="p">,</span> <span class="n">mxargs</span><span class="p">,</span> <span class="n">adsize</span><span class="p">,</span> <span class="n">nindent</span><span class="p">,</span> <span class="n">curdepth</span><span class="p">)</span>
        <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">nindent</span><span class="p">)</span>
        <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;...(+&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">nbargs</span> <span class="o">-</span> <span class="n">mxargs</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;)...&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">lexpr</span><span class="p">[</span><span class="o">-</span><span class="n">eargs</span><span class="p">:]:</span>
            <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">pretty_print</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">mxdepth</span><span class="p">,</span> <span class="n">mxargs</span><span class="p">,</span> <span class="n">adsize</span><span class="p">,</span> <span class="n">nindent</span><span class="p">,</span> <span class="n">curdepth</span><span class="p">)</span>

    <span class="c1"># Write end banner</span>
    <span class="c1"># out.write(&#39;\n&#39;)</span>
    <span class="c1"># out.write(indent)</span>
    <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">lend</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_domain_min</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Retrieves the lower bound of a domain</span>

<span class="sd">    Args:</span>
<span class="sd">        d: Domain</span>
<span class="sd">    Returns:</span>
<span class="sd">        Domain lower bound</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">is_array</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span> <span class="k">else</span> <span class="n">v</span>
    <span class="k">return</span> <span class="n">d</span>


<span class="k">def</span> <span class="nf">_domain_max</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Retrieves the upper bound of a domain</span>

<span class="sd">    Args:</span>
<span class="sd">        d: Domain</span>
<span class="sd">    Returns:</span>
<span class="sd">        Domain upper bound</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">is_array</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">v</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span> <span class="k">else</span> <span class="n">v</span>
    <span class="k">return</span> <span class="n">d</span>


<span class="k">def</span> <span class="nf">_domain_iterator</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Iterator on the individual values of an integer variable domain.</span>

<span class="sd">    Args:</span>
<span class="sd">        d: Domain to iterate</span>
<span class="sd">    Returns:</span>
<span class="sd">        Domain iterator</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
                <span class="nb">min</span><span class="p">,</span> <span class="nb">max</span> <span class="o">=</span> <span class="n">x</span>
                <span class="k">if</span> <span class="nb">min</span> <span class="o">==</span> <span class="nb">max</span><span class="p">:</span>
                    <span class="k">yield</span> <span class="nb">min</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">min</span><span class="p">,</span> <span class="nb">max</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                        <span class="k">yield</span> <span class="n">v</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">x</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">yield</span> <span class="n">d</span>


<span class="k">def</span> <span class="nf">_domain_contains</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Check whether a domain contains a given value</span>

<span class="sd">    Args:</span>
<span class="sd">        d:   Domain</span>
<span class="sd">        val: Value to check</span>
<span class="sd">    Returns:</span>
<span class="sd">        True if value is in the domain, False otherwise</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
                <span class="nb">min</span><span class="p">,</span> <span class="nb">max</span> <span class="o">=</span> <span class="n">x</span>
                <span class="k">if</span> <span class="nb">min</span> <span class="o">&lt;=</span> <span class="n">val</span> <span class="o">&lt;=</span> <span class="nb">max</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">True</span>
            <span class="k">elif</span> <span class="n">x</span> <span class="o">==</span> <span class="n">val</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="n">d</span> <span class="o">==</span> <span class="n">val</span>


<span class="c1"># Cache of CPO expressions corresponding to Python values</span>
<span class="c1"># This cache is used to retrieve the CPO expression that corresponds to a Python expression</span>
<span class="c1"># that is used multiple times in a model.</span>
<span class="c1"># This allows to:</span>
<span class="c1">#  - speed-up conversion as expression type has not to be recompute again</span>
<span class="c1">#  - reduce CPO file length as common expressions are easily identified.</span>
<span class="n">_CACHE_CONTEXT</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">cache</span>
<span class="n">_CPO_VALUES_FROM_PYTHON</span> <span class="o">=</span> <span class="n">ObjectCache</span><span class="p">(</span><span class="n">_CACHE_CONTEXT</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
<span class="n">_CACHE_ACTIVE</span> <span class="o">=</span> <span class="n">_CACHE_CONTEXT</span><span class="o">.</span><span class="n">active</span>

<span class="c1"># Lock to protect the map</span>
<span class="n">_CPO_VALUES_FROM_PYTHON_LOCK</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">_CacheKeyTuple</span><span class="p">(</span><span class="nb">tuple</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Tuple that is used as a key of the expression cache &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">all</span><span class="p">(</span><span class="n">x1</span> <span class="ow">is</span> <span class="n">x2</span> <span class="k">for</span> <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">))</span>
    <span class="k">def</span> <span class="nf">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">_CacheKeyTuple</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__hash__</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">_convert_to_tuple_if_possible</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">val</span>


<div class="viewcode-block" id="build_cpo_expr"><a class="viewcode-back" href="../../../docplex.cp.expression.py.html#docplex.cp.expression.build_cpo_expr">[docs]</a><span class="k">def</span> <span class="nf">build_cpo_expr</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Builds an expression from a given Python value.</span>

<span class="sd">    This method uses a cache to return the same CpoExpr for the same constant.</span>

<span class="sd">    Args:</span>
<span class="sd">        val: Value to convert (possibly already an expression).</span>
<span class="sd">    Returns:</span>
<span class="sd">        Corresponding expression.</span>
<span class="sd">    Raises:</span>
<span class="sd">        CpoException if conversion is not possible.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Check if already a CPO expression</span>
    <span class="n">vtyp</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">vtyp</span><span class="p">,</span> <span class="n">CpoExpr</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">val</span>

    <span class="c1">#  Check atoms (not cached)</span>
    <span class="n">ctyp</span> <span class="o">=</span> <span class="n">_PYTHON_TO_CPO_TYPE</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">vtyp</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ctyp</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">CpoValue</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">ctyp</span><span class="p">)</span>

    <span class="c1"># Check numpy scalars (special case when called from overloaded operator)</span>
    <span class="k">if</span> <span class="n">vtyp</span> <span class="ow">is</span> <span class="n">NUMPY_NDARRAY</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">val</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">CpoValue</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">_PYTHON_TO_CPO_TYPE</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">val</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">type</span><span class="p">))</span>

    <span class="c1"># Value is any type of array. Force it as a tuple</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">val</span> <span class="o">=</span> <span class="n">_CacheKeyTuple</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
       <span class="k">raise</span> <span class="n">CpoException</span><span class="p">(</span><span class="s2">&quot;Impossible to build a CP Optimizer expression with value &#39;</span><span class="si">{}</span><span class="s2">&#39; of type &#39;</span><span class="si">{}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">to_string</span><span class="p">(</span><span class="n">val</span><span class="p">),</span> <span class="nb">type</span><span class="p">(</span><span class="n">val</span><span class="p">)))</span>

    <span class="c1"># Check if already in the cache</span>
    <span class="k">if</span> <span class="n">_CACHE_ACTIVE</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">_CPO_VALUES_FROM_PYTHON_LOCK</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">cpval</span> <span class="o">=</span> <span class="n">_CPO_VALUES_FROM_PYTHON</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                <span class="c1"># Convert to tuple every member of the tuple</span>
                <span class="n">val</span> <span class="o">=</span> <span class="n">_CacheKeyTuple</span><span class="p">(</span><span class="n">_convert_to_tuple_if_possible</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">val</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">cpval</span> <span class="o">=</span> <span class="n">_CPO_VALUES_FROM_PYTHON</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">CpoException</span><span class="p">(</span><span class="s2">&quot;Impossible to build a CP Optimizer expression with value &#39;</span><span class="si">{}</span><span class="s2">&#39; of type &#39;</span><span class="si">{}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">to_string</span><span class="p">(</span><span class="n">val</span><span class="p">),</span> <span class="nb">type</span><span class="p">(</span><span class="n">val</span><span class="p">)))</span>
            <span class="k">if</span> <span class="n">cpval</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">cpval</span> <span class="o">=</span> <span class="n">_create_cpo_array_expr</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
                <span class="n">_CPO_VALUES_FROM_PYTHON</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">cpval</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">cpval</span> <span class="o">=</span> <span class="n">_create_cpo_array_expr</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">cpval</span></div>


<div class="viewcode-block" id="build_cpo_tupleset"><a class="viewcode-back" href="../../../docplex.cp.expression.py.html#docplex.cp.expression.build_cpo_tupleset">[docs]</a><span class="k">def</span> <span class="nf">build_cpo_tupleset</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Builds a TupleSet expression from a Python value.</span>

<span class="sd">    This method uses the value cache to return the same CpoExpr for the same value.</span>

<span class="sd">    Args:</span>
<span class="sd">        val: Value to convert. Iterator or iterators of integers, or existing TupleSet expression.</span>
<span class="sd">    Returns:</span>
<span class="sd">        Model tupleset, not editable.</span>
<span class="sd">    Raises:</span>
<span class="sd">        Exception if conversion is not possible.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Check if already a TupleSet expression</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">CpoExpr</span><span class="p">)</span> <span class="ow">and</span> <span class="n">val</span><span class="o">.</span><span class="n">is_type</span><span class="p">(</span><span class="n">Type_TupleSet</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">val</span>

    <span class="c1"># Create result set</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">tset</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">val</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
        <span class="k">assert</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;Argument should be an iterable of iterables of integers.&quot;</span>

    <span class="c1"># Check if already in the cache</span>
    <span class="k">if</span> <span class="n">_CACHE_ACTIVE</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">_CPO_VALUES_FROM_PYTHON_LOCK</span><span class="p">:</span>
            <span class="n">key</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;tupleset&#39;</span><span class="p">,</span> <span class="n">tset</span><span class="p">)</span>
            <span class="n">cpval</span> <span class="o">=</span> <span class="n">_CPO_VALUES_FROM_PYTHON</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">cpval</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># Verify new tuple set</span>
                <span class="k">if</span> <span class="n">tset</span><span class="p">:</span>
                    <span class="c1">#assert len(tset) &gt; 0, &quot;Tuple set should not be empty&quot;</span>
                    <span class="n">size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tset</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">==</span> <span class="n">size</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">tset</span><span class="p">),</span> <span class="s2">&quot;All tuples in &#39;tset&#39; should have the same length&quot;</span>
                    <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span><span class="nb">all</span><span class="p">(</span><span class="n">is_int</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">r</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">tset</span><span class="p">),</span> <span class="s2">&quot;All tupleset values should be integer&quot;</span>
                <span class="c1"># Put tuple set in cache</span>
                <span class="n">cpval</span> <span class="o">=</span> <span class="n">CpoValue</span><span class="p">(</span><span class="n">tset</span><span class="p">,</span> <span class="n">Type_TupleSet</span><span class="p">)</span>
                <span class="n">_CPO_VALUES_FROM_PYTHON</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">cpval</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">cpval</span> <span class="o">=</span> <span class="n">CpoValue</span><span class="p">(</span><span class="n">tset</span><span class="p">,</span> <span class="n">Type_TupleSet</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">cpval</span></div>


<div class="viewcode-block" id="build_cpo_transition_matrix"><a class="viewcode-back" href="../../../docplex.cp.expression.py.html#docplex.cp.expression.build_cpo_transition_matrix">[docs]</a><span class="k">def</span> <span class="nf">build_cpo_transition_matrix</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Builds a TransitionMatrix expression from a Python value.</span>

<span class="sd">    This method uses the value cache to return the same CpoExpr for the same value.</span>

<span class="sd">    Args:</span>
<span class="sd">        val: Value to convert. Iterator or iterators of integers, or existing TransitionMatrix expression.</span>
<span class="sd">    Returns:</span>
<span class="sd">        Model transition matrix, not editable.</span>
<span class="sd">    Raises:</span>
<span class="sd">        Exception if conversion is not possible.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Check if already a TransitionMatrix expression</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">CpoExpr</span><span class="p">)</span> <span class="ow">and</span> <span class="n">val</span><span class="o">.</span><span class="n">is_type</span><span class="p">(</span><span class="n">Type_TransitionMatrix</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">val</span>

    <span class="c1"># Create internal tuple</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">trmx</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">val</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
        <span class="k">assert</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;Argument should be an iterable of iterables of integers.&quot;</span>

    <span class="c1"># Check if already in the cache</span>
    <span class="k">if</span> <span class="n">_CACHE_ACTIVE</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">_CPO_VALUES_FROM_PYTHON_LOCK</span><span class="p">:</span>
            <span class="n">key</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;matrix&#39;</span><span class="p">,</span> <span class="n">trmx</span><span class="p">)</span>
            <span class="n">cpval</span> <span class="o">=</span> <span class="n">_CPO_VALUES_FROM_PYTHON</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">cpval</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># Verify matrix</span>
                <span class="n">size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">trmx</span><span class="p">)</span>
                <span class="k">assert</span> <span class="n">size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Transition matrix should not be empty&quot;</span>
                <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">==</span> <span class="n">size</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">trmx</span><span class="p">),</span> <span class="s2">&quot;All matrix lines should have the same length &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
                <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span><span class="nb">all</span><span class="p">(</span><span class="n">is_int</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="ow">and</span> <span class="n">v</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">r</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">trmx</span><span class="p">),</span> <span class="s2">&quot;All matrix values should be positive integer&quot;</span>
                <span class="c1"># Build matrix and put it in cache</span>
                <span class="n">cpval</span> <span class="o">=</span> <span class="n">CpoTransitionMatrix</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="n">trmx</span><span class="p">)</span>
                <span class="n">_CPO_VALUES_FROM_PYTHON</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">cpval</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">cpval</span> <span class="o">=</span> <span class="n">CpoTransitionMatrix</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="n">trmx</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">cpval</span></div>


<div class="viewcode-block" id="compare_expressions"><a class="viewcode-back" href="../../../docplex.cp.expression.py.html#docplex.cp.expression.compare_expressions">[docs]</a><span class="k">def</span> <span class="nf">compare_expressions</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Compare two expressions for declaration order</span>

<span class="sd">    Args:</span>
<span class="sd">        x1: Expression 1</span>
<span class="sd">        x2: Expression 2</span>
<span class="sd">    Returns:</span>
<span class="sd">        Integer value that is negative if v1 &lt; v2, zero if v1 == v2 and positive if v1 &gt; v2.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># First sort by expression type</span>
    <span class="k">if</span> <span class="n">x1</span><span class="o">.</span><span class="n">type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">x2</span><span class="o">.</span><span class="n">type</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">x1</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">id</span> <span class="o">-</span> <span class="n">x2</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">id</span>
    <span class="c1"># Check object type</span>
    <span class="n">tx1</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">x1</span><span class="p">)</span>
    <span class="n">tx2</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">x2</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">tx1</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">tx2</span><span class="p">:</span>
        <span class="c1"># Alias always loss</span>
        <span class="k">if</span> <span class="n">tx1</span> <span class="ow">is</span> <span class="n">CpoAlias</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">tx2</span> <span class="ow">is</span> <span class="n">CpoAlias</span><span class="p">:</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
    <span class="c1"># Compare by name in natural order</span>
    <span class="k">return</span> <span class="n">compare_natural</span><span class="p">(</span><span class="n">x1</span><span class="o">.</span><span class="n">get_name</span><span class="p">(),</span> <span class="n">x2</span><span class="o">.</span><span class="n">get_name</span><span class="p">())</span></div>


<span class="c1">###############################################################################</span>
<span class="c1">## Private utility functions</span>
<span class="c1">###############################################################################</span>

<span class="k">def</span> <span class="nf">_create_cpo_array_expr</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Create a new CP expression from a given array Python value</span>

<span class="sd">    Args:</span>
<span class="sd">        val: Origin value, as a _CacheKeyTuple(val)</span>
<span class="sd">    Returns:</span>
<span class="sd">        New expression</span>
<span class="sd">    Raises:</span>
<span class="sd">        CpoException if it is not possible.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Determine type</span>
    <span class="n">typ</span> <span class="o">=</span> <span class="n">_get_cpo_array_type</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">typ</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">CpoException</span><span class="p">(</span><span class="s2">&quot;Impossible to build a CP Optimizer expression with value &#39;&quot;</span> <span class="o">+</span> <span class="n">to_string</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;&quot;</span><span class="p">)</span>

    <span class="c1"># Convert array elements if required</span>
    <span class="k">if</span> <span class="n">typ</span><span class="o">.</span><span class="n">is_array_of_expr</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">CpoValue</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">build_cpo_expr</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">val</span><span class="p">),</span> <span class="n">typ</span><span class="p">)</span>

    <span class="c1"># If int array, assure all elements are ints</span>
    <span class="k">if</span> <span class="n">typ</span> <span class="ow">is</span> <span class="n">Type_IntArray</span><span class="p">:</span>
        <span class="n">val</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">value</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="ow">is</span> <span class="n">CpoValue</span> <span class="k">else</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">val</span><span class="p">]</span>

    <span class="c1"># Default</span>
    <span class="k">return</span> <span class="n">CpoValue</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">typ</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_get_cpo_array_type</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Determine the CPO type of a given Python array value</span>
<span class="sd">    Args:</span>
<span class="sd">        val: Python value</span>
<span class="sd">    Returns:</span>
<span class="sd">        Corresponding CPO Type, None if none</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Check empty Array</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Type_IntArray</span>

    <span class="c1"># Get the most common type for all array elements</span>
    <span class="n">cet</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">val</span><span class="p">:</span>
        <span class="c1"># Determine type of element</span>
        <span class="n">nt</span> <span class="o">=</span> <span class="n">_get_cpo_type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">nt</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="c1"># Combine with global type</span>
        <span class="n">ncet</span> <span class="o">=</span> <span class="n">nt</span> <span class="k">if</span> <span class="n">cet</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">cet</span><span class="o">.</span><span class="n">get_common_type</span><span class="p">(</span><span class="n">nt</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ncet</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Check special case of couple of int mixed with ints</span>
            <span class="k">if</span> <span class="n">cet</span> <span class="ow">is</span> <span class="n">Type_Int</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">nt</span> <span class="ow">is</span> <span class="n">Type_IntArray</span><span class="p">)</span> <span class="ow">and</span> <span class="n">_is_cpo_int_interval</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
                    <span class="n">ncet</span> <span class="o">=</span> <span class="n">Type_Int</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">None</span>
            <span class="k">elif</span> <span class="n">cet</span> <span class="ow">is</span> <span class="n">Type_IntArray</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">nt</span> <span class="ow">is</span> <span class="n">Type_Int</span><span class="p">:</span>
                    <span class="n">ncet</span> <span class="o">=</span> <span class="n">Type_Int</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">None</span>
            <span class="k">else</span><span class="p">:</span>
               <span class="k">return</span> <span class="kc">None</span>
        <span class="n">cet</span> <span class="o">=</span> <span class="n">ncet</span>

    <span class="c1"># Determine array type for result element type</span>
    <span class="k">if</span> <span class="n">cet</span> <span class="ow">is</span> <span class="n">Type_IntArray</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">_is_cpo_int_interval</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">val</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">Type_IntArray</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Type_TupleSet</span>
    <span class="k">return</span> <span class="n">cet</span><span class="o">.</span><span class="n">parent_array_type</span>


<span class="k">def</span> <span class="nf">_get_cpo_type</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Determine the CPO type of a given Python value</span>
<span class="sd">    Args:</span>
<span class="sd">        val: Python value</span>
<span class="sd">    Returns:</span>
<span class="sd">        Corresponding CPO Type, None if none</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Check simple types</span>
    <span class="n">ctyp</span> <span class="o">=</span> <span class="n">_PYTHON_TO_CPO_TYPE</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">val</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">ctyp</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">ctyp</span>

    <span class="c1"># Check CPO Expr</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">CpoExpr</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">val</span><span class="o">.</span><span class="n">type</span>

    <span class="c1"># Check numpy Array Scalars (special case when called from overloaded operator)</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="ow">is</span> <span class="n">NUMPY_NDARRAY</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">val</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_PYTHON_TO_CPO_TYPE</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">val</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">type</span><span class="p">)</span>

    <span class="c1"># Check array</span>
    <span class="k">if</span> <span class="n">is_array</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_get_cpo_array_type</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>

    <span class="k">return</span> <span class="kc">None</span>


<span class="k">def</span> <span class="nf">_clear_value_cache</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot; Clear the cache of CPO values</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">_CPO_VALUES_FROM_PYTHON_LOCK</span><span class="p">:</span>
        <span class="n">_CPO_VALUES_FROM_PYTHON</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">_get_cpo_type_str</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Get the CPO type name of a value</span>

<span class="sd">    Args:</span>
<span class="sd">        val: Value</span>
<span class="sd">    Returns:</span>
<span class="sd">        Value type string in CPO types</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">_get_cpo_type</span><span class="p">(</span><span class="n">val</span><span class="p">)</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">_create_operation</span><span class="p">(</span><span class="n">oper</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Create a new expression that matches an operation descriptor</span>

<span class="sd">    Search in the signatures which one matches a set or arguments</span>
<span class="sd">    and then create an instance of the returned expression</span>

<span class="sd">    Args:</span>
<span class="sd">        oper:   Operation descriptor</span>
<span class="sd">        params: List of expression parameters</span>
<span class="sd">    Returns:</span>
<span class="sd">        New expression </span>
<span class="sd">    Raises:</span>
<span class="sd">        CpoException if no operation signature matches arguments</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># assert isinstance(oper, CpoOperation)</span>

    <span class="c1"># Convert arguments in CPO expressions</span>
    <span class="n">args</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">build_cpo_expr</span><span class="p">,</span> <span class="n">params</span><span class="p">))</span>
      
    <span class="c1"># Search corresponding signature</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">_get_matching_signature</span><span class="p">(</span><span class="n">oper</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">s</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">CpoException</span><span class="p">(</span><span class="s2">&quot;The combination of parameters (</span><span class="si">{}</span><span class="s2">) is not allowed for operation &#39;</span><span class="si">{}</span><span class="s2">&#39; (</span><span class="si">{}</span><span class="s2">)&quot;</span>
                           <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">_get_cpo_type_str</span><span class="p">,</span> <span class="n">args</span><span class="p">)),</span> <span class="n">oper</span><span class="o">.</span><span class="n">python_name</span><span class="p">,</span> <span class="n">oper</span><span class="o">.</span><span class="n">cpo_name</span><span class="p">))</span>

    <span class="c1"># Create result expression</span>
    <span class="k">return</span> <span class="n">CpoFunctionCall</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">operation</span><span class="p">,</span> <span class="n">s</span><span class="o">.</span><span class="n">return_type</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>


<span class="c1">###############################################################################</span>
<span class="c1">##  Private Functions</span>
<span class="c1">###############################################################################</span>

<span class="c1"># Mapping of Python types to CPO types</span>
<span class="n">_PYTHON_TO_CPO_TYPE</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">BOOL_TYPES</span><span class="p">:</span>
    <span class="n">_PYTHON_TO_CPO_TYPE</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">Type_Bool</span>
<span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">INTEGER_TYPES</span><span class="p">:</span>
    <span class="n">_PYTHON_TO_CPO_TYPE</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">Type_Int</span>
<span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">FLOAT_TYPES</span><span class="p">:</span>
    <span class="n">_PYTHON_TO_CPO_TYPE</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">Type_Float</span>
<span class="n">_PYTHON_TO_CPO_TYPE</span><span class="p">[</span><span class="n">CpoIntVar</span><span class="p">]</span>           <span class="o">=</span> <span class="n">Type_IntVar</span>
<span class="n">_PYTHON_TO_CPO_TYPE</span><span class="p">[</span><span class="n">CpoIntervalVar</span><span class="p">]</span>      <span class="o">=</span> <span class="n">Type_IntervalVar</span>
<span class="n">_PYTHON_TO_CPO_TYPE</span><span class="p">[</span><span class="n">CpoSequenceVar</span><span class="p">]</span>      <span class="o">=</span> <span class="n">Type_SequenceVar</span>
<span class="n">_PYTHON_TO_CPO_TYPE</span><span class="p">[</span><span class="n">CpoTransitionMatrix</span><span class="p">]</span> <span class="o">=</span> <span class="n">Type_TransitionMatrix</span>
<span class="n">_PYTHON_TO_CPO_TYPE</span><span class="p">[</span><span class="n">CpoStateFunction</span><span class="p">]</span>    <span class="o">=</span> <span class="n">Type_StateFunction</span>


<span class="k">def</span> <span class="nf">_is_cpo_int</span><span class="p">(</span><span class="n">arg</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Check that a value is a valid integer for cpo</span>
<span class="sd">    Args:</span>
<span class="sd">        arg:  Value to check</span>
<span class="sd">    Returns:</span>
<span class="sd">        True if value is a valid CPO integer, False otherwise</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">is_int</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">INT_MIN</span> <span class="o">&lt;=</span> <span class="n">arg</span> <span class="o">&lt;=</span> <span class="n">INT_MAX</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_is_cpo_int_interval</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Check if a value represents an interval of CPO integers</span>
<span class="sd">    Args:</span>
<span class="sd">        val:  Value to check</span>
<span class="sd">    Returns:</span>
<span class="sd">        True if value is a tuple representing an interval of integers</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="ow">and</span> <span class="n">_is_cpo_int</span><span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="ow">and</span> <span class="n">_is_cpo_int</span><span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="ow">and</span> <span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">val</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>


<span class="k">def</span> <span class="nf">_is_cpo_interval_value</span><span class="p">(</span><span class="n">arg</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Check that a value is a valid value for an interval</span>
<span class="sd">    Args:</span>
<span class="sd">        arg:  Value to check</span>
<span class="sd">    Returns:</span>
<span class="sd">        True if value is a valid interval, False otherwise</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">is_int</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">INTERVAL_MIN</span> <span class="o">&lt;=</span> <span class="n">arg</span> <span class="o">&lt;=</span> <span class="n">INTERVAL_MAX</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_check_arg_boolean</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Check that an argument is a boolean and raise error if wrong</span>
<span class="sd">    Args:</span>
<span class="sd">        arg:  Argument value</span>
<span class="sd">        name: Argument name</span>
<span class="sd">    Returns:</span>
<span class="sd">        Boolean to be set</span>
<span class="sd">    Raises:</span>
<span class="sd">        Exception if argument has the wrong format</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">is_bool</span><span class="p">(</span><span class="n">arg</span><span class="p">),</span> <span class="s2">&quot;Argument &#39;</span><span class="si">{}</span><span class="s2">&#39; should be a boolean&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">arg</span>


<span class="k">def</span> <span class="nf">_check_arg_integer</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Check that an argument is an valid integer value and raises error if wrong</span>
<span class="sd">    Args:</span>
<span class="sd">        arg:  Argument value</span>
<span class="sd">        name: Argument name</span>
<span class="sd">    Returns:</span>
<span class="sd">        Integer to be set</span>
<span class="sd">    Raises:</span>
<span class="sd">        Exception if argument has the wrong format</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">is_int</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">INT_MIN</span> <span class="o">&lt;=</span> <span class="n">arg</span> <span class="o">&lt;=</span> <span class="n">INT_MAX</span><span class="p">),</span> <span class="s2">&quot;Argument &#39;</span><span class="si">{}</span><span class="s2">&#39; should be an integer in [INT_MIN , INT_MAX]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">arg</span>


<span class="k">def</span> <span class="nf">_check_arg_interval</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Check that an argument is an interval and raise error if wrong</span>
<span class="sd">    Args:</span>
<span class="sd">        arg:  Argument value</span>
<span class="sd">        name: Argument name</span>
<span class="sd">    Returns:</span>
<span class="sd">        Interval to be set</span>
<span class="sd">    Raises:</span>
<span class="sd">        Exception if argument has the wrong format</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Check default interval</span>
    <span class="k">if</span> <span class="n">arg</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">DEFAULT_INTERVAL</span>

    <span class="c1"># Check single value</span>
    <span class="k">if</span> <span class="n">is_int</span><span class="p">(</span><span class="n">arg</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">INTERVAL_MIN</span> <span class="o">&lt;=</span> <span class="n">arg</span> <span class="o">&lt;=</span> <span class="n">INTERVAL_MAX</span><span class="p">,</span> <span class="s2">&quot;Argument &#39;</span><span class="si">{}</span><span class="s2">&#39; should be in [INTERVAL_MIN , INTERVAL_MAX]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">arg</span><span class="p">,</span> <span class="n">arg</span>

    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">))</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;Argument &#39;&quot;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;&#39; should be an integer or an interval expressed as a tuple of two integers&quot;</span>
    <span class="n">lb</span><span class="p">,</span> <span class="n">ub</span> <span class="o">=</span> <span class="n">arg</span>
    <span class="k">assert</span> <span class="n">_is_cpo_interval_value</span><span class="p">(</span><span class="n">lb</span><span class="p">),</span> <span class="s2">&quot;Lower bound of argument &#39;</span><span class="si">{}</span><span class="s2">&#39; should be an integer in [INTERVAL_MIN , INTERVAL_MAX]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">_is_cpo_interval_value</span><span class="p">(</span><span class="n">ub</span><span class="p">),</span> <span class="s2">&quot;Upper bound of argument &#39;</span><span class="si">{}</span><span class="s2">&#39; should be an integer in [INTERVAL_MIN , INTERVAL_MAX]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">lb</span> <span class="o">&lt;=</span> <span class="n">ub</span><span class="p">,</span> <span class="s2">&quot;Lower bound or argument &#39;</span><span class="si">{}</span><span class="s2">&#39; should be lower or equal to upper bound&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">arg</span>


<span class="k">def</span> <span class="nf">_build_int_var_domain</span><span class="p">(</span><span class="nb">min</span><span class="p">,</span> <span class="nb">max</span><span class="p">,</span> <span class="n">domain</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Create/check integer variable domain from integer variable creation parameters</span>
<span class="sd">    Args:</span>
<span class="sd">        min:    Domain min value, None if extensive list.</span>
<span class="sd">        max:    Domain max value, None if extensive list.</span>
<span class="sd">        domain: Extensive list of values and/or intervals expressed as tuples of integers.</span>
<span class="sd">    Returns:</span>
<span class="sd">        Valid integer variable domain</span>
<span class="sd">    Raises:</span>
<span class="sd">        Exception if argument has the wrong format</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Domain not given extensively</span>
    <span class="k">if</span> <span class="n">domain</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">min</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">max</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">((</span><span class="n">INT_MIN</span><span class="p">,</span> <span class="n">INT_MAX</span><span class="p">),)</span>
            <span class="n">_check_arg_integer</span><span class="p">(</span><span class="nb">max</span><span class="p">,</span> <span class="s2">&quot;max&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">((</span><span class="n">INT_MIN</span><span class="p">,</span> <span class="nb">max</span><span class="p">),)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">max</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># Test that first argument is directly a domain (ascending compatibility)</span>
                <span class="k">if</span> <span class="n">is_array</span><span class="p">(</span><span class="nb">min</span><span class="p">):</span>
                    <span class="n">domain</span> <span class="o">=</span> <span class="nb">min</span>
                    <span class="nb">min</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">_check_arg_integer</span><span class="p">(</span><span class="nb">min</span><span class="p">,</span> <span class="s2">&quot;min&quot;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="p">((</span><span class="nb">min</span><span class="p">,</span> <span class="n">INT_MAX</span><span class="p">),)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">_check_arg_integer</span><span class="p">(</span><span class="nb">min</span><span class="p">,</span> <span class="s2">&quot;min&quot;</span><span class="p">)</span>
                <span class="n">_check_arg_integer</span><span class="p">(</span><span class="nb">max</span><span class="p">,</span> <span class="s2">&quot;max&quot;</span><span class="p">)</span>
                <span class="k">assert</span> <span class="nb">min</span> <span class="o">&lt;=</span> <span class="nb">max</span><span class="p">,</span> <span class="s2">&quot;Argument &#39;min&#39; should be lower or equal to &#39;max&#39;&quot;</span>
                <span class="k">return</span> <span class="p">((</span><span class="nb">min</span><span class="p">,</span> <span class="nb">max</span><span class="p">),)</span>

    <span class="c1"># Domain given extensively</span>
    <span class="k">assert</span> <span class="p">(</span><span class="nb">min</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">max</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">),</span> <span class="s2">&quot;If domain is given extensively in &#39;domain&#39;, &#39;min&#39; and/or &#39;max&#39; should not be given&quot;</span>
    <span class="k">if</span> <span class="n">is_int</span><span class="p">(</span><span class="n">domain</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">domain</span>
    <span class="n">domain</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">domain</span><span class="p">)</span>  <span class="c1">#In case domain is a generator</span>
    <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span><span class="n">_is_cpo_int</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="ow">or</span> <span class="n">_is_cpo_int_interval</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">domain</span><span class="p">),</span> <span class="s2">&quot;Argument &#39;domain&#39; should be a list of integers and/or intervals (tuples of 2 integers)&quot;</span>
    <span class="k">return</span> <span class="n">IntegerDomain</span><span class="p">(</span><span class="n">domain</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_check_arg_step_function</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Check that an argument is a step function and raise error if wrong</span>
<span class="sd">    Args:</span>
<span class="sd">        arg:  Argument value</span>
<span class="sd">        name: Argument name</span>
<span class="sd">    Returns:</span>
<span class="sd">        Resulting step function</span>
<span class="sd">    Raises:</span>
<span class="sd">        Exception if argument has the wrong format</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">CpoExpr</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">arg</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">Type_StepFunction</span><span class="p">),</span> <span class="s2">&quot;Argument &#39;&quot;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;&#39; should be a CpoStepFunction&quot;</span>
    <span class="k">return</span> <span class="n">arg</span>


<span class="k">def</span> <span class="nf">_check_arg_intensity</span><span class="p">(</span><span class="n">intensity</span><span class="p">,</span> <span class="n">granularity</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Check the intensity parameter of an interval var.</span>
<span class="sd">    Args:</span>
<span class="sd">       intensity:   Intensity function (None, or StepFunction).</span>
<span class="sd">       granularity: Granularity</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">__debug__</span> <span class="ow">and</span> <span class="p">(</span><span class="n">intensity</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">intensity</span><span class="p">,</span> <span class="n">CpoExpr</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">intensity</span><span class="o">.</span><span class="n">is_type</span><span class="p">(</span><span class="n">Type_StepFunction</span><span class="p">)),</span> <span class="s2">&quot;Interval variable &#39;intensity&#39; should be None or a CpoStepFunction&quot;</span>
        <span class="k">if</span> <span class="n">granularity</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">granularity</span> <span class="o">=</span> <span class="mi">100</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="n">intensity</span><span class="o">.</span><span class="n">get_step_list</span><span class="p">():</span>
            <span class="k">assert</span> <span class="n">is_int</span><span class="p">(</span><span class="n">s</span><span class="p">),</span> <span class="s2">&quot;&#39;intensity&#39; step start should be an integer&quot;</span>
            <span class="k">assert</span> <span class="n">is_int</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">v</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">v</span> <span class="o">&lt;=</span> <span class="n">granularity</span><span class="p">),</span> <span class="s2">&quot;&#39;intensity&#39; step value should be in [0..granularity]&quot;</span>


<span class="k">def</span> <span class="nf">_check_and_expand_interval_tuples</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">arr</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Check that a list contains only integers and expand interval tuples if any</span>
<span class="sd">    Args:</span>
<span class="sd">        name:  Argument name</span>
<span class="sd">        arr:   Array of integers and/or intervals</span>
<span class="sd">    Returns:</span>
<span class="sd">        Array of integers</span>
<span class="sd">    Raises:</span>
<span class="sd">        Exception if wrong type</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)),</span> <span class="s2">&quot;Argument &#39;</span><span class="si">{}</span><span class="s2">&#39; (type </span><span class="si">{}</span><span class="s2">) should be a list of integers or intervals&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">arr</span><span class="p">))</span>
    <span class="n">res</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="p">)):</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">arr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">is_int</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">res</span><span class="p">:</span>
                <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">_is_cpo_int_interval</span><span class="p">(</span><span class="n">v</span><span class="p">),</span> <span class="s2">&quot;Argument &#39;</span><span class="si">{}</span><span class="s2">&#39; (type </span><span class="si">{}</span><span class="s2">) should be a list of integers or intervals&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">arr</span><span class="p">))</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">res</span><span class="p">:</span>
                <span class="n">res</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">arr</span><span class="p">[:</span><span class="n">i</span><span class="p">])</span>
            <span class="n">res</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
    <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">res</span> <span class="k">if</span> <span class="n">res</span> <span class="k">else</span> <span class="n">arr</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_get_matching_signature</span><span class="p">(</span><span class="n">oper</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Search the first operation signature matched by a list of arguments</span>

<span class="sd">    Args:</span>
<span class="sd">        oper: Operation where searching signature</span>
<span class="sd">        args: Candidate list of argument expressions</span>
<span class="sd">    Returns:</span>
<span class="sd">        Matching signature, None if not found</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Search corresponding signature</span>
    <span class="k">return</span> <span class="nb">next</span><span class="p">((</span><span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">oper</span><span class="o">.</span><span class="n">signatures</span> <span class="k">if</span> <span class="n">_is_matching_arguments</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">args</span><span class="p">)),</span> <span class="kc">None</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_is_matching_arguments</span><span class="p">(</span><span class="n">sgn</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Check if a list of argument expressions matches this signature</span>

<span class="sd">    Args:</span>
<span class="sd">        sgn:  Signature descriptor</span>
<span class="sd">        args: Candidate list of argument expressions</span>
<span class="sd">    Returns:</span>
<span class="sd">        True if the arguments are matching signature</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">params</span> <span class="o">=</span> <span class="n">sgn</span><span class="o">.</span><span class="n">parameters</span>
    <span class="k">if</span> <span class="n">params</span> <span class="ow">is</span> <span class="n">ANY_ARGUMENTS</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">zip_longest</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">a</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Accepted if there is a parameter descriptor that is compatible with argument type</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">p</span> <span class="ow">and</span> <span class="n">a</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">is_kind_of</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">type</span><span class="p">)):</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Argument absent, check that parameter has a default value</span>
            <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">default_value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="kc">True</span>


<span class="k">def</span> <span class="nf">_is_equal_expressions</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Check if two expressions can be considered as equivalent.</span>

<span class="sd">    This method handles values that can be CPO expressions, None, and manage possible</span>
<span class="sd">    differences between number representations.</span>

<span class="sd">    It is implemented outside expression objects and use a self-managed stack to avoid too many</span>
<span class="sd">    recursive calls that may lead to an exception &#39;RuntimeError: maximum recursion depth exceeded&#39;.</span>

<span class="sd">    Args:</span>
<span class="sd">        v1:  First CPO expression</span>
<span class="sd">        v2:  Second CPO expression</span>
<span class="sd">    Returns:</span>
<span class="sd">        True if both values are &#39;equivalent&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Initialize expression stack</span>
    <span class="n">estack</span> <span class="o">=</span> <span class="p">[[</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]]</span>  <span class="c1"># [expr1, expr2, child index]</span>

    <span class="c1"># Loop while expression stack is not empty</span>
    <span class="k">while</span> <span class="n">estack</span><span class="p">:</span>
        <span class="c1"># Get expressions to compare</span>
        <span class="n">edscr</span> <span class="o">=</span> <span class="n">estack</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">cx</span> <span class="o">=</span> <span class="n">edscr</span>
        <span class="c1">#print(&quot;Compare {} (type {}) with {} (type {})&quot;.format(v1, type(v1), v2, type(v2)))</span>

        <span class="c1"># Skip aliases</span>
        <span class="k">while</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">CpoAlias</span><span class="p">):</span>
            <span class="n">v1</span> <span class="o">=</span> <span class="n">v1</span><span class="o">.</span><span class="n">expr</span>
        <span class="k">while</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v2</span><span class="p">,</span> <span class="n">CpoAlias</span><span class="p">):</span>
            <span class="n">v2</span> <span class="o">=</span> <span class="n">v2</span><span class="o">.</span><span class="n">expr</span>

        <span class="c1"># Check physical equality</span>
        <span class="k">if</span> <span class="n">v1</span> <span class="ow">is</span> <span class="n">v2</span><span class="p">:</span>
            <span class="n">estack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
            <span class="k">continue</span>

        <span class="c1"># Check same object type</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">v1</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">type</span><span class="p">(</span><span class="n">v2</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># Check if expression is a CPO expression</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">CpoExpr</span><span class="p">):</span>
            <span class="c1"># Check objects itself</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">cx</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">v1</span><span class="o">.</span><span class="n">_equals</span><span class="p">(</span><span class="n">v2</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="c1"># Access children</span>
            <span class="n">ar1</span> <span class="o">=</span> <span class="n">v1</span><span class="o">.</span><span class="n">children</span>
            <span class="n">ar2</span> <span class="o">=</span> <span class="n">v2</span><span class="o">.</span><span class="n">children</span>
            <span class="c1"># Check children</span>
            <span class="n">alen</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ar1</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">cx</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">alen</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ar2</span><span class="p">)):</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="n">cx</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">cx</span> <span class="o">&gt;=</span> <span class="n">alen</span><span class="p">:</span>
                <span class="n">estack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                <span class="k">continue</span>
            <span class="c1"># Store new child index in descriptor</span>
            <span class="n">edscr</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">cx</span>
            <span class="c1"># Stack children to compare it</span>
            <span class="n">estack</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">ar1</span><span class="p">[</span><span class="n">cx</span><span class="p">],</span> <span class="n">ar2</span><span class="p">[</span><span class="n">cx</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">])</span>

        <span class="c1"># Else, expressions are Python values</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">_is_equal_values</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="n">estack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>

    <span class="c1"># Expressions identical</span>
    <span class="k">return</span> <span class="kc">True</span>


<span class="k">def</span> <span class="nf">_is_equal_values</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Check if two values can be considered as equivalent.</span>

<span class="sd">    This method handles values that can be CPO expressions, None, and manage possible</span>
<span class="sd">    differences between number representations.</span>

<span class="sd">    Args:</span>
<span class="sd">        v1:  First value</span>
<span class="sd">        v2:  Second value</span>
<span class="sd">    Returns:</span>
<span class="sd">        True if both values are &#39;equivalent&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Check obvious cases</span>
    <span class="k">if</span> <span class="n">v1</span> <span class="ow">is</span> <span class="n">v2</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="c1"># Check specifically CPO expressions (to not call &#39;==&#39; operator on it)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">CpoExpr</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">v1</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="n">v2</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v2</span><span class="p">,</span> <span class="n">CpoExpr</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="c1"># Check floats</span>
    <span class="k">if</span> <span class="n">is_float</span><span class="p">(</span><span class="n">v1</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">is_float</span><span class="p">(</span><span class="n">v2</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">v1</span> <span class="o">-</span> <span class="n">v2</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">_FLOATING_POINT_PRECISION</span> <span class="o">*</span> <span class="nb">max</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">v1</span><span class="p">),</span> <span class="nb">abs</span><span class="p">(</span><span class="n">v2</span><span class="p">)))</span>
    <span class="k">if</span> <span class="n">is_array</span><span class="p">(</span><span class="n">v1</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">is_array</span><span class="p">(</span><span class="n">v2</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">v1</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">v2</span><span class="p">))</span> <span class="ow">and</span> <span class="nb">all</span><span class="p">(</span><span class="n">_is_equal_values</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">)</span> <span class="k">for</span> <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">))</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v2</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">v1</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">v2</span><span class="p">))</span> <span class="ow">and</span> <span class="nb">all</span><span class="p">(</span><span class="n">_is_equal_values</span><span class="p">(</span><span class="n">v1</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">v2</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">v1</span><span class="p">)</span>
    <span class="c1"># Check finally basic equality</span>
    <span class="k">return</span> <span class="n">v1</span> <span class="o">==</span> <span class="n">v2</span>


<span class="k">def</span> <span class="nf">_reset_cache</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot; Reset expression cache (for testing purpose).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_CPO_VALUES_FROM_PYTHON</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">_to_string</span><span class="p">(</span><span class="n">expr</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Build a string representing an expression.</span>
<span class="sd">    Args:</span>
<span class="sd">        expr:  Expression to convert into string</span>
<span class="sd">    Returns:</span>
<span class="sd">        String representing this expression</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">docplex.cp.cpo.cpo_compiler</span> <span class="k">as</span> <span class="nn">compiler</span>
    <span class="k">return</span> <span class="n">compiler</span><span class="o">.</span><span class="n">expr_to_string</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">DOcplex.CP: Constraint Programming Modeling for Python V2.18 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2016, IBM.
    </div>
  </body>
</html>