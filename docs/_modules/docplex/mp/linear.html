<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>docplex.mp.linear &mdash; DOcplex Preview 1.0 documentation</title>
    
    <link rel="stylesheet" href="../../../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="DOcplex Preview 1.0 documentation" href="../../../index.html" />
    <link rel="up" title="Module code" href="../../index.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">DOcplex Preview 1.0 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for docplex.mp.linear</h1><div class="highlight"><pre>
<span class="c"># pylint: disable=too-many-lines</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span>

<span class="c"># fast merge of counter-like dictionaries</span>

<span class="kn">from</span> <span class="nn">six</span> <span class="kn">import</span> <span class="n">itervalues</span>
<span class="kn">from</span> <span class="nn">enum</span> <span class="kn">import</span> <span class="n">Enum</span>
<span class="kn">import</span> <span class="nn">operator</span>
<span class="kn">from</span> <span class="nn">docplex.mp.basic</span> <span class="kn">import</span> <span class="n">ModelingObject</span><span class="p">,</span> <span class="n">Expr</span>
<span class="kn">from</span> <span class="nn">docplex.mp.functional</span> <span class="kn">import</span> <span class="n">FunctionalExpr</span>

<span class="kn">from</span> <span class="nn">docplex.mp.utils</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">docplex.mp.utils</span> <span class="kn">import</span> <span class="n">StringIO</span>

<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">OrderedDict</span>


<div class="viewcode-block" id="VarType"><a class="viewcode-back" href="../../../docplex.mp.linear.html#docplex.mp.linear.VarType">[docs]</a><span class="k">class</span> <span class="nc">VarType</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; This class defines the various types of decision variables.</span>

<span class="sd">        This class should never be instantiated. Three instances of</span>
<span class="sd">        variable types are available for Binary, Integer and Continuous types.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">short_name</span><span class="p">,</span> <span class="n">lb</span><span class="p">,</span> <span class="n">ub</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Constructor</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_short_name</span> <span class="o">=</span> <span class="n">short_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lb</span> <span class="o">=</span> <span class="n">lb</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ub</span> <span class="o">=</span> <span class="n">ub</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">short_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;  Returns a short name string for the type.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_short_name</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">default_lb</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;  Returns the default lower bound for the type.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lb</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">default_ub</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;  Returns the default upper bound for the type.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ub</span>

    <span class="k">def</span> <span class="nf">compute_lb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">candidate_lb</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>  <span class="c"># pragma : no cover</span>

    <span class="k">def</span> <span class="nf">compute_ub</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">candidate_ub</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>  <span class="c"># pragma : no cover</span>

<div class="viewcode-block" id="VarType.is_discrete"><a class="viewcode-back" href="../../../docplex.mp.linear.html#docplex.mp.linear.VarType.is_discrete">[docs]</a>    <span class="k">def</span> <span class="nf">is_discrete</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns True if the type is a discrete type.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>  <span class="c"># pragma : no cover</span>
</div>
<div class="viewcode-block" id="VarType.accept_value"><a class="viewcode-back" href="../../../docplex.mp.linear.html#docplex.mp.linear.VarType.accept_value">[docs]</a>    <span class="k">def</span> <span class="nf">accept_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">numeric_value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns True if the numeric_value is valid for the type.</span>

<span class="sd">        Accepted values depend on the type:</span>

<span class="sd">        - Binary type accepts only 0 or 1.</span>

<span class="sd">        - Integer type accepts only integers.</span>

<span class="sd">        - Continuous type accepts any floating-point number within -inf and +inf, where inf</span>
<span class="sd">          is the model&#39;s infinity value.</span>

<span class="sd">        This method never raises any exception.</span>

<span class="sd">        :param numeric_value: The candidate value.</span>

<span class="sd">        :return: True if the candidate value is valid, else False.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>  <span class="c"># pragma : no cover</span>

    <span class="c"># compat</span></div>
    <span class="k">def</span> <span class="nf">is_continuous</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_discrete</span><span class="p">()</span>

<div class="viewcode-block" id="VarType.to_string"><a class="viewcode-back" href="../../../docplex.mp.linear.html#docplex.mp.linear.VarType.to_string">[docs]</a>    <span class="k">def</span> <span class="nf">to_string</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns a string representation of the type.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s">&quot;VarType_</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">short_name</span>
</div>
    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_string</span><span class="p">()</span>

    <span class="n">Binary</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">Integer</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">Continuous</span> <span class="o">=</span> <span class="bp">None</span>

</div>
<div class="viewcode-block" id="BinaryVarType"><a class="viewcode-back" href="../../../docplex.mp.linear.html#docplex.mp.linear.BinaryVarType">[docs]</a><span class="k">class</span> <span class="nc">BinaryVarType</span><span class="p">(</span><span class="n">VarType</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Binary variable type.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Constructor</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">VarType</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">short_name</span><span class="o">=</span><span class="s">&quot;binary&quot;</span><span class="p">,</span> <span class="n">lb</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ub</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">compute_lb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">candidate_lb</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">0.0</span>

    <span class="k">def</span> <span class="nf">compute_ub</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">candidate_ub</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">1.0</span>

    <span class="k">def</span> <span class="nf">is_discrete</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">True</span>

    <span class="k">def</span> <span class="nf">accept_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">numeric_value</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">numeric_value</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">numeric_value</span> <span class="o">==</span> <span class="mi">1</span>

</div>
<div class="viewcode-block" id="ContinuousVarType"><a class="viewcode-back" href="../../../docplex.mp.linear.html#docplex.mp.linear.ContinuousVarType">[docs]</a><span class="k">class</span> <span class="nc">ContinuousVarType</span><span class="p">(</span><span class="n">VarType</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Continuous variable type.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plus_infinity</span><span class="o">=</span><span class="mf">1e+20</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Constructor</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">VarType</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">short_name</span><span class="o">=</span><span class="s">&quot;float&quot;</span><span class="p">,</span> <span class="n">lb</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ub</span><span class="o">=</span><span class="n">plus_infinity</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_plus_infinity</span> <span class="o">=</span> <span class="n">plus_infinity</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_minus_infinity</span> <span class="o">=</span> <span class="o">-</span> <span class="n">plus_infinity</span>

    <span class="k">def</span> <span class="nf">compute_ub</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">candidate_ub</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plus_infinity</span> <span class="k">if</span> <span class="n">candidate_ub</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plus_infinity</span> <span class="k">else</span> <span class="nb">float</span><span class="p">(</span><span class="n">candidate_ub</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">compute_lb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">candidate_lb</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_minus_infinity</span> <span class="k">if</span> <span class="n">candidate_lb</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_minus_infinity</span> <span class="k">else</span> <span class="nb">float</span><span class="p">(</span><span class="n">candidate_lb</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">is_discrete</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">False</span>

    <span class="k">def</span> <span class="nf">accept_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">numeric_value</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_minus_infinity</span> <span class="o">&lt;=</span> <span class="n">numeric_value</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plus_infinity</span>

</div>
<div class="viewcode-block" id="IntegerVarType"><a class="viewcode-back" href="../../../docplex.mp.linear.html#docplex.mp.linear.IntegerVarType">[docs]</a><span class="k">class</span> <span class="nc">IntegerVarType</span><span class="p">(</span><span class="n">VarType</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Integer variable type.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plus_infinity</span><span class="o">=</span><span class="mf">1e+20</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Constructor</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">VarType</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">short_name</span><span class="o">=</span><span class="s">&quot;int&quot;</span><span class="p">,</span> <span class="n">lb</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ub</span><span class="o">=</span><span class="n">plus_infinity</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_plus_infinity</span> <span class="o">=</span> <span class="n">plus_infinity</span>

    <span class="k">def</span> <span class="nf">compute_ub</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">candidate_ub</span><span class="p">):</span>
        <span class="n">iub</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">candidate_ub</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plus_infinity</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">iub</span><span class="p">)</span> <span class="o">!=</span> <span class="n">iub</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">iub</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">iub</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">compute_lb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">candidate_lb</span><span class="p">):</span>
        <span class="n">ilb</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">candidate_lb</span><span class="p">,</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">_plus_infinity</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">ilb</span><span class="p">)</span> <span class="o">!=</span> <span class="n">ilb</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">ilb</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">ilb</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">is_discrete</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">True</span>

    <span class="k">def</span> <span class="nf">accept_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">numeric_value</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">is_int</span><span class="p">(</span><span class="n">numeric_value</span><span class="p">)</span> <span class="ow">or</span> <span class="n">numeric_value</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="n">numeric_value</span><span class="p">)</span>

<span class="c"># global scope</span></div>
<span class="n">VarType</span><span class="o">.</span><span class="n">Binary</span> <span class="o">=</span> <span class="n">BinaryVarType</span><span class="p">()</span>
<span class="n">VarType</span><span class="o">.</span><span class="n">Integer</span> <span class="o">=</span> <span class="n">IntegerVarType</span><span class="p">()</span>
<span class="n">VarType</span><span class="o">.</span><span class="n">Continuous</span> <span class="o">=</span> <span class="n">ContinuousVarType</span><span class="p">()</span>


<div class="viewcode-block" id="Var"><a class="viewcode-back" href="../../../docplex.mp.linear.html#docplex.mp.linear.Var">[docs]</a><span class="k">class</span> <span class="nc">Var</span><span class="p">(</span><span class="n">ModelingObject</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Decision variable object.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c"># @profile</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">vartype</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">lb</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">ub</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">_safe_domain</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">is_automatic_name</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;__init__(model, vartype, name, lb=None, ub=None)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ModelingObject</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">is_automatic_name</span><span class="o">=</span><span class="n">is_automatic_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_vartype</span> <span class="o">=</span> <span class="n">vartype</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_solution_value</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="k">if</span> <span class="n">_safe_domain</span><span class="p">:</span>
            <span class="c"># this is called by the var_list</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_lb</span> <span class="o">=</span> <span class="n">lb</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ub</span> <span class="o">=</span> <span class="n">ub</span>
        <span class="k">elif</span> <span class="n">ub</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">lb</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_lb</span> <span class="o">=</span> <span class="n">vartype</span><span class="o">.</span><span class="n">default_lb</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ub</span> <span class="o">=</span> <span class="n">vartype</span><span class="o">.</span><span class="n">default_ub</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">used_lb</span> <span class="o">=</span> <span class="n">vartype</span><span class="o">.</span><span class="n">default_lb</span> <span class="k">if</span> <span class="n">lb</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">vartype</span><span class="o">.</span><span class="n">compute_lb</span><span class="p">(</span><span class="n">lb</span><span class="p">)</span>
            <span class="n">used_ub</span> <span class="o">=</span> <span class="n">vartype</span><span class="o">.</span><span class="n">default_ub</span> <span class="k">if</span> <span class="n">ub</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">vartype</span><span class="o">.</span><span class="n">compute_ub</span><span class="p">(</span><span class="n">ub</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">used_lb</span> <span class="o">&lt;=</span> <span class="n">used_ub</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_lb</span> <span class="o">=</span> <span class="n">used_lb</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_ub</span> <span class="o">=</span> <span class="n">used_ub</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">model</span><span class="o">.</span><span class="n">fatal</span><span class="p">(</span><span class="s">&quot;Variable: {0} has empty domain: [{1}..{2}]&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">lb</span><span class="p">,</span> <span class="n">ub</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_model</span><span class="p">,</span> <span class="n">var_mapping</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">var_mapping</span><span class="p">[</span><span class="bp">self</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">typecheck_initial_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">numeric_value</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">vartype</span><span class="o">.</span><span class="n">accept_value</span><span class="p">(</span><span class="n">numeric_value</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">lb</span> <span class="o">&lt;=</span> <span class="n">numeric_value</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ub</span>

    <span class="k">def</span> <span class="nf">check_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_name</span><span class="p">):</span>
        <span class="n">ModelingObject</span><span class="o">.</span><span class="n">check_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_string</span><span class="p">(</span><span class="n">new_name</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">new_name</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fatal</span><span class="p">(</span><span class="s">&quot;Variable name accepts only non-empty strings, got: {0!s}&quot;</span><span class="p">,</span> <span class="n">new_name</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">new_name</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s">&quot;Variable name contains blank space, var: {0!s}, name: {1!s}&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">new_name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># INTERNAL Necessary for python 3</span>
        <span class="k">return</span> <span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">to_linear_expr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">linear_expr</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

<div class="viewcode-block" id="Var.set_name"><a class="viewcode-back" href="../../../docplex.mp.linear.html#docplex.mp.linear.Var.set_name">[docs]</a>    <span class="k">def</span> <span class="nf">set_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Changes the name of the variable.</span>

<span class="sd">        :param new_name: The new name of the variable. The new name should be a non-empty string.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">set_var_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_name</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Var.get_lb"><a class="viewcode-back" href="../../../docplex.mp.linear.html#docplex.mp.linear.Var.get_lb">[docs]</a>    <span class="k">def</span> <span class="nf">get_lb</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; This property is used to get or set the lower bound of the variable.</span>


<span class="sd">        Possible values for the lower bound depend on the variable type. Binary variables</span>
<span class="sd">        accept only 0 or 1 as bounds. An integer variable will convert the upper bound value to the</span>
<span class="sd">        ceiling integer value of the argument.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lb</span>
</div>
    <span class="k">def</span> <span class="nf">set_lb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lb</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">set_var_lb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lb</span><span class="p">)</span>

    <span class="n">lb</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">get_lb</span><span class="p">,</span> <span class="n">set_lb</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_internal_set_lb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lb</span><span class="p">):</span>
        <span class="c"># Internal, used only by the model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lb</span> <span class="o">=</span> <span class="n">lb</span>

    <span class="k">def</span> <span class="nf">_internal_set_ub</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ub</span><span class="p">):</span>
        <span class="c"># INTERNAL</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ub</span> <span class="o">=</span> <span class="n">ub</span>

    <span class="k">def</span> <span class="nf">_get_ub</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; This property is used to get or set the upper bound of the variable.</span>

<span class="sd">        Possible values for the upper bound depend on the variable type. Binary variables</span>
<span class="sd">        accept only 0 or 1 as bounds. An integer variable will convert the upper bound value to the</span>
<span class="sd">        floor integer value.</span>

<span class="sd">        To reset the upper bound to its default infinity value, use model.infinity.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ub</span>

    <span class="k">def</span> <span class="nf">_set_ub</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ub</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">set_var_ub</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ub</span><span class="p">)</span>

    <span class="n">ub</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_ub</span><span class="p">,</span> <span class="n">_set_ub</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">has_free_lb</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">is_free_lb</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_lb</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">has_free_ub</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">is_free_ub</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ub</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">is_free</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_free_lb</span><span class="p">()</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_free_ub</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lb</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ub</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">vartype</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns the variable type, an instance of VarType.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vartype</span>

    <span class="k">def</span> <span class="nf">_internal_set_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_type</span><span class="p">):</span>
        <span class="c"># INTERNAL</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_vartype</span> <span class="o">=</span> <span class="n">new_type</span>

    <span class="k">def</span> <span class="nf">has_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">avartype</span><span class="p">):</span>
        <span class="c"># internal</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vartype</span> <span class="o">==</span> <span class="n">avartype</span>

    <span class="k">def</span> <span class="nf">set_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_vartype</span><span class="p">):</span>
        <span class="c"># DOES NOT WORK</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">set_var_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_vartype</span><span class="p">)</span>  <span class="c"># pragma: no cover</span>

<div class="viewcode-block" id="Var.is_binary"><a class="viewcode-back" href="../../../docplex.mp.linear.html#docplex.mp.linear.Var.is_binary">[docs]</a>    <span class="k">def</span> <span class="nf">is_binary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns True if the variable has Binary type.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vartype</span> <span class="ow">is</span> <span class="n">VarType</span><span class="o">.</span><span class="n">Binary</span>
</div>
<div class="viewcode-block" id="Var.is_integer"><a class="viewcode-back" href="../../../docplex.mp.linear.html#docplex.mp.linear.Var.is_integer">[docs]</a>    <span class="k">def</span> <span class="nf">is_integer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns True if the variable has Integer type.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vartype</span> <span class="ow">is</span> <span class="n">VarType</span><span class="o">.</span><span class="n">Integer</span>
</div>
<div class="viewcode-block" id="Var.is_continuous"><a class="viewcode-back" href="../../../docplex.mp.linear.html#docplex.mp.linear.Var.is_continuous">[docs]</a>    <span class="k">def</span> <span class="nf">is_continuous</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns True if the variable has Continuous type.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vartype</span> <span class="ow">is</span> <span class="n">VarType</span><span class="o">.</span><span class="n">Continuous</span>
</div>
<div class="viewcode-block" id="Var.is_discrete"><a class="viewcode-back" href="../../../docplex.mp.linear.html#docplex.mp.linear.Var.is_discrete">[docs]</a>    <span class="k">def</span> <span class="nf">is_discrete</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Checks whether the variable has type Binary or Integer.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_binary</span><span class="p">()</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_integer</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Var.get_value"><a class="viewcode-back" href="../../../docplex.mp.linear.html#docplex.mp.linear.Var.get_value">[docs]</a>    <span class="k">def</span> <span class="nf">get_value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns the solution value of the variable.</span>

<span class="sd">        Raises an exception if the model has not been solved.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">solution_value</span>
</div>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">solution_value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; This property returns the solution value of the variable.</span>

<span class="sd">        Raises an exception if the model has not been solved.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_model_has_solution</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_solution_value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">unchecked_solution_value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># INTERNAL</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_solution_value</span>

    <span class="k">def</span> <span class="nf">_internal_set_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">engine_value</span><span class="p">):</span>
        <span class="c"># INTERNAL</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_solution_value</span> <span class="o">=</span> <span class="n">engine_value</span>

    <span class="k">def</span> <span class="nf">_internal_clear_value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># INTERNAL: used when returning from a failed solve.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_solution_value</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">__le__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="n">expr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_linear_expr</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">expr</span><span class="o">.</span><span class="n">le_constraint</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="n">expr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_linear_expr</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">expr</span><span class="o">.</span><span class="n">eq_constraint</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="c"># INTERNAL: For now, implemented as different ids.</span>
        <span class="k">return</span> <span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">id</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>  <span class="c"># pragma : no cover</span>

    <span class="k">def</span> <span class="nf">__ge__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_linear_expr</span><span class="p">()</span><span class="o">.</span><span class="n">ge_constraint</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__gt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">unsupported_operator_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&quot;&gt;&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">unsupported_operator_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&quot;&lt;&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">times</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">times</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="c"># --- outcomment this block to generate monomials on multiply</span>
        <span class="k">if</span> <span class="n">is_number</span><span class="p">(</span><span class="n">e</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">monomial_expr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span> <span class="k">if</span> <span class="n">e</span> <span class="ow">is</span> <span class="ow">not</span> <span class="mi">0</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">_zero_expr</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_linear_expr</span><span class="p">()</span><span class="o">.</span><span class="n">_internal_multiply</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__rmul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__mul__</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">plus</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">plus</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>  <span class="n">e</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_linear_expr</span><span class="p">()</span><span class="o">.</span><span class="n">_internal_add</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__radd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__add__</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">minus</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">minus</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_linear_expr</span><span class="p">()</span><span class="o">.</span><span class="n">_internal_subtract</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__rsub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="n">expr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">linear_expr</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">expr</span><span class="o">.</span><span class="n">_internal_subtract</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__div__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="n">expr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_linear_expr</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">expr</span><span class="o">.</span><span class="n">_internal_divide</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__truediv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="c"># for py3</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__div__</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>  <span class="c"># pragma : no cover</span>

    <span class="k">def</span> <span class="nf">__pos__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># the &quot;+e&quot; unary plus is syntactic sugar</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">__neg__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># the &quot;-e&quot; unary minus returns a linear expression</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">monomial_expr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__rtruediv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="c"># for py3</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fatal</span><span class="p">(</span><span class="s">&quot;Variable {0!s} cannot be used as quotient of {1!s}&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>  <span class="c"># pragma: no cover</span>

    <span class="k">def</span> <span class="nf">__rdiv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fatal</span><span class="p">(</span><span class="s">&quot;Variable {0!s} cannot be used as quotient of {1!s}&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>

<div class="viewcode-block" id="Var.__float__"><a class="viewcode-back" href="../../../docplex.mp.linear.html#docplex.mp.linear.Var.__float__">[docs]</a>    <span class="k">def</span> <span class="nf">__float__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Converts a decision variable to a floating-point number.</span>

<span class="sd">        This is only possible when the model has been solved.</span>
<span class="sd">        Otherwise an exception is raised.</span>
<span class="sd">        If the model has been solved, returns the variable&#39;s solution value.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">solution_value</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Var.to_bool"><a class="viewcode-back" href="../../../docplex.mp.linear.html#docplex.mp.linear.Var.to_bool">[docs]</a>    <span class="k">def</span> <span class="nf">to_bool</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="mf">1e-5</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Converts a variable value to a Boolean.</span>

<span class="sd">        This is only possible for discrete variables and assumes there is a solution.</span>
<span class="sd">        This method will raise an exception if the variable is not discrete</span>
<span class="sd">        (see is_discrete) or if the model has not been solved successfully.</span>

<span class="sd">        If the variable is above 1 or below -1 (within a tolerance),</span>
<span class="sd">        then it is converted to True.</span>

<span class="sd">        Note</span>
<span class="sd">            If the model has not been solved successfully, an exception is raised.</span>
<span class="sd">            If the variable is continuous, and exception is raised.</span>

<span class="sd">        :param precision: A floating-point number (default is 1e-5) used as tolerance margin.</span>

<span class="sd">        :return: True or False.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_discrete</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fatal</span><span class="p">(</span><span class="s">&quot;boolean conversion only for discrete variables, type is {0!s}&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">vartype</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">precision</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fatal</span><span class="p">(</span><span class="s">&quot;precision must be less than 1/2, got: {0!s}&quot;</span><span class="p">,</span> <span class="n">precision</span><span class="p">)</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">solution_value</span>  <span class="c"># this property checks for a solution.</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">value</span> <span class="o">&gt;=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">precision</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">value</span> <span class="o">&lt;=</span> <span class="o">-</span><span class="mi">1</span> <span class="o">+</span> <span class="n">precision</span><span class="p">)</span>

    <span class="c"># def __nonzero__(self):</span>
    <span class="c"># return self.to_boolean(precision=1e-5)</span>
</div>
<div class="viewcode-block" id="Var.__str__"><a class="viewcode-back" href="../../../docplex.mp.linear.html#docplex.mp.linear.Var.__str__">[docs]</a>    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns a string representation of the variable.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_string</span><span class="p">()</span>
</div>
    <span class="k">def</span> <span class="nf">to_string</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">print_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="ow">or</span> <span class="s">&#39;x_</span><span class="si">%s</span><span class="s">[</span><span class="si">%d</span><span class="s">]&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vartype</span><span class="o">.</span><span class="n">short_name</span><span class="p">,</span> <span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">print_name</span>

    <span class="k">def</span> <span class="nf">to_stringio</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">oss</span><span class="p">):</span>
        <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">to_string</span><span class="p">())</span>


<span class="c"># noinspection PyAbstractClass</span></div>
<span class="k">class</span> <span class="nc">AbstractLinearExpr</span><span class="p">(</span><span class="n">Expr</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">):</span>
        <span class="n">Expr</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dvar</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">unchecked_get_coef</span><span class="p">(</span><span class="n">dvar</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># INTERNAL: this is necessary to prevent expr from being an iterable.</span>
        <span class="c"># as it follows getitem protocol, it can mistakenly be interpreted as an iterable</span>
        <span class="c"># but this would make sum loop forever.</span>
        <span class="k">raise</span> <span class="ne">TypeError</span>



<span class="k">class</span> <span class="nc">MonomialExpr</span><span class="p">(</span><span class="n">AbstractLinearExpr</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">dvar</span><span class="p">,</span> <span class="n">coeff</span><span class="p">):</span>
        <span class="n">Expr</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">)</span>
        <span class="n">model</span><span class="o">.</span><span class="n">typecheck_var</span><span class="p">(</span><span class="n">dvar</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dvar</span> <span class="o">=</span> <span class="n">dvar</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_coef</span> <span class="o">=</span> <span class="n">coeff</span>

    <span class="k">def</span> <span class="nf">number_of_variables</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">1</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">var</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dvar</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">coef</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_coef</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">constant</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        For compatibiity.</span>
<span class="sd">        :return: 0 as monomials have no constant.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">clone</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">MonomialExpr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dvar</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_coef</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target_model</span><span class="p">,</span> <span class="n">var_mapping</span><span class="p">):</span>
        <span class="n">copy_var</span> <span class="o">=</span> <span class="n">var_mapping</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_dvar</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">MonomialExpr</span><span class="p">(</span><span class="n">target_model</span><span class="p">,</span> <span class="n">dvar</span><span class="o">=</span><span class="n">copy_var</span><span class="p">,</span> <span class="n">coeff</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_coef</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">iter_variables</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">iter</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">_dvar</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">unchecked_get_coef</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dvar</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_coef</span> <span class="k">if</span> <span class="n">dvar</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dvar</span> <span class="k">else</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">contains_var</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dvar</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dvar</span> <span class="ow">is</span> <span class="n">dvar</span>

    <span class="k">def</span> <span class="nf">is_normal_form</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_coef</span> <span class="o">!=</span> <span class="mi">0</span>

    <span class="c"># arithmetics</span>
    <span class="k">def</span> <span class="nf">negate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_coef</span> <span class="o">=</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_coef</span>

    <span class="k">def</span> <span class="nf">plus</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">e</span> <span class="ow">is</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_linear_expr</span><span class="p">()</span><span class="o">.</span><span class="n">_internal_add</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">minus</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="n">expr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_linear_expr</span><span class="p">()</span>
        <span class="n">expr</span><span class="o">.</span><span class="n">_internal_subtract</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">expr</span>

    <span class="k">def</span> <span class="nf">times</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">e</span> <span class="ow">is</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span>
        <span class="k">elif</span> <span class="n">is_number</span><span class="p">(</span><span class="n">e</span><span class="p">):</span>
            <span class="c"># return a fresh instance</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">monomial_expr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dvar</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_coef</span> <span class="o">*</span> <span class="n">e</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">expr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_linear_expr</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">expr</span><span class="o">.</span><span class="n">_internal_multiply</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">plus</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__radd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__add__</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">minus</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__rsub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">_to_linear_expr</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">.</span><span class="n">minus</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">times</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__rmul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">times</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__le__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_linear_expr</span><span class="p">()</span><span class="o">.</span><span class="n">le_constraint</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_linear_expr</span><span class="p">()</span><span class="o">.</span><span class="n">eq_constraint</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__ge__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_linear_expr</span><span class="p">()</span><span class="o">.</span><span class="n">ge_constraint</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="c"># unsupported operator</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">unsupported_operator_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&quot;&lt;&quot;</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__gt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="c"># unsupported operator</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">unsupported_operator_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&quot;&gt;&quot;</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">equals_expr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">MonomialExpr</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span> <span class="ow">is</span> <span class="n">other</span><span class="o">.</span><span class="n">var</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">coef</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">coef</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">LinearExpr</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">other</span><span class="o">.</span><span class="n">is_monomial</span><span class="p">():</span>
                <span class="k">return</span> <span class="bp">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">other_first_var</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">iter_variables</span><span class="p">())</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span> <span class="ow">is</span> <span class="n">other_first_var</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">coef</span> <span class="o">==</span> <span class="n">other</span><span class="p">[</span><span class="n">other_first_var</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>

    <span class="c"># conversion</span>
    <span class="k">def</span> <span class="nf">to_linear_expr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">self_as_dict</span> <span class="o">=</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_dvar</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_coef</span><span class="p">}</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">linear_expr</span><span class="p">(</span><span class="n">e</span><span class="o">=</span><span class="n">self_as_dict</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">to_stringio</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">oss</span><span class="p">,</span> <span class="n">nb_digits</span><span class="p">,</span> <span class="n">prod_symbol</span><span class="p">,</span> <span class="n">use_space</span><span class="p">,</span> <span class="n">var_namer</span><span class="o">=</span><span class="k">lambda</span> <span class="n">v</span><span class="p">:</span> <span class="n">v</span><span class="o">.</span><span class="n">name</span><span class="p">):</span>
        <span class="n">self_coef</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_coef</span>
        <span class="k">if</span> <span class="n">self_coef</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">self_coef</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;-&#39;</span><span class="p">)</span>
                <span class="n">self_coef</span> <span class="o">=</span> <span class="o">-</span> <span class="n">self_coef</span>
            <span class="k">if</span> <span class="n">self_coef</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_num_to_stringio</span><span class="p">(</span><span class="n">oss</span><span class="p">,</span> <span class="n">self_coef</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">use_space</span><span class="p">:</span>
                <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">prod_symbol</span><span class="p">:</span>
                <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">prod_symbol</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">use_space</span><span class="p">:</span>
                    <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">)</span>
        <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">var_namer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dvar</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">to_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nb_digits</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">prod_symbol</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">use_space</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="n">oss</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">to_stringio</span><span class="p">(</span><span class="n">oss</span><span class="p">,</span> <span class="n">nb_digits</span><span class="o">=</span><span class="n">nb_digits</span><span class="p">,</span> <span class="n">prod_symbol</span><span class="o">=</span><span class="n">prod_symbol</span><span class="p">,</span> <span class="n">use_space</span><span class="o">=</span><span class="n">use_space</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">oss</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_string</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">solution_value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">coef</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dvar</span><span class="o">.</span><span class="n">solution_value</span>


<span class="k">class</span> <span class="nc">LinearExpr</span><span class="p">(</span><span class="n">AbstractLinearExpr</span><span class="p">):</span>
    <span class="n">_private_instance_counter</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c"># what type to use for merging dicts</span>
    <span class="n">counter_type</span> <span class="o">=</span> <span class="n">Counter</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">number_of_instances</span><span class="p">():</span>
        <span class="k">return</span> <span class="n">LinearExpr</span><span class="o">.</span><span class="n">_private_instance_counter</span>  <span class="c"># pragma: no cover</span>

    <span class="k">def</span> <span class="nf">to_linear_expr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span>



    <span class="k">def</span> <span class="nf">_as_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        INTERNAL</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__terms</span>

    <span class="k">def</span> <span class="nf">__check_terms_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">terms</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        INTERNAL: check a given dictionary of terms for (var, float)</span>
<span class="sd">        :param terms:</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">terms</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fatal</span><span class="p">(</span><span class="s">&quot;expecting expression terms as python dict, got: {0!s}&quot;</span><span class="p">,</span> <span class="n">terms</span><span class="p">)</span>
        <span class="n">self_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">terms</span><span class="p">):</span>
            <span class="n">self_model</span><span class="o">.</span><span class="n">typecheck_var</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
            <span class="n">self_model</span><span class="o">.</span><span class="n">typecheck_num</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="s">&#39;LinearExpr:importTerms&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_assign_var_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var_seq</span><span class="p">,</span> <span class="n">is_safe</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        INTERNAL: Imports a list of variables, possibly with repetition.</span>
<span class="sd">        :param var_seq:</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">accumulated_counter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">counter_type</span><span class="p">(</span><span class="n">var_seq</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_assign_terms</span><span class="p">(</span><span class="n">accumulated_counter</span><span class="p">,</span> <span class="n">is_safe</span><span class="o">=</span><span class="n">is_safe</span><span class="p">,</span> <span class="n">assume_normalized</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">_assign_terms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">terms</span><span class="p">,</span> <span class="n">is_safe</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">assume_normalized</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_safe</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__check_terms_dict</span><span class="p">(</span><span class="n">terms</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">assume_normalized</span><span class="p">:</span>
            <span class="c"># BEWARE: creating ordered dict here is very expensive</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__terms</span> <span class="o">=</span> <span class="n">terms</span>  <span class="c"># OrderedDict(terms)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># must put back to normal form</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__terms</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">([(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">terms</span><span class="p">)</span> <span class="k">if</span> <span class="n">v</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">])</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">e</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">constant</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">Expr</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="c"># a global counter for performance measurement</span>
        <span class="n">LinearExpr</span><span class="o">.</span><span class="n">_private_instance_counter</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="c"># &quot;calling LinearExpr ctor, k=%d&quot; % LinearExpr.InstanceCounter)</span>
        <span class="k">if</span> <span class="mi">0</span> <span class="o">!=</span> <span class="n">constant</span><span class="p">:</span>
            <span class="n">model</span><span class="o">.</span><span class="n">typecheck_num</span><span class="p">(</span><span class="n">constant</span><span class="p">,</span> <span class="s">&#39;LinearExpr()&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_constant</span> <span class="o">=</span> <span class="n">constant</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__terms</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">e</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">Var</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__terms</span><span class="p">[</span><span class="n">e</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="n">is_number</span><span class="p">(</span><span class="n">e</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_constant</span> <span class="o">+=</span> <span class="n">e</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">MonomialExpr</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_add_term</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">var</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">coef</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="c"># cant we just plain copy the dict???</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">e</span><span class="p">):</span>
                <span class="n">model</span><span class="o">.</span><span class="n">typecheck_var</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
                <span class="n">model</span><span class="o">.</span><span class="n">typecheck_num</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="s">&#39;LinearExpr&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">k</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__terms</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="n">k</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fatal</span><span class="p">(</span><span class="s">&quot;Only tuples of len 2 are accepted to build an expression, got: {0!s}&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Var</span><span class="p">):</span>
                <span class="n">model</span><span class="o">.</span><span class="n">typecheck_num</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s">&#39;LinearExpr&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_add_term</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">e</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">Var</span><span class="p">):</span>
                <span class="n">model</span><span class="o">.</span><span class="n">typecheck_num</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s">&#39;LinearExpr&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_add_term</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">e</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fatal</span><span class="p">(</span><span class="s">&quot;Not a (variable, value) tuple: {0!s}&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">LinearExpr</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_constant</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">constant</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__terms</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">__terms</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="k">elif</span> <span class="n">is_iterable</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">is_string</span><span class="p">(</span><span class="n">e</span><span class="p">):</span>
            <span class="c"># assume only variables in iteration?:</span>
            <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">Var</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__terms</span><span class="p">[</span><span class="n">o</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">fatal</span><span class="p">(</span><span class="s">&#39;only variable sequences are accepted to build an expression, got: {0!s}&#39;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fatal</span><span class="p">(</span><span class="s">&quot;Cannot convert this to linear expression: {0!s}&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">clone</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns a deep copy of the expression on the same model.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c">#return LinearExpr(self.model,  self.__terms.copy(), self._constant)</span>
        <span class="n">cloned</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">linear_expr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_constant</span><span class="p">)</span>
        <span class="n">cloned</span><span class="o">.</span><span class="n">__terms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__terms</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">cloned</span>

    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target_model</span><span class="p">,</span> <span class="n">var_mapping</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns a copy of the expression on a different model.</span>

<span class="sd">        :param target_model:</span>
<span class="sd">        :param var_mapping:</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">copied_expr</span> <span class="o">=</span> <span class="n">target_model</span><span class="o">.</span><span class="n">linear_expr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">constant</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">v</span><span class="p">,</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="n">target_v</span> <span class="o">=</span> <span class="n">var_mapping</span><span class="p">[</span><span class="n">v</span><span class="p">]</span>
            <span class="n">copied_expr</span><span class="o">.</span><span class="n">_add_term</span><span class="p">(</span><span class="n">target_v</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">copied_expr</span>

    <span class="k">def</span> <span class="nf">negate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Modifies the self instance: all coefficients and constants are replaced by their opposite.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_constant</span> <span class="o">=</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_constant</span>
        <span class="n">opposite_terms</span> <span class="o">=</span> <span class="p">{</span><span class="n">v</span><span class="p">:</span> <span class="o">-</span><span class="n">k</span> <span class="k">for</span> <span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__terms</span><span class="p">)}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__terms</span> <span class="o">=</span> <span class="n">opposite_terms</span>

    <span class="k">def</span> <span class="nf">_clear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Clears the expression.</span>

<span class="sd">        All variables and coefficients are removed and the constant term is set to zero.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_constant</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__terms</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">equals_constant</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scalar</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_constant</span><span class="p">()</span> <span class="ow">and</span> <span class="p">(</span><span class="n">scalar</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_constant</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">is_zero_expr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">equals_constant</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">is_one</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">equals_constant</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">is_constant</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__terms</span>

    <span class="k">def</span> <span class="nf">is_variable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="mi">0</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">constant</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_of_variables</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">return</span> <span class="mi">1</span> <span class="o">==</span> <span class="nb">next</span><span class="p">(</span><span class="n">itervalues</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__terms</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">is_monomial</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">0</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">constant</span> <span class="ow">and</span> <span class="mi">1</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_of_variables</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">is_normal_form</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Returns True if expression has no zero coefficient.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__terms</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">if</span> <span class="mi">0</span> <span class="o">==</span> <span class="n">k</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">False</span>
        <span class="k">return</span> <span class="bp">True</span>

    <span class="k">def</span> <span class="nf">number_of_variables</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__terms</span><span class="p">)</span>

    <span class="c">#@profile</span>
    <span class="k">def</span> <span class="nf">unchecked_get_coef</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">avar</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Internal, does not check its argument is indeed a variable.</span>
<span class="sd">        :param avar:</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__terms</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">avar</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_set_coef</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">avar</span><span class="p">,</span> <span class="n">acoef</span><span class="p">):</span>
        <span class="c"># INTERNAL</span>
        <span class="k">if</span> <span class="mi">0</span> <span class="o">!=</span> <span class="n">acoef</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__terms</span><span class="p">[</span><span class="n">avar</span><span class="p">]</span> <span class="o">=</span> <span class="n">acoef</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_remove_term</span><span class="p">(</span><span class="n">avar</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">add_term</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">avar</span><span class="p">,</span> <span class="n">acoef</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">typecheck_var</span><span class="p">(</span><span class="n">avar</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_term</span><span class="p">(</span><span class="n">avar</span><span class="p">,</span> <span class="n">acoef</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">_add_term</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">avar</span><span class="p">,</span> <span class="n">acoef</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="c"># INTERNAL</span>
        <span class="n">self_terms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__terms</span>
        <span class="k">if</span> <span class="n">acoef</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">new_coef</span> <span class="o">=</span> <span class="n">acoef</span> <span class="o">+</span> <span class="n">self_terms</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">avar</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">new_coef</span><span class="p">:</span>
                <span class="n">self_terms</span><span class="p">[</span><span class="n">avar</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_coef</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">del</span> <span class="n">self_terms</span><span class="p">[</span><span class="n">avar</span><span class="p">]</span>

    <span class="c"># @profile</span>
    <span class="k">def</span> <span class="nf">_add_var</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">avar</span><span class="p">):</span>
        <span class="n">old_coeff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__terms</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">avar</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">new_coef</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">old_coeff</span>
        <span class="k">if</span> <span class="n">new_coef</span><span class="p">:</span>  <span class="c"># nonzero is True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__terms</span><span class="p">[</span><span class="n">avar</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_coef</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">__terms</span><span class="p">[</span><span class="n">avar</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">remove_term</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">avar</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">typecheck_var</span><span class="p">(</span><span class="n">avar</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_remove_term</span><span class="p">(</span><span class="n">avar</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_remove_term</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">avar</span><span class="p">):</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">__terms</span><span class="p">[</span><span class="n">avar</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">get_constant</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_constant</span>

    <span class="k">def</span> <span class="nf">set_constant</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">numval</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_constant</span> <span class="o">=</span> <span class="n">numval</span>

    <span class="n">constant</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">get_constant</span><span class="p">,</span> <span class="n">set_constant</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">iter_variables</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;  Iterates over all variables mentioned in the linear expression.</span>
<span class="sd">        Returns:</span>
<span class="sd">            An iterator object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__terms</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">var_set</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns the set of all variables mentioned in the expresion.</span>

<span class="sd">        As with all Python sets, the ordering of variable shas no particular meaning.</span>

<span class="sd">        Returns:</span>
<span class="sd">            An instance of set.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__terms</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">contains_var</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dvar</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Checks whether a decision variable is part of an expression.</span>

<span class="sd">        Returns True if dvar is mentioned in the expression with a nonzero coefficient.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">dvar</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__terms</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__terms</span><span class="p">[</span><span class="n">dvar</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>

    <span class="c"># def __contains__(self, avar):</span>
    <span class="c"># &quot;&quot;&quot;</span>
    <span class="c"># Overloads operator &quot;in&quot; for an expression and a variable</span>
    <span class="c">#     :param avar: a decision variable</span>
    <span class="c">#     :return: True if contains_var is true</span>
    <span class="c">#     &quot;&quot;&quot;</span>
    <span class="c">#     return self.contains_var(avar)</span>

    <span class="k">def</span> <span class="nf">equals_expr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">is_number</span><span class="p">(</span><span class="n">other</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">equals_number</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">LinearExpr</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">constant</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">constant</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">False</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_of_variables</span><span class="p">()</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">number_of_variables</span><span class="p">():</span>
                <span class="k">return</span> <span class="bp">False</span>
            <span class="k">for</span> <span class="n">dvar</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter_variables</span><span class="p">():</span>
                <span class="k">if</span> <span class="bp">self</span><span class="p">[</span><span class="n">dvar</span><span class="p">]</span> <span class="o">!=</span> <span class="n">other</span><span class="p">[</span><span class="n">dvar</span><span class="p">]:</span>
                    <span class="k">return</span> <span class="bp">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>

    <span class="k">def</span> <span class="nf">equals_number</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nb</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_constant</span><span class="p">()</span> <span class="ow">and</span> <span class="p">(</span><span class="n">nb</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_constant</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">equals_var</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">avar</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">0</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">constant</span> <span class="ow">and</span> <span class="mi">1</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__terms</span><span class="p">)</span> <span class="ow">and</span> <span class="mi">1</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">unchecked_get_coef</span><span class="p">(</span><span class="n">avar</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">to_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nb_digits</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">prod_symbol</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">use_space</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="n">oss</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">to_stringio</span><span class="p">(</span><span class="n">oss</span><span class="p">,</span> <span class="n">nb_digits</span><span class="p">,</span> <span class="n">prod_symbol</span><span class="p">,</span> <span class="n">use_space</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">oss</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>

    <span class="c"># noinspection PyPep8</span>
    <span class="k">def</span> <span class="nf">to_stringio</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">oss</span><span class="p">,</span> <span class="n">nb_digits</span><span class="p">,</span> <span class="n">prod_symbol</span><span class="p">,</span> <span class="n">use_space</span><span class="p">,</span> <span class="n">var_namer</span><span class="o">=</span><span class="k">lambda</span> <span class="n">v</span><span class="p">:</span> <span class="n">v</span><span class="o">.</span><span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Performs a side-effect on a passed stringIO object.</span>
<span class="sd">        :param oss: A stringIO object.</span>
<span class="sd">        :param nb_digits:</span>
<span class="sd">        :param prod_symbol: A string or None, symbol to be used between variables and coefs if any.</span>
<span class="sd">        :param use_space:</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">c</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">SP</span> <span class="o">=</span> <span class="s">&#39; &#39;</span>

        <span class="k">for</span> <span class="n">v</span><span class="p">,</span> <span class="n">coeff</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__terms</span><span class="p">):</span>
            <span class="k">if</span> <span class="mi">0</span> <span class="o">==</span> <span class="n">coeff</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="c"># 1 separator</span>
            <span class="k">if</span> <span class="n">use_space</span> <span class="ow">and</span> <span class="n">c</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">SP</span><span class="p">)</span>

            <span class="c"># ---</span>
            <span class="c"># sign is printed if  non-first OR negative</span>
            <span class="c"># at the end of this block coeff is positive</span>
            <span class="n">wrote_sign</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="k">if</span> <span class="n">coeff</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">c</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;-&#39;</span> <span class="k">if</span> <span class="n">coeff</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="s">&#39;+&#39;</span><span class="p">)</span>
                <span class="n">wrote_sign</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="k">if</span> <span class="n">coeff</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">coeff</span> <span class="o">=</span> <span class="o">-</span><span class="n">coeff</span>
            <span class="c"># ---</span>
            <span class="n">varname</span> <span class="o">=</span> <span class="n">var_namer</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
            <span class="k">if</span> <span class="mi">1</span> <span class="o">!=</span> <span class="n">coeff</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">wrote_sign</span> <span class="ow">and</span> <span class="n">use_space</span><span class="p">:</span>
                    <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">SP</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_num_to_stringio</span><span class="p">(</span><span class="n">oss</span><span class="p">,</span> <span class="n">coeff</span><span class="p">,</span> <span class="n">nb_digits</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">prod_symbol</span><span class="p">:</span>
                    <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">prod_symbol</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">wrote_sign</span> <span class="ow">and</span> <span class="n">c</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">use_space</span><span class="p">:</span>
                <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">SP</span><span class="p">)</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="n">use_space</span> <span class="ow">and</span> <span class="n">varname</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">isdigit</span><span class="p">():</span>
                <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">SP</span><span class="p">)</span>
            <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">varname</span><span class="p">)</span>
            <span class="n">c</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="n">k</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">constant</span>
        <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_num_to_stringio</span><span class="p">(</span><span class="n">oss</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">nb_digits</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">k</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">sign</span> <span class="o">=</span> <span class="s">&#39;-&#39;</span>
                <span class="n">k</span> <span class="o">=</span> <span class="o">-</span><span class="n">k</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sign</span> <span class="o">=</span> <span class="s">&#39;+&#39;</span>
            <span class="k">if</span> <span class="n">use_space</span><span class="p">:</span> <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">SP</span><span class="p">)</span>
            <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">sign</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">use_space</span><span class="p">:</span> <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">SP</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_num_to_stringio</span><span class="p">(</span><span class="n">oss</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">nb_digits</span><span class="p">)</span>

    <span class="c"># @profile</span>
    <span class="k">def</span> <span class="nf">_add_expr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other_expr</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Internal, assume other_expr is an expression.</span>
<span class="sd">        :param other_expr:</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">constant</span> <span class="o">+=</span> <span class="n">other_expr</span><span class="o">.</span><span class="n">constant</span>
        <span class="c"># merge term dictionaries</span>
        <span class="k">for</span> <span class="n">v</span><span class="p">,</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">other_expr</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="c"># use unchecked version</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_add_term</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>

    <span class="c"># --- algebra methods always modify self.</span>
    <span class="c">#@profile</span>
    <span class="k">def</span> <span class="nf">_internal_add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="c"># INTERNAL: modify self.</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">Var</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_add_var</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">is_number</span><span class="p">(</span><span class="n">e</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">e</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_constant</span> <span class="o">+=</span> <span class="n">e</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">LinearExpr</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_add_expr</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">MonomialExpr</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_add_term</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">var</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">coef</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">elt</span> <span class="ow">in</span> <span class="n">e</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_internal_add</span><span class="p">(</span><span class="n">elt</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fatal</span><span class="p">(</span><span class="s">&quot;Unexpected argument for add: {0!s}&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="c"># def _add_scaled(self, e, factor):</span>
    <span class="c">#     assert (is_number(factor))</span>
    <span class="c">#     if isinstance(e, LinearExpr):</span>
    <span class="c">#         if e.is_zero_expr():</span>
    <span class="c">#             pass</span>
    <span class="c">#         else:</span>
    <span class="c">#             self.constant += (e.constant * factor)</span>
    <span class="c">#             # merge term dictionaries</span>
    <span class="c">#             for v, k in e.iteritems():</span>
    <span class="c">#                 if k != 0:</span>
    <span class="c">#                     self._add_term(v, k * factor)</span>
    <span class="c">#     elif isinstance(e, Var):</span>
    <span class="c">#         self._add_term(e, factor)</span>
    <span class="c">#     elif is_number(e):</span>
    <span class="c">#         self.constant += e * factor</span>
    <span class="c">#     elif e is None:</span>
    <span class="c">#         pass</span>
    <span class="c">#</span>
    <span class="c">#     # elif isinstance(e, list):</span>
    <span class="c">#     # for elt in e:</span>
    <span class="c">#     #         self.addScaled(elt, factor)</span>
    <span class="c">#     else:</span>
    <span class="c">#         raise TypeError</span>
    <span class="c">#     return self</span>

    <span class="k">def</span> <span class="nf">iteritems</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">iteritems</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__terms</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_internal_subtract</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        INTERNAL: Subtracts to self, self will be modified.</span>
<span class="sd">        :param e:</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">Var</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_add_term</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">is_number</span><span class="p">(</span><span class="n">e</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">e</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_constant</span> <span class="o">-=</span> <span class="n">e</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">LinearExpr</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">is_zero_expr</span><span class="p">():</span>
                <span class="k">return</span> <span class="bp">self</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c"># 1. decr constant</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">constant</span> <span class="o">-=</span> <span class="n">e</span><span class="o">.</span><span class="n">constant</span>
                <span class="c"># merge term dictionaries </span>
                <span class="k">for</span> <span class="n">v</span><span class="p">,</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">e</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_add_term</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="o">-</span><span class="n">k</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">MonomialExpr</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_add_term</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">var</span><span class="p">,</span> <span class="o">-</span><span class="n">e</span><span class="o">.</span><span class="n">coef</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="c"># do not use is_iterable as string will loop</span>
            <span class="k">for</span> <span class="n">elt</span> <span class="ow">in</span> <span class="n">e</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_internal_subtract</span><span class="p">(</span><span class="n">elt</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fatal</span><span class="p">(</span><span class="s">&quot;Unexpected argument for subtract: {0!s}&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">scale</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">factor</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Internal, assume factor is a number.</span>
<span class="sd">        :param factor:</span>
<span class="sd">        :return: None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">factor</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_clear</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">factor</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_constant</span> <span class="o">*=</span> <span class="n">factor</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__terms</span> <span class="o">=</span> <span class="p">{</span><span class="n">v</span><span class="p">:</span> <span class="n">k</span> <span class="o">*</span> <span class="n">factor</span> <span class="k">for</span> <span class="n">v</span><span class="p">,</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__terms</span><span class="p">)}</span>

    <span class="k">def</span> <span class="nf">_internal_multiply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">is_number</span><span class="p">(</span><span class="n">e</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">LinearExpr</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">is_constant</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">constant</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fatal</span><span class="p">(</span><span class="s">&#39;cannot multiply by a non-constant expression {0!s}&#39;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">Var</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_constant</span><span class="p">():</span>
                <span class="n">k</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">constant</span>
                <span class="k">if</span> <span class="n">k</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_assign_terms</span><span class="p">({</span><span class="n">e</span><span class="p">:</span> <span class="n">k</span><span class="p">},</span> <span class="n">is_safe</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">assume_normalized</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">constant</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fatal</span><span class="p">(</span><span class="s">&quot;cannot multiply a non-constant expression by a variable: {0!s}&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fatal</span><span class="p">(</span><span class="s">&quot;Multiply expects variable, expr or number, got: {0!s}&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">_internal_divide</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_number</span><span class="p">(</span><span class="n">e</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fatal</span><span class="p">(</span><span class="s">&quot;Divide expects number, got: {0!s}&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
        <span class="k">if</span> <span class="mi">0</span> <span class="o">==</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fatal</span><span class="p">(</span><span class="s">&quot;Attempting zero divide on expression: {0!s}&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="n">inverse</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_internal_multiply</span><span class="p">(</span><span class="n">inverse</span><span class="p">)</span>

    <span class="c"># operator-based API</span>
    <span class="k">def</span> <span class="nf">opposite</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">cloned</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
        <span class="n">cloned</span><span class="o">.</span><span class="n">negate</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">cloned</span>

    <span class="k">def</span> <span class="nf">plus</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="n">cloned</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
        <span class="n">cloned</span><span class="o">.</span><span class="n">_internal_add</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cloned</span>

    <span class="k">def</span> <span class="nf">minus</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="n">cloned</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
        <span class="n">cloned</span><span class="o">.</span><span class="n">_internal_subtract</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cloned</span>

    <span class="k">def</span> <span class="nf">times</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="n">cloned</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">cloned</span><span class="o">.</span><span class="n">_internal_multiply</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">divide</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="n">cloned</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
        <span class="n">cloned</span><span class="o">.</span><span class="n">_internal_divide</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cloned</span>

    <span class="k">def</span> <span class="nf">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">plus</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__radd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__add__</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__iadd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_internal_add</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">minus</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__rsub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="n">cloned</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
        <span class="n">cloned</span><span class="o">.</span><span class="n">_internal_subtract</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cloned</span><span class="o">.</span><span class="n">opposite</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__isub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_internal_subtract</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__neg__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">opposite</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">times</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__imul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_internal_multiply</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__div__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__truediv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__div__</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>  <span class="c"># pragma : no cover</span>

    <span class="k">def</span> <span class="nf">__rtruediv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fatal</span><span class="p">(</span><span class="s">&quot;Expression {0} cannot be used as divider of {1}&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>  <span class="c"># pragma: no cover</span>

    <span class="k">def</span> <span class="nf">__rmul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__mul__</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_string</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__le__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">le_constraint</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">eq_constraint</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">unsupported_operator_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&quot;&lt;&quot;</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__gt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">unsupported_operator_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&quot;&gt;&quot;</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__ge__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ge_constraint</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">le_constraint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">le_constraint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">eq_constraint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">eq_constraint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">ge_constraint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">ge_constraint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">solution_value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; This property returns the solution value of the variable.</span>

<span class="sd">        Raises:</span>
<span class="sd">            An exception if the model has not been solved.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_model_has_solution</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_value</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">get_value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_model_has_solution</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_value</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_get_value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># INTERNAL: no checks</span>
        <span class="c"># PCO: what about reduce() here ?</span>
        <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">constant</span>
        <span class="k">for</span> <span class="n">var</span><span class="p">,</span> <span class="n">koef</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="n">val</span> <span class="o">+=</span> <span class="n">koef</span> <span class="o">*</span> <span class="n">var</span><span class="o">.</span><span class="n">unchecked_solution_value</span>
        <span class="k">return</span> <span class="n">val</span>

    <span class="k">def</span> <span class="nf">is_discrete</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns true if expression contains only discrete variables and coefficients.</span>

<span class="sd">        Example:</span>
<span class="sd">            If X is an integer variable, X, X+1, 2X+3 are discrete</span>
<span class="sd">            but X+0.3, 1.5X, 2X + 0.7 are not.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">constant</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">for</span> <span class="n">v</span><span class="p">,</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">v</span><span class="o">.</span><span class="n">is_discrete</span><span class="p">()</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">is_int</span><span class="p">(</span><span class="n">k</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">True</span>


<span class="k">class</span> <span class="nc">LinearConstraintType</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
    <span class="n">LE</span><span class="p">,</span> <span class="n">EQ</span><span class="p">,</span> <span class="n">GE</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>

    <span class="c"># NOTE: Never add a static field in an enum class: it would be interpreted as an other enum</span>

    <span class="k">def</span> <span class="nf">get_operator_symbol</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns a string operator for the constraint.</span>

<span class="sd">        Example:</span>
<span class="sd">            Returns string &quot;&lt;=&quot; for a exp1 &lt;= exp2 constraint.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A string describing the logical operator used in the constraint.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">_LinearConstraintType_Utils</span><span class="o">.</span><span class="n">get_operator</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">opposite</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns the opposite type of the constraint&#39;s type.</span>

<span class="sd">        Returns the type obtained by inverting the sense of comparison, that is:</span>
<span class="sd">            If the constraint is an EQ constraint, returns EQ.</span>
<span class="sd">            If the constraint is a LE constraint, returns GE.</span>
<span class="sd">            If the constraint is a GE constraint, returns LE.</span>

<span class="sd">        Returns:</span>
<span class="sd">            An instance of LinearConstraintType.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">_LinearConstraintType_Utils</span><span class="o">.</span><span class="n">get_opposite</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">_LinearConstraintType_Utils</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_get_map_value</span><span class="p">(</span><span class="n">cttype</span><span class="p">,</span> <span class="n">attribute_map</span><span class="p">,</span> <span class="n">default_value</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">cttype</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">attribute_map</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DOCplexException</span><span class="p">(</span><span class="s">&quot;unexpected constraint type: {0!s}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cttype</span><span class="p">))</span>  <span class="c"># pragma : no cover</span>

        <span class="k">return</span> <span class="n">attribute_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">cttype</span><span class="p">,</span> <span class="n">default_value</span><span class="p">)</span>

    <span class="n">_operator_symbol_map</span> <span class="o">=</span> <span class="p">{</span><span class="n">LinearConstraintType</span><span class="o">.</span><span class="n">LE</span><span class="p">:</span> <span class="s">&quot;&lt;=&quot;</span><span class="p">,</span>
                            <span class="n">LinearConstraintType</span><span class="o">.</span><span class="n">EQ</span><span class="p">:</span> <span class="s">&quot;==&quot;</span><span class="p">,</span>
                            <span class="n">LinearConstraintType</span><span class="o">.</span><span class="n">GE</span><span class="p">:</span> <span class="s">&quot;&gt;=&quot;</span><span class="p">}</span>
    <span class="n">_name_map</span> <span class="o">=</span> <span class="p">{</span><span class="n">LinearConstraintType</span><span class="o">.</span><span class="n">LE</span><span class="p">:</span> <span class="s">&quot;LE&quot;</span><span class="p">,</span>
                 <span class="n">LinearConstraintType</span><span class="o">.</span><span class="n">EQ</span><span class="p">:</span> <span class="s">&quot;EQ&quot;</span><span class="p">,</span>
                 <span class="n">LinearConstraintType</span><span class="o">.</span><span class="n">GE</span><span class="p">:</span> <span class="s">&quot;GE&quot;</span><span class="p">}</span>
    <span class="n">_opposite_map</span> <span class="o">=</span> <span class="p">{</span><span class="n">LinearConstraintType</span><span class="o">.</span><span class="n">LE</span><span class="p">:</span> <span class="n">LinearConstraintType</span><span class="o">.</span><span class="n">GE</span><span class="p">,</span>
                     <span class="n">LinearConstraintType</span><span class="o">.</span><span class="n">EQ</span><span class="p">:</span> <span class="n">LinearConstraintType</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span>
                     <span class="n">LinearConstraintType</span><span class="o">.</span><span class="n">GE</span><span class="p">:</span> <span class="n">LinearConstraintType</span><span class="o">.</span><span class="n">LE</span><span class="p">}</span>

    <span class="n">_python_op_map</span> <span class="o">=</span> <span class="p">{</span><span class="n">LinearConstraintType</span><span class="o">.</span><span class="n">LE</span><span class="p">:</span> <span class="n">operator</span><span class="o">.</span><span class="n">le</span><span class="p">,</span>
                      <span class="n">LinearConstraintType</span><span class="o">.</span><span class="n">EQ</span><span class="p">:</span> <span class="n">operator</span><span class="o">.</span><span class="n">eq</span><span class="p">,</span>
                      <span class="n">LinearConstraintType</span><span class="o">.</span><span class="n">GE</span><span class="p">:</span> <span class="n">operator</span><span class="o">.</span><span class="n">ge</span><span class="p">}</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_operator</span><span class="p">(</span><span class="n">cttype</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_LinearConstraintType_Utils</span><span class="o">.</span><span class="n">_get_map_value</span><span class="p">(</span><span class="n">cttype</span><span class="p">,</span> <span class="n">_LinearConstraintType_Utils</span><span class="o">.</span><span class="n">_operator_symbol_map</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_opposite</span><span class="p">(</span><span class="n">cttype</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_LinearConstraintType_Utils</span><span class="o">.</span><span class="n">_get_map_value</span><span class="p">(</span><span class="n">cttype</span><span class="p">,</span> <span class="n">_LinearConstraintType_Utils</span><span class="o">.</span><span class="n">_opposite_map</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_name</span><span class="p">(</span><span class="n">cttype</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_LinearConstraintType_Utils</span><span class="o">.</span><span class="n">_get_map_value</span><span class="p">(</span><span class="n">cttype</span><span class="p">,</span> <span class="n">_LinearConstraintType_Utils</span><span class="o">.</span><span class="n">_name_map</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_python_operator_fn</span><span class="p">(</span><span class="n">cttype</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the Python operator function associated with the ct.</span>
<span class="sd">        For example, returns operator.ge(a, b) for a GE constraint.</span>
<span class="sd">        :param cttype: A binary constraint type (LE, EQ, GE.</span>
<span class="sd">        :return: A Python operator function.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">_LinearConstraintType_Utils</span><span class="o">.</span><span class="n">_get_map_value</span><span class="p">(</span><span class="n">cttype</span><span class="p">,</span> <span class="n">_LinearConstraintType_Utils</span><span class="o">.</span><span class="n">_python_op_map</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Priority</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
    <span class="c"># priority values are not sequential integers</span>
    <span class="n">VERY_LOW</span><span class="p">,</span> <span class="n">LOW</span><span class="p">,</span> <span class="n">MEDIUM</span><span class="p">,</span> <span class="n">HIGH</span><span class="p">,</span> <span class="n">VERY_HIGH</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">6</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
    <span class="n">MANDATORY</span> <span class="o">=</span> <span class="mi">999999999</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">default_priority</span><span class="p">():</span>
        <span class="k">return</span> <span class="n">Priority</span><span class="o">.</span><span class="n">MEDIUM</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">all_sorted</span><span class="p">():</span>
        <span class="c"># INTERNAL</span>
        <span class="n">sorted_properties</span> <span class="o">=</span> <span class="p">[</span><span class="n">Priority</span><span class="o">.</span><span class="n">VERY_LOW</span><span class="p">,</span> <span class="n">Priority</span><span class="o">.</span><span class="n">LOW</span><span class="p">,</span> <span class="n">Priority</span><span class="o">.</span><span class="n">MEDIUM</span><span class="p">,</span> <span class="n">Priority</span><span class="o">.</span><span class="n">HIGH</span><span class="p">,</span> <span class="n">Priority</span><span class="o">.</span><span class="n">VERY_HIGH</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">sorted_properties</span>

    <span class="k">def</span> <span class="nf">_level</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># INTERNAL: retuens an integer value for priority</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>

    <span class="k">def</span> <span class="nf">print_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">priority_names</span> <span class="o">=</span> <span class="p">{</span><span class="n">Priority</span><span class="o">.</span><span class="n">MANDATORY</span><span class="p">:</span> <span class="s">&#39;Mandatory&#39;</span><span class="p">,</span>
                          <span class="n">Priority</span><span class="o">.</span><span class="n">HIGH</span><span class="p">:</span> <span class="s">&#39;High&#39;</span><span class="p">,</span>
                          <span class="n">Priority</span><span class="o">.</span><span class="n">VERY_HIGH</span><span class="p">:</span> <span class="s">&quot;Very High&quot;</span><span class="p">,</span>
                          <span class="n">Priority</span><span class="o">.</span><span class="n">MEDIUM</span><span class="p">:</span> <span class="s">&#39;Medium&#39;</span><span class="p">,</span>
                          <span class="n">Priority</span><span class="o">.</span><span class="n">LOW</span><span class="p">:</span> <span class="s">&#39;Low&#39;</span><span class="p">,</span>
                          <span class="n">Priority</span><span class="o">.</span><span class="n">VERY_LOW</span><span class="p">:</span> <span class="s">&#39;Very Low&#39;</span><span class="p">}</span>
        <span class="k">return</span> <span class="n">priority_names</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&quot;Unexpected Priority&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_geometric_preference_factor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="mf">10.0</span><span class="p">):</span>
        <span class="c"># INTERNAL: returns a CPLEX preference factor as a poer of &quot;base&quot;</span>
        <span class="c"># MEDIUM priority has always a preference factor of 1</span>
        <span class="k">assert</span> <span class="n">is_number</span><span class="p">(</span><span class="n">base</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_mandatory</span><span class="p">():</span>
            <span class="k">return</span> <span class="mf">1e+20</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># pylint complains about no value member but is wrong!</span>
            <span class="n">diff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">-</span> <span class="n">Priority</span><span class="o">.</span><span class="n">MEDIUM</span><span class="o">.</span><span class="n">value</span>
            <span class="n">factor</span> <span class="o">=</span> <span class="mf">1.0</span>
            <span class="n">pdiff</span> <span class="o">=</span> <span class="n">diff</span> <span class="k">if</span> <span class="n">diff</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="k">else</span> <span class="o">-</span><span class="n">diff</span>
            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">pdiff</span><span class="p">):</span>
                <span class="n">factor</span> <span class="o">*=</span> <span class="n">base</span>
            <span class="k">return</span> <span class="n">factor</span> <span class="k">if</span> <span class="n">diff</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="k">else</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">factor</span>

    <span class="k">def</span> <span class="nf">less_than</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Priority</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_level</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">other</span><span class="o">.</span><span class="n">_level</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">less_than</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__gt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">other</span><span class="o">.</span><span class="n">less_than</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">is_mandatory</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span> <span class="o">==</span> <span class="n">Priority</span><span class="o">.</span><span class="n">MANDATORY</span>


<span class="k">class</span> <span class="nc">AbstractConstraint</span><span class="p">(</span><span class="n">ModelingObject</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">ModelingObject</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_unsupported_relational_op</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">op_string</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fatal</span><span class="p">(</span><span class="s">&quot;Cannot use relational operator {1} on linear constraint: {0!s}&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">op_string</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__le__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_unsupported_relational_op</span><span class="p">(</span><span class="s">&quot;&lt;=&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__ge__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_unsupported_relational_op</span><span class="p">(</span><span class="s">&quot;&gt;=&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_unsupported_relational_op</span><span class="p">(</span><span class="s">&quot;&lt;&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__gt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_unsupported_relational_op</span><span class="p">(</span><span class="s">&quot;&gt;&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>

    <span class="c"># def __eq__(self, e):</span>
    <span class="c"># self._unsupported_relational_op(&quot;==&quot;, e)</span>

    <span class="k">def</span> <span class="nf">_no_linear_ct_in_logical_test_error</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fatal</span><span class="p">(</span><span class="s">&quot;cannot convert a constraint to boolean: {0!s}&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__nonzero__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_no_linear_ct_in_logical_test_error</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__bool__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># python 3 version of nonzero</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_no_linear_ct_in_logical_test_error</span><span class="p">()</span>  <span class="c"># pragma : no cover</span>

    <span class="k">def</span> <span class="nf">iter_variables</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>  <span class="c"># pragma : no cover</span>

    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">traget_model</span><span class="p">,</span> <span class="n">var_map</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>  <span class="c"># pragma : no cover</span>

    <span class="c"># noinspection PyMethodMayBeStatic</span>
    <span class="k">def</span> <span class="nf">notify_deleted</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># INTERNAL</span>
        <span class="k">pass</span>  <span class="c"># pragma : no cover</span>

    <span class="k">def</span> <span class="nf">short_typename</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&quot;constraint&quot;</span>

    <span class="k">def</span> <span class="nf">is_trivial</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">False</span>


<span class="c"># noinspection PyAbstractClass</span>
<span class="k">class</span> <span class="nc">AbstractLinearConstraint</span><span class="p">(</span><span class="n">AbstractConstraint</span><span class="p">):</span>
    <span class="c"># INTERNAL:  base class for linear constraints</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">AbstractConstraint</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">traget_model</span><span class="p">,</span> <span class="n">var_map</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>  <span class="c"># pragma : no cover</span>

    <span class="k">def</span> <span class="nf">getVarCoef</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dvar</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns the coefficient of the variable in the constraint.</span>
<span class="sd">             Calls the unsafe fastGetCoef method once type has been checked.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">typecheck_var</span><span class="p">(</span><span class="n">dvar</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fast_get_coef</span><span class="p">(</span><span class="n">dvar</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">fast_get_coef</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Redefine this method for concrete sub-classes.&quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>  <span class="c"># pragma: no cover</span>

    <span class="k">def</span> <span class="nf">rhs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Redefine this for any concrete constraint class.&quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>  <span class="c"># pragma: no cover</span>

    <span class="k">def</span> <span class="nf">is_ranged_constraint</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">False</span>


<span class="c"># noinspection PyAbstractClass</span>
<span class="k">class</span> <span class="nc">AbstractLogicalConstraint</span><span class="p">(</span><span class="n">AbstractConstraint</span><span class="p">):</span>
    <span class="c"># INTERNAL Root class for all logical stuff constraints</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">AbstractConstraint</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>


<div class="viewcode-block" id="BinaryLinearConstraint"><a class="viewcode-back" href="../../../docplex.mp.linear.html#docplex.mp.linear.BinaryLinearConstraint">[docs]</a><span class="k">class</span> <span class="nc">BinaryLinearConstraint</span><span class="p">(</span><span class="n">AbstractLinearConstraint</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; The class that models all constraints of the form &lt;expr1&gt; &lt;OP&gt; &lt;expr2&gt;.</span>

<span class="sd">    BinaryLinearConstraint()</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">left_expr</span><span class="p">,</span> <span class="n">ctype</span><span class="p">,</span> <span class="n">right_expr</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">AbstractLinearConstraint</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__type__</span> <span class="o">=</span> <span class="n">ctype</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_left_expr</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">_to_linear_expr</span><span class="p">(</span><span class="n">left_expr</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_right_expr</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">_to_linear_expr</span><span class="p">(</span><span class="n">right_expr</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_canonical_form_expr</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_left_expr</span><span class="o">.</span><span class="n">model</span> <span class="ow">is</span> <span class="n">model</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_right_expr</span><span class="o">.</span><span class="n">model</span> <span class="ow">is</span> <span class="n">model</span>

    <span class="k">def</span> <span class="nf">is_trivial</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Checks whether the constraint is equivalent to a comparison between numbers.</span>
        <span class="c"># For example, x &lt;= x+1 is trivial, but 1.5 X &lt;= X + 1 is not.</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_canonical_form</span><span class="p">()</span><span class="o">.</span><span class="n">is_constant</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">is_trivial_feasible</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_trivial</span><span class="p">()</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_trivially_feasible</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">is_trivial_infeasible</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_trivial</span><span class="p">()</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_trivially_infeasible</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_is_trivially_feasible</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># INTERNAL : assume self is trivial()</span>
        <span class="n">op_func</span> <span class="o">=</span> <span class="n">_LinearConstraintType_Utils</span><span class="o">.</span><span class="n">get_python_operator_fn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">op_func</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">left_expr</span><span class="o">.</span><span class="n">constant</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">right_expr</span><span class="o">.</span><span class="n">constant</span><span class="p">)</span> <span class="k">if</span> <span class="n">op_func</span> <span class="k">else</span> <span class="bp">False</span>

    <span class="k">def</span> <span class="nf">_is_trivially_infeasible</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># INTERNAL: assume self is trivial .</span>
        <span class="n">op_func</span> <span class="o">=</span> <span class="n">_LinearConstraintType_Utils</span><span class="o">.</span><span class="n">get_python_operator_fn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">)</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="n">op_func</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">left_expr</span><span class="o">.</span><span class="n">constant</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">right_expr</span><span class="o">.</span><span class="n">constant</span><span class="p">)</span> <span class="k">if</span> <span class="n">op_func</span> <span class="k">else</span> <span class="bp">False</span>

    <span class="k">def</span> <span class="nf">_canonical_form</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># INTERNAL</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_canonical_form_expr</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_canonical_form_expr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">left_expr</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">right_expr</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_canonical_form_expr</span>

    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target_model</span><span class="p">,</span> <span class="n">var_map</span><span class="p">):</span>
        <span class="n">copied_left</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">left_expr</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">target_model</span><span class="p">,</span> <span class="n">var_map</span><span class="p">)</span>
        <span class="n">copied_right</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">right_expr</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">target_model</span><span class="p">,</span> <span class="n">var_map</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">NewBinaryConstraint</span><span class="p">(</span><span class="n">target_model</span><span class="p">,</span> <span class="n">copied_left</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">copied_right</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; This property returns the type of the constraint; type is an enumerated value</span>
<span class="sd">        of type LinearConstraintType, with three possible values:</span>

<span class="sd">        - LE for e1 &lt;= e2 constraints</span>

<span class="sd">        - EQ for e1 == e2 constraints</span>

<span class="sd">        - GE for e1 &gt;= e2 constraints</span>

<span class="sd">        where e1 and e2 denote linear expressions.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__type__</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">left_expr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; This property returns the left expression in the constraint.</span>

<span class="sd">        Example:</span>
<span class="sd">            (X+Y &lt;= Z+1) has left expression (X+Y).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_left_expr</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">right_expr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; This property returns the right expression in the constraint.</span>

<span class="sd">        Example:</span>
<span class="sd">            (X+Y &lt;= Z+1) has right expression (Z+1).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_right_expr</span>

<div class="viewcode-block" id="BinaryLinearConstraint.to_string"><a class="viewcode-back" href="../../../docplex.mp.linear.html#docplex.mp.linear.BinaryLinearConstraint.to_string">[docs]</a>    <span class="k">def</span> <span class="nf">to_string</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns a string representation of the constraint.</span>

<span class="sd">        The operators in this representation are the usual operators &lt;=, ==, and &gt;=.</span>

<span class="sd">        Example:</span>
<span class="sd">            The constraint (X+Y &lt;= Z+1) is represented as &quot;X+Y &lt;= Z+1&quot;.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">left_expr</span><span class="o">.</span><span class="n">to_string</span><span class="p">(),</span>
                             <span class="bp">self</span><span class="o">.</span><span class="n">__type__</span><span class="o">.</span><span class="n">get_operator_symbol</span><span class="p">(),</span>
                             <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">right_expr</span><span class="p">))</span>
</div>
    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_string</span><span class="p">()</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">NewBinaryConstraint</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">left_expr</span><span class="p">,</span> <span class="n">ctype</span><span class="p">,</span> <span class="n">right_expr</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">LinearConstraintType</span><span class="o">.</span><span class="n">LE</span> <span class="o">==</span> <span class="n">ctype</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">BinaryLEConstraint</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">left_expr</span><span class="p">,</span> <span class="n">right_expr</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">LinearConstraintType</span><span class="o">.</span><span class="n">GE</span> <span class="o">==</span> <span class="n">ctype</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">BinaryGEConstraint</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">left_expr</span><span class="p">,</span> <span class="n">right_expr</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">LinearConstraintType</span><span class="o">.</span><span class="n">EQ</span> <span class="o">==</span> <span class="n">ctype</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">BinaryEQConstraint</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">left_expr</span><span class="p">,</span> <span class="n">right_expr</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">model</span><span class="o">.</span><span class="n">fatal</span><span class="p">(</span><span class="s">&quot;Unexpected constraint type: {0!s}&quot;</span><span class="p">,</span> <span class="n">ctype</span><span class="p">)</span>  <span class="c"># pragma: no cover</span>

    <span class="k">def</span> <span class="nf">__le__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="c"># INTERNAL: try to define ranges with operators, doe snot work.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_number</span><span class="p">(</span><span class="n">e</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fatal</span><span class="p">(</span><span class="s">&quot;operator &lt;= on constraint requires numeric argument, got: {0!s}&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="ow">is</span> <span class="n">LinearConstraintType</span><span class="o">.</span><span class="n">GE</span><span class="p">:</span>
            <span class="n">rhs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">right_expr</span>
            <span class="k">if</span> <span class="n">rhs</span><span class="o">.</span><span class="n">is_constant</span><span class="p">():</span>
                <span class="n">rangeMin</span> <span class="o">=</span> <span class="n">rhs</span><span class="o">.</span><span class="n">get_constant</span><span class="p">()</span>
                <span class="n">rangeMax</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">range_constraint</span><span class="p">(</span><span class="n">rangeMin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">left_expr</span><span class="p">,</span> <span class="n">rangeMax</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fatal</span><span class="p">(</span><span class="s">&quot;operator &lt;= requires a constraint with numeric RHS, rhs is: {0!s}&quot;</span><span class="p">,</span> <span class="n">rhs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fatal</span><span class="p">(</span><span class="s">&quot;operator &lt;= is only allowed for LE constraints, type is: {0!s}&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__ge__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="c"># INTERNAL: try to define ranges with operators, does not work.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_number</span><span class="p">(</span><span class="n">e</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">DOCplexException</span><span class="p">(</span><span class="s">&quot;operator &gt;= on constraints requires number argument, got:</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="ow">is</span> <span class="n">LinearConstraintType</span><span class="o">.</span><span class="n">LE</span><span class="p">:</span>
            <span class="n">rhs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">right_expr</span>
            <span class="k">if</span> <span class="n">rhs</span><span class="o">.</span><span class="n">is_constant</span><span class="p">():</span>
                <span class="n">range_max</span> <span class="o">=</span> <span class="n">rhs</span><span class="o">.</span><span class="n">get_constant</span><span class="p">()</span>
                <span class="n">range_min</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">range_constraint</span><span class="p">(</span><span class="n">range_min</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">left_expr</span><span class="p">,</span> <span class="n">range_max</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">DOCplexException</span><span class="p">(</span><span class="s">&quot;operator &gt;= requires a constraint with numeric RHS, got:</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">rhs</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DOCplexException</span><span class="p">(</span><span class="s">&quot;operator &gt;= is only allowed for GE constraints&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="BinaryLinearConstraint.iter_variables"><a class="viewcode-back" href="../../../docplex.mp.linear.html#docplex.mp.linear.BinaryLinearConstraint.iter_variables">[docs]</a>    <span class="k">def</span> <span class="nf">iter_variables</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns an iterator on all variables mentioned in the constraint.</span>

<span class="sd">        Note: Includes variables mentioned with a zero coefficient. For example,</span>
<span class="sd">        the iterator on the following constraint:</span>

<span class="sd">         X &lt;= X+Y + 1</span>

<span class="sd">        will return X and Y, although X is mentioned with a zero coefficient.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">left_vars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">left_expr</span><span class="o">.</span><span class="n">var_set</span><span class="p">()</span>
        <span class="n">right_vars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">right_expr</span><span class="o">.</span><span class="n">var_set</span><span class="p">()</span>
        <span class="n">union_vars</span> <span class="o">=</span> <span class="n">left_vars</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">right_vars</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="n">union_vars</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">contains_var</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dvar</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_left_expr</span><span class="o">.</span><span class="n">contains_var</span><span class="p">(</span><span class="n">dvar</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_right_expr</span><span class="o">.</span><span class="n">contains_var</span><span class="p">(</span><span class="n">dvar</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">fast_get_coef</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dvar</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_canonical_form</span><span class="p">()</span><span class="o">.</span><span class="n">unchecked_get_coef</span><span class="p">(</span><span class="n">dvar</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">rhs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">right_cst</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_right_expr</span><span class="o">.</span><span class="n">get_constant</span><span class="p">()</span>
        <span class="n">left_cst</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_left_expr</span><span class="o">.</span><span class="n">get_constant</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">right_cst</span> <span class="o">-</span> <span class="n">left_cst</span>

</div>
<span class="k">class</span> <span class="nc">BinaryLEConstraint</span><span class="p">(</span><span class="n">BinaryLinearConstraint</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">left_expr</span><span class="p">,</span> <span class="n">right_expr</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">BinaryLinearConstraint</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">left_expr</span><span class="p">,</span> <span class="n">LinearConstraintType</span><span class="o">.</span><span class="n">LE</span><span class="p">,</span> <span class="n">right_expr</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">BinaryGEConstraint</span><span class="p">(</span><span class="n">BinaryLinearConstraint</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">left_expr</span><span class="p">,</span> <span class="n">right_expr</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">BinaryLinearConstraint</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">left_expr</span><span class="p">,</span> <span class="n">LinearConstraintType</span><span class="o">.</span><span class="n">GE</span><span class="p">,</span> <span class="n">right_expr</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">BinaryEQConstraint</span><span class="p">(</span><span class="n">BinaryLinearConstraint</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">left_expr</span><span class="p">,</span> <span class="n">right_expr</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">BinaryLinearConstraint</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">left_expr</span><span class="p">,</span> <span class="n">LinearConstraintType</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="n">right_expr</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">_DummyFeasibleConstraint</span><span class="p">(</span><span class="n">BinaryEQConstraint</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; A dummy constraint that is never posted to CPLEX.&#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">zero</span><span class="p">):</span>
        <span class="n">BinaryEQConstraint</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">zero</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;_dummy_feasible_ct_&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">_DummyInfeasibleConstraint</span><span class="p">(</span><span class="n">BinaryEQConstraint</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; A dummy constraint, on which is mapped all infeasible A op B comparison results.&#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">zero</span><span class="p">):</span>
        <span class="n">BinaryEQConstraint</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">zero</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&quot;_dummy_infeasible_ct_&quot;</span><span class="p">)</span>


<div class="viewcode-block" id="RangeConstraint"><a class="viewcode-back" href="../../../docplex.mp.linear.html#docplex.mp.linear.RangeConstraint">[docs]</a><span class="k">class</span> <span class="nc">RangeConstraint</span><span class="p">(</span><span class="n">AbstractLinearConstraint</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; This class models range constraints</span>

<span class="sd">    A range constraint states that an expression must stay between two</span>
<span class="sd">    values lb and ub.</span>

<span class="sd">    This class is not meant to be instantiated by the user.</span>
<span class="sd">    To create a range constraint, use the factory method add_range_consraint defined on Model.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="n">lb</span><span class="p">,</span> <span class="n">ub</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">AbstractLinearConstraint</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="n">model</span><span class="o">.</span><span class="n">typecheck_num</span><span class="p">(</span><span class="n">lb</span><span class="p">,</span> <span class="s">&#39;RangeConstraint.lb&#39;</span><span class="p">)</span>
        <span class="n">model</span><span class="o">.</span><span class="n">typecheck_num</span><span class="p">(</span><span class="n">ub</span><span class="p">,</span> <span class="s">&#39;RangeConstraint.ub&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__ub</span> <span class="o">=</span> <span class="n">ub</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__lb</span> <span class="o">=</span> <span class="n">lb</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__expr</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">_to_linear_expr</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">short_typename</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&quot;range&quot;</span>

    <span class="k">def</span> <span class="nf">is_ranged_constraint</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">True</span>

    <span class="k">def</span> <span class="nf">is_trivial</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__expr</span><span class="o">.</span><span class="n">is_constant</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_is_trivially_feasible</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># INTERNAL : assume self is trivial()</span>
        <span class="n">expr_num</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__expr</span><span class="o">.</span><span class="n">constant</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__lb</span> <span class="o">&lt;=</span> <span class="n">expr_num</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ub</span>

    <span class="k">def</span> <span class="nf">_is_trivially_infeasible</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># INTERNAL : assume self is trivial()</span>
        <span class="n">expr_num</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__expr</span><span class="o">.</span><span class="n">constant</span>
        <span class="k">return</span> <span class="n">expr_num</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">__lb</span> <span class="ow">or</span> <span class="n">expr_num</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ub</span>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">expr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns the linear expression of the range constraint.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__expr</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__lb</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ub</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">lb</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns the lower bound of the range constraint.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__lb</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">ub</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns the upper bound of the range constraint.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ub</span>

    <span class="k">def</span> <span class="nf">range</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># INTERNAL</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ub</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">__lb</span>

    <span class="k">def</span> <span class="nf">is_valid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">range</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="mi">0</span>

<div class="viewcode-block" id="RangeConstraint.iter_variables"><a class="viewcode-back" href="../../../docplex.mp.linear.html#docplex.mp.linear.RangeConstraint.iter_variables">[docs]</a>    <span class="k">def</span> <span class="nf">iter_variables</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Iterate on the variables of the range constraint.</span>

<span class="sd">        returns:</span>
<span class="sd">            an iterator object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__expr</span><span class="o">.</span><span class="n">iter_variables</span><span class="p">()</span>
</div>
    <span class="k">def</span> <span class="nf">contains_var</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dvar</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__expr</span><span class="o">.</span><span class="n">contains_var</span><span class="p">(</span><span class="n">dvar</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">rhs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># INTERNAL</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__lb</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">__expr</span><span class="o">.</span><span class="n">constant</span>

    <span class="k">def</span> <span class="nf">fast_get_coef</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dvar</span><span class="p">):</span>
        <span class="c"># INTERNAL</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__expr</span><span class="o">.</span><span class="n">unchecked_get_coef</span><span class="p">(</span><span class="n">dvar</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target_model</span><span class="p">,</span> <span class="n">var_map</span><span class="p">):</span>
        <span class="n">copied_expr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">expr</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">target_model</span><span class="p">,</span> <span class="n">var_map</span><span class="p">)</span>
        <span class="n">copied_range</span> <span class="o">=</span> <span class="n">RangeConstraint</span><span class="p">(</span><span class="n">target_model</span><span class="p">,</span> <span class="n">copied_expr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lb</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ub</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">copied_range</span>

    <span class="k">def</span> <span class="nf">to_string</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&quot;{0} &lt;= {1!s} &lt;= {2}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__lb</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__expr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ub</span><span class="p">)</span>

<div class="viewcode-block" id="RangeConstraint.__str__"><a class="viewcode-back" href="../../../docplex.mp.linear.html#docplex.mp.linear.RangeConstraint.__str__">[docs]</a>    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns a string representation of the range constraint.</span>

<span class="sd">        Example:</span>
<span class="sd">            1 &lt;= x+y+z &lt;= 3 represents the range constraint where the expression (x+y+z) is </span>
<span class="sd">            constrained to stay between 1 and 3.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A string.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_string</span><span class="p">()</span>

</div></div>
<span class="k">class</span> <span class="nc">IndicatorConstraint</span><span class="p">(</span><span class="n">AbstractLogicalConstraint</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">binary_var</span><span class="p">,</span> <span class="n">linear_ct</span><span class="p">,</span> <span class="n">active_value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">AbstractLogicalConstraint</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">active_value</span> <span class="ow">in</span> <span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_binary_var</span> <span class="o">=</span> <span class="n">binary_var</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_linear_ct</span> <span class="o">=</span> <span class="n">linear_ct</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_active_value</span> <span class="o">=</span> <span class="n">active_value</span>
        <span class="k">if</span> <span class="n">linear_ct</span><span class="o">.</span><span class="n">is_trivial</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s">&quot;Using trivial linear constraint in indicator, binary: {0!s}, ct: {1!s}&quot;</span><span class="p">,</span> <span class="n">binary_var</span><span class="p">,</span>
                         <span class="n">linear_ct</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">short_typename</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&quot;indicator&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">active_value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_active_value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">indicator_var</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_binary_var</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">linear_constraint</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_linear_ct</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">logical_rhs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the target rhs used to trigger the linear ct.</span>
<span class="sd">        :return: 1 if not complemented else 0.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_value</span>

    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target_model</span><span class="p">,</span> <span class="n">var_map</span><span class="p">):</span>
        <span class="n">copied_binary</span> <span class="o">=</span> <span class="n">var_map</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">indicator_var</span><span class="p">]</span>
        <span class="n">copied_linear_ct</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">linear_constraint</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">target_model</span><span class="p">,</span> <span class="n">var_map</span><span class="p">)</span>
        <span class="n">copied_indicator</span> <span class="o">=</span> <span class="n">IndicatorConstraint</span><span class="p">(</span><span class="n">target_model</span><span class="p">,</span> <span class="n">copied_binary</span><span class="p">,</span> <span class="n">copied_linear_ct</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_value</span><span class="p">,</span>
                                               <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">copied_indicator</span>

    <span class="k">def</span> <span class="nf">invalidate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the binary variable to the opposite of ist active value.</span>
<span class="sd">        Typically used by indicator constraints with trivial infeasible linear part.</span>
<span class="sd">        For example, z=1 -&gt; 4 &lt;= 3 sets z to 0.</span>
<span class="sd">        z=0 -&gt; 4&lt;= 3 sets z to 1</span>
<span class="sd">        This is equivalent to z=a =&gt; False thus z *cannot* be equal to a.</span>

<span class="sd">        :return: None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_value</span> <span class="ow">is</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c"># set to 1 : lb = 1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">indicator_var</span><span class="o">.</span><span class="n">lb</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_value</span> <span class="ow">is</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c"># set to 0 ub = 0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">indicator_var</span><span class="o">.</span><span class="n">ub</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fatal</span><span class="p">(</span><span class="s">&quot;Unexpected active value for indicator constraint {0!s}, expecting 0 or 1&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">iter_variables</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">_binary_var</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_linear_ct</span><span class="o">.</span><span class="n">iter_variables</span><span class="p">():</span>
            <span class="k">yield</span> <span class="n">v</span>

    <span class="k">def</span> <span class="nf">contains_var</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dvar</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">dvar</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">_binary_var</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_linear_ct</span><span class="o">.</span><span class="n">contains_var</span><span class="p">(</span><span class="n">dvar</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">to_string</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Displays the indicator constraint in the LP style.</span>
<span class="sd">        z = 1 -&gt; x+y+z == 2</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s"> = </span><span class="si">%d</span><span class="s"> -&gt; </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">indicator_var</span><span class="o">.</span><span class="n">name_or_str</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">logical_rhs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">linear_constraint</span><span class="o">.</span><span class="n">to_string</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_string</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">ModelFactory</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">default_variable_lb</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">0</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">default_variable_ub</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">infinity</span>

    <span class="k">def</span> <span class="nf">is_free_lb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var_lb</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">var_lb</span> <span class="o">&lt;=</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">infinity</span>

    <span class="k">def</span> <span class="nf">is_free_ub</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var_ub</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">var_ub</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">infinity</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">engine</span><span class="p">,</span> <span class="n">error_handler</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__model</span> <span class="o">=</span> <span class="n">model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__engine</span> <span class="o">=</span> <span class="n">engine</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__error_handler</span> <span class="o">=</span> <span class="n">error_handler</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">infinity</span> <span class="o">=</span> <span class="n">engine</span><span class="o">.</span><span class="n">getInfinity</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">init</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># singleton: unique empty expr.</span>
        <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zero_expr</span> <span class="o">=</span> <span class="n">LinearExpr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>  <span class="c"># singleton</span>

    <span class="k">def</span> <span class="nf">new_trivial_feasible_ct</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_DummyFeasibleConstraint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">zero_expr</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">new_trivial_infeasible_ct</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_DummyInfeasibleConstraint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">zero_expr</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">fatal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__error_handler</span><span class="o">.</span><span class="n">fatal</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">warning</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__error_handler</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">resetEngine</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">engine</span><span class="p">):</span>
        <span class="c"># the model has already disposed the old engine, if any   </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__engine</span> <span class="o">=</span> <span class="n">engine</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">infinity</span> <span class="o">=</span> <span class="n">engine</span><span class="o">.</span><span class="n">getInfinity</span><span class="p">()</span>

        <span class="c"># reset all scopes</span>

    <span class="c"># @profile</span>
    <span class="k">def</span> <span class="nf">__make_one_var</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">vartype</span><span class="p">,</span> <span class="n">varname</span><span class="p">,</span> <span class="n">lb</span><span class="p">,</span> <span class="n">ub</span><span class="p">,</span> <span class="n">safe_domain</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">is_automatic_name</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Var</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">vartype</span><span class="p">,</span> <span class="n">varname</span><span class="p">,</span> <span class="n">lb</span><span class="p">,</span> <span class="n">ub</span><span class="p">,</span> <span class="n">_safe_domain</span><span class="o">=</span><span class="n">safe_domain</span><span class="p">,</span> <span class="n">is_automatic_name</span><span class="o">=</span><span class="n">is_automatic_name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_make_one_default_var</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">vartype</span><span class="p">,</span> <span class="n">varname</span><span class="p">,</span> <span class="n">is_automatic_name</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Var</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">vartype</span><span class="p">,</span> <span class="n">varname</span><span class="p">,</span> <span class="n">lb</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">ub</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                   <span class="n">_safe_domain</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                   <span class="n">is_automatic_name</span><span class="o">=</span><span class="n">is_automatic_name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">var</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vartype</span><span class="p">,</span> <span class="n">lb</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">ub</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">varname</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">actual_name</span> <span class="o">=</span> <span class="n">varname</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">__model</span><span class="o">.</span><span class="n">_create_automatic_varname</span><span class="p">()</span>
        <span class="c"># BEWARE: use explicit comparisons to None as 0 is False in Python</span>
        <span class="n">var</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__make_one_var</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__model</span><span class="p">,</span> <span class="n">vartype</span><span class="p">,</span> <span class="n">actual_name</span><span class="p">,</span> <span class="n">lb</span><span class="p">,</span> <span class="n">ub</span><span class="p">,</span> <span class="n">is_automatic_name</span><span class="o">=</span><span class="ow">not</span> <span class="nb">bool</span><span class="p">(</span><span class="n">varname</span><span class="p">))</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__engine</span><span class="o">.</span><span class="n">createOneVariable</span><span class="p">(</span><span class="n">vartype</span><span class="p">,</span> <span class="n">var</span><span class="o">.</span><span class="n">lb</span><span class="p">,</span> <span class="n">var</span><span class="o">.</span><span class="n">ub</span><span class="p">,</span> <span class="n">actual_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__model</span><span class="o">.</span><span class="n">_register_one_var</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">var</span>

    <span class="k">def</span> <span class="nf">_compute_safe_naming_rule</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">keys</span><span class="p">,</span> <span class="n">user_naming_rule</span><span class="p">,</span> <span class="n">arity</span><span class="p">,</span> <span class="n">key_format</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Builds a safe naming rule scheme.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">default_naming_fn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__model</span><span class="o">.</span><span class="n">_create_automatic_varname</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">user_naming_rule</span><span class="p">:</span>
            <span class="c"># in this branch we cover the None case</span>
            <span class="c"># and the null list</span>
            <span class="k">return</span> <span class="k">lambda</span> <span class="n">k</span><span class="p">:</span> <span class="n">default_naming_fn</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ensure_naming_function</span><span class="p">(</span><span class="n">keys</span><span class="p">,</span> <span class="n">user_naming_rule</span><span class="p">,</span> <span class="n">default_naming_fn</span><span class="p">,</span> <span class="n">arity</span><span class="p">,</span> <span class="n">key_format</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_expand_bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">keys</span><span class="p">,</span> <span class="n">var_bound</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">lb_or_ub</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Converts raw bounds data (either LB or UB) to CPLEX-compatible bounds list.</span>
<span class="sd">            If lbs is None, this is the default, return [].</span>
<span class="sd">            If lbs is [] take the default again.</span>
<span class="sd">            If it is a number, build a list of size &lt;size&gt; with this number.</span>
<span class="sd">            If it is a list, use it if size ok (check numbers??),</span>
<span class="sd">            else try it as a function over keys.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">var_bound</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_bad_bounds_fatal</span><span class="p">(</span><span class="n">var_bound</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">var_bound</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c"># default lb is zero, default ub is infinity</span>
            <span class="k">return</span> <span class="p">[]</span>
        <span class="k">elif</span> <span class="n">is_number</span><span class="p">(</span><span class="n">var_bound</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">var_bound</span><span class="p">]</span> <span class="o">*</span> <span class="n">size</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">var_bound</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">nb_bounds</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">var_bound</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">nb_bounds</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">None</span>  <span class="c"># use defaults</span>
            <span class="k">elif</span> <span class="n">nb_bounds</span> <span class="o">&lt;</span> <span class="n">size</span><span class="p">:</span>
                <span class="c"># see how we can use defaults for those missing bounds</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fatal</span><span class="p">(</span><span class="s">&quot;Variable bounds list is too small, expecting: </span><span class="si">%d</span><span class="s">, got: </span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">nb_bounds</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">nb_bounds</span> <span class="o">&gt;</span> <span class="n">size</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s">&quot;Variable bounds list is too large, required: </span><span class="si">%d</span><span class="s">, got: </span><span class="si">%d</span><span class="s">.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">nb_bounds</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">size</span><span class="p">):</span>
                    <span class="n">b_value</span> <span class="o">=</span> <span class="n">var_bound</span><span class="p">[</span><span class="n">b</span><span class="p">]</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">is_number</span><span class="p">(</span><span class="n">b_value</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">fatal</span><span class="p">(</span><span class="s">&quot;Variable bounds list expects numbers, got: {0!s} (pos: #{1})&quot;</span><span class="p">,</span>
                                   <span class="n">b_value</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">var_bound</span>
        <span class="k">elif</span> <span class="n">is_iterator</span><span class="p">(</span><span class="n">var_bound</span><span class="p">):</span>
            <span class="c"># unfold the iterator, as CPLEX needs a list</span>
            <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">var_bound</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">var_bound</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">default_bound</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">infinity</span> <span class="k">if</span> <span class="n">lb_or_ub</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">infinity</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">var_bound</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">default_bound</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># try a function?</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">_computed_bounds</span> <span class="o">=</span> <span class="p">[</span><span class="n">var_bound</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">]</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">is_iterable</span><span class="p">(</span><span class="n">_computed_bounds</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_bad_bounds_fatal</span><span class="p">(</span><span class="n">var_bound</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">_computed_bounds</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">_computed_bounds</span><span class="p">:</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_number</span><span class="p">(</span><span class="n">b</span><span class="p">):</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">fatal</span><span class="p">(</span><span class="s">&quot;computed bound expects a number, got: {0!s}&quot;</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">_computed_bounds</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_bad_bounds_fatal</span><span class="p">(</span><span class="n">var_bound</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fatal</span><span class="p">(</span><span class="s">&quot;error calling function model bounds: {0!s}&quot;</span><span class="p">,</span> <span class="n">var_bound</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_bad_bounds_fatal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bad_bound</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fatal</span><span class="p">(</span><span class="s">&quot;unexpected variable bound: {0!s}, expecting: None|number|function|iterable&quot;</span><span class="p">,</span> <span class="n">bad_bound</span><span class="p">)</span>

    <span class="c"># @profile</span>
    <span class="k">def</span> <span class="nf">var_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">keys</span><span class="p">,</span> <span class="n">vartype</span><span class="p">,</span>
                 <span class="n">lb</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">ub</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">name</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
                 <span class="n">arity</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">key_format</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">allow_empty_keys</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">keys</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">allow_empty_keys</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">[]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fatal</span><span class="p">(</span><span class="s">&quot;No keys to index the variables.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">any</span><span class="p">((</span><span class="n">k</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fatal</span><span class="p">(</span><span class="s">&quot;A variable key cannot be None, see: {0!s}&quot;</span><span class="p">,</span> <span class="n">keys</span><span class="p">)</span>

        <span class="n">actual_naming_rule</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_safe_naming_rule</span><span class="p">(</span><span class="n">keys</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">arity</span><span class="p">,</span> <span class="n">key_format</span><span class="p">)</span>

        <span class="n">number_of_vars</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span>
        <span class="n">xlbs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expand_bounds</span><span class="p">(</span><span class="n">keys</span><span class="p">,</span> <span class="n">lb</span><span class="p">,</span> <span class="n">number_of_vars</span><span class="p">,</span> <span class="n">lb_or_ub</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">xubs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expand_bounds</span><span class="p">(</span><span class="n">keys</span><span class="p">,</span> <span class="n">ub</span><span class="p">,</span> <span class="n">number_of_vars</span><span class="p">,</span> <span class="n">lb_or_ub</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="c"># at this point both list are either [] or have size numberOfVars</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__error_handler</span><span class="o">.</span><span class="n">ensure</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xlbs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">xlbs</span><span class="p">)</span> <span class="o">==</span> <span class="n">number_of_vars</span><span class="p">,</span> <span class="s">&quot;bad lb sequence&quot;</span><span class="p">,</span> <span class="n">xlbs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__error_handler</span><span class="o">.</span><span class="n">ensure</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xubs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">xubs</span><span class="p">)</span> <span class="o">==</span> <span class="n">number_of_vars</span><span class="p">,</span> <span class="s">&quot;bad ub sequence&quot;</span><span class="p">,</span> <span class="n">xubs</span><span class="p">)</span>

        <span class="c"># compute defaults once</span>
        <span class="n">default_lb</span> <span class="o">=</span> <span class="n">vartype</span><span class="o">.</span><span class="n">default_lb</span>
        <span class="n">default_ub</span> <span class="o">=</span> <span class="n">vartype</span><span class="o">.</span><span class="n">default_ub</span>
        <span class="n">useDefaultLbs</span> <span class="o">=</span> <span class="p">(</span><span class="n">xlbs</span> <span class="o">==</span> <span class="p">[])</span>
        <span class="n">useDefaultUbs</span> <span class="o">=</span> <span class="p">(</span><span class="n">xubs</span> <span class="o">==</span> <span class="p">[])</span>
        <span class="n">is_safe</span> <span class="o">=</span> <span class="n">useDefaultUbs</span> <span class="ow">and</span> <span class="n">useDefaultLbs</span>
        <span class="n">mdl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__model</span>

        <span class="n">is_auto</span> <span class="o">=</span> <span class="ow">not</span> <span class="nb">bool</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

        <span class="n">allvars</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__make_one_var</span><span class="p">(</span><span class="n">mdl</span><span class="p">,</span> <span class="n">vartype</span><span class="p">,</span>
                                       <span class="n">actual_naming_rule</span><span class="p">(</span><span class="n">key</span><span class="p">),</span>
                                       <span class="n">xlbs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">if</span> <span class="n">xlbs</span> <span class="k">else</span> <span class="n">default_lb</span><span class="p">,</span>
                                       <span class="n">xubs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">if</span> <span class="n">xubs</span> <span class="k">else</span> <span class="n">default_ub</span><span class="p">,</span>
                                       <span class="n">safe_domain</span><span class="o">=</span><span class="n">is_safe</span><span class="p">,</span>
                                       <span class="n">is_automatic_name</span><span class="o">=</span><span class="n">is_auto</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">keys</span><span class="p">)]</span>

        <span class="n">indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__engine</span><span class="o">.</span><span class="n">createVariables</span><span class="p">(</span><span class="n">keys</span><span class="p">,</span> <span class="n">vartype</span><span class="p">,</span> <span class="n">xlbs</span><span class="p">,</span> <span class="n">xubs</span><span class="p">,</span> <span class="n">actual_naming_rule</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">allvars</span><span class="p">)</span>
        <span class="c"># with MyTimer(&quot;register_block_vars&quot;):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__model</span><span class="o">.</span><span class="n">_register_block_vars</span><span class="p">(</span><span class="n">allvars</span><span class="p">,</span> <span class="n">indices</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">allvars</span>

    <span class="k">def</span> <span class="nf">linear_expr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">constant</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">expr</span> <span class="o">=</span> <span class="n">LinearExpr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__model</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">constant</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">expr</span>

    <span class="k">def</span> <span class="nf">new_num_expr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">constant</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">force_new</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">force_new</span> <span class="ow">and</span> <span class="p">(</span><span class="mi">0</span> <span class="o">==</span> <span class="n">constant</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">name</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">zero_expr</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">linear_expr</span><span class="p">(</span><span class="n">constant</span><span class="o">=</span><span class="n">constant</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">new_zero_expr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">new_num_expr</span><span class="p">(</span><span class="n">constant</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">force_new</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">scal_prod</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dvars</span><span class="p">,</span> <span class="n">coefs</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">dvars</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">coefs</span><span class="p">:</span>
            <span class="c"># what about returning plain 0 ??</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">new_num_expr</span><span class="p">(</span><span class="n">constant</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">force_new</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">is_number</span><span class="p">(</span><span class="n">coefs</span><span class="p">):</span>
            <span class="n">coefs</span> <span class="o">=</span> <span class="n">generate_constant</span><span class="p">(</span><span class="n">coefs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__model</span><span class="o">.</span><span class="n">typecheck_iterable</span><span class="p">(</span><span class="n">coefs</span><span class="p">)</span>

        <span class="c"># process var sequence</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_iterable</span><span class="p">(</span><span class="n">dvars</span><span class="p">):</span>
            <span class="n">dvars</span> <span class="o">=</span> <span class="p">[</span><span class="n">dvars</span><span class="p">]</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scal_prod</span><span class="p">(</span><span class="n">dvars</span><span class="p">,</span> <span class="n">coefs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_scal_prod</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dvars</span><span class="p">,</span> <span class="n">coefs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        INTERNAL, dvars is not empty.</span>
<span class="sd">        :param dvars:</span>
<span class="sd">        :param coefs:</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">total_num</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">fcc</span> <span class="o">=</span> <span class="n">ExprCounter</span><span class="p">()</span>
        <span class="c"># try:</span>
        <span class="k">for</span> <span class="n">item</span><span class="p">,</span> <span class="n">coef</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">dvars</span><span class="p">,</span> <span class="n">coefs</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">coef</span> <span class="ow">is</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">Var</span><span class="p">):</span>
                <span class="n">fcc</span><span class="o">.</span><span class="n">update_from_item_value</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">coef</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">LinearExpr</span><span class="p">):</span>
                <span class="n">fcc</span><span class="o">.</span><span class="n">update_from_scaled_dict</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">_as_dict</span><span class="p">(),</span> <span class="n">coef</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">MonomialExpr</span><span class="p">):</span>
                <span class="n">fcc</span><span class="o">.</span><span class="n">update_from_item_value</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">var</span><span class="p">,</span> <span class="n">item</span><span class="o">.</span><span class="n">coef</span> <span class="o">*</span> <span class="n">coef</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">is_number</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">item</span><span class="p">:</span>
                    <span class="n">total_num</span> <span class="o">+=</span> <span class="n">coef</span> <span class="o">*</span> <span class="n">item</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fatal</span><span class="p">(</span><span class="s">&quot;scal_prod accepts variables, expressions, numbers, got: {0!s}&quot;</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>
        <span class="c"># pass</span>
        <span class="n">fcc</span><span class="o">.</span><span class="n">normalize</span><span class="p">()</span>
        <span class="n">scalprod_expr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">new_num_expr</span><span class="p">(</span><span class="n">constant</span><span class="o">=</span><span class="n">total_num</span><span class="p">,</span> <span class="n">force_new</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">scalprod_expr</span><span class="o">.</span><span class="n">_assign_terms</span><span class="p">(</span><span class="n">fcc</span><span class="p">,</span> <span class="n">is_safe</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">assume_normalized</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">scalprod_expr</span>

    <span class="k">def</span> <span class="nf">_accumulate_scaled</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fcc</span><span class="p">,</span> <span class="n">items</span><span class="p">,</span> <span class="n">coefs</span><span class="p">):</span>
        <span class="n">total_num</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">item</span><span class="p">,</span> <span class="n">coef</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="n">coefs</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">coef</span> <span class="ow">is</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">Var</span><span class="p">):</span>
                <span class="n">fcc</span><span class="o">.</span><span class="n">update_from_item</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">MonomialExpr</span><span class="p">):</span>
                <span class="n">fcc</span><span class="o">.</span><span class="n">update_from_item_value</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">var</span><span class="p">,</span> <span class="n">item</span><span class="o">.</span><span class="n">coef</span> <span class="o">*</span> <span class="n">coef</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">LinearExpr</span><span class="p">):</span>
                <span class="n">fcc</span><span class="o">.</span><span class="n">update_from_scaled_dict</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">_as_dict</span><span class="p">(),</span> <span class="n">coef</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">is_number</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
                <span class="n">total_num</span> <span class="o">+=</span> <span class="n">coef</span> <span class="o">*</span> <span class="n">item</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fatal</span><span class="p">(</span><span class="s">&quot;unexpected object in scal_prod: {0!s}&quot;</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__model</span><span class="o">.</span><span class="n">linear_expr</span><span class="p">(</span><span class="n">e</span><span class="o">=</span><span class="n">fcc</span><span class="p">,</span> <span class="n">constant</span><span class="o">=</span><span class="n">total_num</span><span class="p">)</span>

    <span class="c"># @profile</span>
    <span class="k">def</span> <span class="nf">sum</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x_seq</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">x_seq</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">linear_expr</span><span class="p">(</span><span class="n">e</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">is_number</span><span class="p">(</span><span class="n">x_seq</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">x_seq</span>

        <span class="k">if</span> <span class="n">is_iterable</span><span class="p">(</span><span class="n">x_seq</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x_seq</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="c"># handle dict: sum all values</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sum_with_seq</span><span class="p">(</span><span class="n">x_seq</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
            <span class="k">elif</span> <span class="n">is_indexable</span><span class="p">(</span><span class="n">x_seq</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sum_with_seq</span><span class="p">(</span><span class="n">x_seq</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c"># return self._sum_with_seq(list(x_seq))</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sum_with_iter</span><span class="p">(</span><span class="n">x_seq</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__model</span><span class="o">.</span><span class="n">_to_linear_expr</span><span class="p">(</span><span class="n">x_seq</span><span class="p">)</span>

    <span class="c"># @profile</span>
    <span class="k">def</span> <span class="nf">_sum_with_iter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        x-seq is an iterator so can be used only once.</span>
<span class="sd">        :param args:</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">accumulated_ct</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c"># do we really need to sort variables here??</span>
        <span class="n">acc</span> <span class="o">=</span> <span class="n">ExprCounter</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">Var</span><span class="p">):</span>
                <span class="n">acc</span><span class="o">.</span><span class="n">update_from_item</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">LinearExpr</span><span class="p">):</span>
                <span class="n">acc</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">_as_dict</span><span class="p">())</span>
                <span class="n">accumulated_ct</span> <span class="o">+=</span> <span class="n">item</span><span class="o">.</span><span class="n">constant</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">MonomialExpr</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">coef</span><span class="p">:</span>
                    <span class="n">acc</span><span class="o">.</span><span class="n">update_from_item_value</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">var</span><span class="p">,</span> <span class="n">item</span><span class="o">.</span><span class="n">coef</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">FunctionalExpr</span><span class="p">):</span>
                <span class="n">acc</span><span class="o">.</span><span class="n">update_from_item</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">functional_var</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">accumulated_ct</span> <span class="o">+=</span> <span class="n">item</span>

        <span class="n">sum_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">linear_expr</span><span class="p">(</span><span class="n">constant</span><span class="o">=</span><span class="n">accumulated_ct</span><span class="p">)</span>
        <span class="n">sum_x</span><span class="o">.</span><span class="n">_assign_terms</span><span class="p">(</span><span class="n">acc</span><span class="p">,</span> <span class="n">is_safe</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">assume_normalized</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">sum_x</span>

    <span class="c"># @profile</span>
    <span class="k">def</span> <span class="nf">_sum_with_seq</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x_list</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">x_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">Var</span><span class="p">):</span>
                <span class="n">x_seq_all_variables</span> <span class="o">=</span> <span class="bp">False</span>
                <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">x_seq_all_variables</span> <span class="o">=</span> <span class="bp">True</span>

        <span class="k">if</span> <span class="n">x_seq_all_variables</span><span class="p">:</span>
            <span class="n">expr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">linear_expr</span><span class="p">()</span>
            <span class="c"># in this case, we are sure thr esulting dict is always normalize (no zero value)</span>
            <span class="c"># however, the ordering might be random</span>
            <span class="k">return</span> <span class="n">expr</span><span class="o">.</span><span class="n">_assign_var_list</span><span class="p">(</span><span class="n">x_list</span><span class="p">,</span> <span class="n">is_safe</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sum_with_iter</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="n">x_list</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_new_binary_constraint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lhs</span><span class="p">,</span> <span class="n">ctype</span><span class="p">,</span> <span class="n">rhs</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">ct</span> <span class="o">=</span> <span class="n">BinaryLinearConstraint</span><span class="o">.</span><span class="n">NewBinaryConstraint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__model</span><span class="p">,</span> <span class="n">lhs</span><span class="p">,</span> <span class="n">ctype</span><span class="p">,</span> <span class="n">rhs</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ct</span>

    <span class="k">def</span> <span class="nf">set_objective</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sense</span><span class="p">,</span> <span class="n">expr</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>

    <span class="k">def</span> <span class="nf">le_constraint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">rhs</span><span class="p">,</span> <span class="n">ctname</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_new_binary_constraint</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">LinearConstraintType</span><span class="o">.</span><span class="n">LE</span><span class="p">,</span> <span class="n">rhs</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">ctname</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">eq_constraint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">rhs</span><span class="p">,</span> <span class="n">ctname</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_new_binary_constraint</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">LinearConstraintType</span><span class="o">.</span><span class="n">EQ</span><span class="p">,</span> <span class="n">rhs</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">ctname</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">ge_constraint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">rhs</span><span class="p">,</span> <span class="n">ctname</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_new_binary_constraint</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">LinearConstraintType</span><span class="o">.</span><span class="n">GE</span><span class="p">,</span> <span class="n">rhs</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">ctname</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">newRangeConstraint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lhs</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="n">rhs</span><span class="p">,</span> <span class="n">ctname</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Adds a new range constraint.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">rng</span> <span class="o">=</span> <span class="n">RangeConstraint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__model</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">,</span> <span class="n">ctname</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">rng</span>

    <span class="k">def</span> <span class="nf">newIndicatorConstraint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">binary_var</span><span class="p">,</span> <span class="n">linear_ct</span><span class="p">,</span> <span class="n">active_value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ctname</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">indicator_ct</span> <span class="o">=</span> <span class="n">IndicatorConstraint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__model</span><span class="p">,</span> <span class="n">binary_var</span><span class="p">,</span> <span class="n">linear_ct</span><span class="p">,</span> <span class="n">active_value</span><span class="p">,</span> <span class="n">ctname</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">indicator_ct</span>


<span class="k">class</span> <span class="nc">ObjectiveSense</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
    <span class="n">Minimize</span><span class="p">,</span> <span class="n">Maximize</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span>

    <span class="c"># static method: which type is the default.</span>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">default_sense</span><span class="p">():</span>
        <span class="k">return</span> <span class="n">ObjectiveSense</span><span class="o">.</span><span class="n">Minimize</span>

    <span class="k">def</span> <span class="nf">is_minimize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span> <span class="ow">is</span> <span class="n">ObjectiveSense</span><span class="o">.</span><span class="n">Minimize</span>

    <span class="k">def</span> <span class="nf">is_maximize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span> <span class="ow">is</span> <span class="n">ObjectiveSense</span><span class="o">.</span><span class="n">Maximize</span>

    <span class="k">def</span> <span class="nf">verb</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&quot;minimize&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_minimize</span><span class="p">()</span> <span class="k">else</span> <span class="s">&quot;maximize&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_maximize</span><span class="p">()</span> <span class="k">else</span> <span class="s">&quot;WHAT???&quot;</span>

    <span class="k">def</span> <span class="nf">action</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">ing&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">verb</span><span class="p">()[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">errorhandler</span><span class="p">,</span> <span class="n">do_raise</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">text</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">is_string</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">do_raise</span><span class="p">:</span>
                <span class="n">errorhandler</span><span class="o">.</span><span class="n">fatal</span><span class="p">(</span><span class="s">&quot;cannot read objective sense from: &lt;{}&gt;&quot;</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">errorhandler</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s">&quot;cannot read objective sense from: &lt;{}&gt;&quot;</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lower_text</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">lower_text</span> <span class="ow">in</span> <span class="p">{</span><span class="s">&quot;minimize&quot;</span><span class="p">,</span> <span class="s">&quot;min&quot;</span><span class="p">}:</span>
                <span class="k">return</span> <span class="n">ObjectiveSense</span><span class="o">.</span><span class="n">Minimize</span>
            <span class="k">elif</span> <span class="n">lower_text</span> <span class="ow">in</span> <span class="p">{</span><span class="s">&quot;maximize&quot;</span><span class="p">,</span> <span class="s">&quot;max&quot;</span><span class="p">}:</span>
                <span class="k">return</span> <span class="n">ObjectiveSense</span><span class="o">.</span><span class="n">Maximize</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">errorhandler</span><span class="o">.</span><span class="n">fatal</span><span class="p">(</span><span class="s">&quot;Text is not recognized as objective sense: {0}, expecting min&quot;&quot; or max&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">text</span><span class="p">,))</span>


<span class="c"># --- version with global functions</span>


<span class="k">def</span> <span class="nf">_docplex_extract_model</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">do_raise</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">model</span>
        <span class="k">return</span> <span class="n">model</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">do_raise</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DOCplexException</span><span class="p">(</span><span class="s">&quot;object has no model attribute: {0!s}&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>


<span class="k">def</span> <span class="nf">docplex_sum</span><span class="p">(</span><span class="n">x_seq</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">is_iterable</span><span class="p">(</span><span class="n">x_seq</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">x_seq</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x_seq</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">_docplex_sum_with_seq</span><span class="p">(</span><span class="n">x_seq</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="k">elif</span> <span class="n">is_indexable</span><span class="p">(</span><span class="n">x_seq</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">_docplex_sum_with_seq</span><span class="p">(</span><span class="n">x_seq</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">_docplex_sum_with_seq</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">x_seq</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">x_seq</span><span class="p">:</span>
        <span class="n">mdl</span> <span class="o">=</span> <span class="n">_docplex_extract_model</span><span class="p">(</span><span class="n">x_seq</span><span class="p">,</span> <span class="n">do_raise</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">mdl</span><span class="o">.</span><span class="n">to_linear_expr</span><span class="p">(</span><span class="n">x_seq</span><span class="p">)</span> <span class="k">if</span> <span class="n">mdl</span> <span class="k">else</span> <span class="n">x_seq</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>


<span class="k">def</span> <span class="nf">_docplex_sum_with_seq</span><span class="p">(</span><span class="n">x_list</span><span class="p">):</span>
    <span class="n">shared_model</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">x_list</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">model</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">model</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">shared_model</span><span class="p">:</span>
                <span class="n">shared_model</span> <span class="o">=</span> <span class="n">model</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">model</span> <span class="o">!=</span> <span class="n">shared_model</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">DOCplexException</span><span class="p">(</span><span class="s">&quot;Cannot mix objects belonging to different models&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">pass</span>
    <span class="k">if</span> <span class="n">shared_model</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">shared_model</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">x_list</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c"># try a python sum ?</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">x_list</span><span class="p">)</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">DOcplex Preview 1.0 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2015, IBM CPLEX.
    </div>
  </body>
</html>