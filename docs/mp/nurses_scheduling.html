<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
    
    <title>The Nurses Model &mdash; DOcplex.MP: Mathematical Programming Modeling for Python V2.0 documentation</title>
    
    <link rel="stylesheet" href="_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     'V2.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  false
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="DOcplex.MP: Mathematical Programming Modeling for Python V2.0 documentation" href="index.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">DOcplex.MP: Mathematical Programming Modeling for Python V2.0 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="the-nurses-model">
<h1>The Nurses Model<a class="headerlink" href="#the-nurses-model" title="Permalink to this headline">&para;</a></h1>
<p>This tutorial includes everything you need to set up IBM Decision
Optimization CPLEX Modeling for Python (DOcplex), build a Mathematical
Programming model, and get its solution by solving the model on the
cloud with IBM ILOG CPLEX Optimizer.</p>
<p>When you finish this tutorial, you&#8217;ll have a foundational knowledge of
<em>Prescriptive Analytics</em>.</p>
<blockquote>
<div><p>This notebook is part of <a class="reference external" href="https://rawgit.com/IBMDecisionOptimization/docplex-doc/master/docs/index.html">Prescriptive Analytics for
Python</a>.</p>
<p>It requires a valid subscription to <strong>Decision Optimization on
Cloud</strong>. Try it for free
<a class="reference external" href="https://developer.ibm.com/docloud">here</a>.</p>
</div></blockquote>
<p>Table of contents:</p>
<ul class="simple">
<li><a class="reference internal" href="#describe-the-business-problem">Describe the business problem</a></li>
<li><a class="reference internal" href="#how-decision-optimization-can-help">How  decision optimization can help</a></li>
<li><a class="reference internal" href="#use-decision-optimization">Use decision optimization</a><ul>
<li><a class="reference internal" href="#step-1-download-the-library">Step 1: Download the library</a></li>
<li><a class="reference internal" href="#step-2-set-up-the-prescriptive-engine">Step 2: Set up the prescriptive engine</a></li>
<li><a class="reference internal" href="#step-3-model-the-data">Step 3: Model the data</a></li>
<li><a class="reference internal" href="#step-4-prepare-the-data">Step 4: Prepare the data</a></li>
<li><a class="reference internal" href="#step-5-set-up-the-prescriptive-model">Step 5: Set up the prescriptive model</a><ul>
<li><a class="reference internal" href="#define-the-decision-variables">Define the decision variables</a></li>
<li><a class="reference internal" href="#express-the-business-constraints">Express the business constraints</a></li>
<li><a class="reference internal" href="#express-the-objective">Express the objective</a></li>
<li><a class="reference internal" href="#solve-with-the-decision-optimization-solve-service">Solve with the Decision Optimization solve service</a></li>
</ul>
</li>
<li><a class="reference internal" href="#step-6-investigate-the-solution-and-then-run-an-example-analysis">Step 6: Investigate the solution and then run an example analysis</a></li>
</ul>
</li>
<li><a class="reference internal" href="#summary">Summary</a></li>
</ul>
<hr class="docutils" />
<div class="section" id="describe-the-business-problem">
<h2>Describe the business problem<a class="headerlink" href="#describe-the-business-problem" title="Permalink to this headline">&para;</a></h2>
<p>This model deals with nurse scheduling. Nurses must be assigned to
hospital shifts in accordance with various skill and staffing
constraints.</p>
<p>The goal of the model is to find an efficient balance between the
different objectives:</p>
<ul class="simple">
<li>minimize the overall cost of the plan and</li>
<li>assign shifts as fairly as possible.</li>
</ul>
</div>
<div class="section" id="how-decision-optimization-can-help">
<h2>How decision optimization can help<a class="headerlink" href="#how-decision-optimization-can-help" title="Permalink to this headline">&para;</a></h2>
<ul>
<li><p class="first">Prescriptive analytics (decision optimization) technology recommends
actions that are based on desired outcomes. It takes into account
specific scenarios, resources, and knowledge of past and current
events. With this insight, your organization can make better
decisions and have greater control of business outcomes.</p>
</li>
<li><p class="first">Prescriptive analytics is the next step on the path to insight-based
actions. It creates value through synergy with predictive analytics,
which analyzes data to predict future outcomes.</p>
</li>
<li><div class="first line-block">
<div class="line">Prescriptive analytics takes that insight to the next level by
suggesting the optimal way to handle that future situation.
Organizations that can act fast in dynamic conditions and make
superior decisions in uncertain environments gain a strong
competitive advantage.</div>
<div class="line"><br /></div>
</div>
</li>
</ul>
<p>With prescriptive analytics, you can:</p>
<ul class="simple">
<li>Automate the complex decisions and trade-offs to better manage your
limited resources.</li>
<li>Take advantage of a future opportunity or mitigate a future risk.</li>
<li>Proactively update recommendations based on changing events.</li>
<li>Meet operational goals, increase customer loyalty, prevent threats
and fraud, and optimize business processes.</li>
</ul>
</div>
<div class="section" id="use-decision-optimization">
<h2>Use decision optimization<a class="headerlink" href="#use-decision-optimization" title="Permalink to this headline">&para;</a></h2>
<div class="section" id="step-1-download-the-library">
<h3>Step 1: Download the library<a class="headerlink" href="#step-1-download-the-library" title="Permalink to this headline">&para;</a></h3>
<p>Run the following code to install Decision Optimization CPLEX Modeling
library. The <em>DOcplex</em> library contains the two modeling packages,
Mathematical Programming and Constraint Programming.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span></span>import sys
try:
    import docplex.mp
except:
    if hasattr(sys, &#39;real_prefix&#39;):
        #we are in a virtual env.
        !pip install docplex
    else:
        !pip install --user docplex
</pre></div>
</div>
</div>
<div class="section" id="step-2-set-up-the-prescriptive-engine">
<h3>Step 2: Set up the prescriptive engine<a class="headerlink" href="#step-2-set-up-the-prescriptive-engine" title="Permalink to this headline">&para;</a></h3>
<ul class="simple">
<li>Subscribe to the <a class="reference external" href="https://developer.ibm.com/docloud">Decision Optimization on Cloud solve
service</a>.</li>
<li>Get the service URL and your personal API key and enter your
credentials here:</li>
</ul>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;ENTER YOUR URL HERE&quot;</span>
<span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;ENTER YOUR KEY HERE&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="step-3-model-the-data">
<h3>Step 3: Model the data<a class="headerlink" href="#step-3-model-the-data" title="Permalink to this headline">&para;</a></h3>
<p>Input data consists of several tables:</p>
<ul class="simple">
<li>The Departments table lists all departments in the scope of the
assignment.</li>
<li>The Skills table list all skills.</li>
<li>The Shifts table lists all shifts to be staffed. A shift contains a
department, a day in the week, plus the start and end times.</li>
<li>The Nurses table lists all nurses, identified by their names.</li>
<li>The NurseSkills table gives the skills of each nurse.</li>
<li>The SkillRequirements table lists the minimum number of persons
required for a given department and skill.</li>
<li>The NurseVacations table lists days off for each nurse.</li>
<li>The NurseAssociations table lists pairs of nurses who wish to work
together.</li>
<li>The NurseIncompatibilities table lists pairs of nurses who do not
want to work together . In addition, the plan has to satisfy a
maximum worktime for all nurses, for example 40 hours a week.</li>
</ul>
</div>
<div class="section" id="step-4-prepare-the-data">
<h3>Step 4: Prepare the data<a class="headerlink" href="#step-4-prepare-the-data" title="Permalink to this headline">&para;</a></h3>
<p>Now we need some basic data structures to store information.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">enum</span> <span class="kn">import</span> <span class="n">Enum</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">namedtuple</span>

<span class="c1"># utility to conevrt a weekday string to an index in 0..6</span>
<span class="n">_all_days</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;monday&quot;</span><span class="p">,</span> <span class="s2">&quot;tuesday&quot;</span><span class="p">,</span> <span class="s2">&quot;wednesday&quot;</span><span class="p">,</span> <span class="s2">&quot;thursday&quot;</span><span class="p">,</span> <span class="s2">&quot;friday&quot;</span><span class="p">,</span> <span class="s2">&quot;saturday&quot;</span><span class="p">,</span> <span class="s2">&quot;sunday&quot;</span><span class="p">]</span>


<span class="k">def</span> <span class="nf">day_to_day_week</span><span class="p">(</span><span class="n">day</span><span class="p">):</span>
    <span class="n">day_map</span> <span class="o">=</span> <span class="p">{</span><span class="n">day</span><span class="p">:</span> <span class="n">d</span> <span class="k">for</span> <span class="n">d</span><span class="p">,</span> <span class="n">day</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">_all_days</span><span class="p">)}</span>
    <span class="k">return</span> <span class="n">day_map</span><span class="p">[</span><span class="n">day</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span>

<span class="n">TWorkRules</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s2">&quot;TWorkRules&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;work_time_max&quot;</span><span class="p">])</span>
<span class="n">TVacation</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s2">&quot;TVacation&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;nurse&quot;</span><span class="p">,</span> <span class="s2">&quot;day&quot;</span><span class="p">])</span>
<span class="n">TNursePair</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s2">&quot;TNursePair&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;firstNurse&quot;</span><span class="p">,</span> <span class="s2">&quot;secondNurse&quot;</span><span class="p">])</span>
<span class="n">TSkillRequirement</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s2">&quot;TSkillRequirement&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;department&quot;</span><span class="p">,</span> <span class="s2">&quot;skill&quot;</span><span class="p">,</span> <span class="s2">&quot;required&quot;</span><span class="p">])</span>


<span class="c1"># subclass the namedtuple to refine the str() method as the nurse&#39;s name</span>
<span class="k">class</span> <span class="nc">TNurse</span><span class="p">(</span><span class="n">namedtuple</span><span class="p">(</span><span class="s2">&quot;TNurse1&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;pay_rate&quot;</span><span class="p">])):</span>
    <span class="sd">&quot;&quot;&quot; A subclass to redefine the default str() of namedtuple.</span>
<span class="sd">    This class is used in variable naming, so we need to redefine the str() method</span>
<span class="sd">    used by variable naming.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>


<span class="k">class</span> <span class="nc">TShift</span><span class="p">(</span>
    <span class="n">namedtuple</span><span class="p">(</span><span class="s2">&quot;TShift1&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;department&quot;</span><span class="p">,</span> <span class="s2">&quot;day&quot;</span><span class="p">,</span> <span class="s2">&quot;start_time&quot;</span><span class="p">,</span> <span class="s2">&quot;end_time&quot;</span><span class="p">,</span> <span class="s2">&quot;min_requirement&quot;</span><span class="p">,</span> <span class="s2">&quot;max_requirement&quot;</span><span class="p">])):</span>
    <span class="sd">&quot;&quot;&quot; specialize namedtuple to redefine its str() method</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># keep first two characters in departement, uppercased</span>
        <span class="n">dept2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">department</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
        <span class="c1"># keep 3 days of weekday</span>
        <span class="n">dayname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">day</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
        <span class="k">return</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_</span><span class="si">%s</span><span class="s1">_</span><span class="si">%02d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">dept2</span><span class="p">,</span> <span class="n">dayname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">ShiftActivity</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">to_abstime</span><span class="p">(</span><span class="n">day_index</span><span class="p">,</span> <span class="n">time_of_day</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Convert a pair (day_index, time) into a number of hours since Monday 00:00</span>

<span class="sd">        :param day_index: The index of the day from 1 to 7 (Monday is 1).</span>
<span class="sd">        :param time_of_day: An integer number of hours.</span>

<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">time</span> <span class="o">=</span> <span class="mi">24</span> <span class="o">*</span> <span class="p">(</span><span class="n">day_index</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">time</span> <span class="o">+=</span> <span class="n">time_of_day</span>
        <span class="k">return</span> <span class="n">time</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">weekday</span><span class="p">,</span> <span class="n">start_time_of_day</span><span class="p">,</span> <span class="n">end_time_of_day</span><span class="p">):</span>
        <span class="k">assert</span> <span class="p">(</span><span class="n">start_time_of_day</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">assert</span> <span class="p">(</span><span class="n">start_time_of_day</span> <span class="o">&lt;=</span> <span class="mi">24</span><span class="p">)</span>
        <span class="k">assert</span> <span class="p">(</span><span class="n">end_time_of_day</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">assert</span> <span class="p">(</span><span class="n">end_time_of_day</span> <span class="o">&lt;=</span> <span class="mi">24</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_weekday</span> <span class="o">=</span> <span class="n">weekday</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_start_time_of_day</span> <span class="o">=</span> <span class="n">start_time_of_day</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_end_time_of_day</span> <span class="o">=</span> <span class="n">end_time_of_day</span>
        <span class="c1"># conversion to absolute time.</span>
        <span class="n">start_day_index</span> <span class="o">=</span> <span class="n">day_to_day_week</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_weekday</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_abstime</span><span class="p">(</span><span class="n">start_day_index</span><span class="p">,</span> <span class="n">start_time_of_day</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">day_start_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_abstime</span><span class="p">(</span><span class="n">start_day_index</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">end_day_index</span> <span class="o">=</span> <span class="n">start_day_index</span> <span class="k">if</span> <span class="n">end_time_of_day</span> <span class="o">&gt;</span> <span class="n">start_time_of_day</span> <span class="k">else</span> <span class="n">start_day_index</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_abstime</span><span class="p">(</span><span class="n">end_day_index</span><span class="p">,</span> <span class="n">end_time_of_day</span><span class="p">)</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_time</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">duration</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_time</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span>

    <span class="k">def</span> <span class="nf">overlaps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other_shift</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other_shift</span><span class="p">,</span> <span class="n">ShiftActivity</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">other_shift</span><span class="o">.</span><span class="n">end_time</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span> <span class="ow">and</span> <span class="n">other_shift</span><span class="o">.</span><span class="n">start_time</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_time</span>
</pre></div>
</div>
<div class="section" id="loading-data-from-excel-with-pandas">
<h4>Loading data from Excel with pandas<a class="headerlink" href="#loading-data-from-excel-with-pandas" title="Permalink to this headline">&para;</a></h4>
<p>We load the data from an Excel file using <em>pandas</em>. Each sheet is read
into a separate <em>pandas</em> DataFrame.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span></span># This notebook requires pandas to work
import pandas as pd

# Make sure that xlrd package, which is a pandas optional dependency, is installed
# This package is required for Excel I/O
try:
    import xlrd
except:
    if hasattr(sys, &#39;real_prefix&#39;):
        #we are in a virtual env.
        !pip install xlrd
    else:
        !pip install --user xlrd
nurse_xls_file = pd.ExcelFile(&#39;nurses_data.xls&#39;)
SkillTable = nurse_xls_file.parse(&#39;Skills&#39;)
DeptTable  = nurse_xls_file.parse(&#39;Departments&#39;)
ShiftTable = nurse_xls_file.parse(&#39;Shifts&#39;)
SkillRequirementTable = nurse_xls_file.parse(&#39;SkillRequirements&#39;)
NurseTable = nurse_xls_file.parse(&#39;Nurses&#39;)
NurseSkillTable = nurse_xls_file.parse(&#39;NurseSkills&#39;)
NurseVacationTable = nurse_xls_file.parse(&#39;NurseVacations&#39;)
NurseAssociationTable = nurse_xls_file.parse(&#39;NurseAssociations&#39;)
NurseIncompatibilityTable = nurse_xls_file.parse(&#39;NurseIncompatibilities&#39;)

print(NurseTable)
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span></span>        name  seniority  qualification  pay_rate
0       Anne         11              1        25
1   Bethanie          4              5        28
2      Betsy          2              2        17
3      Cathy          2              2        17
4    Cecilia          9              5        38
5      Chris         11              4        38
6      Cindy          5              2        21
7      David          1              2        15
8     Debbie          7              2        24
9        Dee          3              3        21
10    Gloria          8              2        25
11  Isabelle          3              1        16
12      Jane          3              4        23
13   Janelle          4              3        22
14    Janice          2              2        17
15     Jemma          2              4        22
16      Joan          5              3        24
17     Joyce          8              3        29
18      Jude          4              3        22
19     Julie          6              2        22
20    Juliet          7              4        31
21      Kate          5              3        24
22     Nancy          8              4        32
23  Nathalie          9              5        38
24    Nicole          0              2        14
25  Patricia          1              1        13
26   Patrick          6              1        19
27   Roberta          3              5        26
28   Suzanne          5              1        18
29    Vickie          7              1        20
30    Wendie          5              2        21
31       Zoe          8              3        29
</pre></div>
</div>
<p>Now, we create some additional data structures to be used for building
the prescriptive model. The goal is to not depend on <em>pandas</em> when
defining decision variables and constraints. The &#8216;nurses_pandas&#8217;
notebook illustrates how to benefit from pandas to build the
prescriptive model.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="n">skills</span> <span class="o">=</span> <span class="p">[</span><span class="n">SkillTable</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">SkillTable</span><span class="p">))]</span>
<span class="n">depts</span>  <span class="o">=</span> <span class="p">[</span><span class="n">DeptTable</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">DeptTable</span><span class="p">))]</span>
<span class="n">nurses</span> <span class="o">=</span><span class="p">[</span><span class="n">TNurse</span><span class="p">(</span><span class="n">NurseTable</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="n">NurseTable</span><span class="p">[</span><span class="s2">&quot;pay_rate&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">NurseTable</span><span class="p">))]</span>

<span class="c1"># Build {nurse: [skills]} dictionary</span>
<span class="n">nurse_skills</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">nsk</span> <span class="ow">in</span> <span class="n">NurseSkillTable</span><span class="o">.</span><span class="n">itertuples</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="n">nurse_skills</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">nsk</span><span class="o">.</span><span class="n">nurse</span><span class="p">,</span> <span class="p">[])</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nsk</span><span class="o">.</span><span class="n">skill</span><span class="p">)</span>

<span class="n">shifts</span> <span class="o">=</span> <span class="p">[</span><span class="n">TShift</span><span class="p">(</span><span class="o">*</span><span class="n">shift_row</span><span class="p">)</span> <span class="k">for</span> <span class="n">shift_row</span> <span class="ow">in</span> <span class="n">ShiftTable</span><span class="o">.</span><span class="n">itertuples</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="bp">False</span><span class="p">)]</span>
<span class="n">skill_requirements</span> <span class="o">=</span> <span class="p">[</span><span class="n">TSkillRequirement</span><span class="p">(</span><span class="o">*</span><span class="n">skill_requirement_row</span><span class="p">)</span> <span class="k">for</span> <span class="n">skill_requirement_row</span> <span class="ow">in</span>
                      <span class="n">SkillRequirementTable</span><span class="o">.</span><span class="n">itertuples</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="bp">False</span><span class="p">)]</span>
<span class="n">vacations</span> <span class="o">=</span> <span class="p">[</span><span class="n">TVacation</span><span class="p">(</span><span class="o">*</span><span class="n">vacation_row</span><span class="p">)</span> <span class="k">for</span> <span class="n">vacation_row</span> <span class="ow">in</span> <span class="n">NurseVacationTable</span><span class="o">.</span><span class="n">itertuples</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="bp">False</span><span class="p">)]</span>
<span class="n">nurse_associations</span> <span class="o">=</span> <span class="p">[</span><span class="n">TNursePair</span><span class="p">(</span><span class="o">*</span><span class="n">na</span><span class="p">)</span> <span class="k">for</span> <span class="n">na</span> <span class="ow">in</span> <span class="n">NurseAssociationTable</span><span class="o">.</span><span class="n">itertuples</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="bp">False</span><span class="p">)]</span>
<span class="n">nurse_incompatibilities</span> <span class="o">=</span> <span class="p">[</span><span class="n">TNursePair</span><span class="p">(</span><span class="o">*</span><span class="n">na</span><span class="p">)</span> <span class="k">for</span> <span class="n">na</span> <span class="ow">in</span> <span class="n">NurseIncompatibilityTable</span><span class="o">.</span><span class="n">itertuples</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="bp">False</span><span class="p">)]</span>

<span class="c1"># compute shift activities (start, end, duration) and store them in a dict indexed by shifts</span>
<span class="n">shift_activities</span> <span class="o">=</span> <span class="p">{</span><span class="n">s</span><span class="p">:</span> <span class="n">ShiftActivity</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">day</span><span class="p">,</span> <span class="n">s</span><span class="o">.</span><span class="n">start_time</span><span class="p">,</span> <span class="n">s</span><span class="o">.</span><span class="n">end_time</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">shifts</span><span class="p">}</span>

<span class="c1"># map from nurse names to nurse tuples.</span>
<span class="n">nurses_by_id</span> <span class="o">=</span> <span class="p">{</span><span class="n">n</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">nurses</span><span class="p">}</span>

<span class="c1"># Work rules: max work time</span>
<span class="n">work_rules</span> <span class="o">=</span> <span class="n">TWorkRules</span><span class="p">(</span><span class="mi">40</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="step-5-set-up-the-prescriptive-model">
<h3>Step 5: Set up the prescriptive model<a class="headerlink" href="#step-5-set-up-the-prescriptive-model" title="Permalink to this headline">&para;</a></h3>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">docplex.mp.environment</span> <span class="kn">import</span> <span class="n">Environment</span>
<span class="n">env</span> <span class="o">=</span> <span class="n">Environment</span><span class="p">()</span>
<span class="n">env</span><span class="o">.</span><span class="n">print_information</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span></span>* system is: Windows 64bit
* Python is present, version is 2.7.11
* docplex is present, version is (1, 0, 0)
</pre></div>
</div>
<div class="section" id="create-the-docplex-model">
<h4>Create the DOcplex model<a class="headerlink" href="#create-the-docplex-model" title="Permalink to this headline">&para;</a></h4>
<p>This model contains all the business constraints and defines the
objective.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">docplex.mp.model</span> <span class="kn">import</span> <span class="n">Model</span>

<span class="n">mdl</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="s2">&quot;nurses&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="define-the-decision-variables">
<h4>Define the decision variables<a class="headerlink" href="#define-the-decision-variables" title="Permalink to this headline">&para;</a></h4>
<p>The basic decisions are &#8220;which nurse works which shift&#8221;, which is
modeled by binary variables for each (nurse, shift) pair.</p>
<p>The output of the model is, for each shift, the list of nurses that work
the shift.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="c1"># One binary variable for each pair (nurse, shift) equal to 1 if nurse n is assigned to shift s</span>
<span class="n">nurse_assignment_vars</span> <span class="o">=</span> <span class="n">mdl</span><span class="o">.</span><span class="n">binary_var_matrix</span><span class="p">(</span><span class="n">nurses</span><span class="p">,</span> <span class="n">shifts</span><span class="p">,</span> <span class="s1">&#39;NurseAssigned&#39;</span><span class="p">)</span>

<span class="c1"># For each nurse, allocate one variable for worktime</span>
<span class="n">nurse_work_time_vars</span> <span class="o">=</span> <span class="n">mdl</span><span class="o">.</span><span class="n">continuous_var_dict</span><span class="p">(</span><span class="n">nurses</span><span class="p">,</span> <span class="n">lb</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;NurseWorkTime&#39;</span><span class="p">)</span>

<span class="c1"># And two variables for over_average and under-average work time</span>
<span class="n">nurse_over_average_time_vars</span> <span class="o">=</span> <span class="n">mdl</span><span class="o">.</span><span class="n">continuous_var_dict</span><span class="p">(</span><span class="n">nurses</span><span class="p">,</span> <span class="n">lb</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;NurseOverAverageWorkTime&#39;</span><span class="p">)</span>
<span class="n">nurse_under_average_time_vars</span> <span class="o">=</span> <span class="n">mdl</span><span class="o">.</span><span class="n">continuous_var_dict</span><span class="p">(</span><span class="n">nurses</span><span class="p">,</span> <span class="n">lb</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;NurseUnderAverageWorkTime&#39;</span><span class="p">)</span>

<span class="c1"># Finally the global average work time</span>
<span class="n">average_nurse_work_time</span> <span class="o">=</span> <span class="n">mdl</span><span class="o">.</span><span class="n">continuous_var</span><span class="p">(</span><span class="n">lb</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;AverageWorkTime&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="express-the-business-constraints">
<h4>Express the business constraints<a class="headerlink" href="#express-the-business-constraints" title="Permalink to this headline">&para;</a></h4>
<div class="section" id="first-constraint-define-average-work-time">
<h5>First constraint: define average work time<a class="headerlink" href="#first-constraint-define-average-work-time" title="Permalink to this headline">&para;</a></h5>
<p>The average work time over all nurses will be used in particular to
calculate the over/under average work time for each nurse, and to
formulate a <em>fairness</em> rule.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="n">mdl</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">nurses</span><span class="p">)</span> <span class="o">*</span> <span class="n">average_nurse_work_time</span> <span class="o">==</span>
                   <span class="n">mdl</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">nurse_work_time_vars</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">nurses</span><span class="p">),</span> <span class="s2">&quot;average&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span></span>docplex.mp.linear.LinearConstraint[average](32AverageWorkTime,EQ,NurseWorkTime_Jemma+NurseWorkTime_Nathalie+NurseWorkTime_Patrick+NurseWorkTime_Janice+NurseWorkTime_Janelle+NurseWorkTime_Cathy+NurseWorkTime_Roberta+NurseWorkTime_Jane+NurseWorkTime_Isabelle+NurseWorkTime_Joyce+NurseWorkTime_Gloria+NurseWorkTime_Suzanne+NurseWorkTime_Dee+NurseWorkTime_Cindy+NurseWorkTime_Nancy+NurseWorkTime_Debbie+NurseWorkTime_Vickie+NurseWorkTime_David+NurseWorkTime_Julie+NurseWorkTime_Chris+NurseWorkTime_Cecilia+NurseWorkTime_Nicole+NurseWorkTime_Wendie+NurseWorkTime_Juliet+NurseWorkTime_Betsy+NurseWorkTime_Kate+NurseWorkTime_Zoe+NurseWorkTime_Jude+NurseWorkTime_Patricia+NurseWorkTime_Anne+NurseWorkTime_Bethanie+NurseWorkTime_Joan)
</pre></div>
</div>
</div>
<div class="section" id="second-constraint-compute-nurse-work-time-average-and-under-over-time">
<h5>Second constraint: compute nurse work time, average and under/over time<a class="headerlink" href="#second-constraint-compute-nurse-work-time-average-and-under-over-time" title="Permalink to this headline">&para;</a></h5>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">nurses</span><span class="p">:</span>
    <span class="n">work_time_var</span> <span class="o">=</span> <span class="n">nurse_work_time_vars</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
    <span class="n">mdl</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span>
        <span class="n">work_time_var</span> <span class="o">==</span> <span class="n">mdl</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">nurse_assignment_vars</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="n">s</span><span class="p">]</span> <span class="o">*</span> <span class="n">shift_activities</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">duration</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">shifts</span><span class="p">),</span>
        <span class="s2">&quot;work_time_{0!s}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>

    <span class="c1"># Relate over/under average worktime variables to the worktime variables.</span>
    <span class="c1"># The trick here is that variables have zero lower bound</span>
    <span class="c1"># however, these variables are not completely defined by this constraint,</span>
    <span class="c1"># only their difference is.</span>
    <span class="c1"># If these variables are part of the objective, CPLEX will naturally minimize their value,</span>
    <span class="c1"># as expected.</span>
    <span class="n">mdl</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span>
        <span class="n">work_time_var</span> <span class="o">==</span> <span class="n">average_nurse_work_time</span> <span class="o">+</span> <span class="n">nurse_over_average_time_vars</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">-</span> <span class="n">nurse_under_average_time_vars</span><span class="p">[</span><span class="n">n</span><span class="p">],</span>
        <span class="s2">&quot;average_work_time_{0!s}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>

    <span class="c1"># State the maximum work time as a constraint, so that it can be relaxed,</span>
    <span class="c1"># should the problem become infeasible.</span>
    <span class="n">mdl</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span><span class="n">work_time_var</span> <span class="o">&lt;=</span> <span class="n">work_rules</span><span class="o">.</span><span class="n">work_time_max</span><span class="p">,</span> <span class="s2">&quot;max_time_{0!s}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="third-constraint-vacations">
<h5>Third constraint: vacations<a class="headerlink" href="#third-constraint-vacations" title="Permalink to this headline">&para;</a></h5>
<p>When a nurse is on vacation, he or she cannot be assigned to any shift
starting that day.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">vac_nurse_id</span><span class="p">,</span> <span class="n">vac_day</span> <span class="ow">in</span> <span class="n">vacations</span><span class="p">:</span>
        <span class="n">vac_n</span> <span class="o">=</span> <span class="n">nurses_by_id</span><span class="p">[</span><span class="n">vac_nurse_id</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">shift</span> <span class="ow">in</span> <span class="p">(</span><span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">shifts</span> <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">day</span> <span class="o">==</span> <span class="n">vac_day</span><span class="p">):</span>
            <span class="n">mdl</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span><span class="n">nurse_assignment_vars</span><span class="p">[</span><span class="n">vac_n</span><span class="p">,</span> <span class="n">shift</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span>
                                 <span class="s2">&quot;medium_vacations_{0!s}_{1!s}_{2!s}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">vac_n</span><span class="p">,</span> <span class="n">vac_day</span><span class="p">,</span> <span class="n">shift</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="fourth-constraint-a-nurse-cannot-be-assigned-overlapping-shifts">
<h5>Fourth constraint: a nurse cannot be assigned overlapping shifts<a class="headerlink" href="#fourth-constraint-a-nurse-cannot-be-assigned-overlapping-shifts" title="Permalink to this headline">&para;</a></h5>
<p>Some shifts overlap in time and thus cannot be assigned to the same
nurse.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="c1"># Post only one constraint per couple(s1, s2)</span>
<span class="n">number_of_overlaps</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">nb_shifts</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">shifts</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i1</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nb_shifts</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i2</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i1</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nb_shifts</span><span class="p">):</span>
        <span class="n">s1</span> <span class="o">=</span> <span class="n">shifts</span><span class="p">[</span><span class="n">i1</span><span class="p">]</span>
        <span class="n">s2</span> <span class="o">=</span> <span class="n">shifts</span><span class="p">[</span><span class="n">i2</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">shift_activities</span><span class="p">[</span><span class="n">s1</span><span class="p">]</span><span class="o">.</span><span class="n">overlaps</span><span class="p">(</span><span class="n">shift_activities</span><span class="p">[</span><span class="n">s2</span><span class="p">]):</span>
            <span class="n">number_of_overlaps</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">nurses</span><span class="p">:</span>
                <span class="n">mdl</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span><span class="n">nurse_assignment_vars</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="n">s1</span><span class="p">]</span> <span class="o">+</span> <span class="n">nurse_assignment_vars</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="n">s2</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">,</span>
                                   <span class="s2">&quot;high_overlapping_{0!s}_{1!s}_{2!s}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;# overlapping shifts: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">number_of_overlaps</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># overlapping shifts: 20</span>
</pre></div>
</div>
</div>
<div class="section" id="fifth-constraint-enforce-minimum-and-maximum-requirements-for-shifts">
<h5>Fifth constraint: enforce minimum and maximum requirements for shifts<a class="headerlink" href="#fifth-constraint-enforce-minimum-and-maximum-requirements-for-shifts" title="Permalink to this headline">&para;</a></h5>
<p>Each shift requires a minimum and a maximum number of nurses. For each
shift, the sum over all nurses of assignments to this shift must be
greater than or equal to the minimum requirement and lesser than or
equal to the maximum requirement.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">shifts</span><span class="p">:</span>
    <span class="n">demand_min</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">min_requirement</span>
    <span class="n">demand_max</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">max_requirement</span>
    <span class="n">total_assigned</span> <span class="o">=</span> <span class="n">mdl</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">nurse_assignment_vars</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="n">s</span><span class="p">]</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">nurses</span><span class="p">)</span>
    <span class="n">mdl</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span><span class="n">total_assigned</span> <span class="o">&gt;=</span> <span class="n">demand_min</span><span class="p">,</span>
                       <span class="s2">&quot;high_req_min_{0!s}_{1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">demand_min</span><span class="p">))</span>
    <span class="n">mdl</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span><span class="n">total_assigned</span> <span class="o">&lt;=</span> <span class="n">demand_max</span><span class="p">,</span>
                       <span class="s2">&quot;medium_req_max_{0!s}_{1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">demand_max</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="sixth-constraint-enforce-skill-requirements-for-selected-shifts">
<h5>Sixth constraint: enforce skill requirements for selected shifts<a class="headerlink" href="#sixth-constraint-enforce-skill-requirements-for-selected-shifts" title="Permalink to this headline">&para;</a></h5>
<p>Some shifts require at least <em>x</em> nurses with a specified skill.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="p">(</span><span class="n">dept</span><span class="p">,</span> <span class="n">skill</span><span class="p">,</span> <span class="n">required</span><span class="p">)</span> <span class="ow">in</span> <span class="n">skill_requirements</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">required</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">dsh</span> <span class="ow">in</span> <span class="p">(</span><span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">shifts</span> <span class="k">if</span> <span class="n">dept</span> <span class="o">==</span> <span class="n">s</span><span class="o">.</span><span class="n">department</span><span class="p">):</span>
            <span class="n">mdl</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span><span class="n">mdl</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">nurse_assignment_vars</span><span class="p">[</span><span class="n">skilled_nurse</span><span class="p">,</span> <span class="n">dsh</span><span class="p">]</span> <span class="k">for</span> <span class="n">skilled_nurse</span> <span class="ow">in</span>
                                       <span class="p">(</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">nurses</span> <span class="k">if</span> <span class="n">n</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">nurse_skills</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">and</span>
                                        <span class="n">skill</span> <span class="ow">in</span> <span class="n">nurse_skills</span><span class="p">[</span><span class="n">n</span><span class="o">.</span><span class="n">name</span><span class="p">]))</span> <span class="o">&gt;=</span> <span class="n">required</span><span class="p">,</span>
                               <span class="s2">&quot;high_required_{0!s}_{1!s}_{2!s}_{3!s}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dept</span><span class="p">,</span> <span class="n">skill</span><span class="p">,</span> <span class="n">required</span><span class="p">,</span> <span class="n">dsh</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="seventh-constraint-associations">
<h5>Seventh constraint: associations<a class="headerlink" href="#seventh-constraint-associations" title="Permalink to this headline">&para;</a></h5>
<p>Some pairs of nurses get along particularly well, so we wish to assign
them together as a team. In other words, for every such pair and for
each shift, both assignment variables should always be equal. Either
both nurses work the shift, or both do not.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="c1"># for each pair of associted nurses, their assignement variables are equal over all shifts.</span>
<span class="n">c</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="p">(</span><span class="n">nurse_id1</span><span class="p">,</span> <span class="n">nurse_id2</span><span class="p">)</span> <span class="ow">in</span> <span class="n">nurse_associations</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">nurse_id1</span> <span class="ow">in</span> <span class="n">nurses_by_id</span> <span class="ow">and</span> <span class="n">nurse_id2</span> <span class="ow">in</span> <span class="n">nurses_by_id</span><span class="p">:</span>
        <span class="n">nurse1</span> <span class="o">=</span> <span class="n">nurses_by_id</span><span class="p">[</span><span class="n">nurse_id1</span><span class="p">]</span>
        <span class="n">nurse2</span> <span class="o">=</span> <span class="n">nurses_by_id</span><span class="p">[</span><span class="n">nurse_id2</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">shifts</span><span class="p">:</span>
            <span class="n">c</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">ctname</span> <span class="o">=</span> <span class="s1">&#39;medium_ct_nurse_assoc_{0!s}_{1!s}_{2:d}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nurse_id1</span><span class="p">,</span> <span class="n">nurse_id2</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
            <span class="n">mdl</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span><span class="n">nurse_assignment_vars</span><span class="p">[</span><span class="n">nurse1</span><span class="p">,</span> <span class="n">s</span><span class="p">]</span> <span class="o">==</span> <span class="n">nurse_assignment_vars</span><span class="p">[</span><span class="n">nurse2</span><span class="p">,</span> <span class="n">s</span><span class="p">],</span> <span class="n">ctname</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="eighth-constraint-incompatibilities">
<h5>Eighth constraint: incompatibilities<a class="headerlink" href="#eighth-constraint-incompatibilities" title="Permalink to this headline">&para;</a></h5>
<p>Similarly, certain pairs of nurses do not get along well, and we want to
avoid having them together on a shift. In other words, for each shift,
both nurses of an incompatible pair cannot be assigned together to the
shift.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="c1"># For each pair of incompatible nurses, the sum of assigned variables is less than one</span>
<span class="n">c</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="p">(</span><span class="n">nurse_id1</span><span class="p">,</span> <span class="n">nurse_id2</span><span class="p">)</span> <span class="ow">in</span> <span class="n">nurse_incompatibilities</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">nurse_id1</span> <span class="ow">in</span> <span class="n">nurses_by_id</span> <span class="ow">and</span> <span class="n">nurse_id2</span> <span class="ow">in</span> <span class="n">nurses_by_id</span><span class="p">:</span>
        <span class="n">nurse1</span> <span class="o">=</span> <span class="n">nurses_by_id</span><span class="p">[</span><span class="n">nurse_id1</span><span class="p">]</span>
        <span class="n">nurse2</span> <span class="o">=</span> <span class="n">nurses_by_id</span><span class="p">[</span><span class="n">nurse_id2</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">shifts</span><span class="p">:</span>
            <span class="n">c</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">ctname</span> <span class="o">=</span> <span class="s1">&#39;medium_ct_nurse_incompat_{0!s}_{1!s}_{2:d}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nurse_id1</span><span class="p">,</span> <span class="n">nurse_id2</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
            <span class="n">mdl</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span><span class="n">nurse_assignment_vars</span><span class="p">[</span><span class="n">nurse1</span><span class="p">,</span> <span class="n">s</span><span class="p">]</span> <span class="o">+</span> <span class="n">nurse_assignment_vars</span><span class="p">[</span><span class="n">nurse2</span><span class="p">,</span> <span class="n">s</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ctname</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="express-the-objective">
<h4>Express the objective<a class="headerlink" href="#express-the-objective" title="Permalink to this headline">&para;</a></h4>
<p>The objective mixes different (and contradictory) KPIs.</p>
<p>The first KPI is the total salary cost, computed as the sum of work
times over all nurses, weighted by pay rate. The second KPI is the total
number of assignments (nurse, shift). The third KPI is the average total
work time over all nurses. The fourth KPI represents the total number of
hours that is above the average work time (summed over all nurses),
while the fifth KPI represents the total number of hours that is below
this average. Finally, the last KPI is a measure of fairness, which is
evaluated as the total deviation from the average work time.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="n">total_number_of_assignments</span> <span class="o">=</span> <span class="n">mdl</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">nurse_assignment_vars</span><span class="p">[</span><span class="n">n</span><span class="p">,</span><span class="n">s</span><span class="p">]</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">nurses</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">shifts</span><span class="p">)</span>
<span class="n">nurse_costs</span> <span class="o">=</span> <span class="p">[</span><span class="n">nurse_assignment_vars</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="n">s</span><span class="p">]</span> <span class="o">*</span> <span class="n">n</span><span class="o">.</span><span class="n">pay_rate</span> <span class="o">*</span> <span class="n">shift_activities</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">duration</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">nurses</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">shifts</span><span class="p">]</span>
<span class="n">total_salary_cost</span> <span class="o">=</span> <span class="n">mdl</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">nurse_costs</span><span class="p">)</span>
<span class="n">mdl</span><span class="o">.</span><span class="n">add_kpi</span><span class="p">(</span><span class="n">total_salary_cost</span><span class="p">,</span> <span class="s2">&quot;Total salary cost&quot;</span><span class="p">)</span>
<span class="n">mdl</span><span class="o">.</span><span class="n">add_kpi</span><span class="p">(</span><span class="n">total_number_of_assignments</span><span class="p">,</span> <span class="s2">&quot;Total number of assignments&quot;</span><span class="p">)</span>
<span class="n">mdl</span><span class="o">.</span><span class="n">add_kpi</span><span class="p">(</span><span class="n">average_nurse_work_time</span><span class="p">)</span>

<span class="n">total_over_average_worktime</span> <span class="o">=</span> <span class="n">mdl</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">nurse_over_average_time_vars</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">nurses</span><span class="p">)</span>
<span class="n">total_under_average_worktime</span> <span class="o">=</span> <span class="n">mdl</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">nurse_under_average_time_vars</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">nurses</span><span class="p">)</span>
<span class="n">mdl</span><span class="o">.</span><span class="n">add_kpi</span><span class="p">(</span><span class="n">total_over_average_worktime</span><span class="p">,</span> <span class="s2">&quot;Total over-average worktime&quot;</span><span class="p">)</span>
<span class="n">mdl</span><span class="o">.</span><span class="n">add_kpi</span><span class="p">(</span><span class="n">total_under_average_worktime</span><span class="p">,</span> <span class="s2">&quot;Total under-average worktime&quot;</span><span class="p">)</span>

<span class="n">total_fairness</span> <span class="o">=</span> <span class="n">total_over_average_worktime</span> <span class="o">+</span> <span class="n">total_under_average_worktime</span>
<span class="n">mdl</span><span class="o">.</span><span class="n">add_kpi</span><span class="p">(</span><span class="n">total_fairness</span><span class="p">,</span> <span class="s2">&quot;Total fairness&quot;</span><span class="p">)</span>

<span class="n">mdl</span><span class="o">.</span><span class="n">print_information</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span></span>Model: nurses
 - number of variables: 1409
   - binary=1312, integer=0, continuous=97
 - number of constraints: 1719
 -   LE=1164, EQ=489, GE=66, RNG=0
 - parameters: defaults
</pre></div>
</div>
<div class="section" id="minimizing-objective">
<h5>Minimizing objective<a class="headerlink" href="#minimizing-objective" title="Permalink to this headline">&para;</a></h5>
<p>The goal is to minimize the non-weighted sum of the <em>total salary cost</em>,
<em>fairness</em> and <em>total number of assignment</em>. This is accomplished using
the <code class="docutils literal"><span class="pre">Model.minimize()</span></code> method.</p>
<p>This definition is arbitrary and could be revised. For instance, one
could emphasize minimizing salary cost by adding a weight on this term
in the objective.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="n">mdl</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="n">total_salary_cost</span> <span class="o">+</span> <span class="n">total_fairness</span> <span class="o">+</span> <span class="n">total_number_of_assignments</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="solve-with-the-decision-optimization-solve-service">
<h4>Solve with the Decision Optimization solve service<a class="headerlink" href="#solve-with-the-decision-optimization-solve-service" title="Permalink to this headline">&para;</a></h4>
<p>Now we have everything we need to solve the model, using
<code class="docutils literal"><span class="pre">Model.solve()</span></code>. The following cell solves using your local CPLEX (if
any, and provided you have added it to your <code class="docutils literal"><span class="pre">PYTHONPATH</span></code> variable). If
you do not have CPLEX installed, please enter your DOcplexcloud
credentials below in the <code class="docutils literal"><span class="pre">key</span></code> and <code class="docutils literal"><span class="pre">url</span></code> fields in order to solve
with DOcplexcloud.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="c1"># Set Cplex mipgap to 1e-5 to enforce precision to be of the order of a unit (objective value magnitude is ~1e+5).</span>
<span class="n">mdl</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">mip</span><span class="o">.</span><span class="n">tolerances</span><span class="o">.</span><span class="n">mipgap</span> <span class="o">=</span> <span class="mf">1e-5</span>

<span class="n">s</span> <span class="o">=</span> <span class="n">mdl</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="n">log_output</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">s</span><span class="p">,</span> <span class="s2">&quot;solve failed&quot;</span>
<span class="n">mdl</span><span class="o">.</span><span class="n">report</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span></span>Tried aggregator 2 times.
MIP Presolve eliminated 1028 rows and 379 columns.
MIP Presolve modified 90 coefficients.
Aggregator did 41 substitutions.
Reduced MIP has 650 rows, 989 columns, and 4029 nonzeros.
Reduced MIP has 892 binaries, 0 generals, 0 SOSs, and 0 indicators.
Presolve time = 0.00 sec. (4.48 ticks)
Probing time = 0.00 sec. (1.78 ticks)
Cover probing fixed 0 vars, tightened 3 bounds.
Tried aggregator 1 time.
Reduced MIP has 650 rows, 989 columns, and 4029 nonzeros.
Reduced MIP has 892 binaries, 32 generals, 0 SOSs, and 0 indicators.
Presolve time = 0.00 sec. (1.96 ticks)
Probing time = 0.00 sec. (0.77 ticks)
Clique table members: 479.
MIP emphasis: balance optimality and feasibility.
MIP search method: dynamic search.
Parallel mode: deterministic, using up to 8 threads.
Root relaxation solution time = 0.02 sec. (9.97 ticks)

        Nodes                                         Cuts/
   Node  Left     Objective  IInf  Best Integer    Best Bound    ItCnt     Gap

      0     0    29102.0000    42                  29102.0000      657
      0     0    29102.0000    59                    Cuts: 79      806
      0     0    29102.0000    27                    Cuts: 22      880
      0     0    29102.0000    40                    Cuts: 52      985
*     0+    0                        29648.3750    29102.0000             1.84%
*     0+    0                        29448.0000    29102.0000             1.17%
*     0+    0                        29446.0000    29102.0000             1.17%
*     0+    0                        29376.0000    29102.0000             0.93%
      0     2    29102.0000    18    29376.0000    29102.0000      985    0.93%
Elapsed time = 0.34 sec. (182.16 ticks, tree = 0.01 MB, solutions = 4)
*     4+    4                        29344.0000    29102.0000             0.82%
*     4+    4                        29310.0000    29102.0000             0.71%
*     4+    4                        29298.0000    29102.0000             0.67%
*    11+   11                        29296.0000    29102.0000             0.66%
*    18+   18                        29268.0000    29102.0000             0.57%
*    19+   19                        29214.0000    29102.0000             0.38%
*    26+   26                        29184.0000    29102.0000             0.28%
*  1762+ 1632                        29140.0000    29102.0000             0.13%
*  1763+ 1633                        29120.0000    29102.0000             0.06%
   1763  1635    29102.0000    34    29120.0000    29102.0000    30055    0.06%
   1764  1636    29102.0000    17    29120.0000    29102.0000    30089    0.06%
   1765  1634    29120.0000    12    29120.0000    29102.0000    30105    0.06%
*  1766+ 1632                        29102.0000    29102.0000             0.00%
   1767  1628    29137.0000    21    29102.0000    29102.0000    30168    0.00%

GUB cover cuts applied:  16
Cover cuts applied:  55
Flow cuts applied:  11
Mixed integer rounding cuts applied:  10
Zero-half cuts applied:  14
Lift and project cuts applied:  1
Gomory fractional cuts applied:  2

Root node processing (before b&amp;c):
  Real time             =    0.34 sec. (181.90 ticks)
Parallel b&amp;c, 8 threads:
  Real time             =    0.69 sec. (426.73 ticks)
  Sync time (average)   =    0.31 sec.
  Wait time (average)   =    0.32 sec.
                          ------------
Total (root+branch&amp;cut) =    1.03 sec. (608.63 ticks)
* model solved with objective: 29102.000
* KPI: Total salary cost=28824.000
* KPI: Total number of assignments=220.000
* KPI: AverageWorkTime=39.000
* KPI: Total over-average worktime=29.000
* KPI: Total under-average worktime=29.000
* KPI: Total fairness=58.000
</pre></div>
</div>
</div>
</div>
<div class="section" id="step-6-investigate-the-solution-and-then-run-an-example-analysis">
<h3>Step 6: Investigate the solution and then run an example analysis<a class="headerlink" href="#step-6-investigate-the-solution-and-then-run-an-example-analysis" title="Permalink to this headline">&para;</a></h3>
<p>Let&#8217;s display some charts to visualize the results: a Gantt chart
displaying the assignment of nurses to shifts in a Gantt chart, and
another chart showing the number of assigned nurses to each department
over time.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="nb">min</span><span class="p">(</span><span class="n">shift_activities</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">i</span><span class="p">:</span> <span class="n">shift_activities</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">day_start_time</span><span class="p">)</span>
<span class="nb">min</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">day_start_time</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">shift_activities</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="o">-</span><span class="mi">24</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span></span>import matplotlib.pyplot as plt
import matplotlib.gridspec as gridspec
%matplotlib inline

# Build set of all departments and assign a color to each of them to be used in figures
departments = {s.department for s in shifts}
colorByDepartment = {}
for d, c in zip(departments, [&#39;r&#39;, &#39;m&#39;, &#39;b&#39;, &#39;g&#39;, &#39;y&#39;, &#39;c&#39;, &#39;k&#39;]):
    colorByDepartment[d] = c

# Build dictionary with number of assigned nurses for each shift
nbAssignmentsByShift={}
for n in nurses:
    for s in shifts:
        if nurse_assignment_vars[n,s].solution_value &gt; 0:
            nbAssignmentsByShift[s] = nbAssignmentsByShift.get(s,0) + 1

# Build a dictionary with the list of each shift corresponding to each department
shiftsByDepartment = {}
for s in shifts:
    shiftsByDepartment.setdefault(s.department, []).append(s)


# Shared code
def createLabels(ax, title, xlabel, ylabel):
    shiftInfoByDay = {s1.day : s1 for s1 in shifts}
    plt.xticks([shift_activities[s].day_start_time + w * 7 * 24 for w in [0,1] for (d, s) in shiftInfoByDay.iteritems()],
              [&quot;{}&quot;.format(s.day) for w in [0,1] for (d, s) in shiftInfoByDay.iteritems()])
    plt.xlim([min(s.day_start_time for s in shift_activities.values()) - 6,
              max(s.day_start_time for s in shift_activities.values()) + 30])
    ax.set_xlabel(xlabel)
    ax.set_ylabel(ylabel)
    ax.grid()
    ax.set_title(title)

# Plot shift assignments for each nurse
def displayNursesAssignmentsGantt(ax):
    ylabels, tickloc = [], []
    for i, n in enumerate(nurses):
        for s in shifts:
            if nurse_assignment_vars[n,s].solution_value &gt; 0:
                ax.bar(shift_activities[s].start_time, 0.8,
                       width=shift_activities[s].end_time - shift_activities[s].start_time, bottom=i + 0.1,
                       color=colorByDepartment[s.department])

        ylabels.append(&quot;{} (worked: {} hours)&quot;.format(str(n), nurse_work_time_vars[n].solution_value))
        tickloc.append(i + 0.5)

    plt.ylim(0, len(nurses))
    plt.yticks(tickloc, ylabels)

    # Create labels on x/y axis
    createLabels(ax, &#39;SHIFTS ASSIGNMENTS&#39;, &#39;DAY OF WEEK&#39;, &#39;NURSES&#39;)

# Plot number of assigned nurses for each shift, by department
def displayDepartmentsAssignments(ax):
    ylabels, tickloc = [], []
    maxNbAssignements = max(nbAssignmentsByShift.values())
    for i, d in enumerate(departments):
        for s in shiftsByDepartment[d]:
            ax.bar(shift_activities[s].start_time, nbAssignmentsByShift[s] / float(maxNbAssignements + 1),
                   width=shift_activities[s].end_time - shift_activities[s].start_time, bottom=i + 0.5,
                   color=colorByDepartment[s.department])
        ylabels.append(&quot;{}&quot;.format(d))
        tickloc.append(i + 0.5)

    plt.ylim(0, len(departments) + 0.5)
    plt.yticks(tickloc, ylabels)

    # Create labels on x/y axis
    createLabels(ax, &#39;NUMBER OF ASSIGNED NURSES&#39;, &#39;DAY OF WEEK&#39;, &#39;DEPARTMENTS&#39;)

# Display figures as two sub-plots so that they are vertically aligned
fig = plt.figure(figsize=[14,12])
gs = gridspec.GridSpec(2, 1, height_ratios=[3,1])

ax = plt.subplot(gs[0])
displayNursesAssignmentsGantt(ax)

ax = plt.subplot(gs[1])
displayDepartmentsAssignments(ax)
</pre></div>
</div>
<img alt="_images/nurses_scheduling_46_0.png" src="_images/nurses_scheduling_46_0.png" />
</div>
</div>
<div class="section" id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="Permalink to this headline">&para;</a></h2>
<p>You learned how to set up and use IBM Decision Optimization CPLEX
Modeling for Python to formulate a Mathematical Programming model and
solve it with IBM Decision Optimization on Cloud.</p>
</div>
<div class="section" id="references">
<h2>References<a class="headerlink" href="#references" title="Permalink to this headline">&para;</a></h2>
<ul class="simple">
<li><a class="reference external" href="https://rawgit.com/IBMDecisionOptimization/docplex-doc/master/docs/index.html">CPLEX Modeling for Python
documentation</a></li>
<li><a class="reference external" href="https://developer.ibm.com/docloud/">Decision Optimization on
Cloud</a></li>
<li>Need help with DOcplex or to report a bug? Please go
<a class="reference external" href="https://developer.ibm.com/answers/smartspace/docloud">here</a>.</li>
<li>Contact us at <a class="reference external" href="mailto:dofeedback&#37;&#52;&#48;wwpdl&#46;vnet&#46;ibm&#46;com">dofeedback<span>&#64;</span>wwpdl<span>&#46;</span>vnet<span>&#46;</span>ibm<span>&#46;</span>com</a>.</li>
</ul>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">The Nurses Model</a><ul>
<li><a class="reference internal" href="#describe-the-business-problem">Describe the business problem</a></li>
<li><a class="reference internal" href="#how-decision-optimization-can-help">How decision optimization can help</a></li>
<li><a class="reference internal" href="#use-decision-optimization">Use decision optimization</a><ul>
<li><a class="reference internal" href="#step-1-download-the-library">Step 1: Download the library</a></li>
<li><a class="reference internal" href="#step-2-set-up-the-prescriptive-engine">Step 2: Set up the prescriptive engine</a></li>
<li><a class="reference internal" href="#step-3-model-the-data">Step 3: Model the data</a></li>
<li><a class="reference internal" href="#step-4-prepare-the-data">Step 4: Prepare the data</a><ul>
<li><a class="reference internal" href="#loading-data-from-excel-with-pandas">Loading data from Excel with pandas</a></li>
</ul>
</li>
<li><a class="reference internal" href="#step-5-set-up-the-prescriptive-model">Step 5: Set up the prescriptive model</a><ul>
<li><a class="reference internal" href="#create-the-docplex-model">Create the DOcplex model</a></li>
<li><a class="reference internal" href="#define-the-decision-variables">Define the decision variables</a></li>
<li><a class="reference internal" href="#express-the-business-constraints">Express the business constraints</a><ul>
<li><a class="reference internal" href="#first-constraint-define-average-work-time">First constraint: define average work time</a></li>
<li><a class="reference internal" href="#second-constraint-compute-nurse-work-time-average-and-under-over-time">Second constraint: compute nurse work time, average and under/over time</a></li>
<li><a class="reference internal" href="#third-constraint-vacations">Third constraint: vacations</a></li>
<li><a class="reference internal" href="#fourth-constraint-a-nurse-cannot-be-assigned-overlapping-shifts">Fourth constraint: a nurse cannot be assigned overlapping shifts</a></li>
<li><a class="reference internal" href="#fifth-constraint-enforce-minimum-and-maximum-requirements-for-shifts">Fifth constraint: enforce minimum and maximum requirements for shifts</a></li>
<li><a class="reference internal" href="#sixth-constraint-enforce-skill-requirements-for-selected-shifts">Sixth constraint: enforce skill requirements for selected shifts</a></li>
<li><a class="reference internal" href="#seventh-constraint-associations">Seventh constraint: associations</a></li>
<li><a class="reference internal" href="#eighth-constraint-incompatibilities">Eighth constraint: incompatibilities</a></li>
</ul>
</li>
<li><a class="reference internal" href="#express-the-objective">Express the objective</a><ul>
<li><a class="reference internal" href="#minimizing-objective">Minimizing objective</a></li>
</ul>
</li>
<li><a class="reference internal" href="#solve-with-the-decision-optimization-solve-service">Solve with the Decision Optimization solve service</a></li>
</ul>
</li>
<li><a class="reference internal" href="#step-6-investigate-the-solution-and-then-run-an-example-analysis">Step 6: Investigate the solution and then run an example analysis</a></li>
</ul>
</li>
<li><a class="reference internal" href="#summary">Summary</a></li>
<li><a class="reference internal" href="#references">References</a></li>
</ul>
</li>
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">DOcplex.MP: Mathematical Programming Modeling for Python V2.0 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2016-2017, IBM&reg;.
    </div>
  </body>
</html>