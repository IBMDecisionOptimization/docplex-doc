

<!doctype html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
    
    <title>The Unit Commitment Problem (UCP) &#8212; DOcplex.MP: Mathematical Programming Modeling for Python V2.7 documentation</title>
    
    <link rel="stylesheet" href="_static/bizstyle.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     'V2.7',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  false,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="_static/bizstyle.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="diet_pandas.py" href="diet_pandas.html" />
    <link rel="prev" title="Use decision optimization to help a sports league schedule its games" href="sports_scheduling.html" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <!--[if lt IE 9]>
    <script type="text/javascript" src="_static/css3-mediaqueries.js"></script>
    <![endif]-->
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="diet_pandas.html" title="diet_pandas.py"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="sports_scheduling.html" title="Use decision optimization to help a sports league schedule its games"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">DOcplex.MP: Mathematical Programming Modeling for Python V2.7 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="samples.html" accesskey="U">Examples of mathematical programming</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">The Unit Commitment Problem (UCP)</a><ul>
<li><a class="reference internal" href="#describe-the-business-problem">Describe the business problem</a></li>
<li><a class="reference internal" href="#how-decision-optimization-can-help">How decision optimization can help</a></li>
<li><a class="reference internal" href="#checking-minimum-requirements">Checking minimum requirements</a></li>
<li><a class="reference internal" href="#use-decision-optimization">Use decision optimization</a><ul>
<li><a class="reference internal" href="#step-1-download-the-library">Step 1: Download the library</a></li>
<li><a class="reference internal" href="#step-2-set-up-the-prescriptive-engine">Step 2: Set up the prescriptive engine</a></li>
<li><a class="reference internal" href="#step-3-model-the-data">Step 3: Model the data</a><ul>
<li><a class="reference internal" href="#load-data-from-a-pandas-dataframe">Load data from a <em>pandas</em> DataFrame</a></li>
<li><a class="reference internal" href="#available-energy-technologies">Available energy technologies</a></li>
</ul>
</li>
<li><a class="reference internal" href="#step-4-prepare-the-data">Step 4: Prepare the data</a></li>
<li><a class="reference internal" href="#step-5-set-up-the-prescriptive-model">Step 5: Set up the prescriptive model</a><ul>
<li><a class="reference internal" href="#create-the-docplex-model">Create the DOcplex model</a></li>
<li><a class="reference internal" href="#define-the-decision-variables">Define the decision variables</a></li>
<li><a class="reference internal" href="#express-the-business-constraints">Express the business constraints</a><ul>
<li><a class="reference internal" href="#linking-in-use-status-to-production">Linking in-use status to production</a></li>
<li><a class="reference internal" href="#initial-state">Initial state</a></li>
<li><a class="reference internal" href="#ramp-up-ramp-down-constraint">Ramp-up / ramp-down constraint</a></li>
<li><a class="reference internal" href="#turn-on-turn-off">Turn on / turn off</a></li>
<li><a class="reference internal" href="#minimum-uptime-and-downtime">Minimum uptime and downtime</a></li>
<li><a class="reference internal" href="#demand-constraint">Demand constraint</a></li>
</ul>
</li>
<li><a class="reference internal" href="#express-the-objective">Express the objective</a></li>
<li><a class="reference internal" href="#solve-with-the-decision-optimization-solve-service">Solve with the Decision Optimization solve service</a></li>
</ul>
</li>
<li><a class="reference internal" href="#step-6-investigate-the-solution-and-then-run-an-example-analysis">Step 6: Investigate the solution and then run an example analysis</a><ul>
<li><a class="reference internal" href="#number-of-plants-online-by-period">Number of plants online by period</a></li>
<li><a class="reference internal" href="#costs-by-period">Costs by period</a></li>
<li><a class="reference internal" href="#cost-breakdown-by-unit-and-by-energy">Cost breakdown by unit and by energy</a></li>
</ul>
</li>
<li><a class="reference internal" href="#arbitration-between-co2-cost-and-economic-cost">Arbitration between CO2 cost and economic cost</a></li>
</ul>
</li>
<li><a class="reference internal" href="#summary">Summary</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="sports_scheduling.html"
                        title="previous chapter">Use decision optimization to help a sports league schedule its games</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="diet_pandas.html"
                        title="next chapter">diet_pandas.py</a></p>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <center></center><div class="section" id="the-unit-commitment-problem-ucp">
<h1>The Unit Commitment Problem (UCP)<a class="headerlink" href="#the-unit-commitment-problem-ucp" title="Permalink to this headline">&para;</a></h1>
<p>This tutorial includes everything you need to set up IBM Decision
Optimization CPLEX Modeling for Python (DOcplex), build a Mathematical
Programming model, and get its solution by solving the model on the
cloud with IBM ILOG CPLEX Optimizer.</p>
<p>When you finish this tutorial, you&#8217;ll have a foundational knowledge of
<em>Prescriptive Analytics</em>.</p>
<blockquote>
<div><p>This notebook is part of <a class="reference external" href="https://rawgit.com/IBMDecisionOptimization/docplex-doc/master/docs/index.html">Prescriptive Analytics for
Python</a>.</p>
<p>It requires a valid subscription to <strong>Decision Optimization on the
Cloud</strong>. Try it for free
<a class="reference external" href="https://developer.ibm.com/docloud">here</a>.</p>
</div></blockquote>
<p>Table of contents:</p>
<ul class="simple">
<li><a class="reference internal" href="#describe-the-business-problem">Describe the business problem</a></li>
<li><a class="reference internal" href="#how-decision-optimization-can-help">How  decision optimization can help</a></li>
<li><a class="reference internal" href="#use-decision-optimization">Use decision optimization</a><ul>
<li><a class="reference internal" href="#step-1-download-the-library">Step 1: Download the library</a></li>
<li><a class="reference internal" href="#step-2-set-up-the-prescriptive-engine">Step 2: Set up the prescriptive engine</a></li>
<li><a class="reference internal" href="#step-3-model-the-data">Step 3: Model the data</a></li>
<li><a class="reference internal" href="#step-4-prepare-the-data">Step 4: Prepare the data</a></li>
<li><a class="reference internal" href="#step-5-set-up-the-prescriptive-model">Step 5: Set up the prescriptive model</a><ul>
<li><a class="reference internal" href="#define-the-decision-variables">Define the decision variables</a></li>
<li><a class="reference internal" href="#express-the-business-constraints">Express the business constraints</a></li>
<li><a class="reference internal" href="#express-the-objective">Express the objective</a></li>
<li><a class="reference internal" href="#solve-with-the-decision-optimization-solve-service">Solve with the Decision Optimization solve service</a></li>
</ul>
</li>
<li><a class="reference internal" href="#step-6-investigate-the-solution-and-then-run-an-example-analysis">Step 6: Investigate the solution and then run an example analysis</a></li>
</ul>
</li>
<li><a class="reference internal" href="#summary">Summary</a></li>
</ul>
<hr class="docutils" />
<div class="section" id="describe-the-business-problem">
<h2>Describe the business problem<a class="headerlink" href="#describe-the-business-problem" title="Permalink to this headline">&para;</a></h2>
<ul class="simple">
<li>The Model estimates the lower cost of generating electricity within a
given plan. Depending on the demand for electricity, we turn on or
off units that generate power and which have operational properties
and costs.</li>
<li>The Unit Commitment Problem answers the question, &#8220;Which power
generators should I run at which times and at what level in order to
satisfy the demand for electricity?&#8221; This model helps users to find
not only a feasible answer to the question, but one that also
optimizes its solution to meet as many of the electricity company&#8217;s
overall goals as possible.</li>
</ul>
</div>
<div class="section" id="how-decision-optimization-can-help">
<h2>How decision optimization can help<a class="headerlink" href="#how-decision-optimization-can-help" title="Permalink to this headline">&para;</a></h2>
<ul>
<li><p class="first">Prescriptive analytics (decision optimization) technology recommends
actions that are based on desired outcomes. It takes into account
specific scenarios, resources, and knowledge of past and current
events. With this insight, your organization can make better
decisions and have greater control of business outcomes.</p>
</li>
<li><p class="first">Prescriptive analytics is the next step on the path to insight-based
actions. It creates value through synergy with predictive analytics,
which analyzes data to predict future outcomes.</p>
</li>
<li><div class="first line-block">
<div class="line">Prescriptive analytics takes that insight to the next level by
suggesting the optimal way to handle that future situation.
Organizations that can act fast in dynamic conditions and make
superior decisions in uncertain environments gain a strong
competitive advantage.</div>
<div class="line"><br /></div>
</div>
</li>
</ul>
<p>With prescriptive analytics, you can:</p>
<ul class="simple">
<li>Automate the complex decisions and trade-offs to better manage your
limited resources.</li>
<li>Take advantage of a future opportunity or mitigate a future risk.</li>
<li>Proactively update recommendations based on changing events.</li>
<li>Meet operational goals, increase customer loyalty, prevent threats
and fraud, and optimize business processes.</li>
</ul>
</div>
<div class="section" id="checking-minimum-requirements">
<h2>Checking minimum requirements<a class="headerlink" href="#checking-minimum-requirements" title="Permalink to this headline">&para;</a></h2>
<p>This notebook uses some features of <em>pandas</em> that are available in
version 0.17.1 or above.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pip</span>
<span class="n">REQUIRED_MINIMUM_PANDAS_VERSION</span> <span class="o">=</span> <span class="s1">&#39;0.17.1&#39;</span>
<span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="n">pkg</span><span class="o">.</span><span class="n">key</span> <span class="p">:</span> <span class="n">pkg</span><span class="o">.</span><span class="n">version</span> <span class="k">for</span> <span class="n">pkg</span> <span class="ow">in</span> <span class="n">pip</span><span class="o">.</span><span class="n">get_installed_distributions</span><span class="p">()}</span>
<span class="k">try</span><span class="p">:</span>
    <span class="k">assert</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;pandas&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">REQUIRED_MINIMUM_PANDAS_VERSION</span>
<span class="k">except</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Version &quot;</span> <span class="o">+</span> <span class="n">REQUIRED_MINIMUM_PANDAS_VERSION</span> <span class="o">+</span> <span class="s2">&quot; or above of Pandas is required to run this notebook&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="use-decision-optimization">
<h2>Use decision optimization<a class="headerlink" href="#use-decision-optimization" title="Permalink to this headline">&para;</a></h2>
<div class="section" id="step-1-download-the-library">
<h3>Step 1: Download the library<a class="headerlink" href="#step-1-download-the-library" title="Permalink to this headline">&para;</a></h3>
<p>Run the following code to the install the Decision Optimization CPLEX
Modeling library. The <em>DOcplex</em> library contains the two modeling
packages, Mathematical Programming (<em>docplex.mp</em>) and Constraint
Programming (<em>docplex.cp</em>).</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span>import sys
try:
    import docplex.mp
except:
    if hasattr(sys, &#39;real_prefix&#39;):
        #we are in a virtual env.
        !pip install docplex
    else:
        !pip install --user docplex
</pre></div>
</div>
</div>
<div class="section" id="step-2-set-up-the-prescriptive-engine">
<h3>Step 2: Set up the prescriptive engine<a class="headerlink" href="#step-2-set-up-the-prescriptive-engine" title="Permalink to this headline">&para;</a></h3>
<ul class="simple">
<li>Subscribe to the <a class="reference external" href="https://developer.ibm.com/docloud">Decision Optimization on Cloud solve
service</a>.</li>
<li>Get the service URL and your personal API key and enter your
credentials here:</li>
</ul>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;ENTER YOUR URL HERE&quot;</span>
<span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;ENTER YOUR KEY HERE&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="step-3-model-the-data">
<h3>Step 3: Model the data<a class="headerlink" href="#step-3-model-the-data" title="Permalink to this headline">&para;</a></h3>
<div class="section" id="load-data-from-a-pandas-dataframe">
<h4>Load data from a <em>pandas</em> DataFrame<a class="headerlink" href="#load-data-from-a-pandas-dataframe" title="Permalink to this headline">&para;</a></h4>
<p>Data for the Unit Commitment Problem is provided as a <em>pandas</em>
DataFrame. For a standalone notebook, we provide the raw data as Python
collections, but real data could be loaded from an Excel sheet, also
using <em>pandas</em>.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">pandas</span> <span class="k">import</span> <span class="n">DataFrame</span><span class="p">,</span> <span class="n">Series</span>

<span class="c1"># make matplotlib plots appear inside the notebook</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
<span class="kn">from</span> <span class="nn">pylab</span> <span class="k">import</span> <span class="n">rcParams</span>
<span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.figsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">5</span> <span class="c1">############################ &lt;-Use this to change the plot</span>
</pre></div>
</div>
<p>Update the configuration of notebook so that display matches browser
window width.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">IPython.core.display</span> <span class="k">import</span> <span class="n">HTML</span>
<span class="n">HTML</span><span class="p">(</span><span class="s2">&quot;&lt;style&gt;.container { width:100%; }&lt;/style&gt;&quot;</span><span class="p">)</span>
</pre></div>
</div>
<style>.container { width:100%; }</style></div>
<div class="section" id="available-energy-technologies">
<h4>Available energy technologies<a class="headerlink" href="#available-energy-technologies" title="Permalink to this headline">&para;</a></h4>
<p>The following <em>df_energy</em> DataFrame stores CO2 cost information,
indexed by energy type.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">energies</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;coal&quot;</span><span class="p">,</span> <span class="s2">&quot;gas&quot;</span><span class="p">,</span> <span class="s2">&quot;diesel&quot;</span><span class="p">,</span> <span class="s2">&quot;wind&quot;</span><span class="p">]</span>
<span class="n">df_energy</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;co2_cost&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">30</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">0</span><span class="p">]},</span> <span class="n">index</span><span class="o">=</span><span class="n">energies</span><span class="p">)</span>

<span class="c1"># Display the &#39;df_energy&#39; Data Frame</span>
<span class="n">df_energy</span>
</pre></div>
</div>
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>co2_cost</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>coal</th>
      <td>30</td>
    </tr>
    <tr>
      <th>gas</th>
      <td>5</td>
    </tr>
    <tr>
      <th>diesel</th>
      <td>15</td>
    </tr>
    <tr>
      <th>wind</th>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div><p>The following <em>df_units</em> DataFrame stores common elements for units of
a given technology.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">all_units</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;coal1&quot;</span><span class="p">,</span> <span class="s2">&quot;coal2&quot;</span><span class="p">,</span>
             <span class="s2">&quot;gas1&quot;</span><span class="p">,</span> <span class="s2">&quot;gas2&quot;</span><span class="p">,</span> <span class="s2">&quot;gas3&quot;</span><span class="p">,</span> <span class="s2">&quot;gas4&quot;</span><span class="p">,</span>
             <span class="s2">&quot;diesel1&quot;</span><span class="p">,</span> <span class="s2">&quot;diesel2&quot;</span><span class="p">,</span> <span class="s2">&quot;diesel3&quot;</span><span class="p">,</span> <span class="s2">&quot;diesel4&quot;</span><span class="p">]</span>

<span class="n">ucp_raw_unit_data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;energy&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;coal&quot;</span><span class="p">,</span> <span class="s2">&quot;coal&quot;</span><span class="p">,</span> <span class="s2">&quot;gas&quot;</span><span class="p">,</span> <span class="s2">&quot;gas&quot;</span><span class="p">,</span> <span class="s2">&quot;gas&quot;</span><span class="p">,</span> <span class="s2">&quot;gas&quot;</span><span class="p">,</span> <span class="s2">&quot;diesel&quot;</span><span class="p">,</span> <span class="s2">&quot;diesel&quot;</span><span class="p">,</span> <span class="s2">&quot;diesel&quot;</span><span class="p">,</span> <span class="s2">&quot;diesel&quot;</span><span class="p">],</span>
        <span class="s2">&quot;initial&quot;</span> <span class="p">:</span> <span class="p">[</span><span class="mi">400</span><span class="p">,</span> <span class="mi">350</span><span class="p">,</span> <span class="mi">205</span><span class="p">,</span> <span class="mi">52</span><span class="p">,</span> <span class="mi">155</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">78</span><span class="p">,</span> <span class="mi">76</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="s2">&quot;min_gen&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">140</span><span class="p">,</span> <span class="mi">78</span><span class="p">,</span> <span class="mi">52</span><span class="p">,</span> <span class="mf">54.25</span><span class="p">,</span> <span class="mi">39</span><span class="p">,</span> <span class="mf">17.4</span><span class="p">,</span> <span class="mf">15.2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mf">2.4</span><span class="p">],</span>
        <span class="s2">&quot;max_gen&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">425</span><span class="p">,</span> <span class="mi">365</span><span class="p">,</span> <span class="mi">220</span><span class="p">,</span> <span class="mi">210</span><span class="p">,</span> <span class="mi">165</span><span class="p">,</span> <span class="mi">158</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">87</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">12</span><span class="p">],</span>
        <span class="s2">&quot;operating_max_gen&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">400</span><span class="p">,</span> <span class="mi">350</span><span class="p">,</span> <span class="mi">205</span><span class="p">,</span> <span class="mi">197</span><span class="p">,</span> <span class="mi">155</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">78</span><span class="p">,</span> <span class="mi">76</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">12</span><span class="p">],</span>
        <span class="s2">&quot;min_uptime&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">15</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
        <span class="s2">&quot;min_downtime&quot;</span><span class="p">:[</span><span class="mi">9</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
        <span class="s2">&quot;ramp_up&quot;</span><span class="p">:</span>   <span class="p">[</span><span class="mi">212</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mf">101.2</span><span class="p">,</span> <span class="mf">94.8</span><span class="p">,</span> <span class="mi">58</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">12</span><span class="p">],</span>
        <span class="s2">&quot;ramp_down&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">183</span><span class="p">,</span> <span class="mi">198</span><span class="p">,</span> <span class="mf">95.6</span><span class="p">,</span> <span class="mf">101.7</span><span class="p">,</span> <span class="mf">77.5</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">45</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">12</span><span class="p">],</span>
        <span class="s2">&quot;start_cost&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">5000</span><span class="p">,</span> <span class="mi">4550</span><span class="p">,</span> <span class="mi">1320</span><span class="p">,</span> <span class="mi">1291</span><span class="p">,</span> <span class="mi">1280</span><span class="p">,</span> <span class="mi">1105</span><span class="p">,</span> <span class="mi">560</span><span class="p">,</span> <span class="mi">554</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">250</span><span class="p">],</span>
        <span class="s2">&quot;fixed_cost&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">208.61</span><span class="p">,</span> <span class="mf">117.37</span><span class="p">,</span> <span class="mf">174.12</span><span class="p">,</span> <span class="mf">172.75</span><span class="p">,</span> <span class="mf">95.353</span><span class="p">,</span> <span class="mf">144.52</span><span class="p">,</span> <span class="mf">54.417</span><span class="p">,</span> <span class="mf">54.551</span><span class="p">,</span> <span class="mf">79.638</span><span class="p">,</span> <span class="mf">16.259</span><span class="p">],</span>
        <span class="s2">&quot;variable_cost&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">22.536</span><span class="p">,</span> <span class="mf">31.985</span><span class="p">,</span> <span class="mf">70.5</span><span class="p">,</span> <span class="mi">69</span><span class="p">,</span> <span class="mf">32.146</span><span class="p">,</span> <span class="mf">54.84</span><span class="p">,</span> <span class="mf">40.222</span><span class="p">,</span> <span class="mf">40.522</span><span class="p">,</span> <span class="mf">116.33</span><span class="p">,</span> <span class="mf">76.642</span><span class="p">],</span>
        <span class="p">}</span>

<span class="n">df_units</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">ucp_raw_unit_data</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">all_units</span><span class="p">)</span>

<span class="c1"># Display the &#39;df_units&#39; Data Frame</span>
<span class="n">df_units</span>
</pre></div>
</div>
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>energy</th>
      <th>fixed_cost</th>
      <th>initial</th>
      <th>max_gen</th>
      <th>min_downtime</th>
      <th>min_gen</th>
      <th>min_uptime</th>
      <th>operating_max_gen</th>
      <th>ramp_down</th>
      <th>ramp_up</th>
      <th>start_cost</th>
      <th>variable_cost</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>coal1</th>
      <td>coal</td>
      <td>208.610</td>
      <td>400</td>
      <td>425</td>
      <td>9</td>
      <td>100.00</td>
      <td>15</td>
      <td>400</td>
      <td>183.0</td>
      <td>212.0</td>
      <td>5000</td>
      <td>22.536</td>
    </tr>
    <tr>
      <th>coal2</th>
      <td>coal</td>
      <td>117.370</td>
      <td>350</td>
      <td>365</td>
      <td>8</td>
      <td>140.00</td>
      <td>15</td>
      <td>350</td>
      <td>198.0</td>
      <td>150.0</td>
      <td>4550</td>
      <td>31.985</td>
    </tr>
    <tr>
      <th>gas1</th>
      <td>gas</td>
      <td>174.120</td>
      <td>205</td>
      <td>220</td>
      <td>7</td>
      <td>78.00</td>
      <td>6</td>
      <td>205</td>
      <td>95.6</td>
      <td>101.2</td>
      <td>1320</td>
      <td>70.500</td>
    </tr>
    <tr>
      <th>gas2</th>
      <td>gas</td>
      <td>172.750</td>
      <td>52</td>
      <td>210</td>
      <td>4</td>
      <td>52.00</td>
      <td>5</td>
      <td>197</td>
      <td>101.7</td>
      <td>94.8</td>
      <td>1291</td>
      <td>69.000</td>
    </tr>
    <tr>
      <th>gas3</th>
      <td>gas</td>
      <td>95.353</td>
      <td>155</td>
      <td>165</td>
      <td>3</td>
      <td>54.25</td>
      <td>5</td>
      <td>155</td>
      <td>77.5</td>
      <td>58.0</td>
      <td>1280</td>
      <td>32.146</td>
    </tr>
    <tr>
      <th>gas4</th>
      <td>gas</td>
      <td>144.520</td>
      <td>150</td>
      <td>158</td>
      <td>2</td>
      <td>39.00</td>
      <td>4</td>
      <td>150</td>
      <td>60.0</td>
      <td>50.0</td>
      <td>1105</td>
      <td>54.840</td>
    </tr>
    <tr>
      <th>diesel1</th>
      <td>diesel</td>
      <td>54.417</td>
      <td>78</td>
      <td>90</td>
      <td>2</td>
      <td>17.40</td>
      <td>3</td>
      <td>78</td>
      <td>24.0</td>
      <td>40.0</td>
      <td>560</td>
      <td>40.222</td>
    </tr>
    <tr>
      <th>diesel2</th>
      <td>diesel</td>
      <td>54.551</td>
      <td>76</td>
      <td>87</td>
      <td>2</td>
      <td>15.20</td>
      <td>3</td>
      <td>76</td>
      <td>45.0</td>
      <td>60.0</td>
      <td>554</td>
      <td>40.522</td>
    </tr>
    <tr>
      <th>diesel3</th>
      <td>diesel</td>
      <td>79.638</td>
      <td>0</td>
      <td>20</td>
      <td>1</td>
      <td>4.00</td>
      <td>1</td>
      <td>20</td>
      <td>20.0</td>
      <td>20.0</td>
      <td>300</td>
      <td>116.330</td>
    </tr>
    <tr>
      <th>diesel4</th>
      <td>diesel</td>
      <td>16.259</td>
      <td>0</td>
      <td>12</td>
      <td>1</td>
      <td>2.40</td>
      <td>1</td>
      <td>12</td>
      <td>12.0</td>
      <td>12.0</td>
      <td>250</td>
      <td>76.642</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="section" id="step-4-prepare-the-data">
<h3>Step 4: Prepare the data<a class="headerlink" href="#step-4-prepare-the-data" title="Permalink to this headline">&para;</a></h3>
<p>The <em>pandas</em> <em>merge</em> operation is used to create a join between the
<em>df_units</em> and <em>df_energy</em> DataFrames. Here, the join is performed
based on the <em>&#8216;energy&#8217;</em> column of <em>df_units</em> and index column of
<em>df_energy</em>.</p>
<p>By default, <em>merge</em> performs an <em>inner</em> join. That is, the resulting
DataFrame is based on the <strong>intersection</strong> of keys from both input
DataFrames.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="c1"># Add a derived co2-cost column by merging with df_energies</span>
<span class="c1"># Use energy key from units and index from energy dataframe</span>
<span class="n">df_up</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df_units</span><span class="p">,</span> <span class="n">df_energy</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="s2">&quot;energy&quot;</span><span class="p">,</span> <span class="n">right_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">df_up</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span>

<span class="c1"># Display first rows of new &#39;df_up&#39; Data Frame</span>
<span class="n">df_up</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>energy</th>
      <th>fixed_cost</th>
      <th>initial</th>
      <th>max_gen</th>
      <th>min_downtime</th>
      <th>min_gen</th>
      <th>min_uptime</th>
      <th>operating_max_gen</th>
      <th>ramp_down</th>
      <th>ramp_up</th>
      <th>start_cost</th>
      <th>variable_cost</th>
      <th>co2_cost</th>
    </tr>
    <tr>
      <th>units</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>coal1</th>
      <td>coal</td>
      <td>208.610</td>
      <td>400</td>
      <td>425</td>
      <td>9</td>
      <td>100.00</td>
      <td>15</td>
      <td>400</td>
      <td>183.0</td>
      <td>212.0</td>
      <td>5000</td>
      <td>22.536</td>
      <td>30</td>
    </tr>
    <tr>
      <th>coal2</th>
      <td>coal</td>
      <td>117.370</td>
      <td>350</td>
      <td>365</td>
      <td>8</td>
      <td>140.00</td>
      <td>15</td>
      <td>350</td>
      <td>198.0</td>
      <td>150.0</td>
      <td>4550</td>
      <td>31.985</td>
      <td>30</td>
    </tr>
    <tr>
      <th>gas1</th>
      <td>gas</td>
      <td>174.120</td>
      <td>205</td>
      <td>220</td>
      <td>7</td>
      <td>78.00</td>
      <td>6</td>
      <td>205</td>
      <td>95.6</td>
      <td>101.2</td>
      <td>1320</td>
      <td>70.500</td>
      <td>5</td>
    </tr>
    <tr>
      <th>gas2</th>
      <td>gas</td>
      <td>172.750</td>
      <td>52</td>
      <td>210</td>
      <td>4</td>
      <td>52.00</td>
      <td>5</td>
      <td>197</td>
      <td>101.7</td>
      <td>94.8</td>
      <td>1291</td>
      <td>69.000</td>
      <td>5</td>
    </tr>
    <tr>
      <th>gas3</th>
      <td>gas</td>
      <td>95.353</td>
      <td>155</td>
      <td>165</td>
      <td>3</td>
      <td>54.25</td>
      <td>5</td>
      <td>155</td>
      <td>77.5</td>
      <td>58.0</td>
      <td>1280</td>
      <td>32.146</td>
      <td>5</td>
    </tr>
  </tbody>
</table>
</div><p>The demand is stored as a <em>pandas</em> <em>Series</em> indexed from 1 to the number
of periods.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">raw_demand</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1259.0</span><span class="p">,</span> <span class="mf">1439.0</span><span class="p">,</span> <span class="mf">1289.0</span><span class="p">,</span> <span class="mf">1211.0</span><span class="p">,</span> <span class="mf">1433.0</span><span class="p">,</span> <span class="mf">1287.0</span><span class="p">,</span> <span class="mf">1285.0</span><span class="p">,</span> <span class="mf">1227.0</span><span class="p">,</span> <span class="mf">1269.0</span><span class="p">,</span> <span class="mf">1158.0</span><span class="p">,</span> <span class="mf">1277.0</span><span class="p">,</span> <span class="mf">1417.0</span><span class="p">,</span> <span class="mf">1294.0</span><span class="p">,</span> <span class="mf">1396.0</span><span class="p">,</span> <span class="mf">1414.0</span><span class="p">,</span> <span class="mf">1386.0</span><span class="p">,</span>
              <span class="mf">1302.0</span><span class="p">,</span> <span class="mf">1215.0</span><span class="p">,</span> <span class="mf">1433.0</span><span class="p">,</span> <span class="mf">1354.0</span><span class="p">,</span> <span class="mf">1436.0</span><span class="p">,</span> <span class="mf">1285.0</span><span class="p">,</span> <span class="mf">1332.0</span><span class="p">,</span> <span class="mf">1172.0</span><span class="p">,</span> <span class="mf">1446.0</span><span class="p">,</span> <span class="mf">1367.0</span><span class="p">,</span> <span class="mf">1243.0</span><span class="p">,</span> <span class="mf">1275.0</span><span class="p">,</span> <span class="mf">1363.0</span><span class="p">,</span> <span class="mf">1208.0</span><span class="p">,</span> <span class="mf">1394.0</span><span class="p">,</span> <span class="mf">1345.0</span><span class="p">,</span>
              <span class="mf">1217.0</span><span class="p">,</span> <span class="mf">1432.0</span><span class="p">,</span> <span class="mf">1431.0</span><span class="p">,</span> <span class="mf">1356.0</span><span class="p">,</span> <span class="mf">1360.0</span><span class="p">,</span> <span class="mf">1364.0</span><span class="p">,</span> <span class="mf">1286.0</span><span class="p">,</span> <span class="mf">1440.0</span><span class="p">,</span> <span class="mf">1440.0</span><span class="p">,</span> <span class="mf">1313.0</span><span class="p">,</span> <span class="mf">1389.0</span><span class="p">,</span> <span class="mf">1385.0</span><span class="p">,</span> <span class="mf">1265.0</span><span class="p">,</span> <span class="mf">1442.0</span><span class="p">,</span> <span class="mf">1435.0</span><span class="p">,</span> <span class="mf">1432.0</span><span class="p">,</span>
              <span class="mf">1280.0</span><span class="p">,</span> <span class="mf">1411.0</span><span class="p">,</span> <span class="mf">1440.0</span><span class="p">,</span> <span class="mf">1258.0</span><span class="p">,</span> <span class="mf">1333.0</span><span class="p">,</span> <span class="mf">1293.0</span><span class="p">,</span> <span class="mf">1193.0</span><span class="p">,</span> <span class="mf">1440.0</span><span class="p">,</span> <span class="mf">1306.0</span><span class="p">,</span> <span class="mf">1264.0</span><span class="p">,</span> <span class="mf">1244.0</span><span class="p">,</span> <span class="mf">1368.0</span><span class="p">,</span> <span class="mf">1437.0</span><span class="p">,</span> <span class="mf">1236.0</span><span class="p">,</span> <span class="mf">1354.0</span><span class="p">,</span> <span class="mf">1356.0</span><span class="p">,</span>
              <span class="mf">1383.0</span><span class="p">,</span> <span class="mf">1350.0</span><span class="p">,</span> <span class="mf">1354.0</span><span class="p">,</span> <span class="mf">1329.0</span><span class="p">,</span> <span class="mf">1427.0</span><span class="p">,</span> <span class="mf">1163.0</span><span class="p">,</span> <span class="mf">1339.0</span><span class="p">,</span> <span class="mf">1351.0</span><span class="p">,</span> <span class="mf">1174.0</span><span class="p">,</span> <span class="mf">1235.0</span><span class="p">,</span> <span class="mf">1439.0</span><span class="p">,</span> <span class="mf">1235.0</span><span class="p">,</span> <span class="mf">1245.0</span><span class="p">,</span> <span class="mf">1262.0</span><span class="p">,</span> <span class="mf">1362.0</span><span class="p">,</span> <span class="mf">1184.0</span><span class="p">,</span>
              <span class="mf">1207.0</span><span class="p">,</span> <span class="mf">1359.0</span><span class="p">,</span> <span class="mf">1443.0</span><span class="p">,</span> <span class="mf">1205.0</span><span class="p">,</span> <span class="mf">1192.0</span><span class="p">,</span> <span class="mf">1364.0</span><span class="p">,</span> <span class="mf">1233.0</span><span class="p">,</span> <span class="mf">1281.0</span><span class="p">,</span> <span class="mf">1295.0</span><span class="p">,</span> <span class="mf">1357.0</span><span class="p">,</span> <span class="mf">1191.0</span><span class="p">,</span> <span class="mf">1329.0</span><span class="p">,</span> <span class="mf">1294.0</span><span class="p">,</span> <span class="mf">1334.0</span><span class="p">,</span> <span class="mf">1265.0</span><span class="p">,</span> <span class="mf">1207.0</span><span class="p">,</span>
              <span class="mf">1365.0</span><span class="p">,</span> <span class="mf">1432.0</span><span class="p">,</span> <span class="mf">1199.0</span><span class="p">,</span> <span class="mf">1191.0</span><span class="p">,</span> <span class="mf">1411.0</span><span class="p">,</span> <span class="mf">1294.0</span><span class="p">,</span> <span class="mf">1244.0</span><span class="p">,</span> <span class="mf">1256.0</span><span class="p">,</span> <span class="mf">1257.0</span><span class="p">,</span> <span class="mf">1224.0</span><span class="p">,</span> <span class="mf">1277.0</span><span class="p">,</span> <span class="mf">1246.0</span><span class="p">,</span> <span class="mf">1243.0</span><span class="p">,</span> <span class="mf">1194.0</span><span class="p">,</span> <span class="mf">1389.0</span><span class="p">,</span> <span class="mf">1366.0</span><span class="p">,</span>
              <span class="mf">1282.0</span><span class="p">,</span> <span class="mf">1221.0</span><span class="p">,</span> <span class="mf">1255.0</span><span class="p">,</span> <span class="mf">1417.0</span><span class="p">,</span> <span class="mf">1358.0</span><span class="p">,</span> <span class="mf">1264.0</span><span class="p">,</span> <span class="mf">1205.0</span><span class="p">,</span> <span class="mf">1254.0</span><span class="p">,</span> <span class="mf">1276.0</span><span class="p">,</span> <span class="mf">1435.0</span><span class="p">,</span> <span class="mf">1335.0</span><span class="p">,</span> <span class="mf">1355.0</span><span class="p">,</span> <span class="mf">1337.0</span><span class="p">,</span> <span class="mf">1197.0</span><span class="p">,</span> <span class="mf">1423.0</span><span class="p">,</span> <span class="mf">1194.0</span><span class="p">,</span>
              <span class="mf">1310.0</span><span class="p">,</span> <span class="mf">1255.0</span><span class="p">,</span> <span class="mf">1300.0</span><span class="p">,</span> <span class="mf">1388.0</span><span class="p">,</span> <span class="mf">1385.0</span><span class="p">,</span> <span class="mf">1255.0</span><span class="p">,</span> <span class="mf">1434.0</span><span class="p">,</span> <span class="mf">1232.0</span><span class="p">,</span> <span class="mf">1402.0</span><span class="p">,</span> <span class="mf">1435.0</span><span class="p">,</span> <span class="mf">1160.0</span><span class="p">,</span> <span class="mf">1193.0</span><span class="p">,</span> <span class="mf">1422.0</span><span class="p">,</span> <span class="mf">1235.0</span><span class="p">,</span> <span class="mf">1219.0</span><span class="p">,</span> <span class="mf">1410.0</span><span class="p">,</span>
              <span class="mf">1363.0</span><span class="p">,</span> <span class="mf">1361.0</span><span class="p">,</span> <span class="mf">1437.0</span><span class="p">,</span> <span class="mf">1407.0</span><span class="p">,</span> <span class="mf">1164.0</span><span class="p">,</span> <span class="mf">1392.0</span><span class="p">,</span> <span class="mf">1408.0</span><span class="p">,</span> <span class="mf">1196.0</span><span class="p">,</span> <span class="mf">1430.0</span><span class="p">,</span> <span class="mf">1264.0</span><span class="p">,</span> <span class="mf">1289.0</span><span class="p">,</span> <span class="mf">1434.0</span><span class="p">,</span> <span class="mf">1216.0</span><span class="p">,</span> <span class="mf">1340.0</span><span class="p">,</span> <span class="mf">1327.0</span><span class="p">,</span> <span class="mf">1230.0</span><span class="p">,</span>
              <span class="mf">1362.0</span><span class="p">,</span> <span class="mf">1360.0</span><span class="p">,</span> <span class="mf">1448.0</span><span class="p">,</span> <span class="mf">1220.0</span><span class="p">,</span> <span class="mf">1435.0</span><span class="p">,</span> <span class="mf">1425.0</span><span class="p">,</span> <span class="mf">1413.0</span><span class="p">,</span> <span class="mf">1279.0</span><span class="p">,</span> <span class="mf">1269.0</span><span class="p">,</span> <span class="mf">1162.0</span><span class="p">,</span> <span class="mf">1437.0</span><span class="p">,</span> <span class="mf">1441.0</span><span class="p">,</span> <span class="mf">1433.0</span><span class="p">,</span> <span class="mf">1307.0</span><span class="p">,</span> <span class="mf">1436.0</span><span class="p">,</span> <span class="mf">1357.0</span><span class="p">,</span>
              <span class="mf">1437.0</span><span class="p">,</span> <span class="mf">1308.0</span><span class="p">,</span> <span class="mf">1207.0</span><span class="p">,</span> <span class="mf">1420.0</span><span class="p">,</span> <span class="mf">1338.0</span><span class="p">,</span> <span class="mf">1311.0</span><span class="p">,</span> <span class="mf">1328.0</span><span class="p">,</span> <span class="mf">1417.0</span><span class="p">,</span> <span class="mf">1394.0</span><span class="p">,</span> <span class="mf">1336.0</span><span class="p">,</span> <span class="mf">1160.0</span><span class="p">,</span> <span class="mf">1231.0</span><span class="p">,</span> <span class="mf">1422.0</span><span class="p">,</span> <span class="mf">1294.0</span><span class="p">,</span> <span class="mf">1434.0</span><span class="p">,</span> <span class="mf">1289.0</span><span class="p">]</span>
<span class="n">nb_periods</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">raw_demand</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;nb periods = </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nb_periods</span><span class="p">))</span>

<span class="n">demand</span> <span class="o">=</span> <span class="n">Series</span><span class="p">(</span><span class="n">raw_demand</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">nb_periods</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>

<span class="c1"># plot demand</span>
<span class="n">demand</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Demand&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">nb</span> <span class="n">periods</span> <span class="o">=</span> <span class="mi">192</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">_subplots</span><span class="o">.</span><span class="n">AxesSubplot</span> <span class="n">at</span> <span class="mh">0x9faff28</span><span class="o">&gt;</span>
</pre></div>
</div>
<img alt="_images/ucp_pandas_23_2.png" src="_images/ucp_pandas_23_2.png" />
</div>
<div class="section" id="step-5-set-up-the-prescriptive-model">
<h3>Step 5: Set up the prescriptive model<a class="headerlink" href="#step-5-set-up-the-prescriptive-model" title="Permalink to this headline">&para;</a></h3>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">docplex.mp.environment</span> <span class="k">import</span> <span class="n">Environment</span>
<span class="n">env</span> <span class="o">=</span> <span class="n">Environment</span><span class="p">()</span>
<span class="n">env</span><span class="o">.</span><span class="n">print_information</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">*</span> <span class="n">system</span> <span class="ow">is</span><span class="p">:</span> <span class="n">Windows</span> <span class="mi">64</span><span class="n">bit</span>
<span class="o">*</span> <span class="n">Python</span> <span class="ow">is</span> <span class="n">present</span><span class="p">,</span> <span class="n">version</span> <span class="ow">is</span> <span class="mf">2.7</span><span class="o">.</span><span class="mi">11</span>
<span class="o">*</span> <span class="n">docplex</span> <span class="ow">is</span> <span class="n">present</span><span class="p">,</span> <span class="n">version</span> <span class="ow">is</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="create-the-docplex-model">
<h4>Create the DOcplex model<a class="headerlink" href="#create-the-docplex-model" title="Permalink to this headline">&para;</a></h4>
<p>The model contains all the business constraints and defines the
objective.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">docplex.mp.model</span> <span class="k">import</span> <span class="n">Model</span>

<span class="n">ucpm</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="s2">&quot;ucp&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="define-the-decision-variables">
<h4>Define the decision variables<a class="headerlink" href="#define-the-decision-variables" title="Permalink to this headline">&para;</a></h4>
<p>Decision variables are:</p>
<ul class="simple">
<li>The variable <em>in_use[u,t]</em> is 1 if and only if unit <em>u</em> is working
at period <em>t</em>.</li>
<li>The variable <em>turn_on[u,t]</em> is 1 if and only if unit <em>u</em> is in
production at period <em>t</em>.</li>
<li>The variable <em>turn_off[u,t]</em> is 1 if unit <em>u</em> is switched off at
period <em>t</em>.</li>
<li>The variable <em>production[u,t]</em> is a continuous variables representing
the production of energy for unit <em>u</em> at period <em>t</em>.</li>
</ul>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">units</span> <span class="o">=</span> <span class="n">all_units</span>
<span class="c1"># periods range from 1 to nb_periods included</span>
<span class="n">periods</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">nb_periods</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># in use[u,t] is true iff unit u is in production at period t</span>
<span class="n">in_use</span> <span class="o">=</span> <span class="n">ucpm</span><span class="o">.</span><span class="n">binary_var_matrix</span><span class="p">(</span><span class="n">keys1</span><span class="o">=</span><span class="n">units</span><span class="p">,</span> <span class="n">keys2</span><span class="o">=</span><span class="n">periods</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;in_use&quot;</span><span class="p">)</span>

<span class="c1"># true if unit u is turned on at period t</span>
<span class="n">turn_on</span> <span class="o">=</span> <span class="n">ucpm</span><span class="o">.</span><span class="n">binary_var_matrix</span><span class="p">(</span><span class="n">keys1</span><span class="o">=</span><span class="n">units</span><span class="p">,</span> <span class="n">keys2</span><span class="o">=</span><span class="n">periods</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;turn_on&quot;</span><span class="p">)</span>

<span class="c1"># true if unit u is switched off at period t</span>
<span class="c1"># modeled as a continuous 0-1 variable, more on this later</span>
<span class="n">turn_off</span> <span class="o">=</span> <span class="n">ucpm</span><span class="o">.</span><span class="n">continuous_var_matrix</span><span class="p">(</span><span class="n">keys1</span><span class="o">=</span><span class="n">units</span><span class="p">,</span> <span class="n">keys2</span><span class="o">=</span><span class="n">periods</span><span class="p">,</span> <span class="n">lb</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ub</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;turn_off&quot;</span><span class="p">)</span>

<span class="c1"># production of energy for unit u at period t</span>
<span class="n">production</span> <span class="o">=</span> <span class="n">ucpm</span><span class="o">.</span><span class="n">continuous_var_matrix</span><span class="p">(</span><span class="n">keys1</span><span class="o">=</span><span class="n">units</span><span class="p">,</span> <span class="n">keys2</span><span class="o">=</span><span class="n">periods</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;p&quot;</span><span class="p">)</span>

<span class="c1"># at this stage we have defined the decision variables.</span>
<span class="n">ucpm</span><span class="o">.</span><span class="n">print_information</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Model</span><span class="p">:</span> <span class="n">ucp</span>
 <span class="o">-</span> <span class="n">number</span> <span class="n">of</span> <span class="n">variables</span><span class="p">:</span> <span class="mi">7680</span>
   <span class="o">-</span> <span class="n">binary</span><span class="o">=</span><span class="mi">3840</span><span class="p">,</span> <span class="n">integer</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">continuous</span><span class="o">=</span><span class="mi">3840</span>
 <span class="o">-</span> <span class="n">number</span> <span class="n">of</span> <span class="n">constraints</span><span class="p">:</span> <span class="mi">0</span>
 <span class="o">-</span>   <span class="n">LE</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">EQ</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">GE</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">RNG</span><span class="o">=</span><span class="mi">0</span>
 <span class="o">-</span> <span class="n">parameters</span><span class="p">:</span> <span class="n">defaults</span>
</pre></div>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="c1"># Organize all decision variables in a DataFrame indexed by &#39;units&#39; and &#39;periods&#39;</span>
<span class="n">df_decision_vars</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;in_use&#39;</span><span class="p">:</span> <span class="n">in_use</span><span class="p">,</span> <span class="s1">&#39;turn_on&#39;</span><span class="p">:</span> <span class="n">turn_on</span><span class="p">,</span> <span class="s1">&#39;turn_off&#39;</span><span class="p">:</span> <span class="n">turn_off</span><span class="p">,</span> <span class="s1">&#39;production&#39;</span><span class="p">:</span> <span class="n">production</span><span class="p">})</span>
<span class="c1"># Set index names</span>
<span class="n">df_decision_vars</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">,</span> <span class="s1">&#39;periods&#39;</span><span class="p">]</span>

<span class="c1"># Display first few rows of &#39;df_decision_vars&#39; DataFrame</span>
<span class="n">df_decision_vars</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>in_use</th>
      <th>production</th>
      <th>turn_off</th>
      <th>turn_on</th>
    </tr>
    <tr>
      <th>units</th>
      <th>periods</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="5" valign="top">coal1</th>
      <th>1</th>
      <td>in_use_coal1_1</td>
      <td>p_coal1_1</td>
      <td>turn_off_coal1_1</td>
      <td>turn_on_coal1_1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>in_use_coal1_2</td>
      <td>p_coal1_2</td>
      <td>turn_off_coal1_2</td>
      <td>turn_on_coal1_2</td>
    </tr>
    <tr>
      <th>3</th>
      <td>in_use_coal1_3</td>
      <td>p_coal1_3</td>
      <td>turn_off_coal1_3</td>
      <td>turn_on_coal1_3</td>
    </tr>
    <tr>
      <th>4</th>
      <td>in_use_coal1_4</td>
      <td>p_coal1_4</td>
      <td>turn_off_coal1_4</td>
      <td>turn_on_coal1_4</td>
    </tr>
    <tr>
      <th>5</th>
      <td>in_use_coal1_5</td>
      <td>p_coal1_5</td>
      <td>turn_off_coal1_5</td>
      <td>turn_on_coal1_5</td>
    </tr>
  </tbody>
</table>
</div></div>
<div class="section" id="express-the-business-constraints">
<h4>Express the business constraints<a class="headerlink" href="#express-the-business-constraints" title="Permalink to this headline">&para;</a></h4>
<div class="section" id="linking-in-use-status-to-production">
<h5>Linking in-use status to production<a class="headerlink" href="#linking-in-use-status-to-production" title="Permalink to this headline">&para;</a></h5>
<p>Whenever the unit is in use, the production must be within the minimum
and maximum generation.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="c1"># Create a join between &#39;df_decision_vars&#39; and &#39;df_up&#39; Data Frames based on common index id (ie: &#39;units&#39;)</span>
<span class="c1"># In &#39;df_up&#39;, one keeps only relevant columns: &#39;min_gen&#39; and &#39;max_gen&#39;</span>
<span class="n">df_join_decision_vars_up</span> <span class="o">=</span> <span class="n">df_decision_vars</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">df_up</span><span class="p">[[</span><span class="s1">&#39;min_gen&#39;</span><span class="p">,</span> <span class="s1">&#39;max_gen&#39;</span><span class="p">]],</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;inner&#39;</span><span class="p">)</span>

<span class="c1"># Display first few rows of joined Data Frames</span>
<span class="n">df_join_decision_vars_up</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>in_use</th>
      <th>production</th>
      <th>turn_off</th>
      <th>turn_on</th>
      <th>min_gen</th>
      <th>max_gen</th>
    </tr>
    <tr>
      <th>units</th>
      <th>periods</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="5" valign="top">coal1</th>
      <th>1</th>
      <td>in_use_coal1_1</td>
      <td>p_coal1_1</td>
      <td>turn_off_coal1_1</td>
      <td>turn_on_coal1_1</td>
      <td>100.0</td>
      <td>425</td>
    </tr>
    <tr>
      <th>2</th>
      <td>in_use_coal1_2</td>
      <td>p_coal1_2</td>
      <td>turn_off_coal1_2</td>
      <td>turn_on_coal1_2</td>
      <td>100.0</td>
      <td>425</td>
    </tr>
    <tr>
      <th>3</th>
      <td>in_use_coal1_3</td>
      <td>p_coal1_3</td>
      <td>turn_off_coal1_3</td>
      <td>turn_on_coal1_3</td>
      <td>100.0</td>
      <td>425</td>
    </tr>
    <tr>
      <th>4</th>
      <td>in_use_coal1_4</td>
      <td>p_coal1_4</td>
      <td>turn_off_coal1_4</td>
      <td>turn_on_coal1_4</td>
      <td>100.0</td>
      <td>425</td>
    </tr>
    <tr>
      <th>5</th>
      <td>in_use_coal1_5</td>
      <td>p_coal1_5</td>
      <td>turn_off_coal1_5</td>
      <td>turn_on_coal1_5</td>
      <td>100.0</td>
      <td>425</td>
    </tr>
  </tbody>
</table>
</div><div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pb</span>
<span class="nb">print</span> <span class="n">pd</span><span class="o">.</span><span class="n">__version__</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="mf">0.18</span><span class="o">.</span><span class="mi">0</span>
</pre></div>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="c1"># When in use, the production level is constrained to be between min and max generation.</span>
<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">df_join_decision_vars_up</span><span class="o">.</span><span class="n">itertuples</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="n">ucpm</span> <span class="o">+=</span> <span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">production</span> <span class="o">&lt;=</span> <span class="n">item</span><span class="o">.</span><span class="n">max_gen</span> <span class="o">*</span> <span class="n">item</span><span class="o">.</span><span class="n">in_use</span><span class="p">)</span>
    <span class="n">ucpm</span> <span class="o">+=</span> <span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">production</span> <span class="o">&gt;=</span> <span class="n">item</span><span class="o">.</span><span class="n">min_gen</span> <span class="o">*</span> <span class="n">item</span><span class="o">.</span><span class="n">in_use</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="initial-state">
<h5>Initial state<a class="headerlink" href="#initial-state" title="Permalink to this headline">&para;</a></h5>
<p>The solution must take into account the initial state. The initial state
of use of the unit is determined by its initial production level.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="c1"># Initial state</span>
<span class="c1"># If initial production is nonzero, then period #1 is not a turn_on</span>
<span class="c1"># else turn_on equals in_use</span>
<span class="c1"># Dual logic is implemented for turn_off</span>
<span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">units</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">df_up</span><span class="o">.</span><span class="n">initial</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1"># if u is already running, not starting up</span>
        <span class="n">ucpm</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span><span class="n">turn_on</span><span class="p">[</span><span class="n">u</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
        <span class="c1"># turnoff iff not in use</span>
        <span class="n">ucpm</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span><span class="n">turn_off</span><span class="p">[</span><span class="n">u</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">in_use</span><span class="p">[</span><span class="n">u</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># turn on at 1 iff in use at 1</span>
        <span class="n">ucpm</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span><span class="n">turn_on</span><span class="p">[</span><span class="n">u</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">in_use</span><span class="p">[</span><span class="n">u</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="c1"># already off, not switched off at t==1</span>
        <span class="n">ucpm</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span><span class="n">turn_off</span><span class="p">[</span><span class="n">u</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">ucpm</span><span class="o">.</span><span class="n">print_information</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Model</span><span class="p">:</span> <span class="n">ucp</span>
 <span class="o">-</span> <span class="n">number</span> <span class="n">of</span> <span class="n">variables</span><span class="p">:</span> <span class="mi">7680</span>
   <span class="o">-</span> <span class="n">binary</span><span class="o">=</span><span class="mi">3840</span><span class="p">,</span> <span class="n">integer</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">continuous</span><span class="o">=</span><span class="mi">3840</span>
 <span class="o">-</span> <span class="n">number</span> <span class="n">of</span> <span class="n">constraints</span><span class="p">:</span> <span class="mi">3860</span>
 <span class="o">-</span>   <span class="n">LE</span><span class="o">=</span><span class="mi">1920</span><span class="p">,</span> <span class="n">EQ</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">GE</span><span class="o">=</span><span class="mi">1920</span><span class="p">,</span> <span class="n">RNG</span><span class="o">=</span><span class="mi">0</span>
 <span class="o">-</span> <span class="n">parameters</span><span class="p">:</span> <span class="n">defaults</span>
</pre></div>
</div>
</div>
<div class="section" id="ramp-up-ramp-down-constraint">
<h5>Ramp-up / ramp-down constraint<a class="headerlink" href="#ramp-up-ramp-down-constraint" title="Permalink to this headline">&para;</a></h5>
<p>Variations of the production level over time in a unit is constrained by
a ramp-up / ramp-down process.</p>
<p>We use the <em>pandas</em> <em>groupby</em> operation to collect all decision
variables for each unit in separate series. Then, we iterate over units
to post constraints enforcing the ramp-up / ramp-down process by setting
upper bounds on the variation of the production level for consecutive
periods.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="c1"># Use groupby operation to process each unit</span>
<span class="k">for</span> <span class="n">unit</span><span class="p">,</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">df_decision_vars</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="s1">&#39;units&#39;</span><span class="p">):</span>
    <span class="n">u_ramp_up</span> <span class="o">=</span> <span class="n">df_up</span><span class="o">.</span><span class="n">ramp_up</span><span class="p">[</span><span class="n">unit</span><span class="p">]</span>
    <span class="n">u_ramp_down</span> <span class="o">=</span> <span class="n">df_up</span><span class="o">.</span><span class="n">ramp_down</span><span class="p">[</span><span class="n">unit</span><span class="p">]</span>
    <span class="n">u_initial</span> <span class="o">=</span> <span class="n">df_up</span><span class="o">.</span><span class="n">initial</span><span class="p">[</span><span class="n">unit</span><span class="p">]</span>
    <span class="c1"># Initial ramp up/down</span>
    <span class="c1"># Note that r.production is a Series that can be indexed as an array (ie: first item index = 0)</span>
    <span class="n">ucpm</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">production</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">u_initial</span> <span class="o">&lt;=</span> <span class="n">u_ramp_up</span><span class="p">)</span>
    <span class="n">ucpm</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span><span class="n">u_initial</span> <span class="o">-</span> <span class="n">r</span><span class="o">.</span><span class="n">production</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">u_ramp_down</span><span class="p">)</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">p_curr</span><span class="p">,</span> <span class="n">p_next</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">production</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">production</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span>
        <span class="n">ucpm</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span><span class="n">p_next</span> <span class="o">-</span> <span class="n">p_curr</span> <span class="o">&lt;=</span> <span class="n">u_ramp_up</span><span class="p">)</span>
        <span class="n">ucpm</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span><span class="n">p_curr</span> <span class="o">-</span> <span class="n">p_next</span> <span class="o">&lt;=</span> <span class="n">u_ramp_down</span><span class="p">)</span>

<span class="n">ucpm</span><span class="o">.</span><span class="n">print_information</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Model</span><span class="p">:</span> <span class="n">ucp</span>
 <span class="o">-</span> <span class="n">number</span> <span class="n">of</span> <span class="n">variables</span><span class="p">:</span> <span class="mi">7680</span>
   <span class="o">-</span> <span class="n">binary</span><span class="o">=</span><span class="mi">3840</span><span class="p">,</span> <span class="n">integer</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">continuous</span><span class="o">=</span><span class="mi">3840</span>
 <span class="o">-</span> <span class="n">number</span> <span class="n">of</span> <span class="n">constraints</span><span class="p">:</span> <span class="mi">7700</span>
 <span class="o">-</span>   <span class="n">LE</span><span class="o">=</span><span class="mi">5760</span><span class="p">,</span> <span class="n">EQ</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">GE</span><span class="o">=</span><span class="mi">1920</span><span class="p">,</span> <span class="n">RNG</span><span class="o">=</span><span class="mi">0</span>
 <span class="o">-</span> <span class="n">parameters</span><span class="p">:</span> <span class="n">defaults</span>
</pre></div>
</div>
</div>
<div class="section" id="turn-on-turn-off">
<h5>Turn on / turn off<a class="headerlink" href="#turn-on-turn-off" title="Permalink to this headline">&para;</a></h5>
<p>The following constraints determine when a unit is turned on or off.</p>
<p>We use the same <em>pandas</em> <em>groupby</em> operation as in the previous
constraint to iterate over the sequence of decision variables for each
unit.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="c1"># Turn_on, turn_off</span>
<span class="c1"># Use groupby operation to process each unit</span>
<span class="k">for</span> <span class="n">unit</span><span class="p">,</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">df_decision_vars</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="s1">&#39;units&#39;</span><span class="p">):</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">in_use_curr</span><span class="p">,</span> <span class="n">in_use_next</span><span class="p">,</span> <span class="n">turn_on_next</span><span class="p">,</span> <span class="n">turn_off_next</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">in_use</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">in_use</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">r</span><span class="o">.</span><span class="n">turn_on</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">r</span><span class="o">.</span><span class="n">turn_off</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span>
        <span class="c1"># if unit is off at time t and on at time t+1, then it was turned on at time t+1</span>
        <span class="n">ucpm</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span><span class="n">in_use_next</span> <span class="o">-</span> <span class="n">in_use_curr</span> <span class="o">&lt;=</span> <span class="n">turn_on_next</span><span class="p">)</span>

        <span class="c1"># if unit is on at time t and time t+1, then it was not turned on at time t+1</span>
        <span class="c1"># mdl.add_constraint(in_use_next + in_use_curr + turn_on_next &lt;= 2)</span>

        <span class="c1"># if unit is on at time t and off at time t+1, then it was turned off at time t+1</span>
        <span class="n">ucpm</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span><span class="n">in_use_curr</span> <span class="o">-</span> <span class="n">in_use_next</span> <span class="o">+</span> <span class="n">turn_on_next</span> <span class="o">==</span> <span class="n">turn_off_next</span><span class="p">)</span>
<span class="n">ucpm</span><span class="o">.</span><span class="n">print_information</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Model</span><span class="p">:</span> <span class="n">ucp</span>
 <span class="o">-</span> <span class="n">number</span> <span class="n">of</span> <span class="n">variables</span><span class="p">:</span> <span class="mi">7680</span>
   <span class="o">-</span> <span class="n">binary</span><span class="o">=</span><span class="mi">3840</span><span class="p">,</span> <span class="n">integer</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">continuous</span><span class="o">=</span><span class="mi">3840</span>
 <span class="o">-</span> <span class="n">number</span> <span class="n">of</span> <span class="n">constraints</span><span class="p">:</span> <span class="mi">11520</span>
 <span class="o">-</span>   <span class="n">LE</span><span class="o">=</span><span class="mi">7670</span><span class="p">,</span> <span class="n">EQ</span><span class="o">=</span><span class="mi">1930</span><span class="p">,</span> <span class="n">GE</span><span class="o">=</span><span class="mi">1920</span><span class="p">,</span> <span class="n">RNG</span><span class="o">=</span><span class="mi">0</span>
 <span class="o">-</span> <span class="n">parameters</span><span class="p">:</span> <span class="n">defaults</span>
</pre></div>
</div>
</div>
<div class="section" id="minimum-uptime-and-downtime">
<h5>Minimum uptime and downtime<a class="headerlink" href="#minimum-uptime-and-downtime" title="Permalink to this headline">&para;</a></h5>
<p>When a unit is turned on, it cannot be turned off before a <em>minimum
uptime</em>. Conversely, when a unit is turned off, it cannot be turned on
again before a <em>minimum downtime</em>.</p>
<p>Again, let&#8217;s use the same <em>pandas</em> <em>groupby</em> operation to implement this
constraint for each unit.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="c1"># Minimum uptime, downtime</span>
<span class="k">for</span> <span class="n">unit</span><span class="p">,</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">df_decision_vars</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="s1">&#39;units&#39;</span><span class="p">):</span>
    <span class="n">min_uptime</span>   <span class="o">=</span> <span class="n">df_up</span><span class="o">.</span><span class="n">min_uptime</span><span class="p">[</span><span class="n">unit</span><span class="p">]</span>
    <span class="n">min_downtime</span> <span class="o">=</span> <span class="n">df_up</span><span class="o">.</span><span class="n">min_downtime</span><span class="p">[</span><span class="n">unit</span><span class="p">]</span>
    <span class="c1"># Note that r.turn_on and r.in_use are Series that can be indexed as arrays (ie: first item index = 0)</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">min_uptime</span><span class="p">,</span> <span class="n">nb_periods</span><span class="p">):</span>
        <span class="n">ctname</span> <span class="o">=</span> <span class="s2">&quot;min_up_</span><span class="si">{0!s}</span><span class="s2">_</span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">r</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">t</span><span class="p">])</span>
        <span class="n">ucpm</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span><span class="n">ucpm</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">turn_on</span><span class="p">[(</span><span class="n">t</span> <span class="o">-</span> <span class="n">min_uptime</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="n">r</span><span class="o">.</span><span class="n">in_use</span><span class="p">[</span><span class="n">t</span><span class="p">],</span> <span class="n">ctname</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">min_downtime</span><span class="p">,</span> <span class="n">nb_periods</span><span class="p">):</span>
        <span class="n">ctname</span> <span class="o">=</span> <span class="s2">&quot;min_down_</span><span class="si">{0!s}</span><span class="s2">_</span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">r</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">t</span><span class="p">])</span>
        <span class="n">ucpm</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span><span class="n">ucpm</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">turn_off</span><span class="p">[(</span><span class="n">t</span> <span class="o">-</span> <span class="n">min_downtime</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">r</span><span class="o">.</span><span class="n">in_use</span><span class="p">[</span><span class="n">t</span><span class="p">],</span> <span class="n">ctname</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="demand-constraint">
<h5>Demand constraint<a class="headerlink" href="#demand-constraint" title="Permalink to this headline">&para;</a></h5>
<p>Total production level must be equal or higher than demand on any
period.</p>
<p>This time, the <em>pandas</em> operation <em>groupby</em> is performed on <em>&#8220;periods&#8221;</em>
since we have to iterate over the list of all units for each period.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="c1"># Enforcing demand</span>
<span class="c1"># we use a &gt;= here to be more robust,</span>
<span class="c1"># objective will ensure  we produce efficiently</span>
<span class="k">for</span> <span class="n">period</span><span class="p">,</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">df_decision_vars</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="s1">&#39;periods&#39;</span><span class="p">):</span>
    <span class="n">total_demand</span> <span class="o">=</span> <span class="n">demand</span><span class="p">[</span><span class="n">period</span><span class="p">]</span>
    <span class="n">ctname</span> <span class="o">=</span> <span class="s2">&quot;ct_meet_demand_</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">period</span>
    <span class="n">ucpm</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span><span class="n">ucpm</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">production</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">total_demand</span><span class="p">,</span> <span class="n">ctname</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="express-the-objective">
<h4>Express the objective<a class="headerlink" href="#express-the-objective" title="Permalink to this headline">&para;</a></h4>
<p>Operating the different units incur different costs: fixed cost,
variable cost, startup cost, co2 cost.</p>
<p>In a first step, we define the objective as a non-weighted sum of all
these costs.</p>
<p>The following <em>pandas</em> <em>join</em> operation groups all the data to calculate
the objective in a single DataFrame.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="c1"># Create a join between &#39;df_decision_vars&#39; and &#39;df_up&#39; Data Frames based on common index ids (ie: &#39;units&#39;)</span>
<span class="c1"># In &#39;df_up&#39;, one keeps only relevant columns: &#39;fixed_cost&#39;, &#39;variable_cost&#39;, &#39;start_cost&#39; and &#39;co2_cost&#39;</span>
<span class="n">df_join_obj</span> <span class="o">=</span> <span class="n">df_decision_vars</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
    <span class="n">df_up</span><span class="p">[[</span><span class="s1">&#39;fixed_cost&#39;</span><span class="p">,</span> <span class="s1">&#39;variable_cost&#39;</span><span class="p">,</span> <span class="s1">&#39;start_cost&#39;</span><span class="p">,</span> <span class="s1">&#39;co2_cost&#39;</span><span class="p">]],</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;inner&#39;</span><span class="p">)</span>

<span class="c1"># Display first few rows of joined Data Frame</span>
<span class="n">df_join_obj</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>in_use</th>
      <th>production</th>
      <th>turn_off</th>
      <th>turn_on</th>
      <th>fixed_cost</th>
      <th>variable_cost</th>
      <th>start_cost</th>
      <th>co2_cost</th>
    </tr>
    <tr>
      <th>units</th>
      <th>periods</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="5" valign="top">coal1</th>
      <th>1</th>
      <td>in_use_coal1_1</td>
      <td>p_coal1_1</td>
      <td>turn_off_coal1_1</td>
      <td>turn_on_coal1_1</td>
      <td>208.61</td>
      <td>22.536</td>
      <td>5000</td>
      <td>30</td>
    </tr>
    <tr>
      <th>2</th>
      <td>in_use_coal1_2</td>
      <td>p_coal1_2</td>
      <td>turn_off_coal1_2</td>
      <td>turn_on_coal1_2</td>
      <td>208.61</td>
      <td>22.536</td>
      <td>5000</td>
      <td>30</td>
    </tr>
    <tr>
      <th>3</th>
      <td>in_use_coal1_3</td>
      <td>p_coal1_3</td>
      <td>turn_off_coal1_3</td>
      <td>turn_on_coal1_3</td>
      <td>208.61</td>
      <td>22.536</td>
      <td>5000</td>
      <td>30</td>
    </tr>
    <tr>
      <th>4</th>
      <td>in_use_coal1_4</td>
      <td>p_coal1_4</td>
      <td>turn_off_coal1_4</td>
      <td>turn_on_coal1_4</td>
      <td>208.61</td>
      <td>22.536</td>
      <td>5000</td>
      <td>30</td>
    </tr>
    <tr>
      <th>5</th>
      <td>in_use_coal1_5</td>
      <td>p_coal1_5</td>
      <td>turn_off_coal1_5</td>
      <td>turn_on_coal1_5</td>
      <td>208.61</td>
      <td>22.536</td>
      <td>5000</td>
      <td>30</td>
    </tr>
  </tbody>
</table>
</div><div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="c1"># objective</span>
<span class="n">total_fixed_cost</span> <span class="o">=</span> <span class="n">ucpm</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">df_join_obj</span><span class="o">.</span><span class="n">in_use</span> <span class="o">*</span> <span class="n">df_join_obj</span><span class="o">.</span><span class="n">fixed_cost</span><span class="p">)</span>
<span class="n">total_variable_cost</span> <span class="o">=</span> <span class="n">ucpm</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">df_join_obj</span><span class="o">.</span><span class="n">production</span> <span class="o">*</span> <span class="n">df_join_obj</span><span class="o">.</span><span class="n">variable_cost</span><span class="p">)</span>
<span class="n">total_startup_cost</span> <span class="o">=</span> <span class="n">ucpm</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">df_join_obj</span><span class="o">.</span><span class="n">turn_on</span> <span class="o">*</span> <span class="n">df_join_obj</span><span class="o">.</span><span class="n">start_cost</span><span class="p">)</span>
<span class="n">total_co2_cost</span> <span class="o">=</span> <span class="n">ucpm</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">df_join_obj</span><span class="o">.</span><span class="n">production</span> <span class="o">*</span> <span class="n">df_join_obj</span><span class="o">.</span><span class="n">co2_cost</span><span class="p">)</span>
<span class="n">total_economic_cost</span> <span class="o">=</span> <span class="n">total_fixed_cost</span> <span class="o">+</span> <span class="n">total_variable_cost</span> <span class="o">+</span> <span class="n">total_startup_cost</span>

<span class="n">total_nb_used</span> <span class="o">=</span> <span class="n">ucpm</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">df_decision_vars</span><span class="o">.</span><span class="n">in_use</span><span class="p">)</span>
<span class="n">total_nb_starts</span> <span class="o">=</span> <span class="n">ucpm</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">df_decision_vars</span><span class="o">.</span><span class="n">turn_on</span><span class="p">)</span>

<span class="c1"># store expression kpis to retrieve them later.</span>
<span class="n">ucpm</span><span class="o">.</span><span class="n">add_kpi</span><span class="p">(</span><span class="n">total_fixed_cost</span>   <span class="p">,</span> <span class="s2">&quot;Total Fixed Cost&quot;</span><span class="p">)</span>
<span class="n">ucpm</span><span class="o">.</span><span class="n">add_kpi</span><span class="p">(</span><span class="n">total_variable_cost</span><span class="p">,</span> <span class="s2">&quot;Total Variable Cost&quot;</span><span class="p">)</span>
<span class="n">ucpm</span><span class="o">.</span><span class="n">add_kpi</span><span class="p">(</span><span class="n">total_startup_cost</span> <span class="p">,</span> <span class="s2">&quot;Total Startup Cost&quot;</span><span class="p">)</span>
<span class="n">ucpm</span><span class="o">.</span><span class="n">add_kpi</span><span class="p">(</span><span class="n">total_economic_cost</span><span class="p">,</span> <span class="s2">&quot;Total Economic Cost&quot;</span><span class="p">)</span>
<span class="n">ucpm</span><span class="o">.</span><span class="n">add_kpi</span><span class="p">(</span><span class="n">total_co2_cost</span>     <span class="p">,</span> <span class="s2">&quot;Total CO2 Cost&quot;</span><span class="p">)</span>
<span class="n">ucpm</span><span class="o">.</span><span class="n">add_kpi</span><span class="p">(</span><span class="n">total_nb_used</span><span class="p">,</span> <span class="s2">&quot;Total #used&quot;</span><span class="p">)</span>
<span class="n">ucpm</span><span class="o">.</span><span class="n">add_kpi</span><span class="p">(</span><span class="n">total_nb_starts</span><span class="p">,</span> <span class="s2">&quot;Total #starts&quot;</span><span class="p">)</span>

<span class="c1"># minimize sum of all costs</span>
<span class="n">ucpm</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="n">total_fixed_cost</span> <span class="o">+</span> <span class="n">total_variable_cost</span> <span class="o">+</span> <span class="n">total_startup_cost</span> <span class="o">+</span> <span class="n">total_co2_cost</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="solve-with-the-decision-optimization-solve-service">
<h4>Solve with the Decision Optimization solve service<a class="headerlink" href="#solve-with-the-decision-optimization-solve-service" title="Permalink to this headline">&para;</a></h4>
<p>Solve the model on the cloud.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">ucpm</span><span class="o">.</span><span class="n">print_information</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Model</span><span class="p">:</span> <span class="n">ucp</span>
 <span class="o">-</span> <span class="n">number</span> <span class="n">of</span> <span class="n">variables</span><span class="p">:</span> <span class="mi">7680</span>
   <span class="o">-</span> <span class="n">binary</span><span class="o">=</span><span class="mi">3840</span><span class="p">,</span> <span class="n">integer</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">continuous</span><span class="o">=</span><span class="mi">3840</span>
 <span class="o">-</span> <span class="n">number</span> <span class="n">of</span> <span class="n">constraints</span><span class="p">:</span> <span class="mi">15455</span>
 <span class="o">-</span>   <span class="n">LE</span><span class="o">=</span><span class="mi">11413</span><span class="p">,</span> <span class="n">EQ</span><span class="o">=</span><span class="mi">1930</span><span class="p">,</span> <span class="n">GE</span><span class="o">=</span><span class="mi">2112</span><span class="p">,</span> <span class="n">RNG</span><span class="o">=</span><span class="mi">0</span>
 <span class="o">-</span> <span class="n">parameters</span><span class="p">:</span> <span class="n">defaults</span>
</pre></div>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="k">assert</span> <span class="n">ucpm</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">),</span> <span class="s2">&quot;!!! Solve of the model fails&quot;</span>
</pre></div>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">ucpm</span><span class="o">.</span><span class="n">report</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">*</span> <span class="n">model</span> <span class="n">solved</span> <span class="k">with</span> <span class="n">objective</span><span class="p">:</span> <span class="mf">14214465.095</span>
<span class="o">*</span> <span class="n">KPI</span><span class="p">:</span> <span class="n">Total</span> <span class="n">Fixed</span> <span class="n">Cost</span><span class="o">=</span><span class="mf">161027.916</span>
<span class="o">*</span> <span class="n">KPI</span><span class="p">:</span> <span class="n">Total</span> <span class="n">Variable</span> <span class="n">Cost</span><span class="o">=</span><span class="mf">8865333.679</span>
<span class="o">*</span> <span class="n">KPI</span><span class="p">:</span> <span class="n">Total</span> <span class="n">Startup</span> <span class="n">Cost</span><span class="o">=</span><span class="mf">3382.000</span>
<span class="o">*</span> <span class="n">KPI</span><span class="p">:</span> <span class="n">Total</span> <span class="n">Economic</span> <span class="n">Cost</span><span class="o">=</span><span class="mf">9029743.595</span>
<span class="o">*</span> <span class="n">KPI</span><span class="p">:</span> <span class="n">Total</span> <span class="n">CO2</span> <span class="n">Cost</span><span class="o">=</span><span class="mf">5184721.500</span>
<span class="o">*</span> <span class="n">KPI</span><span class="p">:</span> <span class="n">Total</span> <span class="c1">#used=1337.000</span>
<span class="o">*</span> <span class="n">KPI</span><span class="p">:</span> <span class="n">Total</span> <span class="c1">#starts=5.000</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="step-6-investigate-the-solution-and-then-run-an-example-analysis">
<h3>Step 6: Investigate the solution and then run an example analysis<a class="headerlink" href="#step-6-investigate-the-solution-and-then-run-an-example-analysis" title="Permalink to this headline">&para;</a></h3>
<p>Now let&#8217;s store the results in a new <em>pandas</em> DataFrame.</p>
<p>For convenience, the different figures are organized into pivot tables
with <em>periods</em> as row index and <em>units</em> as columns. The <em>pandas</em>
<em>unstack</em> operation does this for us.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">df_prods</span> <span class="o">=</span> <span class="n">df_decision_vars</span><span class="o">.</span><span class="n">production</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">v</span><span class="p">:</span> <span class="n">v</span><span class="o">.</span><span class="n">solution_value</span><span class="p">)</span><span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="s1">&#39;units&#39;</span><span class="p">)</span>
<span class="n">df_used</span> <span class="o">=</span> <span class="n">df_decision_vars</span><span class="o">.</span><span class="n">in_use</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">v</span><span class="p">:</span> <span class="n">v</span><span class="o">.</span><span class="n">solution_value</span><span class="p">)</span><span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="s1">&#39;units&#39;</span><span class="p">)</span>
<span class="n">df_started</span> <span class="o">=</span> <span class="n">df_decision_vars</span><span class="o">.</span><span class="n">turn_on</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">v</span><span class="p">:</span> <span class="n">v</span><span class="o">.</span><span class="n">solution_value</span><span class="p">)</span><span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="s1">&#39;units&#39;</span><span class="p">)</span>

<span class="c1"># Display the first few rows of the pivoted &#39;production&#39; data</span>
<span class="n">df_prods</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>units</th>
      <th>coal1</th>
      <th>coal2</th>
      <th>diesel1</th>
      <th>diesel2</th>
      <th>diesel3</th>
      <th>diesel4</th>
      <th>gas1</th>
      <th>gas2</th>
      <th>gas3</th>
      <th>gas4</th>
    </tr>
    <tr>
      <th>periods</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>425.0</td>
      <td>215.0</td>
      <td>90.0</td>
      <td>87.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>109.4</td>
      <td>52.0</td>
      <td>165.0</td>
      <td>115.6</td>
    </tr>
    <tr>
      <th>2</th>
      <td>425.0</td>
      <td>365.0</td>
      <td>90.0</td>
      <td>87.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>78.0</td>
      <td>71.0</td>
      <td>165.0</td>
      <td>158.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>425.0</td>
      <td>312.0</td>
      <td>90.0</td>
      <td>87.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>52.0</td>
      <td>165.0</td>
      <td>158.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>425.0</td>
      <td>234.0</td>
      <td>90.0</td>
      <td>87.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>52.0</td>
      <td>165.0</td>
      <td>158.0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>425.0</td>
      <td>365.0</td>
      <td>90.0</td>
      <td>87.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>143.0</td>
      <td>165.0</td>
      <td>158.0</td>
    </tr>
  </tbody>
</table>
</div><p>From these raw DataFrame results, we can compute <em>derived</em> results. For
example, for a given unit and period, the <em>reserve</em> r(u,t) is defined as
the unit&#8217;s maximum generation minus the current production.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">df_spins</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">df_up</span><span class="o">.</span><span class="n">max_gen</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span> <span class="n">index</span><span class="o">=</span><span class="n">periods</span><span class="p">)</span> <span class="o">-</span> <span class="n">df_prods</span>

<span class="c1"># Display the first few rows of the &#39;df_spins&#39; Data Frame, representing the reserve for each unit, over time</span>
<span class="n">df_spins</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>coal1</th>
      <th>coal2</th>
      <th>diesel1</th>
      <th>diesel2</th>
      <th>diesel3</th>
      <th>diesel4</th>
      <th>gas1</th>
      <th>gas2</th>
      <th>gas3</th>
      <th>gas4</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>0.0</td>
      <td>150.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>20.0</td>
      <td>12.0</td>
      <td>110.6</td>
      <td>158.0</td>
      <td>0.0</td>
      <td>42.4</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>20.0</td>
      <td>12.0</td>
      <td>142.0</td>
      <td>139.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.0</td>
      <td>53.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>20.0</td>
      <td>12.0</td>
      <td>220.0</td>
      <td>158.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.0</td>
      <td>131.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>20.0</td>
      <td>12.0</td>
      <td>220.0</td>
      <td>158.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>20.0</td>
      <td>12.0</td>
      <td>220.0</td>
      <td>67.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div><p>Let&#8217;s plot the evolution of the reserves for the <em>&#8220;coal2&#8221;</em> unit:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">df_spins</span><span class="o">.</span><span class="n">coal2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s1">&#39;o-&#39;</span><span class="p">,</span> <span class="n">ylim</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">200</span><span class="p">])</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">_subplots</span><span class="o">.</span><span class="n">AxesSubplot</span> <span class="n">at</span> <span class="mh">0xe827278</span><span class="o">&gt;</span>
</pre></div>
</div>
<img alt="_images/ucp_pandas_57_1.png" src="_images/ucp_pandas_57_1.png" />
<p>Now we want to sum all unit reserves to compute the <em>global</em> spinning
reserve. We need to sum all columns of the DataFrame to get an
aggregated time series. We use the <em>pandas</em> <strong>sum</strong> method with axis=1
(for rows).</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">global_spin</span> <span class="o">=</span> <span class="n">df_spins</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">global_spin</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Global spinning reserve&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">_subplots</span><span class="o">.</span><span class="n">AxesSubplot</span> <span class="n">at</span> <span class="mh">0xa018828</span><span class="o">&gt;</span>
</pre></div>
</div>
<img alt="_images/ucp_pandas_59_1.png" src="_images/ucp_pandas_59_1.png" />
<div class="section" id="number-of-plants-online-by-period">
<h4>Number of plants online by period<a class="headerlink" href="#number-of-plants-online-by-period" title="Permalink to this headline">&para;</a></h4>
<p>The total number of plants online at each period t is the sum of in_use
variables for all units at this period. Again, we use the <em>pandas</em> sum
with axis=1 (for rows) to sum over all units.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">df_used</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Number of plants online&quot;</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;line&#39;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;r-&quot;</span><span class="p">,</span> <span class="n">ylim</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">units</span><span class="p">)])</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">_subplots</span><span class="o">.</span><span class="n">AxesSubplot</span> <span class="n">at</span> <span class="mh">0xeb9eb38</span><span class="o">&gt;</span>
</pre></div>
</div>
<img alt="_images/ucp_pandas_61_1.png" src="_images/ucp_pandas_61_1.png" />
</div>
<div class="section" id="costs-by-period">
<h4>Costs by period<a class="headerlink" href="#costs-by-period" title="Permalink to this headline">&para;</a></h4>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="c1"># extract unit cost data</span>
<span class="n">all_costs</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;fixed_cost&quot;</span><span class="p">,</span> <span class="s2">&quot;variable_cost&quot;</span><span class="p">,</span> <span class="s2">&quot;start_cost&quot;</span><span class="p">,</span> <span class="s2">&quot;co2_cost&quot;</span><span class="p">]</span>
<span class="n">df_costs</span> <span class="o">=</span> <span class="n">df_up</span><span class="p">[</span><span class="n">all_costs</span><span class="p">]</span>

<span class="n">running_cost</span> <span class="o">=</span> <span class="n">df_used</span> <span class="o">*</span> <span class="n">df_costs</span><span class="o">.</span><span class="n">fixed_cost</span>
<span class="n">startup_cost</span> <span class="o">=</span> <span class="n">df_started</span> <span class="o">*</span> <span class="n">df_costs</span><span class="o">.</span><span class="n">start_cost</span>
<span class="n">variable_cost</span> <span class="o">=</span> <span class="n">df_prods</span> <span class="o">*</span> <span class="n">df_costs</span><span class="o">.</span><span class="n">variable_cost</span>
<span class="n">co2_cost</span> <span class="o">=</span> <span class="n">df_prods</span> <span class="o">*</span> <span class="n">df_costs</span><span class="o">.</span><span class="n">co2_cost</span>
<span class="n">total_cost</span> <span class="o">=</span> <span class="n">running_cost</span> <span class="o">+</span> <span class="n">startup_cost</span> <span class="o">+</span> <span class="n">variable_cost</span> <span class="o">+</span> <span class="n">co2_cost</span>

<span class="n">running_cost</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">)</span>
<span class="n">startup_cost</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="n">variable_cost</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">logy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">co2_cost</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">_subplots</span><span class="o">.</span><span class="n">AxesSubplot</span> <span class="n">at</span> <span class="mh">0xf0e3438</span><span class="o">&gt;</span>
</pre></div>
</div>
<img alt="_images/ucp_pandas_63_1.png" src="_images/ucp_pandas_63_1.png" />
</div>
<div class="section" id="cost-breakdown-by-unit-and-by-energy">
<h4>Cost breakdown by unit and by energy<a class="headerlink" href="#cost-breakdown-by-unit-and-by-energy" title="Permalink to this headline">&para;</a></h4>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="c1"># Calculate sum by column (by default, axis = 0) to get total cost for each unit</span>
<span class="n">cost_by_unit</span> <span class="o">=</span> <span class="n">total_cost</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

<span class="c1"># Create a dictionary storing energy type for each unit, from the corresponding pandas Series</span>
<span class="n">unit_energies</span> <span class="o">=</span> <span class="n">df_up</span><span class="o">.</span><span class="n">energy</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>

<span class="c1"># Group cost by unit type and plot total cost by energy type in a pie chart</span>
<span class="n">gb</span> <span class="o">=</span> <span class="n">cost_by_unit</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">unit_energies</span><span class="p">)</span>
<span class="c1"># gb.sum().plot(kind=&#39;pie&#39;)</span>
<span class="n">gb</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">pie</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span><span class="n">autopct</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.2f</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;total cost by energy type&#39;</span><span class="p">,</span> <span class="n">bbox</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;facecolor&#39;</span><span class="p">:</span><span class="s1">&#39;0.8&#39;</span><span class="p">,</span> <span class="s1">&#39;pad&#39;</span><span class="p">:</span><span class="mi">5</span><span class="p">})</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">Text</span> <span class="n">at</span> <span class="mh">0x1b5f5f60</span><span class="o">&gt;</span>
</pre></div>
</div>
<img alt="_images/ucp_pandas_65_1.png" src="_images/ucp_pandas_65_1.png" />
</div>
</div>
<div class="section" id="arbitration-between-co2-cost-and-economic-cost">
<h3>Arbitration between CO2 cost and economic cost<a class="headerlink" href="#arbitration-between-co2-cost-and-economic-cost" title="Permalink to this headline">&para;</a></h3>
<p>Economic cost and CO2 cost usually push in opposite directions. In the
above discussion, we have minimized the raw sum of economic cost and CO2
cost, without weights. But how good could we be on CO2, regardless of
economic constraints? To know this, let&#8217;s solve again with CO2 cost as
the only objective.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="c1"># first retrieve the co2 and economic kpis</span>
<span class="n">co2_kpi</span> <span class="o">=</span> <span class="n">ucpm</span><span class="o">.</span><span class="n">kpi_by_name</span><span class="p">(</span><span class="s2">&quot;co2&quot;</span><span class="p">)</span> <span class="c1"># does a name matching</span>
<span class="n">eco_kpi</span> <span class="o">=</span> <span class="n">ucpm</span><span class="o">.</span><span class="n">kpi_by_name</span><span class="p">(</span><span class="s2">&quot;eco&quot;</span><span class="p">)</span>
<span class="n">prev_co2_cost</span> <span class="o">=</span> <span class="n">co2_kpi</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
<span class="n">prev_eco_cost</span> <span class="o">=</span> <span class="n">eco_kpi</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;* current CO2 cost is: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">prev_co2_cost</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;* current $$$ cost is: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">prev_eco_cost</span><span class="p">))</span>
<span class="c1"># now set the objective</span>
<span class="n">old_objective</span> <span class="o">=</span> <span class="n">ucpm</span><span class="o">.</span><span class="n">objective_expr</span> <span class="c1"># save it</span>
<span class="n">ucpm</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="n">co2_kpi</span><span class="o">.</span><span class="n">as_expression</span><span class="p">())</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span>* current CO2 cost is: 5184721.5
* current $$$ cost is: 9029743.5947
</pre></div>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="k">assert</span> <span class="n">ucpm</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">),</span> <span class="s2">&quot;Solve failed&quot;</span>
</pre></div>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">min_co2_cost</span> <span class="o">=</span> <span class="n">ucpm</span><span class="o">.</span><span class="n">objective_value</span>
<span class="n">min_co2_eco_cost</span> <span class="o">=</span> <span class="n">eco_kpi</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;* absolute minimum for CO2 cost is </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">min_co2_cost</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;* at this point $$$ cost is </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">min_co2_eco_cost</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span>* absolute minimum for CO2 cost is 3398912.0
* at this point $$$ cost is 12465960.4954
</pre></div>
</div>
<p>As expected, we get a significantly lower CO2 cost when minimized alone,
at the price of a higher economic cost.</p>
<p>We could do a similar analysis for economic cost to estimate the
absolute minimum of the economic cost, regardless of CO2 cost.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="c1"># minimize only economic cost</span>
<span class="n">ucpm</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="n">eco_kpi</span><span class="o">.</span><span class="n">as_expression</span><span class="p">())</span>
</pre></div>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="k">assert</span> <span class="n">ucpm</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">),</span> <span class="s2">&quot;Solve failed&quot;</span>
</pre></div>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">min_eco_cost</span> <span class="o">=</span> <span class="n">ucpm</span><span class="o">.</span><span class="n">objective_value</span>
<span class="n">min_eco_co2_cost</span> <span class="o">=</span> <span class="n">co2_kpi</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;* absolute minimum for $$$ cost is </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">min_eco_cost</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;* at this point CO2 cost is </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">min_eco_co2_cost</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span>* absolute minimum for $$$ cost is 8886788.6474
* at this point CO2 cost is 5375788.0
</pre></div>
</div>
<p>Again, the absolute minimum for economic cost is lower than the figure
we obtained in the original model where we minimized the <em>sum</em> of
economic and CO2 costs, but here we significantly increase the CO2.</p>
<p>But what happens in between these two extreme points?</p>
<p>To investigate, we will divide the interval of CO2 cost values in
smaller intervals, add an upper limit on CO2, and minimize economic cost
with this constraint. This will give us a Pareto optimal point with at
most this CO2 value.</p>
<p>To avoid adding many constraints, we add only one constraint with an
extra variable, and we change only the upper bound of this CO2 limit
variable between successive solves.</p>
<p>Then we iterate (with a fixed number of iterations) and collect the cost
values.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="c1"># add extra variable</span>
<span class="n">co2_limit</span> <span class="o">=</span> <span class="n">ucpm</span><span class="o">.</span><span class="n">continuous_var</span><span class="p">(</span><span class="n">lb</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="c1"># add a named constraint which limits total co2 cost to this variable:</span>
<span class="n">max_co2_ctname</span> <span class="o">=</span> <span class="s2">&quot;ct_max_co2&quot;</span>
<span class="n">co2_ct</span> <span class="o">=</span> <span class="n">ucpm</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span><span class="n">co2_kpi</span><span class="o">.</span><span class="n">as_expression</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="n">co2_limit</span><span class="p">,</span> <span class="n">max_co2_ctname</span><span class="p">)</span>
</pre></div>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">co2min</span> <span class="o">=</span> <span class="n">min_co2_cost</span>
<span class="n">co2max</span> <span class="o">=</span> <span class="n">min_eco_co2_cost</span>
<span class="k">def</span> <span class="nf">explore_ucp</span><span class="p">(</span><span class="n">nb_iters</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="mf">1e-5</span><span class="p">):</span>

    <span class="n">step</span> <span class="o">=</span> <span class="p">(</span><span class="n">co2max</span><span class="o">-</span><span class="n">co2min</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">nb_iters</span><span class="p">)</span>
    <span class="n">co2_ubs</span> <span class="o">=</span> <span class="p">[</span><span class="n">co2min</span> <span class="o">+</span> <span class="n">k</span> <span class="o">*</span> <span class="n">step</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nb_iters</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span>

    <span class="c1"># ensure we minimize eco</span>
    <span class="n">ucpm</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="n">eco_kpi</span><span class="o">.</span><span class="n">as_expression</span><span class="p">())</span>
    <span class="n">all_co2s</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">all_ecos</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nb_iters</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">co2_ub</span> <span class="o">=</span> <span class="n">co2min</span> <span class="o">+</span> <span class="n">k</span> <span class="o">*</span> <span class="n">step</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; iteration #</span><span class="si">{0}</span><span class="s2"> co2_ub=</span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">co2_ub</span><span class="p">))</span>
        <span class="n">co2_limit</span><span class="o">.</span><span class="n">ub</span> <span class="o">=</span> <span class="n">co2_ub</span> <span class="o">+</span> <span class="n">eps</span>
        <span class="k">assert</span> <span class="n">ucpm</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;Solve failed&quot;</span>
        <span class="n">cur_co2</span> <span class="o">=</span> <span class="n">co2_kpi</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
        <span class="n">cur_eco</span> <span class="o">=</span> <span class="n">eco_kpi</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
        <span class="n">all_co2s</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cur_co2</span><span class="p">)</span>
        <span class="n">all_ecos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cur_eco</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">all_co2s</span><span class="p">,</span> <span class="n">all_ecos</span>
</pre></div>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="c1">#explore the co2/eco frontier in 50 points</span>
<span class="n">co2s</span><span class="p">,</span> <span class="n">ecos</span> <span class="o">=</span> <span class="n">explore_ucp</span><span class="p">(</span><span class="n">nb_iters</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">iteration</span> <span class="c1">#0 co2_ub=3398912.0</span>
<span class="n">iteration</span> <span class="c1">#1 co2_ub=3438449.52</span>
<span class="n">iteration</span> <span class="c1">#2 co2_ub=3477987.04</span>
<span class="n">iteration</span> <span class="c1">#3 co2_ub=3517524.56</span>
<span class="n">iteration</span> <span class="c1">#4 co2_ub=3557062.08</span>
<span class="n">iteration</span> <span class="c1">#5 co2_ub=3596599.6</span>
<span class="n">iteration</span> <span class="c1">#6 co2_ub=3636137.12</span>
<span class="n">iteration</span> <span class="c1">#7 co2_ub=3675674.64</span>
<span class="n">iteration</span> <span class="c1">#8 co2_ub=3715212.16</span>
<span class="n">iteration</span> <span class="c1">#9 co2_ub=3754749.68</span>
<span class="n">iteration</span> <span class="c1">#10 co2_ub=3794287.2</span>
<span class="n">iteration</span> <span class="c1">#11 co2_ub=3833824.72</span>
<span class="n">iteration</span> <span class="c1">#12 co2_ub=3873362.24</span>
<span class="n">iteration</span> <span class="c1">#13 co2_ub=3912899.76</span>
<span class="n">iteration</span> <span class="c1">#14 co2_ub=3952437.28</span>
<span class="n">iteration</span> <span class="c1">#15 co2_ub=3991974.8</span>
<span class="n">iteration</span> <span class="c1">#16 co2_ub=4031512.32</span>
<span class="n">iteration</span> <span class="c1">#17 co2_ub=4071049.84</span>
<span class="n">iteration</span> <span class="c1">#18 co2_ub=4110587.36</span>
<span class="n">iteration</span> <span class="c1">#19 co2_ub=4150124.88</span>
<span class="n">iteration</span> <span class="c1">#20 co2_ub=4189662.4</span>
<span class="n">iteration</span> <span class="c1">#21 co2_ub=4229199.92</span>
<span class="n">iteration</span> <span class="c1">#22 co2_ub=4268737.44</span>
<span class="n">iteration</span> <span class="c1">#23 co2_ub=4308274.96</span>
<span class="n">iteration</span> <span class="c1">#24 co2_ub=4347812.48</span>
<span class="n">iteration</span> <span class="c1">#25 co2_ub=4387350.0</span>
<span class="n">iteration</span> <span class="c1">#26 co2_ub=4426887.52</span>
<span class="n">iteration</span> <span class="c1">#27 co2_ub=4466425.04</span>
<span class="n">iteration</span> <span class="c1">#28 co2_ub=4505962.56</span>
<span class="n">iteration</span> <span class="c1">#29 co2_ub=4545500.08</span>
<span class="n">iteration</span> <span class="c1">#30 co2_ub=4585037.6</span>
<span class="n">iteration</span> <span class="c1">#31 co2_ub=4624575.12</span>
<span class="n">iteration</span> <span class="c1">#32 co2_ub=4664112.64</span>
<span class="n">iteration</span> <span class="c1">#33 co2_ub=4703650.16</span>
<span class="n">iteration</span> <span class="c1">#34 co2_ub=4743187.68</span>
<span class="n">iteration</span> <span class="c1">#35 co2_ub=4782725.2</span>
<span class="n">iteration</span> <span class="c1">#36 co2_ub=4822262.72</span>
<span class="n">iteration</span> <span class="c1">#37 co2_ub=4861800.24</span>
<span class="n">iteration</span> <span class="c1">#38 co2_ub=4901337.76</span>
<span class="n">iteration</span> <span class="c1">#39 co2_ub=4940875.28</span>
<span class="n">iteration</span> <span class="c1">#40 co2_ub=4980412.8</span>
<span class="n">iteration</span> <span class="c1">#41 co2_ub=5019950.32</span>
<span class="n">iteration</span> <span class="c1">#42 co2_ub=5059487.84</span>
<span class="n">iteration</span> <span class="c1">#43 co2_ub=5099025.36</span>
<span class="n">iteration</span> <span class="c1">#44 co2_ub=5138562.88</span>
<span class="n">iteration</span> <span class="c1">#45 co2_ub=5178100.4</span>
<span class="n">iteration</span> <span class="c1">#46 co2_ub=5217637.92</span>
<span class="n">iteration</span> <span class="c1">#47 co2_ub=5257175.44</span>
<span class="n">iteration</span> <span class="c1">#48 co2_ub=5296712.96</span>
<span class="n">iteration</span> <span class="c1">#49 co2_ub=5336250.48</span>
<span class="n">iteration</span> <span class="c1">#50 co2_ub=5375788.0</span>
</pre></div>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="c1"># normalize all values by dividing by their maximum</span>
<span class="n">eco_max</span> <span class="o">=</span> <span class="n">min_co2_eco_cost</span>
<span class="n">nxs</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="o">/</span> <span class="n">co2max</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">co2s</span><span class="p">]</span>
<span class="n">nys</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span> <span class="o">/</span> <span class="n">eco_max</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">ecos</span><span class="p">]</span>
<span class="c1"># plot a scatter chart of x=co2, y=costs</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">nxs</span><span class="p">,</span> <span class="n">nys</span><span class="p">)</span>
<span class="c1"># plot as one point</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">prev_co2_cost</span><span class="o">/</span><span class="n">co2max</span><span class="p">,</span> <span class="n">prev_eco_cost</span><span class="o">/</span><span class="n">eco_max</span><span class="p">,</span> <span class="s2">&quot;rH&quot;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;co2 cost&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;economic cost&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img alt="_images/ucp_pandas_78_0.png" src="_images/ucp_pandas_78_0.png" />
<p>This figure demonstrates that the result obtained in the initial model
clearly favored economic cost over CO2 cost: CO2 cost is well above 95%
of its maximum value.</p>
</div>
</div>
<div class="section" id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="Permalink to this headline">&para;</a></h2>
<p>You learned how to set up and use IBM Decision Optimization CPLEX
Modeling for Python to formulate a Mathematical Programming model and
solve it with IBM Decision Optimization on Cloud.</p>
<ul class="simple">
<li><a class="reference external" href="https://rawgit.com/IBMDecisionOptimization/docplex-doc/master/docs/index.html">CPLEX Modeling for Python
documentation</a></li>
<li><a class="reference external" href="https://developer.ibm.com/docloud/">Decision Optimization on
Cloud</a></li>
<li>Need help with DOcplex or to report a bug? Please go
<a class="reference external" href="https://developer.ibm.com/answers/smartspace/docloud">here</a>.</li>
<li>Contact us at <a class="reference external" href="mailto:dofeedback&#37;&#52;&#48;wwpdl&#46;vnet&#46;ibm&#46;com">dofeedback<span>&#64;</span>wwpdl<span>&#46;</span>vnet<span>&#46;</span>ibm<span>&#46;</span>com</a>.</li>
</ul>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="diet_pandas.html" title="diet_pandas.py"
             >next</a> |</li>
        <li class="right" >
          <a href="sports_scheduling.html" title="Use decision optimization to help a sports league schedule its games"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">DOcplex.MP: Mathematical Programming Modeling for Python V2.7 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="samples.html" >Examples of mathematical programming</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2016-2018, IBM&reg;.
    </div>
  </body>
</html>