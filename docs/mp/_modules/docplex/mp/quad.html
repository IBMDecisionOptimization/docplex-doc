

<!doctype html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
    <title>docplex.mp.quad &#8212; DOcplex.MP: Mathematical Programming Modeling for Python V2.18 documentation</title>
    <link rel="stylesheet" href="../../../_static/bizstyle.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../_static/language_data.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../../../_static/bizstyle.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <!--[if lt IE 9]>
    <script type="text/javascript" src="_static/css3-mediaqueries.js"></script>
    <![endif]-->
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">DOcplex.MP: Mathematical Programming Modeling for Python V2.18 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for docplex.mp.quad</h1><div class="highlight"><pre>
<span></span><span class="c1"># --------------------------------------------------------------------------</span>
<span class="c1"># Source file provided under Apache License, Version 2.0, January 2004,</span>
<span class="c1"># http://www.apache.org/licenses/</span>
<span class="c1"># (c) Copyright IBM Corp. 2015, 2016</span>
<span class="c1"># --------------------------------------------------------------------------</span>
<span class="kn">from</span> <span class="nn">six</span> <span class="k">import</span> <span class="n">iteritems</span> <span class="k">as</span> <span class="n">six_iteritems</span>

<span class="kn">from</span> <span class="nn">docplex.mp.compat23</span> <span class="k">import</span> <span class="n">unitext</span>
<span class="kn">from</span> <span class="nn">docplex.mp.constants</span> <span class="k">import</span> <span class="n">UpdateEvent</span>
<span class="kn">from</span> <span class="nn">docplex.mp.basic</span> <span class="k">import</span> <span class="n">_SubscriptionMixin</span>
<span class="kn">from</span> <span class="nn">docplex.mp.linear</span> <span class="k">import</span> <span class="n">Expr</span><span class="p">,</span> <span class="n">AbstractLinearExpr</span><span class="p">,</span> <span class="n">Var</span><span class="p">,</span> <span class="n">ZeroExpr</span>
<span class="kn">from</span> <span class="nn">docplex.mp.utils</span> <span class="k">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">docplex.mp.xcounter</span> <span class="k">import</span> <span class="n">update_dict_from_item_value</span>
<span class="kn">from</span> <span class="nn">docplex.mp.sttck</span> <span class="k">import</span> <span class="n">StaticTypeChecker</span>


<span class="k">def</span> <span class="nf">_compare_vars</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">):</span>
    <span class="n">v1i</span> <span class="o">=</span> <span class="n">v1</span><span class="o">.</span><span class="n">_index</span>
    <span class="n">v2i</span> <span class="o">=</span> <span class="n">v2</span><span class="o">.</span><span class="n">_index</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">v1i</span> <span class="o">&gt;</span> <span class="n">v2i</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">v2i</span> <span class="o">&gt;</span> <span class="n">v1i</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">VarPair</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;first&quot;</span><span class="p">,</span> <span class="s2">&quot;second&quot;</span><span class="p">,</span> <span class="s2">&quot;_cached_hash&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">v2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">first</span> <span class="o">=</span> <span class="n">v1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">second</span> <span class="o">=</span> <span class="n">v1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">_compare_vars</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">first</span> <span class="o">=</span> <span class="n">v1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">second</span> <span class="o">=</span> <span class="n">v2</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">first</span> <span class="o">=</span> <span class="n">v2</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">second</span> <span class="o">=</span> <span class="n">v1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cached_hash</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hash_pair</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">is_square</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">first</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">second</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="c1"># INTERNAL: necessary for use as dict keys</span>
        <span class="c1"># VarPair ensures variables are sorted by indices</span>
        <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">VarPair</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first</span> <span class="ow">is</span> <span class="n">other</span><span class="o">.</span><span class="n">first</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">second</span> <span class="ow">is</span> <span class="n">other</span><span class="o">.</span><span class="n">second</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_hash_pair</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nb">hash</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="nb">hash</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">second</span><span class="p">)</span>
        <span class="c1"># cantor encoding. must cast to int() for py3</span>
        <span class="n">self_hash</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(((</span><span class="n">f</span> <span class="o">+</span> <span class="n">s</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">s</span> <span class="o">+</span> <span class="n">f</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">s</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">self_hash</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="c1"># value -1 is reserved for errors</span>
            <span class="n">self_hash</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span>  <span class="c1"># pragma: no cover</span>
        <span class="k">return</span> <span class="n">self_hash</span>

    <span class="k">def</span> <span class="nf">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cached_hash</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;docplex.mp.quad.VarPair(first=</span><span class="si">{0!s}</span><span class="s2">,second=</span><span class="si">{1!s}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">second</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;VarPair(</span><span class="si">{0!s}</span><span class="s2">, </span><span class="si">{1!s}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">second</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="k">if</span> <span class="mi">0</span> <span class="o">==</span> <span class="n">item</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">first</span>
        <span class="k">elif</span> <span class="mi">1</span> <span class="o">==</span> <span class="n">item</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">second</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">StopIteration</span>

    <span class="k">def</span> <span class="nf">index_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">first</span><span class="o">.</span><span class="n">_index</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">second</span><span class="o">.</span><span class="n">_index</span>


<div class="viewcode-block" id="QuadExpr"><a class="viewcode-back" href="../../../docplex.mp.quad.html#docplex.mp.quad.QuadExpr">[docs]</a><span class="k">class</span> <span class="nc">QuadExpr</span><span class="p">(</span><span class="n">_SubscriptionMixin</span><span class="p">,</span> <span class="n">Expr</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;QuadExpr()</span>

<span class="sd">    This class models quadratic expressions.</span>
<span class="sd">    This class is not intended to be instantiated. Quadratic expressions are built</span>
<span class="sd">    either by using operators or by using :func:`docplex.mp.model.Model.quad_expr`.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_new_term_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">_lfactory</span><span class="o">.</span><span class="n">term_dict_type</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target_model</span><span class="p">,</span> <span class="n">var_mapping</span><span class="p">):</span>
        <span class="n">copied_quads</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_quadterms</span><span class="o">.</span><span class="vm">__class__</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">qv1</span><span class="p">,</span> <span class="n">qv2</span><span class="p">,</span> <span class="n">qk</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter_quad_triplets</span><span class="p">():</span>
            <span class="n">new_v1</span> <span class="o">=</span> <span class="n">var_mapping</span><span class="p">[</span><span class="n">qv1</span><span class="p">]</span>
            <span class="n">new_v2</span> <span class="o">=</span> <span class="n">var_mapping</span><span class="p">[</span><span class="n">qv2</span><span class="p">]</span>
            <span class="n">copied_quads</span><span class="p">[</span><span class="n">VarPair</span><span class="p">(</span><span class="n">new_v1</span><span class="p">,</span> <span class="n">new_v2</span><span class="p">)]</span> <span class="o">=</span> <span class="n">qk</span>

        <span class="n">copied_linear</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_linexpr</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">target_model</span><span class="p">,</span> <span class="n">var_mapping</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">QuadExpr</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">target_model</span><span class="p">,</span>
                        <span class="n">quads</span><span class="o">=</span><span class="n">copied_quads</span><span class="p">,</span>
                        <span class="n">linexpr</span><span class="o">=</span><span class="n">copied_linear</span><span class="p">,</span>
                        <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                        <span class="n">safe</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">relaxed_copy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">relaxed_model</span><span class="p">,</span> <span class="n">var_map</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">DocplexLinearRelaxationError</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cause</span><span class="o">=</span><span class="s1">&#39;quadratic&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="QuadExpr.is_quad_expr"><a class="viewcode-back" href="../../../docplex.mp.quad.html#docplex.mp.quad.QuadExpr.is_quad_expr">[docs]</a>    <span class="k">def</span> <span class="nf">is_quad_expr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="QuadExpr.has_quadratic_term"><a class="viewcode-back" href="../../../docplex.mp.quad.html#docplex.mp.quad.QuadExpr.has_quadratic_term">[docs]</a>    <span class="k">def</span> <span class="nf">has_quadratic_term</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns true if there is at least one quadratic term in the expression.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">any</span><span class="p">(</span><span class="n">qk</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">qk</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter_quads</span><span class="p">())</span></div>

    <span class="k">def</span> <span class="nf">square</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_quadratic_term</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fatal</span><span class="p">(</span><span class="s2">&quot;Cannot take the square of a quadratic term: </span><span class="si">{0!s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_linexpr</span><span class="o">.</span><span class="n">square</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_get_solution_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1"># INTERNAL</span>
        <span class="n">quad_value</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">qv0</span><span class="p">,</span> <span class="n">qv1</span><span class="p">,</span> <span class="n">qk</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter_quad_triplets</span><span class="p">():</span>
            <span class="n">quad_value</span> <span class="o">+=</span> <span class="n">qk</span> <span class="o">*</span> <span class="p">(</span><span class="n">qv0</span><span class="o">.</span><span class="n">_get_solution_value</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">*</span> <span class="n">qv1</span><span class="o">.</span><span class="n">_get_solution_value</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>
        <span class="n">lin_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_linexpr</span><span class="o">.</span><span class="n">_get_solution_value</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">quad_value</span> <span class="o">+</span> <span class="n">lin_value</span>

    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;_quadterms&#39;</span><span class="p">,</span> <span class="s1">&#39;_linexpr&#39;</span><span class="p">,</span> <span class="s1">&#39;_transient&#39;</span><span class="p">,</span> <span class="s1">&#39;_subscribers&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">quads</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">linexpr</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">safe</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">Expr</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_transient</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_subscribers</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># used by subscription mixin</span>
        <span class="k">if</span> <span class="n">quads</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_quadterms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_new_term_dict</span><span class="p">()</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">quads</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">safe</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_quadterms</span> <span class="o">=</span> <span class="n">quads</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># check</span>
                <span class="n">safe_quads</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_new_term_dict</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">qvp</span><span class="p">,</span> <span class="n">qk</span> <span class="ow">in</span> <span class="n">six_iteritems</span><span class="p">(</span><span class="n">quads</span><span class="p">):</span>
                    <span class="n">model</span><span class="o">.</span><span class="n">_typecheck_num</span><span class="p">(</span><span class="n">qk</span><span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">qvp</span><span class="p">,</span> <span class="n">VarPair</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">fatal</span><span class="p">(</span><span class="s2">&quot;Expecting variable-pair, got: </span><span class="si">{0!r}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">qvp</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">safe_quads</span><span class="p">[</span><span class="n">qvp</span><span class="p">]</span> <span class="o">=</span> <span class="n">qk</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_quadterms</span> <span class="o">=</span> <span class="n">safe_quads</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">quads</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">qk</span> <span class="o">=</span> <span class="n">quads</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">safe</span><span class="p">:</span>
                    <span class="n">model</span><span class="o">.</span><span class="n">_typecheck_var</span><span class="p">(</span><span class="n">v1</span><span class="p">)</span>
                    <span class="n">model</span><span class="o">.</span><span class="n">_typecheck_var</span><span class="p">(</span><span class="n">v2</span><span class="p">)</span>
                    <span class="n">model</span><span class="o">.</span><span class="n">_typecheck_num</span><span class="p">(</span><span class="n">qk</span><span class="p">,</span> <span class="s1">&#39;QuadExpr&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_quadterms</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">_lfactory</span><span class="o">.</span><span class="n">_new_term_dict</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_quadterms</span><span class="p">[</span><span class="n">VarPair</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">)]</span> <span class="o">=</span> <span class="n">qk</span>

            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>  <span class="c1"># pragma: no cover</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fatal</span><span class="p">(</span><span class="s2">&quot;QuadExpr accepts tuples of len: 3, got: </span><span class="si">{0!r}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">quads</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">is_iterable</span><span class="p">(</span><span class="n">quads</span><span class="p">):</span>
            <span class="n">qterms</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">_lfactory</span><span class="o">.</span><span class="n">term_dict_type</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">qv1</span><span class="p">,</span> <span class="n">qv2</span><span class="p">,</span> <span class="n">qk</span> <span class="ow">in</span> <span class="n">quads</span><span class="p">:</span>
                <span class="n">qterms</span><span class="p">[</span><span class="n">VarPair</span><span class="p">(</span><span class="n">qv1</span><span class="p">,</span> <span class="n">qv2</span><span class="p">)]</span> <span class="o">=</span> <span class="n">qk</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_quadterms</span> <span class="o">=</span> <span class="n">qterms</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fatal</span><span class="p">(</span><span class="s2">&quot;unexpected argument for QuadExpr: </span><span class="si">{0!r}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">quads</span><span class="p">)</span>  <span class="c1"># pragma: no cover</span>

        <span class="k">if</span> <span class="n">quads</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">_quad_count</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">linexpr</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_linexpr</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">_lfactory</span><span class="o">.</span><span class="n">linear_expr</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_linexpr</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">_lfactory</span><span class="o">.</span><span class="n">_to_linear_expr</span><span class="p">(</span><span class="n">linexpr</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">clone_if_necessary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1">#  INTERNAL</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transient</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">_keep_all_exprs</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_in_use</span><span class="p">():</span>
            <span class="k">return</span> <span class="bp">self</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">keep</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_transient</span> <span class="o">=</span> <span class="kc">False</span>

<div class="viewcode-block" id="QuadExpr.clone"><a class="viewcode-back" href="../../../docplex.mp.quad.html#docplex.mp.quad.QuadExpr.clone">[docs]</a>    <span class="k">def</span> <span class="nf">clone</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Makes a copy of the quadratic expression and returns it.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A quadratic expression.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cloned_linear</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_linexpr</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
        <span class="n">self_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
        <span class="n">cloned_name</span> <span class="o">=</span> <span class="n">self_name</span> <span class="k">if</span> <span class="n">self_name</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">self_name</span><span class="p">[:]</span>
        <span class="n">new_quad</span> <span class="o">=</span> <span class="n">QuadExpr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">quads</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_quadterms</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
                            <span class="n">linexpr</span><span class="o">=</span><span class="n">cloned_linear</span><span class="p">,</span>
                            <span class="n">name</span><span class="o">=</span><span class="n">cloned_name</span><span class="p">,</span> <span class="n">safe</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">new_quad</span></div>

    <span class="k">def</span> <span class="nf">is_discrete</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">qv0</span><span class="p">,</span> <span class="n">qv1</span><span class="p">,</span> <span class="n">qk</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter_quad_triplets</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">qv0</span><span class="o">.</span><span class="n">is_discrete</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">qv1</span><span class="o">.</span><span class="n">is_discrete</span><span class="p">()</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">is_int</span><span class="p">(</span><span class="n">qk</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_linexpr</span><span class="o">.</span><span class="n">is_discrete</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">generate_quad_triplets</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># INTERNAL</span>
        <span class="c1"># a generator that returns triplets (i.e. tuples of len 3)</span>
        <span class="c1"># with the variable pair and the coefficient</span>
        <span class="k">for</span> <span class="n">qvp</span><span class="p">,</span> <span class="n">qk</span> <span class="ow">in</span> <span class="n">six_iteritems</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_quadterms</span><span class="p">):</span>
            <span class="k">yield</span> <span class="n">qvp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">qvp</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">qk</span>

    <span class="k">def</span> <span class="nf">iter_quads</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">six_iteritems</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_quadterms</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">iter_sorted_quads</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_model_ordered</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">six_iteritems</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_quadterms</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iter_sorted_quads</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_iter_sorted_quads</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">quadterms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_quadterms</span>
        <span class="k">for</span> <span class="n">vp</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">quadterms</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">vvp</span><span class="p">:</span> <span class="n">vvp</span><span class="o">.</span><span class="n">index_tuple</span><span class="p">()):</span>
            <span class="k">yield</span> <span class="n">vp</span><span class="p">,</span> <span class="n">quadterms</span><span class="p">[</span><span class="n">vp</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">iter_opposite_ordered_quads</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># INTERNAL</span>
        <span class="k">for</span> <span class="n">qv</span><span class="p">,</span> <span class="n">qk</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter_sorted_quads</span><span class="p">():</span>
            <span class="k">yield</span> <span class="n">qv</span><span class="p">,</span> <span class="o">-</span><span class="n">qk</span>

<div class="viewcode-block" id="QuadExpr.iter_quad_triplets"><a class="viewcode-back" href="../../../docplex.mp.quad.html#docplex.mp.quad.QuadExpr.iter_quad_triplets">[docs]</a>    <span class="k">def</span> <span class="nf">iter_quad_triplets</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Iterates over quadratic terms.</span>

<span class="sd">        This iterator returns triplets of the form `v1,v2,k`, where `v1` and `v2` are decision</span>
<span class="sd">        variables and `k` is a number.</span>

<span class="sd">        Returns:</span>
<span class="sd">            An iterator object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_quad_triplets</span><span class="p">()</span></div>

<div class="viewcode-block" id="QuadExpr.iter_terms"><a class="viewcode-back" href="../../../docplex.mp.quad.html#docplex.mp.quad.QuadExpr.iter_terms">[docs]</a>    <span class="k">def</span> <span class="nf">iter_terms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Iterates over the linear terms in the quadratic expression.</span>

<span class="sd">        Equivalent to self.linear_part.iter_terms()</span>

<span class="sd">        Returns:</span>
<span class="sd">            An iterator over the (variable, coefficient) pairs in the linear part of the expression.</span>

<span class="sd">        Example:</span>
<span class="sd">            Calling this method on (x^2 +2x+1) will return one pair (x, 2).</span>

<span class="sd">        See Also:</span>
<span class="sd">            :function:`docplex.mp.linear.LinearExpr.iter_terms`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_linexpr</span><span class="o">.</span><span class="n">iter_terms</span><span class="p">()</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">number_of_quadratic_terms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; This property returns the number of quadratic terms.</span>

<span class="sd">        Counts both the square and product terms.</span>

<span class="sd">        Examples:</span>
<span class="sd">        </span>
<span class="sd">        .. code-block:: python</span>

<span class="sd">           q1 = x**2</span>
<span class="sd">           q1.number_of_quadratic_terms</span>
<span class="sd">           &gt;&gt;&gt; 1</span>
<span class="sd">           q2 = (x+y+1)**2</span>
<span class="sd">           q2.number_of_quadratic_terms</span>
<span class="sd">           &gt;&gt;&gt; 3</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_quadterms</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">size</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_of_quadratic_terms</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_linexpr</span><span class="o">.</span><span class="n">size</span>

<div class="viewcode-block" id="QuadExpr.is_separable"><a class="viewcode-back" href="../../../docplex.mp.quad.html#docplex.mp.quad.QuadExpr.is_separable">[docs]</a>    <span class="k">def</span> <span class="nf">is_separable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Checks if all quadratic terms are separable.</span>

<span class="sd">        Returns:</span>
<span class="sd">            True if all quadratic terms are separable.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">qv</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter_quads</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">qv</span><span class="o">.</span><span class="n">is_square</span><span class="p">():</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span></div>

    <span class="k">def</span> <span class="nf">compute_separable_convexity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sense</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="c1"># INTERNAL</span>
        <span class="c1"># returns 1 if separable, convex</span>
        <span class="c1"># returns -1 if separable non convex</span>
        <span class="c1"># return s0 if non separable</span>

        <span class="n">justifier</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">qv</span><span class="p">,</span> <span class="n">qk</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter_quads</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">qv</span><span class="o">.</span><span class="n">is_square</span><span class="p">():</span>
                <span class="k">return</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">None</span>  <span class="c1"># non separable: fast exit</span>
            <span class="k">elif</span> <span class="n">qk</span> <span class="o">*</span> <span class="n">sense</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">justifier</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">justifier</span> <span class="o">=</span> <span class="p">(</span><span class="n">qk</span><span class="p">,</span> <span class="n">qv</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>  <span class="c1"># separable, non convex, kept</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">justifier</span> <span class="ow">or</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>  <span class="c1"># (1, None) is for separable, convex</span>

<div class="viewcode-block" id="QuadExpr.get_quadratic_coefficient"><a class="viewcode-back" href="../../../docplex.mp.quad.html#docplex.mp.quad.QuadExpr.get_quadratic_coefficient">[docs]</a>    <span class="k">def</span> <span class="nf">get_quadratic_coefficient</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var1</span><span class="p">,</span> <span class="n">var2</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Returns the coefficient of a quadratic term in the expression.</span>

<span class="sd">        Returns the coefficient of the quadratic term `var1*var2` in the expression, if any.</span>
<span class="sd">        If the product is not present in the expression, returns 0.</span>

<span class="sd">        Args:</span>
<span class="sd">            var1: The first variable of the product (an instance of class Var)</span>
<span class="sd">            var2: the second variable of the product. If passed None, returns the coefficient</span>
<span class="sd">                of the square of `var1` in the expression.</span>

<span class="sd">        Example:</span>
<span class="sd">            Assuming `x` and `y` are decision variables and `q` is the expression `2*x**2 + 3*x*y + 5*y**2`, then</span>

<span class="sd">            `q.get_quadratic_coefficient(x)` returns 2</span>

<span class="sd">            `q.get_quadratic_coefficient(x, y)` returns 3</span>

<span class="sd">            `q.get_quadratic_coefficient(y)` returns 5</span>

<span class="sd">        Returns:</span>
<span class="sd">            The coefficient of one quadratic product term in the expression.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">_typecheck_var</span><span class="p">(</span><span class="n">var1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">var2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">var2</span> <span class="o">=</span> <span class="n">var1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">_typecheck_var</span><span class="p">(</span><span class="n">var2</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_quadratic_coefficient</span><span class="p">(</span><span class="n">var1</span><span class="p">,</span> <span class="n">var2</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_get_quadratic_coefficient</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var1</span><span class="p">,</span> <span class="n">var2</span><span class="p">):</span>
        <span class="c1"># INTERNAL, no checks</span>
        <span class="n">vp</span> <span class="o">=</span> <span class="n">VarPair</span><span class="p">(</span><span class="n">var1</span><span class="p">,</span> <span class="n">var2</span> <span class="ow">or</span> <span class="n">var1</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_quadratic_coefficient_from_var_pair</span><span class="p">(</span><span class="n">vp</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_quadratic_coefficient_from_var_pair</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vp</span><span class="p">):</span>
        <span class="c1"># INTERNAL</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_quadterms</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">vp</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_quadratic_coefficient</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var1</span><span class="p">,</span> <span class="n">var2</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">_typecheck_var</span><span class="p">(</span><span class="n">var1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">var2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">var2</span> <span class="o">=</span> <span class="n">var1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">_typecheck_var</span><span class="p">(</span><span class="n">var2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_quadratic_coefficient</span><span class="p">(</span><span class="n">var1</span><span class="p">,</span> <span class="n">var2</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_set_quadratic_coefficient</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var1</span><span class="p">,</span> <span class="n">var2</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
        <span class="n">vp</span> <span class="o">=</span> <span class="n">VarPair</span><span class="p">(</span><span class="n">var1</span><span class="p">,</span> <span class="n">var2</span> <span class="ow">or</span> <span class="n">var1</span><span class="p">)</span>
        <span class="n">event</span> <span class="o">=</span> <span class="n">UpdateEvent</span><span class="o">.</span><span class="n">QuadExprGlobal</span>
        <span class="n">self_quadterms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_quadterms</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">k</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">vp</span> <span class="ow">in</span> <span class="n">self_quadterms</span><span class="p">:</span>
                <span class="k">del</span> <span class="n">self_quadterms</span><span class="p">[</span><span class="n">vp</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">event</span> <span class="o">=</span> <span class="n">UpdateEvent</span><span class="o">.</span><span class="n">NoOp</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">self_quadterms</span><span class="p">[</span><span class="n">vp</span><span class="p">]</span> <span class="o">=</span> <span class="n">k</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">notify_modified</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>

    <span class="c1"># ---</span>
    <span class="k">def</span> <span class="nf">equals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">QuadExpr</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_of_quadratic_terms</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">number_of_quadratic_terms</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">for</span> <span class="n">qvp</span><span class="p">,</span> <span class="n">qk</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter_quads</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">other</span><span class="o">.</span><span class="n">_get_quadratic_coefficient_from_var_pair</span><span class="p">(</span><span class="n">qvp</span><span class="p">)</span> <span class="o">!=</span> <span class="n">qk</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_linexpr</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">_linexpr</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">is_constant</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_quadratic_term</span><span class="p">()</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_linexpr</span><span class="o">.</span><span class="n">is_constant</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">get_constant</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_linexpr</span><span class="o">.</span><span class="n">constant</span>

    <span class="k">def</span> <span class="nf">set_constant</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num</span><span class="p">):</span>
        <span class="n">linexpr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_linexpr</span>
        <span class="n">event</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">num</span> <span class="o">!=</span> <span class="n">linexpr</span><span class="o">.</span><span class="n">get_constant</span><span class="p">():</span>
            <span class="n">linexpr</span><span class="o">.</span><span class="n">_constant</span> <span class="o">=</span> <span class="n">num</span>
            <span class="n">event</span> <span class="o">=</span> <span class="n">UpdateEvent</span><span class="o">.</span><span class="n">ExprConstant</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">notify_modified</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">constant</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This property is used to get or set the constant part of a quadratic expression</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_constant</span><span class="p">()</span>

    <span class="nd">@constant</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">constant</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_cst</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_constant</span><span class="p">(</span><span class="n">new_cst</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">linear_part</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; This property returns the linear part of a quadratic expression.</span>

<span class="sd">        For example, the linear part of x^2 +2x+1 is (2x+1)</span>

<span class="sd">        :return: an instance of :class:`docplex.mp.LinearExpr`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_linear_part</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">get_linear_part</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">linexpr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_linexpr</span>
        <span class="k">return</span> <span class="n">linexpr</span> <span class="k">if</span> <span class="n">linexpr</span> <span class="k">else</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">iter_variables</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">qvp</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter_quads</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">qvp</span><span class="o">.</span><span class="n">is_square</span><span class="p">():</span>
                <span class="k">yield</span> <span class="n">qvp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">qvp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">yield</span> <span class="n">qvp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">linexpr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_linexpr</span>
        <span class="k">for</span> <span class="n">lv</span> <span class="ow">in</span> <span class="n">linexpr</span><span class="o">.</span><span class="n">iter_variables</span><span class="p">():</span>
            <span class="k">yield</span> <span class="n">lv</span>

    <span class="k">def</span> <span class="nf">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dvar</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">contains_var</span><span class="p">(</span><span class="n">dvar</span><span class="p">)</span>

<div class="viewcode-block" id="QuadExpr.contains_var"><a class="viewcode-back" href="../../../docplex.mp.quad.html#docplex.mp.quad.QuadExpr.contains_var">[docs]</a>    <span class="k">def</span> <span class="nf">contains_var</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dvar</span><span class="p">):</span>
        <span class="c1"># required by tests...</span>
        <span class="k">for</span> <span class="n">qv</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter_variables</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">qv</span> <span class="ow">is</span> <span class="n">dvar</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span></div>

    <span class="k">def</span> <span class="nf">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># INTERNAL: this is necessary to prevent expr from being an iterable.</span>
        <span class="c1"># as it follows getitem protocol, it can mistakenly be interpreted as an iterable</span>
        <span class="c1"># but this would make sum loop forever.</span>
        <span class="k">raise</span> <span class="ne">TypeError</span>  <span class="c1"># pragma: no cover</span>

    <span class="k">def</span> <span class="nf">contains_quad</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qv</span><span class="p">):</span>
        <span class="c1"># INTERNAL</span>
        <span class="k">return</span> <span class="n">qv</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_quadterms</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;docplex.mp.quad.QuadExpr(</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">truncated_str</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">to_stringio</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">oss</span><span class="p">,</span> <span class="n">nb_digits</span><span class="p">,</span> <span class="n">use_space</span><span class="p">,</span> <span class="n">var_namer</span><span class="o">=</span><span class="k">lambda</span> <span class="n">v</span><span class="p">:</span> <span class="n">v</span><span class="o">.</span><span class="n">lp_name</span><span class="p">):</span>
        <span class="n">q</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># noinspection PyPep8Naming</span>
        <span class="n">SP</span> <span class="o">=</span> <span class="sa">u</span><span class="s1">&#39; &#39;</span>
        <span class="k">for</span> <span class="n">qvp</span><span class="p">,</span> <span class="n">qk</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter_sorted_quads</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">qk</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">qv1</span> <span class="o">=</span> <span class="n">qvp</span><span class="o">.</span><span class="n">first</span>
            <span class="n">qv2</span> <span class="o">=</span> <span class="n">qvp</span><span class="o">.</span><span class="n">second</span>
            <span class="c1"># ---</span>
            <span class="c1"># sign is printed if  non-first OR negative</span>
            <span class="c1"># at the end of this block coeff is positive</span>
            <span class="k">if</span> <span class="n">qk</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">q</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;-&#39;</span> <span class="k">if</span> <span class="n">qk</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="sa">u</span><span class="s1">&#39;+&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">qk</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">qk</span> <span class="o">=</span> <span class="o">-</span><span class="n">qk</span>
                <span class="k">if</span> <span class="n">use_space</span> <span class="ow">and</span> <span class="n">q</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">SP</span><span class="p">)</span>

            <span class="c1"># write coeff if &lt;&gt; 1</span>
            <span class="n">varname1</span> <span class="o">=</span> <span class="n">var_namer</span><span class="p">(</span><span class="n">qv1</span><span class="p">)</span>
            <span class="k">if</span> <span class="mi">1</span> <span class="o">!=</span> <span class="n">qk</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_num_to_stringio</span><span class="p">(</span><span class="n">oss</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="n">qk</span><span class="p">,</span> <span class="n">ndigits</span><span class="o">=</span><span class="n">nb_digits</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">use_space</span><span class="p">:</span>
                    <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">SP</span><span class="p">)</span>

            <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">unitext</span><span class="p">(</span><span class="n">varname1</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">qv1</span> <span class="ow">is</span> <span class="n">qv2</span><span class="p">:</span>
                <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">u</span><span class="s2">&quot;^2&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">use_space</span><span class="p">:</span>
                    <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">SP</span><span class="p">)</span>
                    <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;*&#39;</span><span class="p">)</span>
                    <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">SP</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;*&#39;</span><span class="p">)</span>
                <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">unitext</span><span class="p">(</span><span class="n">var_namer</span><span class="p">(</span><span class="n">qv2</span><span class="p">)))</span>
            <span class="n">q</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="c1"># problem for linexpr: force &#39;+&#39; ssi c&gt;0</span>
        <span class="n">linexpr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_linexpr</span>
        <span class="n">lin_constant</span> <span class="o">=</span> <span class="n">linexpr</span><span class="o">.</span><span class="n">get_constant</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">linexpr</span><span class="p">:</span>
            <span class="n">first_lk</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">lv</span><span class="p">,</span> <span class="n">lk</span> <span class="ow">in</span> <span class="n">linexpr</span><span class="o">.</span><span class="n">iter_terms</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">lk</span><span class="p">:</span>
                    <span class="n">first_lk</span> <span class="o">=</span> <span class="n">lk</span>
                    <span class="k">break</span>
            <span class="k">if</span> <span class="n">q</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">first_lk</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">use_space</span><span class="p">:</span>
                    <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
                <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">u</span><span class="s2">&quot;+&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">first_lk</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">use_space</span><span class="p">:</span>
                    <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">SP</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_linexpr</span><span class="o">.</span><span class="n">to_stringio</span><span class="p">(</span><span class="n">oss</span><span class="p">,</span> <span class="n">nb_digits</span><span class="p">,</span> <span class="n">use_space</span><span class="p">,</span> <span class="n">var_namer</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">lin_constant</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_num_to_stringio</span><span class="p">(</span><span class="n">oss</span><span class="p">,</span> <span class="n">lin_constant</span><span class="p">,</span> <span class="n">nb_digits</span><span class="p">,</span> <span class="n">print_sign</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">force_plus</span><span class="o">=</span><span class="n">q</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>
                                      <span class="n">use_space</span><span class="o">=</span><span class="n">use_space</span><span class="p">)</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="n">q</span><span class="p">:</span>
                <span class="n">oss</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;0&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">plus</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="n">cloned</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clone_if_necessary</span><span class="p">()</span>
        <span class="n">cloned</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cloned</span>

    <span class="k">def</span> <span class="nf">minus</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="n">cloned</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clone_if_necessary</span><span class="p">()</span>
        <span class="n">cloned</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cloned</span>

    <span class="k">def</span> <span class="nf">rminus</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="c1"># other - self</span>
        <span class="n">cloned</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
        <span class="n">cloned</span><span class="o">.</span><span class="n">negate</span><span class="p">()</span>
        <span class="n">cloned</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cloned</span>

    <span class="k">def</span> <span class="nf">times</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">is_number</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="ow">and</span> <span class="mi">0</span> <span class="o">==</span> <span class="n">other</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">zero_expr</span><span class="p">()</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">ZeroExpr</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">other</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_constant</span><span class="p">():</span>
            <span class="n">k</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">constant</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">k</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">zero_expr</span><span class="p">()</span>
            <span class="k">elif</span> <span class="mi">1</span> <span class="o">==</span> <span class="n">k</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">_lfactory</span><span class="o">.</span><span class="n">_to_linear_expr</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">other</span> <span class="o">*</span> <span class="n">k</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cloned</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
            <span class="n">cloned</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">cloned</span>

    <span class="k">def</span> <span class="nf">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">plus</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__iadd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">__radd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">plus</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">minus</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__rsub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="c1"># e - self</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rsubtract</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__isub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">times</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__rmul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">times</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__imul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="c1"># self is modified</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__div__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">quotient</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__idiv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">check</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">__truediv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">quotient</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>  <span class="c1"># pragma: no cover</span>

    <span class="k">def</span> <span class="nf">__itruediv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="c1"># this is for Python 3.z</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>  <span class="c1"># pragma: no cover</span>

    <span class="k">def</span> <span class="nf">__neg__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">cloned</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
        <span class="n">cloned</span><span class="o">.</span><span class="n">negate</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">cloned</span>

    <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="c1"># increment the QuadExpr with some other argument</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">QuadExpr</span><span class="p">):</span>
            <span class="n">event</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_quad</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_linexpr</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
            <span class="n">event</span> <span class="o">=</span> <span class="n">UpdateEvent</span><span class="o">.</span><span class="n">LinExprGlobal</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">notify_modified</span><span class="p">(</span><span class="n">event</span><span class="o">=</span><span class="n">event</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">rsubtract</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="c1"># to compute (other - self) we copy self, negate the copy and add other</span>
        <span class="c1"># result is always cloned even if other is zero (optimization possible here)</span>
        <span class="n">cloned</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
        <span class="n">cloned</span><span class="o">.</span><span class="n">negate</span><span class="p">()</span>
        <span class="n">cloned</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cloned</span>

    <span class="k">def</span> <span class="nf">subtract</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">QuadExpr</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_subtract_quad</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
            <span class="n">event</span> <span class="o">=</span> <span class="n">UpdateEvent</span><span class="o">.</span><span class="n">QuadExprGlobal</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_linexpr</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
            <span class="n">event</span> <span class="o">=</span> <span class="n">UpdateEvent</span><span class="o">.</span><span class="n">LinExprGlobal</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">notify_modified</span><span class="p">(</span><span class="n">event</span><span class="o">=</span><span class="n">event</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">negate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># INTERNAL: negate sall coefficients, modify self</span>
        <span class="n">qterms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_quadterms</span>
        <span class="k">for</span> <span class="n">qvp</span><span class="p">,</span> <span class="n">qk</span> <span class="ow">in</span> <span class="n">six_iteritems</span><span class="p">(</span><span class="n">qterms</span><span class="p">):</span>
            <span class="n">qterms</span><span class="p">[</span><span class="n">qvp</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">qk</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_linexpr</span><span class="o">.</span><span class="n">negate</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">notify_modified</span><span class="p">(</span><span class="n">event</span><span class="o">=</span><span class="n">UpdateEvent</span><span class="o">.</span><span class="n">QuadExprGlobal</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">multiply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="n">event</span> <span class="o">=</span> <span class="n">UpdateEvent</span><span class="o">.</span><span class="n">QuadExprGlobal</span>
        <span class="k">if</span> <span class="n">is_number</span><span class="p">(</span><span class="n">other</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_scale</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_constant</span><span class="p">():</span>
            <span class="n">this_constant</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_linexpr</span><span class="o">.</span><span class="n">get_constant</span><span class="p">()</span>
            <span class="k">if</span> <span class="mi">0</span> <span class="o">==</span> <span class="n">this_constant</span><span class="p">:</span>
                <span class="c1"># do nothing</span>
                <span class="n">event</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_assign_scaled</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">this_constant</span><span class="p">)</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_quadratic_term</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">other</span><span class="o">.</span><span class="n">is_constant</span><span class="p">():</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">get_constant</span><span class="p">())</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">StaticTypeChecker</span><span class="o">.</span><span class="n">mul_quad_lin_error</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># self is actually a linear expression</span>
            <span class="k">if</span> <span class="n">is_quad_expr</span><span class="p">(</span><span class="n">other</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">other</span><span class="o">.</span><span class="n">has_quadratic_term</span><span class="p">():</span>
                    <span class="n">StaticTypeChecker</span><span class="o">.</span><span class="n">mul_quad_lin_error</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">_linexpr</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">other_linexpr</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">to_linear_expr</span><span class="p">()</span>
                <span class="n">self_linexpr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_linexpr</span>
                <span class="k">for</span> <span class="n">v1</span><span class="p">,</span> <span class="n">k1</span> <span class="ow">in</span> <span class="n">self_linexpr</span><span class="o">.</span><span class="n">iter_terms</span><span class="p">():</span>
                    <span class="k">for</span> <span class="n">v2</span><span class="p">,</span> <span class="n">k2</span> <span class="ow">in</span> <span class="n">other_linexpr</span><span class="o">.</span><span class="n">iter_terms</span><span class="p">():</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_add_one_quad_term</span><span class="p">(</span><span class="n">VarPair</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">),</span> <span class="n">k1</span> <span class="o">*</span> <span class="n">k2</span><span class="p">)</span>
                <span class="n">other_cst</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">get_constant</span><span class="p">()</span>
                <span class="n">self_cst</span> <span class="o">=</span> <span class="n">self_linexpr</span><span class="o">.</span><span class="n">get_constant</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">other_cst</span><span class="p">:</span>
                    <span class="n">self_linexpr</span><span class="o">.</span><span class="n">_scale</span><span class="p">(</span><span class="n">other_cst</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">self_cst</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">ov</span><span class="p">,</span> <span class="n">ok</span> <span class="ow">in</span> <span class="n">other</span><span class="o">.</span><span class="n">iter_terms</span><span class="p">():</span>
                        <span class="n">self_linexpr</span><span class="o">.</span><span class="n">_add_term</span><span class="p">(</span><span class="n">ov</span><span class="p">,</span> <span class="n">ok</span> <span class="o">*</span> <span class="n">self_cst</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">notify_modified</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">quotient</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">_typecheck_as_denominator</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="n">cloned</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
        <span class="n">cloned</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">check</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cloned</span>

    <span class="k">def</span> <span class="nf">divide</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">check</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">check</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">_typecheck_as_denominator</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>  <span class="c1"># only a nonzero number is allowed...</span>
        <span class="n">inverse</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">other</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scale</span><span class="p">(</span><span class="n">inverse</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">notify_modified</span><span class="p">(</span><span class="n">event</span><span class="o">=</span><span class="n">UpdateEvent</span><span class="o">.</span><span class="n">QuadExprGlobal</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">_scale</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">factor</span><span class="p">):</span>
        <span class="c1"># INTERNAL: scales a quad expr from a numeric constant.</span>
        <span class="c1"># no checks done!</span>
        <span class="c1"># this method modifies self.</span>
        <span class="k">if</span> <span class="mi">0</span> <span class="o">==</span> <span class="n">factor</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="k">elif</span> <span class="mi">1</span> <span class="o">==</span> <span class="n">factor</span><span class="p">:</span>
            <span class="c1"># nothing to do</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># scale quads</span>
            <span class="n">self_quadterms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_quadterms</span>
            <span class="k">for</span> <span class="n">qv</span><span class="p">,</span> <span class="n">qk</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter_quads</span><span class="p">():</span>
                <span class="n">self_quadterms</span><span class="p">[</span><span class="n">qv</span><span class="p">]</span> <span class="o">=</span> <span class="n">factor</span> <span class="o">*</span> <span class="n">qk</span>
            <span class="c1"># scale linear part</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_linexpr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_linexpr</span><span class="o">.</span><span class="n">_scale</span><span class="p">(</span><span class="n">factor</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_assign_scaled</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">factor</span><span class="p">):</span>
        <span class="c1"># INTERNAL</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="p">(</span><span class="n">AbstractLinearExpr</span><span class="p">,</span> <span class="n">Var</span><span class="p">)):</span>
            <span class="n">scaled</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">_lfactory</span><span class="o">.</span><span class="n">_to_linear_expr</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">force_clone</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">scaled</span> <span class="o">*=</span> <span class="n">factor</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_linexpr</span> <span class="o">=</span> <span class="n">scaled</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">QuadExpr</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">qv</span><span class="p">,</span> <span class="n">qk</span> <span class="ow">in</span> <span class="n">other</span><span class="o">.</span><span class="n">iter_quads</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_add_one_quad_term</span><span class="p">(</span><span class="n">qv</span><span class="p">,</span> <span class="n">qk</span> <span class="o">*</span> <span class="n">factor</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_assign_scaled</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">linear_part</span><span class="p">,</span> <span class="n">factor</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">_add_one_quad_term</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qv</span><span class="p">,</span> <span class="n">qk</span><span class="p">):</span>
        <span class="n">qterms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_quadterms</span>
        <span class="k">if</span> <span class="n">qk</span> <span class="ow">or</span> <span class="n">qv</span> <span class="ow">in</span> <span class="n">qterms</span><span class="p">:</span>
            <span class="n">qterms</span><span class="p">[</span><span class="n">qv</span><span class="p">]</span> <span class="o">=</span> <span class="n">qterms</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">qv</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="n">qk</span>

    <span class="k">def</span> <span class="nf">normalize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>  <span class="c1"># pragma: no cover</span>
        <span class="c1"># INTERNAL</span>
        <span class="n">quadterms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_quadterms</span>
        <span class="k">if</span> <span class="n">quadterms</span><span class="p">:</span>
            <span class="n">to_remove</span> <span class="o">=</span> <span class="p">[</span><span class="n">qvp</span> <span class="k">for</span> <span class="n">qvp</span><span class="p">,</span> <span class="n">qk</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter_quads</span><span class="p">()</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">qk</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">rvp</span> <span class="ow">in</span> <span class="n">to_remove</span><span class="p">:</span>
                <span class="k">del</span> <span class="n">quadterms</span><span class="p">[</span><span class="n">rvp</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_linexpr</span><span class="o">.</span><span class="n">normalize</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_quadterms</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_linexpr</span><span class="o">.</span><span class="n">_clear</span><span class="p">()</span>

    <span class="c1"># quad-specific</span>
    <span class="k">def</span> <span class="nf">_add_quad</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other_quad</span><span class="p">):</span>
        <span class="c1"># add quad part</span>
        <span class="k">for</span> <span class="n">oqv</span><span class="p">,</span> <span class="n">oqk</span> <span class="ow">in</span> <span class="n">other_quad</span><span class="o">.</span><span class="n">iter_quads</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_add_one_quad_term</span><span class="p">(</span><span class="n">oqv</span><span class="p">,</span> <span class="n">oqk</span><span class="p">)</span>
        <span class="c1"># add linear part</span>
        <span class="k">if</span> <span class="n">other_quad</span><span class="o">.</span><span class="n">_linexpr</span><span class="o">.</span><span class="n">is_zero</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">UpdateEvent</span><span class="o">.</span><span class="n">QuadExprQuadCoef</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_linexpr</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">other_quad</span><span class="o">.</span><span class="n">_linexpr</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">UpdateEvent</span><span class="o">.</span><span class="n">QuadExprGlobal</span>

    <span class="k">def</span> <span class="nf">_subtract_quad</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other_quad</span><span class="p">):</span>
        <span class="c1"># subtract quad</span>
        <span class="n">quadterms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_quadterms</span>
        <span class="k">for</span> <span class="n">oqv</span><span class="p">,</span> <span class="n">oqk</span> <span class="ow">in</span> <span class="n">other_quad</span><span class="o">.</span><span class="n">iter_quads</span><span class="p">():</span>
            <span class="n">update_dict_from_item_value</span><span class="p">(</span><span class="n">quadterms</span><span class="p">,</span> <span class="n">oqv</span><span class="p">,</span> <span class="o">-</span><span class="n">oqk</span><span class="p">)</span>
        <span class="c1"># subtract linear part</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_linexpr</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="n">other_quad</span><span class="o">.</span><span class="n">_linexpr</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">to_linear_expr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>  <span class="c1"># pragma: no cover</span>
        <span class="c1"># used_msg = msg or &quot;Quadratic expression [{0!s}] cannot be converted to a linear expression&quot;</span>
        <span class="c1"># self.fatal(used_msg, self)</span>
        <span class="k">raise</span> <span class="n">DocplexQuadToLinearException</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">is_normalized</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>  <span class="c1"># pragma: no cover</span>
        <span class="c1"># INTERNAL</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">qk</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter_quads</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">qk</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>  <span class="c1"># pragma: no cover</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>

    <span class="c1"># --- relational operators</span>
    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">_qfactory</span><span class="o">.</span><span class="n">new_eq_constraint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__le__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">_qfactory</span><span class="o">.</span><span class="n">new_le_constraint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__ge__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">_qfactory</span><span class="o">.</span><span class="n">new_ge_constraint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">fatal</span><span class="p">(</span><span class="s2">&quot;Operator `!=` is not supported for quadratic expressions, </span><span class="si">{0!s}</span><span class="s2"> was passed&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">notify_expr_modified</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">expr</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">_linexpr</span><span class="p">:</span>
            <span class="c1"># something to do..</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">notify_modified</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="p">)</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">DOcplex.MP: Mathematical Programming Modeling for Python V2.18 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2016-2019, IBM&reg;.
    </div>
  </body>
</html>