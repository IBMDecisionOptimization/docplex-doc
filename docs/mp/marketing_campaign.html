

<!doctype html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
    
    <title>How to make targeted offers to customers? &#8212; DOcplex.MP: Mathematical Programming Modeling for Python V2.3 documentation</title>
    
    <link rel="stylesheet" href="_static/bizstyle.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     'V2.3',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  false,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="_static/bizstyle.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <!--[if lt IE 9]>
    <script type="text/javascript" src="_static/css3-mediaqueries.js"></script>
    <![endif]-->
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">DOcplex.MP: Mathematical Programming Modeling for Python V2.3 documentation</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">How to make targeted offers to customers?</a><ul>
<li><a class="reference internal" href="#describe-the-business-problem">Describe the business problem</a></li>
<li><a class="reference internal" href="#how-decision-optimization-can-help">How decision optimization can help</a></li>
<li><a class="reference internal" href="#prepare-the-data">Prepare the data</a><ul>
<li><a class="reference internal" href="#step-1-model-the-data">Step 1 : Model the data</a></li>
</ul>
</li>
<li><a class="reference internal" href="#use-ibm-decision-optimization-cplex-modeling-for-python">Use IBM Decision Optimization CPLEX Modeling for Python</a><ul>
<li><a class="reference internal" href="#step-1-download-the-library">Step 1: Download the library</a></li>
<li><a class="reference internal" href="#step-2-set-up-the-prescriptive-engine">Step 2: Set up the prescriptive engine</a></li>
<li><a class="reference internal" href="#step-3-set-up-the-prescriptive-model">Step 3: Set up the prescriptive model</a><ul>
<li><a class="reference internal" href="#create-the-model">Create the model</a></li>
<li><a class="reference internal" href="#define-the-decision-variables">Define the decision variables</a></li>
<li><a class="reference internal" href="#set-up-the-constraints">Set up the constraints</a></li>
<li><a class="reference internal" href="#express-the-objective">Express the objective</a></li>
<li><a class="reference internal" href="#solve-with-the-decision-optimization-solve-service">Solve with the Decision Optimization solve service</a></li>
</ul>
</li>
<li><a class="reference internal" href="#step-4-analyze-the-solution">Step 4: Analyze the solution</a></li>
</ul>
</li>
<li><a class="reference internal" href="#summary">Summary</a></li>
<li><a class="reference internal" href="#references">References</a></li>
</ul>
</li>
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="how-to-make-targeted-offers-to-customers">
<h1>How to make targeted offers to customers?<a class="headerlink" href="#how-to-make-targeted-offers-to-customers" title="Permalink to this headline">&para;</a></h1>
<p>This tutorial includes everything you need to set up IBM Decision
Optimization CPLEX Modeling for Python (DOcplex), build a Mathematical
Programming model, and get its solution by solving the model on the
cloud with IBM ILOG CPLEX Optimizer.</p>
<p>When you finish this tutorial, you&#8217;ll have a foundational knowledge of
<em>Prescriptive Analytics</em>.</p>
<blockquote>
<div><p>This notebook is part of the <a class="reference external" href="https://rawgit.com/IBMDecisionOptimization/docplex-doc/master/docs/index.html">Prescriptive Analytics for
Python</a>.</p>
<p>It requires a valid subscription to <strong>Decision Optimization on
Cloud</strong>. Try it for free
<a class="reference external" href="https://developer.ibm.com/docloud">here</a>.</p>
</div></blockquote>
<p>Table of contents:</p>
<ul class="simple">
<li><a class="reference internal" href="#describe-the-business-problem">Describe the business problem</a></li>
<li><a class="reference internal" href="#how-decision-optimization-can-help">How decision optimization can help</a></li>
<li><a class="reference internal" href="#prepare-the-data">Prepare the data</a></li>
<li><a class="reference internal" href="#use-ibm-decision-optimization-cplex-modeling-for-python">Use IBM Decision Optimization CPLEX Modeling for Python</a><ul>
<li><a class="reference internal" href="#step-1-download-the-library">Step 1: Download the library</a></li>
<li><a class="reference internal" href="#step-2-set-up-the-prescriptive-engine">Step 2: Set up the prescriptive engine</a></li>
<li><a class="reference internal" href="#step-3-set-up-the-prescriptive-model">Step 3: Set up the prescriptive model</a><ul>
<li><a class="reference internal" href="#define-the-decision-variables">Define the decision variables</a></li>
<li><a class="reference internal" href="#set-up-the-constraints">Set up the constraints</a></li>
<li><a class="reference internal" href="#express-the-objective">Express the objective</a></li>
<li><a class="reference internal" href="#solve-with-the-decision-optimization-solve-service">Solve with the Decision Optimization solve service</a></li>
</ul>
</li>
<li><a class="reference internal" href="#step-4-analyze-the-solution">Step 4: Analyze the solution</a></li>
</ul>
</li>
</ul>
<div class="section" id="describe-the-business-problem">
<h2>Describe the business problem<a class="headerlink" href="#describe-the-business-problem" title="Permalink to this headline">&para;</a></h2>
<ul class="simple">
<li>The Self-Learning Response Model (SLRM) node enables you to build a
model that you can continually update. Such updates are useful in
building a model that assists with predicting which offers are most
appropriate for customers and the probability of the offers being
accepted. These sorts of models are most beneficial in customer
relationship management, such as marketing applications or call
centers.</li>
<li>This example is based on a fictional banking company.</li>
<li>The marketing department wants to achieve more profitable results in
future campaigns by matching the right offer of financial services to
each customer.</li>
<li>Specifically, the example uses a Self-Learning Response Model to
identify the characteristics of customers who are most likely to
respond favorably based on previous offers and responses and to
promote the best current offer based on the results.</li>
</ul>
<p>A set of business constraints have to be respected:</p>
<ul class="simple">
<li>We have a limited budget to run a marketing campaign based on
&#8220;gifts&#8221;, &#8220;newsletter&#8221;, &#8220;seminar&#8221;...</li>
<li>We want to determine which is the best way to contact the customers.</li>
<li>We need to identify which customers to contact.</li>
</ul>
</div>
<div class="section" id="how-decision-optimization-can-help">
<h2>How decision optimization can help<a class="headerlink" href="#how-decision-optimization-can-help" title="Permalink to this headline">&para;</a></h2>
<ul>
<li><p class="first">Prescriptive analytics technology recommends actions based on desired
outcomes, taking into account specific scenarios, resources, and
knowledge of past and current events. This insight can help your
organization make better decisions and have greater control of
business outcomes.</p>
</li>
<li><p class="first">Prescriptive analytics is the next step on the path to insight-based
actions. It creates value through synergy with predictive analytics,
which analyzes data to predict future outcomes.</p>
</li>
<li><div class="first line-block">
<div class="line">Prescriptive analytics takes that insight to the next level by
suggesting the optimal way to handle that future situation.
Organizations that can act fast in dynamic conditions and make
superior decisions in uncertain environments gain a strong
competitive advantage.</div>
<div class="line"><br /></div>
</div>
</li>
<li><p class="first">For example:</p>
<ul class="simple">
<li>Automate complex decisions and trade-offs to better manage limited
resources.</li>
<li>Take advantage of a future opportunity or mitigate a future risk.</li>
<li>Proactively update recommendations based on changing events.</li>
<li>Meet operational goals, increase customer loyalty, prevent threats
and fraud, and optimize business processes.</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="prepare-the-data">
<h2>Prepare the data<a class="headerlink" href="#prepare-the-data" title="Permalink to this headline">&para;</a></h2>
<div class="section" id="step-1-model-the-data">
<h3>Step 1 : Model the data<a class="headerlink" href="#step-1-model-the-data" title="Permalink to this headline">&para;</a></h3>
<p>The predictions show which offers a customer is most likely to accept,
and the confidence that they will accept, depending on each customer&#8217;s
details.</p>
<p>For example: (139987, &#8220;Pension&#8221;, 0.13221, &#8220;Mortgage&#8221;, 0.10675) indicates
that customer Id=139987 will certainly not buy a <em>Pension</em> as the level
is only 13.2%, whereas (140030, &#8220;Savings&#8221;, 0.95678, &#8220;Pension&#8221;, 0.84446)
is more than likely to buy <em>Savings</em> and a <em>Pension</em> as the rates are
95.7% and 84.4%.</p>
<p>This data is taken from a SPSS example, except that the names of the
customers were modified.</p>
<p>A Python data analysis library, <a class="reference external" href="http://pandas.pydata.org">pandas</a>,
is used to store the data. Let&#8217;s set up and declare the data.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">names</span> <span class="o">=</span> <span class="p">{</span>
    <span class="mi">139987</span> <span class="p">:</span> <span class="s2">&quot;HokaOneOne&quot;</span><span class="p">,</span> <span class="mi">140030</span> <span class="p">:</span> <span class="s2">&quot;Salomon&quot;</span><span class="p">,</span> <span class="mi">140089</span> <span class="p">:</span> <span class="s2">&quot;Altra&quot;</span><span class="p">,</span> <span class="mi">140097</span> <span class="p">:</span> <span class="s2">&quot;Nike&quot;</span><span class="p">,</span> <span class="mi">139068</span> <span class="p">:</span> <span class="s2">&quot;Mizuno&quot;</span><span class="p">,</span> <span class="mi">139154</span> <span class="p">:</span> <span class="s2">&quot;Asics&quot;</span><span class="p">,</span> <span class="mi">139158</span> <span class="p">:</span> <span class="s2">&quot;Quechua&quot;</span><span class="p">,</span> <span class="mi">139169</span> <span class="p">:</span> <span class="s2">&quot;Adidas&quot;</span><span class="p">,</span> <span class="mi">139220</span> <span class="p">:</span> <span class="s2">&quot;Brooks&quot;</span><span class="p">,</span> <span class="mi">139261</span> <span class="p">:</span> <span class="s2">&quot;WAA&quot;</span><span class="p">,</span>
    <span class="mi">139416</span> <span class="p">:</span> <span class="s2">&quot;NorthFace&quot;</span><span class="p">,</span> <span class="mi">139422</span> <span class="p">:</span> <span class="s2">&quot;Polar&quot;</span><span class="p">,</span> <span class="mi">139532</span> <span class="p">:</span> <span class="s2">&quot;Garmin&quot;</span><span class="p">,</span> <span class="mi">139549</span> <span class="p">:</span> <span class="s2">&quot;High5&quot;</span><span class="p">,</span> <span class="mi">139560</span> <span class="p">:</span> <span class="s2">&quot;Helly Hansen&quot;</span><span class="p">,</span> <span class="mi">139577</span> <span class="p">:</span> <span class="s2">&quot;Moutain Hardware&quot;</span><span class="p">,</span> <span class="mi">139580</span> <span class="p">:</span> <span class="s2">&quot;Saucony&quot;</span><span class="p">,</span> <span class="mi">139636</span> <span class="p">:</span> <span class="s2">&quot;Gore Running Wear&quot;</span><span class="p">,</span> <span class="mi">139647</span> <span class="p">:</span> <span class="s2">&quot;Under Armour&quot;</span><span class="p">,</span>
    <span class="mi">139649</span> <span class="p">:</span> <span class="s2">&quot;Saucony&quot;</span><span class="p">,</span> <span class="mi">139665</span> <span class="p">:</span> <span class="s2">&quot;Deuter&quot;</span><span class="p">,</span> <span class="mi">139667</span> <span class="p">:</span> <span class="s2">&quot;Inov-8&quot;</span><span class="p">,</span> <span class="mi">139696</span> <span class="p">:</span> <span class="s2">&quot;Petzl&quot;</span><span class="p">,</span> <span class="mi">139752</span> <span class="p">:</span> <span class="s2">&quot;SKINS&quot;</span><span class="p">,</span> <span class="mi">139832</span> <span class="p">:</span> <span class="s2">&quot;Suunto&quot;</span><span class="p">,</span> <span class="mi">139859</span> <span class="p">:</span> <span class="s2">&quot;Zoot&quot;</span><span class="p">,</span> <span class="mi">139881</span> <span class="p">:</span> <span class="s2">&quot;Peak Performance&quot;</span><span class="p">}</span>


<span class="n">data</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">139987</span><span class="p">,</span> <span class="s2">&quot;Pension&quot;</span><span class="p">,</span> <span class="mf">0.13221</span><span class="p">,</span> <span class="s2">&quot;Mortgage&quot;</span><span class="p">,</span> <span class="mf">0.10675</span><span class="p">),</span> <span class="p">(</span><span class="mi">140030</span><span class="p">,</span> <span class="s2">&quot;Savings&quot;</span><span class="p">,</span> <span class="mf">0.95678</span><span class="p">,</span> <span class="s2">&quot;Pension&quot;</span><span class="p">,</span> <span class="mf">0.84446</span><span class="p">),</span> <span class="p">(</span><span class="mi">140089</span><span class="p">,</span> <span class="s2">&quot;Savings&quot;</span><span class="p">,</span> <span class="mf">0.95678</span><span class="p">,</span> <span class="s2">&quot;Pension&quot;</span><span class="p">,</span> <span class="mf">0.80233</span><span class="p">),</span>
                        <span class="p">(</span><span class="mi">140097</span><span class="p">,</span> <span class="s2">&quot;Pension&quot;</span><span class="p">,</span> <span class="mf">0.13221</span><span class="p">,</span> <span class="s2">&quot;Mortgage&quot;</span><span class="p">,</span> <span class="mf">0.10675</span><span class="p">),</span> <span class="p">(</span><span class="mi">139068</span><span class="p">,</span> <span class="s2">&quot;Pension&quot;</span><span class="p">,</span> <span class="mf">0.80506</span><span class="p">,</span> <span class="s2">&quot;Savings&quot;</span><span class="p">,</span> <span class="mf">0.28391</span><span class="p">),</span> <span class="p">(</span><span class="mi">139154</span><span class="p">,</span> <span class="s2">&quot;Pension&quot;</span><span class="p">,</span> <span class="mf">0.13221</span><span class="p">,</span> <span class="s2">&quot;Mortgage&quot;</span><span class="p">,</span> <span class="mf">0.10675</span><span class="p">),</span>
                        <span class="p">(</span><span class="mi">139158</span><span class="p">,</span> <span class="s2">&quot;Pension&quot;</span><span class="p">,</span> <span class="mf">0.13221</span><span class="p">,</span> <span class="s2">&quot;Mortgage&quot;</span><span class="p">,</span> <span class="mf">0.10675</span><span class="p">),(</span><span class="mi">139169</span><span class="p">,</span> <span class="s2">&quot;Pension&quot;</span><span class="p">,</span> <span class="mf">0.13221</span><span class="p">,</span> <span class="s2">&quot;Mortgage&quot;</span><span class="p">,</span> <span class="mf">0.10675</span><span class="p">),</span> <span class="p">(</span><span class="mi">139220</span><span class="p">,</span> <span class="s2">&quot;Pension&quot;</span><span class="p">,</span> <span class="mf">0.13221</span><span class="p">,</span> <span class="s2">&quot;Mortgage&quot;</span><span class="p">,</span> <span class="mf">0.10675</span><span class="p">),</span>
                        <span class="p">(</span><span class="mi">139261</span><span class="p">,</span> <span class="s2">&quot;Pension&quot;</span><span class="p">,</span> <span class="mf">0.13221</span><span class="p">,</span> <span class="s2">&quot;Mortgage&quot;</span><span class="p">,</span> <span class="mf">0.10675</span><span class="p">),</span> <span class="p">(</span><span class="mi">139416</span><span class="p">,</span> <span class="s2">&quot;Pension&quot;</span><span class="p">,</span> <span class="mf">0.13221</span><span class="p">,</span> <span class="s2">&quot;Mortgage&quot;</span><span class="p">,</span> <span class="mf">0.10675</span><span class="p">),</span> <span class="p">(</span><span class="mi">139422</span><span class="p">,</span> <span class="s2">&quot;Pension&quot;</span><span class="p">,</span> <span class="mf">0.13221</span><span class="p">,</span> <span class="s2">&quot;Mortgage&quot;</span><span class="p">,</span> <span class="mf">0.10675</span><span class="p">),</span>
                        <span class="p">(</span><span class="mi">139532</span><span class="p">,</span> <span class="s2">&quot;Savings&quot;</span><span class="p">,</span> <span class="mf">0.95676</span><span class="p">,</span> <span class="s2">&quot;Mortgage&quot;</span><span class="p">,</span> <span class="mf">0.82269</span><span class="p">),</span> <span class="p">(</span><span class="mi">139549</span><span class="p">,</span> <span class="s2">&quot;Savings&quot;</span><span class="p">,</span> <span class="mf">0.16428</span><span class="p">,</span> <span class="s2">&quot;Pension&quot;</span><span class="p">,</span> <span class="mf">0.13221</span><span class="p">),</span> <span class="p">(</span><span class="mi">139560</span><span class="p">,</span> <span class="s2">&quot;Savings&quot;</span><span class="p">,</span> <span class="mf">0.95678</span><span class="p">,</span> <span class="s2">&quot;Pension&quot;</span><span class="p">,</span> <span class="mf">0.86779</span><span class="p">),</span>
                        <span class="p">(</span><span class="mi">139577</span><span class="p">,</span> <span class="s2">&quot;Pension&quot;</span><span class="p">,</span> <span class="mf">0.13225</span><span class="p">,</span> <span class="s2">&quot;Mortgage&quot;</span><span class="p">,</span> <span class="mf">0.10675</span><span class="p">),</span> <span class="p">(</span><span class="mi">139580</span><span class="p">,</span> <span class="s2">&quot;Pension&quot;</span><span class="p">,</span> <span class="mf">0.13221</span><span class="p">,</span> <span class="s2">&quot;Mortgage&quot;</span><span class="p">,</span> <span class="mf">0.10675</span><span class="p">),</span> <span class="p">(</span><span class="mi">139636</span><span class="p">,</span> <span class="s2">&quot;Pension&quot;</span><span class="p">,</span> <span class="mf">0.13221</span><span class="p">,</span> <span class="s2">&quot;Mortgage&quot;</span><span class="p">,</span> <span class="mf">0.10675</span><span class="p">),</span>
                        <span class="p">(</span><span class="mi">139647</span><span class="p">,</span> <span class="s2">&quot;Savings&quot;</span><span class="p">,</span> <span class="mf">0.28934</span><span class="p">,</span> <span class="s2">&quot;Pension&quot;</span><span class="p">,</span> <span class="mf">0.13221</span><span class="p">),</span> <span class="p">(</span><span class="mi">139649</span><span class="p">,</span> <span class="s2">&quot;Pension&quot;</span><span class="p">,</span> <span class="mf">0.13221</span><span class="p">,</span> <span class="s2">&quot;Mortgage&quot;</span><span class="p">,</span> <span class="mf">0.10675</span><span class="p">),</span> <span class="p">(</span><span class="mi">139665</span><span class="p">,</span> <span class="s2">&quot;Savings&quot;</span><span class="p">,</span> <span class="mf">0.95675</span><span class="p">,</span> <span class="s2">&quot;Pension&quot;</span><span class="p">,</span> <span class="mf">0.27248</span><span class="p">),</span>
                        <span class="p">(</span><span class="mi">139667</span><span class="p">,</span> <span class="s2">&quot;Pension&quot;</span><span class="p">,</span> <span class="mf">0.13221</span><span class="p">,</span> <span class="s2">&quot;Mortgage&quot;</span><span class="p">,</span> <span class="mf">0.10675</span><span class="p">),</span> <span class="p">(</span><span class="mi">139696</span><span class="p">,</span> <span class="s2">&quot;Savings&quot;</span><span class="p">,</span> <span class="mf">0.16188</span><span class="p">,</span> <span class="s2">&quot;Pension&quot;</span><span class="p">,</span> <span class="mf">0.13221</span><span class="p">),</span> <span class="p">(</span><span class="mi">139752</span><span class="p">,</span> <span class="s2">&quot;Pension&quot;</span><span class="p">,</span> <span class="mf">0.13221</span><span class="p">,</span> <span class="s2">&quot;Mortgage&quot;</span><span class="p">,</span> <span class="mf">0.10675</span><span class="p">),</span>
                        <span class="p">(</span><span class="mi">139832</span><span class="p">,</span> <span class="s2">&quot;Savings&quot;</span><span class="p">,</span> <span class="mf">0.95678</span><span class="p">,</span> <span class="s2">&quot;Pension&quot;</span><span class="p">,</span> <span class="mf">0.83426</span><span class="p">),</span> <span class="p">(</span><span class="mi">139859</span><span class="p">,</span> <span class="s2">&quot;Savings&quot;</span><span class="p">,</span> <span class="mf">0.95678</span><span class="p">,</span> <span class="s2">&quot;Pension&quot;</span><span class="p">,</span> <span class="mf">0.75925</span><span class="p">),</span> <span class="p">(</span><span class="mi">139881</span><span class="p">,</span> <span class="s2">&quot;Pension&quot;</span><span class="p">,</span> <span class="mf">0.13221</span><span class="p">,</span> <span class="s2">&quot;Mortgage&quot;</span><span class="p">,</span> <span class="mf">0.10675</span><span class="p">)]</span>

<span class="n">products</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Car loan&quot;</span><span class="p">,</span> <span class="s2">&quot;Savings&quot;</span><span class="p">,</span> <span class="s2">&quot;Mortgage&quot;</span><span class="p">,</span> <span class="s2">&quot;Pension&quot;</span><span class="p">]</span>
<span class="n">productValue</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">400</span><span class="p">]</span>
<span class="n">budgetShare</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">]</span>

<span class="n">availableBudget</span> <span class="o">=</span> <span class="mi">500</span>
<span class="n">channels</span> <span class="o">=</span>  <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="p">[(</span><span class="s2">&quot;gift&quot;</span><span class="p">,</span> <span class="mf">20.0</span><span class="p">,</span> <span class="mf">0.20</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;newsletter&quot;</span><span class="p">,</span> <span class="mf">15.0</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;seminar&quot;</span><span class="p">,</span> <span class="mf">23.0</span><span class="p">,</span> <span class="mf">0.30</span><span class="p">)],</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;cost&quot;</span><span class="p">,</span> <span class="s2">&quot;factor&quot;</span><span class="p">])</span>
</pre></div>
</div>
<p>Offers are stored in a <a class="reference external" href="http://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.html">pandas
DataFrame</a>.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">offers</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;customerid&quot;</span><span class="p">,</span> <span class="s2">&quot;Product1&quot;</span><span class="p">,</span> <span class="s2">&quot;Confidence1&quot;</span><span class="p">,</span> <span class="s2">&quot;Product2&quot;</span><span class="p">,</span> <span class="s2">&quot;Confidence2&quot;</span><span class="p">])</span>
<span class="n">offers</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">data</span><span class="p">))</span>
</pre></div>
</div>
<p>Let&#8217;s customize the display of this data and show the confidence
forecast for each customer.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">CSS</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">body {</span>
<span class="s2">    margin: 0;</span>
<span class="s2">    font-family: Helvetica;</span>
<span class="s2">}</span>
<span class="s2">table.dataframe {</span>
<span class="s2">    border-collapse: collapse;</span>
<span class="s2">    border: none;</span>
<span class="s2">}</span>
<span class="s2">table.dataframe tr {</span>
<span class="s2">    border: none;</span>
<span class="s2">}</span>
<span class="s2">table.dataframe td, table.dataframe th {</span>
<span class="s2">    margin: 0;</span>
<span class="s2">    border: 1px solid white;</span>
<span class="s2">    padding-left: 0.25em;</span>
<span class="s2">    padding-right: 0.25em;</span>
<span class="s2">}</span>
<span class="s2">table.dataframe th:not(:empty) {</span>
<span class="s2">    background-color: #fec;</span>
<span class="s2">    text-align: left;</span>
<span class="s2">    font-weight: normal;</span>
<span class="s2">}</span>
<span class="s2">table.dataframe tr:nth-child(2) th:empty {</span>
<span class="s2">    border-left: none;</span>
<span class="s2">    border-right: 1px dashed #888;</span>
<span class="s2">}</span>
<span class="s2">table.dataframe td {</span>
<span class="s2">    border: 2px solid #ccf;</span>
<span class="s2">    background-color: #f4f4ff;</span>
<span class="s2">}</span>
<span class="s2">    table.dataframe thead th:first-child {</span>
<span class="s2">        display: none;</span>
<span class="s2">    }</span>
<span class="s2">    table.dataframe tbody th {</span>
<span class="s2">        display: none;</span>
<span class="s2">    }</span>
<span class="s2">&quot;&quot;&quot;</span>
</pre></div>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">IPython.core.display</span> <span class="k">import</span> <span class="n">HTML</span>
<span class="n">HTML</span><span class="p">(</span><span class="s1">&#39;&lt;style&gt;</span><span class="si">{}</span><span class="s1">&lt;/style&gt;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">CSS</span><span class="p">))</span>

<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="k">import</span> <span class="n">display</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">display</span><span class="p">(</span><span class="n">offers</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;customerid&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;name&#39;</span><span class="p">))</span> <span class="c1">#Pandas &gt;= 0.17</span>
<span class="k">except</span><span class="p">:</span>
    <span class="n">display</span><span class="p">(</span><span class="n">offers</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;customerid&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">))</span> <span class="c1">#Pandas &lt; 0.17</span>
</pre></div>
</div>
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>name</th>
      <th>Product1</th>
      <th>Confidence1</th>
      <th>Product2</th>
      <th>Confidence2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>7</th>
      <td>Adidas</td>
      <td>Pension</td>
      <td>0.13221</td>
      <td>Mortgage</td>
      <td>0.10675</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Altra</td>
      <td>Savings</td>
      <td>0.95678</td>
      <td>Pension</td>
      <td>0.80233</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Asics</td>
      <td>Pension</td>
      <td>0.13221</td>
      <td>Mortgage</td>
      <td>0.10675</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Brooks</td>
      <td>Pension</td>
      <td>0.13221</td>
      <td>Mortgage</td>
      <td>0.10675</td>
    </tr>
    <tr>
      <th>20</th>
      <td>Deuter</td>
      <td>Savings</td>
      <td>0.95675</td>
      <td>Pension</td>
      <td>0.27248</td>
    </tr>
    <tr>
      <th>12</th>
      <td>Garmin</td>
      <td>Savings</td>
      <td>0.95676</td>
      <td>Mortgage</td>
      <td>0.82269</td>
    </tr>
    <tr>
      <th>17</th>
      <td>Gore Running Wear</td>
      <td>Pension</td>
      <td>0.13221</td>
      <td>Mortgage</td>
      <td>0.10675</td>
    </tr>
    <tr>
      <th>14</th>
      <td>Helly Hansen</td>
      <td>Savings</td>
      <td>0.95678</td>
      <td>Pension</td>
      <td>0.86779</td>
    </tr>
    <tr>
      <th>13</th>
      <td>High5</td>
      <td>Savings</td>
      <td>0.16428</td>
      <td>Pension</td>
      <td>0.13221</td>
    </tr>
    <tr>
      <th>0</th>
      <td>HokaOneOne</td>
      <td>Pension</td>
      <td>0.13221</td>
      <td>Mortgage</td>
      <td>0.10675</td>
    </tr>
    <tr>
      <th>21</th>
      <td>Inov-8</td>
      <td>Pension</td>
      <td>0.13221</td>
      <td>Mortgage</td>
      <td>0.10675</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Mizuno</td>
      <td>Pension</td>
      <td>0.80506</td>
      <td>Savings</td>
      <td>0.28391</td>
    </tr>
    <tr>
      <th>15</th>
      <td>Moutain Hardware</td>
      <td>Pension</td>
      <td>0.13225</td>
      <td>Mortgage</td>
      <td>0.10675</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Nike</td>
      <td>Pension</td>
      <td>0.13221</td>
      <td>Mortgage</td>
      <td>0.10675</td>
    </tr>
    <tr>
      <th>10</th>
      <td>NorthFace</td>
      <td>Pension</td>
      <td>0.13221</td>
      <td>Mortgage</td>
      <td>0.10675</td>
    </tr>
    <tr>
      <th>26</th>
      <td>Peak Performance</td>
      <td>Pension</td>
      <td>0.13221</td>
      <td>Mortgage</td>
      <td>0.10675</td>
    </tr>
    <tr>
      <th>22</th>
      <td>Petzl</td>
      <td>Savings</td>
      <td>0.16188</td>
      <td>Pension</td>
      <td>0.13221</td>
    </tr>
    <tr>
      <th>11</th>
      <td>Polar</td>
      <td>Pension</td>
      <td>0.13221</td>
      <td>Mortgage</td>
      <td>0.10675</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Quechua</td>
      <td>Pension</td>
      <td>0.13221</td>
      <td>Mortgage</td>
      <td>0.10675</td>
    </tr>
    <tr>
      <th>23</th>
      <td>SKINS</td>
      <td>Pension</td>
      <td>0.13221</td>
      <td>Mortgage</td>
      <td>0.10675</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Salomon</td>
      <td>Savings</td>
      <td>0.95678</td>
      <td>Pension</td>
      <td>0.84446</td>
    </tr>
    <tr>
      <th>16</th>
      <td>Saucony</td>
      <td>Pension</td>
      <td>0.13221</td>
      <td>Mortgage</td>
      <td>0.10675</td>
    </tr>
    <tr>
      <th>19</th>
      <td>Saucony</td>
      <td>Pension</td>
      <td>0.13221</td>
      <td>Mortgage</td>
      <td>0.10675</td>
    </tr>
    <tr>
      <th>24</th>
      <td>Suunto</td>
      <td>Savings</td>
      <td>0.95678</td>
      <td>Pension</td>
      <td>0.83426</td>
    </tr>
    <tr>
      <th>18</th>
      <td>Under Armour</td>
      <td>Savings</td>
      <td>0.28934</td>
      <td>Pension</td>
      <td>0.13221</td>
    </tr>
    <tr>
      <th>9</th>
      <td>WAA</td>
      <td>Pension</td>
      <td>0.13221</td>
      <td>Mortgage</td>
      <td>0.10675</td>
    </tr>
    <tr>
      <th>25</th>
      <td>Zoot</td>
      <td>Savings</td>
      <td>0.95678</td>
      <td>Pension</td>
      <td>0.75925</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="section" id="use-ibm-decision-optimization-cplex-modeling-for-python">
<h2>Use IBM Decision Optimization CPLEX Modeling for Python<a class="headerlink" href="#use-ibm-decision-optimization-cplex-modeling-for-python" title="Permalink to this headline">&para;</a></h2>
<p>Let&#8217;s create the optimization model to select the best ways to contact
customers and stay within the limited budget.</p>
<div class="section" id="step-1-download-the-library">
<h3>Step 1: Download the library<a class="headerlink" href="#step-1-download-the-library" title="Permalink to this headline">&para;</a></h3>
<p>First install <em>docplex</em> and set the credentials to solve the model using
IBM ILOG CPLEX Optimizer on Cloud.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span>import sys
try:
    import docplex.mp
except:
    if hasattr(sys, &#39;real_prefix&#39;):
        #we are in a virtual env.
        !pip install docplex
    else:
        !pip install --user docplex
</pre></div>
</div>
</div>
<div class="section" id="step-2-set-up-the-prescriptive-engine">
<h3>Step 2: Set up the prescriptive engine<a class="headerlink" href="#step-2-set-up-the-prescriptive-engine" title="Permalink to this headline">&para;</a></h3>
<ul class="simple">
<li>Subscribe to the Decision Optimization on Cloud solve service
<a class="reference external" href="https://developer.ibm.com/docloud">here</a>.</li>
<li>Get the service URL and your personal API key and enter your
credentials here:</li>
</ul>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;ENTER YOUR URL HERE&quot;</span>
<span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;ENTER YOUR KEY HERE&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="step-3-set-up-the-prescriptive-model">
<h3>Step 3: Set up the prescriptive model<a class="headerlink" href="#step-3-set-up-the-prescriptive-model" title="Permalink to this headline">&para;</a></h3>
<div class="section" id="create-the-model">
<h4>Create the model<a class="headerlink" href="#create-the-model" title="Permalink to this headline">&para;</a></h4>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">docplex.mp.model</span> <span class="k">import</span> <span class="n">Model</span>

<span class="n">mdl</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;marketing_campaign&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="define-the-decision-variables">
<h4>Define the decision variables<a class="headerlink" href="#define-the-decision-variables" title="Permalink to this headline">&para;</a></h4>
<ul class="simple">
<li>The integer decision variables <code class="docutils literal"><span class="pre">channelVars</span></code>, represent whether or
not a customer will be made an offer for a particular product via a
particular channel.</li>
<li>The integer decision variable <code class="docutils literal"><span class="pre">totaloffers</span></code> represents the total
number of offers made.</li>
<li>The continuous variable <code class="docutils literal"><span class="pre">budgetSpent</span></code> represents the total cost of
the offers made.</li>
</ul>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">offersR</span> <span class="o">=</span> <span class="n">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">offers</span><span class="p">))</span>
<span class="n">productsR</span> <span class="o">=</span> <span class="n">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">products</span><span class="p">))</span>
<span class="n">channelsR</span> <span class="o">=</span> <span class="n">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">channels</span><span class="p">))</span>

<span class="n">channelVars</span> <span class="o">=</span> <span class="n">mdl</span><span class="o">.</span><span class="n">binary_var_cube</span><span class="p">(</span><span class="n">offersR</span><span class="p">,</span> <span class="n">productsR</span><span class="p">,</span> <span class="n">channelsR</span><span class="p">)</span>
<span class="n">totaloffers</span> <span class="o">=</span> <span class="n">mdl</span><span class="o">.</span><span class="n">integer_var</span><span class="p">(</span><span class="n">lb</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">budgetSpent</span> <span class="o">=</span> <span class="n">mdl</span><span class="o">.</span><span class="n">continuous_var</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="set-up-the-constraints">
<h4>Set up the constraints<a class="headerlink" href="#set-up-the-constraints" title="Permalink to this headline">&para;</a></h4>
<ul class="simple">
<li>Offer only one product per customer.</li>
<li>Compute the budget and set a maximum on it.</li>
<li>Compute the number of offers to be made.</li>
</ul>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="c1"># Only 1 product is offered to each customer</span>
<span class="n">mdl</span><span class="o">.</span><span class="n">add_constraints</span><span class="p">(</span> <span class="n">mdl</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">channelVars</span><span class="p">[</span><span class="n">o</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">c</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">productsR</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">channelsR</span><span class="p">)</span> <span class="o">&lt;=</span><span class="mi">1</span>
                   <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">offersR</span><span class="p">)</span>

<span class="n">mdl</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span> <span class="n">totaloffers</span> <span class="o">==</span> <span class="n">mdl</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">channelVars</span><span class="p">[</span><span class="n">o</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">c</span><span class="p">]</span>
                                           <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">offersR</span>
                                           <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">productsR</span>
                                           <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">channelsR</span><span class="p">)</span> <span class="p">)</span>

<span class="n">mdl</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span> <span class="n">budgetSpent</span> <span class="o">==</span> <span class="n">mdl</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">channelVars</span><span class="p">[</span><span class="n">o</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">c</span><span class="p">]</span><span class="o">*</span><span class="n">channels</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">c</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="s2">&quot;cost&quot;</span><span class="p">)</span>
                                           <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">offersR</span>
                                           <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">productsR</span>
                                           <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">channelsR</span><span class="p">)</span> <span class="p">)</span>

<span class="c1"># Balance the offers among products</span>
<span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">productsR</span><span class="p">:</span>
    <span class="n">mdl</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span> <span class="n">mdl</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">channelVars</span><span class="p">[</span><span class="n">o</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">c</span><span class="p">]</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">offersR</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">channelsR</span><span class="p">)</span>
                       <span class="o">&lt;=</span> <span class="n">budgetShare</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">*</span> <span class="n">totaloffers</span> <span class="p">)</span>

<span class="c1"># Do not exceed the budget</span>
<span class="n">mdl</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span> <span class="n">mdl</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">channelVars</span><span class="p">[</span><span class="n">o</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">c</span><span class="p">]</span><span class="o">*</span><span class="n">channels</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">c</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="s2">&quot;cost&quot;</span><span class="p">)</span>
                            <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">offersR</span>
                            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">productsR</span>
                            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">channelsR</span><span class="p">)</span>  <span class="o">&lt;=</span> <span class="n">availableBudget</span> <span class="p">)</span>

<span class="n">mdl</span><span class="o">.</span><span class="n">print_information</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Model</span><span class="p">:</span> <span class="n">marketing_campaign</span>
 <span class="o">-</span> <span class="n">number</span> <span class="n">of</span> <span class="n">variables</span><span class="p">:</span> <span class="mi">326</span>
   <span class="o">-</span> <span class="n">binary</span><span class="o">=</span><span class="mi">324</span><span class="p">,</span> <span class="n">integer</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">continuous</span><span class="o">=</span><span class="mi">1</span>
 <span class="o">-</span> <span class="n">number</span> <span class="n">of</span> <span class="n">constraints</span><span class="p">:</span> <span class="mi">34</span>
 <span class="o">-</span>   <span class="n">LE</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">EQ</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">GE</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">RNG</span><span class="o">=</span><span class="mi">0</span>
 <span class="o">-</span> <span class="n">parameters</span><span class="p">:</span> <span class="n">defaults</span>
</pre></div>
</div>
</div>
<div class="section" id="express-the-objective">
<h4>Express the objective<a class="headerlink" href="#express-the-objective" title="Permalink to this headline">&para;</a></h4>
<p>We want to maximize the expected revenue.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">mdl</span><span class="o">.</span><span class="n">maximize</span><span class="p">(</span>
    <span class="n">mdl</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span> <span class="n">channelVars</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">idx2</span><span class="p">]</span> <span class="o">*</span> <span class="n">c</span><span class="o">.</span><span class="n">factor</span> <span class="o">*</span> <span class="n">productValue</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="o">*</span> <span class="n">o</span><span class="o">.</span><span class="n">Confidence1</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">productsR</span>
            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span><span class="n">o</span> <span class="ow">in</span> <span class="n">offers</span><span class="p">[</span><span class="n">offers</span><span class="p">[</span><span class="s1">&#39;Product1&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">products</span><span class="p">[</span><span class="n">p</span><span class="p">]]</span><span class="o">.</span><span class="n">iterrows</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">idx2</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">channels</span><span class="o">.</span><span class="n">iterrows</span><span class="p">())</span>
    <span class="o">+</span>
    <span class="n">mdl</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span> <span class="n">channelVars</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">idx2</span><span class="p">]</span> <span class="o">*</span> <span class="n">c</span><span class="o">.</span><span class="n">factor</span> <span class="o">*</span> <span class="n">productValue</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="o">*</span> <span class="n">o</span><span class="o">.</span><span class="n">Confidence2</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">productsR</span>
            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span><span class="n">o</span> <span class="ow">in</span> <span class="n">offers</span><span class="p">[</span><span class="n">offers</span><span class="p">[</span><span class="s1">&#39;Product2&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">products</span><span class="p">[</span><span class="n">p</span><span class="p">]]</span><span class="o">.</span><span class="n">iterrows</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">idx2</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">channels</span><span class="o">.</span><span class="n">iterrows</span><span class="p">())</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="solve-with-the-decision-optimization-solve-service">
<h4>Solve with the Decision Optimization solve service<a class="headerlink" href="#solve-with-the-decision-optimization-solve-service" title="Permalink to this headline">&para;</a></h4>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">s</span> <span class="o">=</span> <span class="n">mdl</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">s</span><span class="p">,</span> <span class="s2">&quot;No Solution !!!&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="step-4-analyze-the-solution">
<h3>Step 4: Analyze the solution<a class="headerlink" href="#step-4-analyze-the-solution" title="Permalink to this headline">&para;</a></h3>
<p>First, let&#8217;s display the <strong>Optimal Marketing Channel per customer</strong>.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">report</span> <span class="o">=</span> <span class="p">[(</span><span class="n">channels</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">c</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="s2">&quot;name&quot;</span><span class="p">),</span> <span class="n">products</span><span class="p">[</span><span class="n">p</span><span class="p">],</span> <span class="n">names</span><span class="p">[</span><span class="n">offers</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="s2">&quot;customerid&quot;</span><span class="p">)])</span>
          <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">channelsR</span>
          <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">productsR</span>
          <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">offersR</span>  <span class="k">if</span> <span class="n">channelVars</span><span class="p">[</span><span class="n">o</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">solution_value</span><span class="o">==</span><span class="mi">1</span><span class="p">]</span>

<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">report</span><span class="p">)</span> <span class="o">==</span> <span class="n">totaloffers</span><span class="o">.</span><span class="n">solution_value</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Marketing plan has </span><span class="si">{0}</span><span class="s2"> offers costing </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">totaloffers</span><span class="o">.</span><span class="n">solution_value</span><span class="p">,</span> <span class="n">budgetSpent</span><span class="o">.</span><span class="n">solution_value</span><span class="p">))</span>

<span class="n">report_bd</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">report</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;channel&#39;</span><span class="p">,</span> <span class="s1">&#39;product&#39;</span><span class="p">,</span> <span class="s1">&#39;customer&#39;</span><span class="p">])</span>
<span class="n">display</span><span class="p">(</span><span class="n">report_bd</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Marketing</span> <span class="n">plan</span> <span class="n">has</span> <span class="mi">20</span> <span class="n">offers</span> <span class="n">costing</span> <span class="mf">364.0</span>
</pre></div>
</div>
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>channel</th>
      <th>product</th>
      <th>customer</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>newsletter</td>
      <td>Car loan</td>
      <td>Quechua</td>
    </tr>
    <tr>
      <th>1</th>
      <td>newsletter</td>
      <td>Car loan</td>
      <td>Adidas</td>
    </tr>
    <tr>
      <th>2</th>
      <td>newsletter</td>
      <td>Car loan</td>
      <td>NorthFace</td>
    </tr>
    <tr>
      <th>3</th>
      <td>newsletter</td>
      <td>Car loan</td>
      <td>Polar</td>
    </tr>
    <tr>
      <th>4</th>
      <td>newsletter</td>
      <td>Car loan</td>
      <td>High5</td>
    </tr>
    <tr>
      <th>5</th>
      <td>newsletter</td>
      <td>Car loan</td>
      <td>Moutain Hardware</td>
    </tr>
    <tr>
      <th>6</th>
      <td>newsletter</td>
      <td>Car loan</td>
      <td>Saucony</td>
    </tr>
    <tr>
      <th>7</th>
      <td>newsletter</td>
      <td>Car loan</td>
      <td>Gore Running Wear</td>
    </tr>
    <tr>
      <th>8</th>
      <td>newsletter</td>
      <td>Car loan</td>
      <td>Under Armour</td>
    </tr>
    <tr>
      <th>9</th>
      <td>newsletter</td>
      <td>Car loan</td>
      <td>Saucony</td>
    </tr>
    <tr>
      <th>10</th>
      <td>newsletter</td>
      <td>Car loan</td>
      <td>Inov-8</td>
    </tr>
    <tr>
      <th>11</th>
      <td>newsletter</td>
      <td>Car loan</td>
      <td>Petzl</td>
    </tr>
    <tr>
      <th>12</th>
      <td>seminar</td>
      <td>Savings</td>
      <td>Altra</td>
    </tr>
    <tr>
      <th>13</th>
      <td>seminar</td>
      <td>Savings</td>
      <td>Zoot</td>
    </tr>
    <tr>
      <th>14</th>
      <td>seminar</td>
      <td>Mortgage</td>
      <td>Nike</td>
    </tr>
    <tr>
      <th>15</th>
      <td>seminar</td>
      <td>Mortgage</td>
      <td>Garmin</td>
    </tr>
    <tr>
      <th>16</th>
      <td>seminar</td>
      <td>Mortgage</td>
      <td>SKINS</td>
    </tr>
    <tr>
      <th>17</th>
      <td>seminar</td>
      <td>Mortgage</td>
      <td>Peak Performance</td>
    </tr>
    <tr>
      <th>18</th>
      <td>seminar</td>
      <td>Pension</td>
      <td>Salomon</td>
    </tr>
    <tr>
      <th>19</th>
      <td>seminar</td>
      <td>Pension</td>
      <td>Helly Hansen</td>
    </tr>
  </tbody>
</table>
</div><p>Then let&#8217;s <strong>focus on seminar</strong>.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">display</span><span class="p">(</span><span class="n">report_bd</span><span class="p">[</span><span class="n">report_bd</span><span class="p">[</span><span class="s1">&#39;channel&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;seminar&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;channel&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>product</th>
      <th>customer</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>12</th>
      <td>Savings</td>
      <td>Altra</td>
    </tr>
    <tr>
      <th>13</th>
      <td>Savings</td>
      <td>Zoot</td>
    </tr>
    <tr>
      <th>14</th>
      <td>Mortgage</td>
      <td>Nike</td>
    </tr>
    <tr>
      <th>15</th>
      <td>Mortgage</td>
      <td>Garmin</td>
    </tr>
    <tr>
      <th>16</th>
      <td>Mortgage</td>
      <td>SKINS</td>
    </tr>
    <tr>
      <th>17</th>
      <td>Mortgage</td>
      <td>Peak Performance</td>
    </tr>
    <tr>
      <th>18</th>
      <td>Pension</td>
      <td>Salomon</td>
    </tr>
    <tr>
      <th>19</th>
      <td>Pension</td>
      <td>Helly Hansen</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="section" id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="Permalink to this headline">&para;</a></h2>
<p>You learned how to set up and use IBM Decision Optimization CPLEX
Modeling for Python to formulate a Mathematical Programming model and
solve it with IBM Decision Optimization on Cloud.</p>
</div>
<div class="section" id="references">
<h2>References<a class="headerlink" href="#references" title="Permalink to this headline">&para;</a></h2>
<ul class="simple">
<li><a class="reference external" href="https://rawgit.com/IBMDecisionOptimization/docplex-doc/master/docs/index.html">CPLEX Modeling for Python
documentation</a></li>
<li><a class="reference external" href="https://developer.ibm.com/docloud/">Decision Optimization on
Cloud</a></li>
<li>Need help with DOcplex or to report a bug? Please go
<a class="reference external" href="https://developer.ibm.com/answers/smartspace/docloud">here</a>.</li>
<li>Contact us at <a class="reference external" href="mailto:dofeedback&#37;&#52;&#48;wwpdl&#46;vnet&#46;ibm&#46;com">dofeedback<span>&#64;</span>wwpdl<span>&#46;</span>vnet<span>&#46;</span>ibm<span>&#46;</span>com</a>.</li>
</ul>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">DOcplex.MP: Mathematical Programming Modeling for Python V2.3 documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2016-2017, IBM&reg;.
    </div>
  </body>
</html>