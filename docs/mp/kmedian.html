<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>The K-Median Problem &mdash; DOcplex.MP: Mathematical Programming Modeling for Python V1.0 documentation</title>
    
    <link rel="stylesheet" href="_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     'V1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  false
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="DOcplex.MP: Mathematical Programming Modeling for Python V1.0 documentation" href="index.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">DOcplex.MP: Mathematical Programming Modeling for Python V1.0 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="the-k-median-problem">
<h1>The K-Median Problem<a class="headerlink" href="#the-k-median-problem" title="Permalink to this headline">¶</a></h1>
<p>The K_median problem deals with finding pseudo centers in a cloud of
points.</p>
<div class="section" id="to-begin-let-s-generate-a-random-set-of-points-in-the-plane-with-coordinates-ranging-from-1-to-100">
<h2>To begin, let&#8217;s generate a random set of points in the plane, with coordinates ranging from 1 to 100.<a class="headerlink" href="#to-begin-let-s-generate-a-random-set-of-points-in-the-plane-with-coordinates-ranging-from-1-to-100" title="Permalink to this headline">¶</a></h2>
<p>First, we specialize a namedtuple class to model 2D points:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">namedtuple</span>

<span class="k">class</span> <span class="nc">Point</span><span class="p">(</span><span class="n">namedtuple</span><span class="p">(</span><span class="s2">&quot;TPoint&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">])):</span>
    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;P&lt;</span><span class="si">%g</span><span class="s2">,</span><span class="si">%g</span><span class="s2">&gt;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">coords</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
<p>Now define the Euclidean distance function between two points:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">math</span>
<span class="k">def</span> <span class="nf">euclidean_distance</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">):</span>
    <span class="n">dx</span> <span class="o">=</span> <span class="n">p1</span><span class="o">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">p2</span><span class="o">.</span><span class="n">x</span>
    <span class="n">dy</span> <span class="o">=</span> <span class="n">p1</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">p2</span><span class="o">.</span><span class="n">y</span>
    <span class="k">return</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">dx</span> <span class="o">*</span> <span class="n">dx</span> <span class="o">+</span> <span class="n">dy</span> <span class="o">*</span> <span class="n">dy</span><span class="p">)</span>
</pre></div>
</div>
<p>We also need an auxiliary function to generate the distance matrix
between points. For now, we use the Euclidean distance, but any
distance in the plane is sufficient.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">generate_matrix</span><span class="p">(</span><span class="n">points</span><span class="p">):</span>
    <span class="n">matrix</span> <span class="o">=</span> <span class="p">{(</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">):</span> <span class="n">euclidean_distance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">points</span> <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">points</span><span class="p">}</span>
    <span class="k">return</span> <span class="n">matrix</span>
</pre></div>
</div>
<p>Inside this set of points, we want to choose some points, say C,
which have a &#8220;centric&#8221; situation within the set. More precisely, we want
to link any point to exactly one &#8220;pseudo-center&#8221; in such a way that
the total distance from any point to its pseudo-center is minimal. If
C=1 this is the classical barycenter of the set of points, but for
greater values of C, this can become less intuitive. We need a small
model to generate these pseudo-centers.</p>
<p>Install the CPLEX for Python library:</p>
<div class="code python highlight-python"><div class="highlight"><pre>!pip install docplex
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>Requirement already satisfied (use --upgrade to upgrade): docplex in /Users/docloud/anaconda/lib/python2.7/site-packages
Requirement already satisfied (use --upgrade to upgrade): docloud&gt;=1.0.0 in /Users/docloud/anaconda/lib/python2.7/site-packages (from docplex)
Requirement already satisfied (use --upgrade to upgrade): futures in /Users/docloud/anaconda/lib/python2.7/site-packages (from docplex)
Requirement already satisfied (use --upgrade to upgrade): requests in /Users/docloud/anaconda/lib/python2.7/site-packages (from docplex)
Requirement already satisfied (use --upgrade to upgrade): six in /Users/docloud/anaconda/lib/python2.7/site-packages (from docplex)
Requirement already satisfied (use --upgrade to upgrade): enum34 in /Users/docloud/anaconda/lib/python2.7/site-packages (from docloud&gt;=1.0.0-&gt;docplex)
</pre></div>
</div>
<p>Enter DOcloud credentials:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">docplex.mp.environment</span> <span class="kn">import</span> <span class="n">Environment</span>
<span class="n">env</span> <span class="o">=</span> <span class="n">Environment</span><span class="p">()</span>
<span class="n">env</span><span class="o">.</span><span class="n">print_information</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>* system is: Darwin 64bit
* CPLEX wrapper is not available
* Numpy is present, version is 1.10.1
* Matplotlib is present, version is 1.4.3
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">docplex.mp.context</span> <span class="kn">import</span> <span class="n">DOcloudContext</span>
<span class="n">context</span> <span class="o">=</span> <span class="n">DOcloudContext</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="s2">&quot;PUT_YOUR_DOCLOUD_URL_HERE&quot;</span><span class="p">,</span>
                         <span class="n">api_key</span><span class="o">=</span><span class="s2">&quot;PUT_YOUR_DOCLOUD_KEY_HERE&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">docplex.mp.model</span> <span class="kn">import</span> <span class="n">Model</span>

<span class="k">def</span> <span class="nf">build_kmedian1</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">distance_matrix</span><span class="p">,</span> <span class="n">nb_hubs</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="c1"># any point is a potential hub</span>
    <span class="n">hubs</span> <span class="o">=</span> <span class="n">points</span>

    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">distance_matrix</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span>
    <span class="n">BIGDIST</span> <span class="o">=</span> <span class="mi">999999999</span>
    <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">hubs</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">points</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> <span class="ow">in</span> <span class="n">distance_matrix</span><span class="p">:</span>
                <span class="k">assert</span> <span class="n">distance_matrix</span><span class="p">[</span><span class="n">h</span><span class="p">,</span> <span class="n">p</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span>
                <span class="k">if</span> <span class="n">h</span> <span class="o">==</span> <span class="n">p</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="n">distance_matrix</span><span class="p">[</span><span class="n">h</span><span class="p">,</span> <span class="n">p</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span>
            <span class="k">elif</span> <span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span> <span class="ow">in</span> <span class="n">distance_matrix</span><span class="p">:</span>
                <span class="k">assert</span> <span class="n">distance_matrix</span><span class="p">[</span><span class="n">p</span><span class="p">,</span> <span class="n">h</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span>
                <span class="k">if</span> <span class="n">h</span> <span class="o">==</span> <span class="n">p</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="n">distance_matrix</span><span class="p">[</span><span class="n">p</span><span class="p">,</span> <span class="n">h</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s2">&quot;* forbidden arc {0} -&gt; {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">p</span><span class="p">))</span>

    <span class="c1"># now build the model</span>
    <span class="n">kmedian_name</span> <span class="o">=</span> <span class="s2">&quot;Kmedian_p_{0}_h_{1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">),</span> <span class="n">nb_hubs</span><span class="p">)</span>
    <span class="n">mdl</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">docloud_context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>
    <span class="c1"># vars</span>
    <span class="n">mdl</span><span class="o">.</span><span class="n">hub_vars</span> <span class="o">=</span> <span class="n">mdl</span><span class="o">.</span><span class="n">binary_var_dict</span><span class="p">(</span><span class="n">hubs</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;is_hub&quot;</span><span class="p">)</span>
    <span class="n">mdl</span><span class="o">.</span><span class="n">link_vars</span> <span class="o">=</span> <span class="n">mdl</span><span class="o">.</span><span class="n">binary_var_dict2</span><span class="p">(</span><span class="n">hubs</span><span class="p">,</span> <span class="n">points</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;link&quot;</span><span class="p">)</span>
    <span class="c1"># cts</span>
    <span class="c1"># ct #1. each point can be linked only to an open hub</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">points</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">hubs</span><span class="p">:</span>
            <span class="n">mdl</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span><span class="n">mdl</span><span class="o">.</span><span class="n">link_vars</span><span class="p">[</span><span class="n">h</span><span class="p">,</span> <span class="n">p</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">mdl</span><span class="o">.</span><span class="n">hub_vars</span><span class="p">[</span><span class="n">h</span><span class="p">])</span>

    <span class="c1"># zap arcs with &quot;infinite&quot; distance</span>
    <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">hubs</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">points</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">distance_matrix</span><span class="p">[</span><span class="n">h</span><span class="p">,</span> <span class="n">p</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">BIGDIST</span><span class="p">:</span>
                <span class="n">mdl</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span><span class="n">mdl</span><span class="o">.</span><span class="n">link_vars</span><span class="p">[</span><span class="n">h</span><span class="p">,</span> <span class="n">p</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">p</span> <span class="o">==</span> <span class="n">h</span><span class="p">:</span>
                <span class="n">mdl</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span><span class="n">mdl</span><span class="o">.</span><span class="n">link_vars</span><span class="p">[</span><span class="n">h</span><span class="p">,</span> <span class="n">p</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>


    <span class="c1"># ct #2 each non hub point is linked to exactly one hub.</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">points</span><span class="p">:</span>
        <span class="n">mdl</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span><span class="n">mdl</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">mdl</span><span class="o">.</span><span class="n">link_vars</span><span class="p">[</span><span class="n">h</span><span class="p">,</span> <span class="n">p</span><span class="p">]</span> <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">hubs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">mdl</span><span class="o">.</span><span class="n">hub_vars</span><span class="p">[</span><span class="n">p</span><span class="p">])</span>

    <span class="c1"># ct #3 total nb of open hubs</span>
    <span class="n">mdl</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span><span class="n">mdl</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">mdl</span><span class="o">.</span><span class="n">hub_vars</span><span class="p">[</span><span class="n">h</span><span class="p">]</span> <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">hubs</span><span class="p">)</span> <span class="o">==</span> <span class="n">nb_hubs</span><span class="p">)</span>

    <span class="c1"># minimizee total distance from points to hubs</span>
    <span class="k">def</span> <span class="nf">get_dist</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">distance_matrix</span><span class="o">.</span><span class="n">get</span><span class="p">((</span><span class="n">h</span><span class="p">,</span> <span class="n">p</span><span class="p">),</span> <span class="n">BIGDIST</span><span class="p">)</span>

    <span class="n">total_distance</span> <span class="o">=</span> <span class="n">mdl</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">mdl</span><span class="o">.</span><span class="n">link_vars</span><span class="p">[</span><span class="n">h</span><span class="p">,</span> <span class="n">p</span><span class="p">]</span> <span class="o">*</span> <span class="n">get_dist</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">hubs</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">points</span><span class="p">)</span>
    <span class="n">mdl</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="n">total_distance</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">mdl</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">solve_kmedian1</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">distance_matrix</span><span class="p">,</span> <span class="n">nb_hubs</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">mdl</span> <span class="o">=</span> <span class="n">build_kmedian1</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">distance_matrix</span><span class="p">,</span> <span class="n">nb_hubs</span><span class="p">)</span>
    <span class="c1"># any point is a potential hub</span>
    <span class="n">hubs</span> <span class="o">=</span> <span class="n">points</span>

    <span class="n">ok</span> <span class="o">=</span> <span class="n">mdl</span><span class="o">.</span><span class="n">solve</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">ok</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Kmedian model fails&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">total_distance</span> <span class="o">=</span> <span class="n">mdl</span><span class="o">.</span><span class="n">objective_value</span>
        <span class="n">open_hubs</span> <span class="o">=</span> <span class="p">[</span><span class="n">h</span> <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">hubs</span> <span class="k">if</span> <span class="nb">float</span><span class="p">(</span><span class="n">mdl</span><span class="o">.</span><span class="n">hub_vars</span><span class="p">[</span><span class="n">h</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="mf">0.9</span><span class="p">]</span>
        <span class="n">edges</span> <span class="o">=</span> <span class="p">[(</span><span class="n">p</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">points</span> <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">hubs</span> <span class="k">if</span> <span class="nb">float</span><span class="p">(</span><span class="n">mdl</span><span class="o">.</span><span class="n">link_vars</span><span class="p">[</span><span class="n">p</span><span class="p">,</span> <span class="n">h</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="mf">0.9</span><span class="p">]</span>
        <span class="c1"># returning a tuple</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;total distance=</span><span class="si">%g</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">total_distance</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;#hubs={0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">open_hubs</span><span class="p">)))</span>
        <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">open_hubs</span><span class="p">:</span>
            <span class="c1"># h is an index</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;--hub: {0!s}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">h</span><span class="p">))</span>

        <span class="n">res</span> <span class="o">=</span> <span class="n">total_distance</span><span class="p">,</span> <span class="n">open_hubs</span><span class="p">,</span> <span class="n">edges</span>
        <span class="k">return</span> <span class="n">res</span>
</pre></div>
</div>
<p>Now let&#8217;s try the algorithm on a simple topology with three points as a
triangle and one point at the center of gravity of the triangle. Of
course, we expect the hub to be at the center of gravity of the
triangle.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">simple_points</span> <span class="o">=</span> <span class="p">[</span> <span class="n">Point</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="n">Point</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="n">Point</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">Point</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">)]</span>
<span class="n">simple_matrix</span> <span class="o">=</span> <span class="p">{(</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">):</span> <span class="n">euclidean_distance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">simple_points</span> <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">simple_points</span><span class="p">}</span>

<span class="n">simple_res</span> <span class="o">=</span> <span class="n">solve_kmedian1</span><span class="p">(</span><span class="n">points</span><span class="o">=</span><span class="n">simple_points</span><span class="p">,</span> <span class="n">distance_matrix</span><span class="o">=</span><span class="n">simple_matrix</span><span class="p">,</span> <span class="n">nb_hubs</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<pre class="literal-block">
Warning: CPLEX DLL not found, will solve on DOcloud
* #non-compliant LP name: |is_hub_P&lt;0,0&gt;|

total distance=19.1421
#hubs=1
--hub: P&lt;5,5&gt;
</pre>
<p>Define a function to plot the result: the initial points, the
hubs found by the algorithms, and the edges.</p>
<div class="code python highlight-python"><div class="highlight"><pre>if env.has_matplotlib:
    import matplotlib.pyplot as plt
    %matplotlib inline

def plot_kmedian(points, hubs, edges):
    if env.has_matplotlib:
        plt.cla()
        pxs = [p.x for p in points]
        pys = [p.y for p in points]
        plt.scatter(pxs, pys, c=&quot;yellow&quot;, marker=&#39;o&#39;)
        hxs = [h.x for h in hubs]
        hys = [h.y for h in hubs]
        plt.scatter(hxs, hys, c=&quot;blue&quot;, marker=&#39;v&#39;, s=100)

        edge_xs = []
        edge_ys = []
        for (pe, he) in edges:
            edge_xs.append(pe.x)
            edge_xs.append(he.x)
            edge_xs.append(None)
            edge_ys.append(pe.y)
            edge_ys.append(he.y)
            edge_ys.append(None)
        plt.plot(edge_xs, edge_ys)
        plt.show()
    else:
        print(&quot;warning: no display&quot;)
</pre></div>
</div>
<p>Let&#8217;s try to plot the result of the simple topology:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="p">(</span><span class="n">simple_distance</span><span class="p">,</span> <span class="n">simple_hubs</span><span class="p">,</span> <span class="n">simple_edges</span><span class="p">)</span> <span class="o">=</span> <span class="n">simple_res</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;hubs=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">simple_hubs</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;simple=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">simple_points</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;edges=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">simple_edges</span><span class="p">))</span>

<span class="n">plot_kmedian</span><span class="p">(</span><span class="n">simple_points</span><span class="p">,</span> <span class="n">simple_hubs</span><span class="p">,</span> <span class="n">simple_edges</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">hubs</span><span class="o">=</span><span class="p">[</span><span class="n">TPoint</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">5</span><span class="p">)]</span>
<span class="n">simple</span><span class="o">=</span><span class="p">[</span><span class="n">TPoint</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">TPoint</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">TPoint</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">10</span><span class="p">),</span> <span class="n">TPoint</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">5</span><span class="p">)]</span>
<span class="n">edges</span><span class="o">=</span><span class="p">[(</span><span class="n">TPoint</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">5</span><span class="p">),</span> <span class="n">TPoint</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">)),</span> <span class="p">(</span><span class="n">TPoint</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">5</span><span class="p">),</span> <span class="n">TPoint</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">)),</span> <span class="p">(</span><span class="n">TPoint</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">5</span><span class="p">),</span> <span class="n">TPoint</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">10</span><span class="p">))]</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>/Users/docloud/anaconda/lib/python2.7/site-packages/matplotlib/collections.py:590: FutureWarning: elementwise comparison failed; returning scalar instead, but in the future will perform elementwise comparison
  if self._edgecolors == str(&#39;face&#39;):
</pre></div>
</div>
<img alt="_images/output_21_2.png" src="_images/output_21_2.png" />
<p>The hub is indeed at the center of gravity. Now let&#8217;s try with a random
set of points set in the upper right quadrant [0..100]</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">random</span>

<span class="k">def</span> <span class="nf">generate_random_points</span><span class="p">(</span><span class="n">nb_points</span><span class="p">,</span> <span class="n">grid_size</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>
    <span class="n">xs</span> <span class="o">=</span> <span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">grid_size</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nb_points</span><span class="p">)]</span>
    <span class="n">ys</span> <span class="o">=</span> <span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">grid_size</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nb_points</span><span class="p">)]</span>
    <span class="k">return</span> <span class="nb">set</span><span class="p">([</span><span class="n">Point</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">)])</span>

<span class="n">rand_points</span> <span class="o">=</span> <span class="n">generate_random_points</span><span class="p">(</span><span class="n">nb_points</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">grid_size</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c1"># now generate the matrix</span>
<span class="n">rand_matrix</span> <span class="o">=</span> <span class="n">generate_matrix</span><span class="p">(</span><span class="n">rand_points</span><span class="p">)</span>

<span class="c1"># and solve the kmedian problem looking for two ceneters this time</span>
<span class="p">(</span><span class="n">rand_distance</span><span class="p">,</span> <span class="n">rand_hubs</span><span class="p">,</span> <span class="n">rand_edges</span><span class="p">)</span> <span class="o">=</span> <span class="n">solve_kmedian1</span><span class="p">(</span><span class="n">rand_points</span><span class="p">,</span> <span class="n">rand_matrix</span><span class="p">,</span> <span class="n">nb_hubs</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">plot_kmedian</span><span class="p">(</span><span class="n">rand_points</span><span class="p">,</span> <span class="n">rand_hubs</span><span class="p">,</span> <span class="n">rand_edges</span><span class="p">)</span>
</pre></div>
</div>
<pre class="literal-block">
Warning: CPLEX DLL not found, will solve on DOcloud
* #non-compliant LP name: |is_hub_P&lt;30,26&gt;|

total distance=2188.64
#hubs=3
--hub: P&lt;58,87&gt;
--hub: P&lt;66,28&gt;
--hub: P&lt;20,47&gt;
</pre>
<img alt="_images/output_23_1.png" src="_images/output_23_1.png" />
</div>
<div class="section" id="electrifying-example">
<h2>Electrifying Example<a class="headerlink" href="#electrifying-example" title="Permalink to this headline">¶</a></h2>
<p>A new city is being built which will include 20 distinct neighborhoods
as shown by the house icons in the map. As part of the planning process,
electricity needs to be connected to each of the neighborhoods.</p>
<p>The city has been allocated funds to put in 3 electrical substations to
service the electrical needs of the neighborhoods. The substations are
represented by the 3 electrical box icons to the right of the map.
Because laying electrical line to each neighborhood is expensive, the
placement of the substations on the map requires careful consideration.</p>
<p>A neighborhood will be serviced by the nearest electrical substation. A
neighborhood may only be connected to one substation. The substations
may be placed in any cell (including the same cell as an existing
neighborhood). The cost of electrical wiring is 1M dollars per km.
Distances are measured using a direct line between cells, which are each
1km apart. For example, the distance between cell A1 and B2 is 1.41km.</p>
<p>Question: What is the minimum cost required to connect all neighborhoods
to electricity?</p>
<div class="section" id="references">
<h3>References<a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>The PuzzlOr - Electrifying
(<a class="reference external" href="http://puzzlor.com/2014-12_Electrifying.html">http://puzzlor.com/2014-12_Electrifying.html</a>) .</li>
</ul>
<center></center><p>Let&#8217;s begin with defining the points of our map that we want to connect:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">rand_points</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">Point</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span><span class="n">Point</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="mi">5</span><span class="p">),</span><span class="n">Point</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="mi">6</span><span class="p">),</span><span class="n">Point</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="mi">8</span><span class="p">),</span><span class="n">Point</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span><span class="n">Point</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="mi">10</span><span class="p">),</span><span class="n">Point</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span><span class="n">Point</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span><span class="n">Point</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="mi">6</span><span class="p">),</span><span class="n">Point</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="mi">8</span><span class="p">),</span><span class="n">Point</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span><span class="n">Point</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="mi">5</span><span class="p">),</span><span class="n">Point</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span><span class="n">Point</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="mi">8</span><span class="p">),</span><span class="n">Point</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="mi">5</span><span class="p">),</span><span class="n">Point</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="mi">7</span><span class="p">),</span><span class="n">Point</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="mi">8</span><span class="p">),</span><span class="n">Point</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="mi">4</span><span class="p">),</span><span class="n">Point</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="mi">7</span><span class="p">),</span><span class="n">Point</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="mi">3</span><span class="p">)])</span>
</pre></div>
</div>
<p>Let&#8217;s now solve the problem:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c1"># now generate the matrix</span>
<span class="n">rand_matrix</span> <span class="o">=</span> <span class="n">generate_matrix</span><span class="p">(</span><span class="n">rand_points</span><span class="p">)</span>

<span class="c1"># and solve the kmedian problem looking for tree centers this time</span>
<span class="p">(</span><span class="n">rand_distance</span><span class="p">,</span> <span class="n">rand_hubs</span><span class="p">,</span> <span class="n">rand_edges</span><span class="p">)</span> <span class="o">=</span> <span class="n">solve_kmedian1</span><span class="p">(</span><span class="n">rand_points</span><span class="p">,</span> <span class="n">rand_matrix</span><span class="p">,</span> <span class="n">nb_hubs</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">plot_kmedian</span><span class="p">(</span><span class="n">rand_points</span><span class="p">,</span> <span class="n">rand_hubs</span><span class="p">,</span> <span class="n">rand_edges</span><span class="p">)</span>
</pre></div>
</div>
<pre class="literal-block">
Warning: CPLEX DLL not found, will solve on DOcloud
* #non-compliant LP name: |is_hub_P&lt;4,10&gt;|

total distance=36.518
#hubs=3
--hub: P&lt;8,7&gt;
--hub: P&lt;3,8&gt;
--hub: P&lt;5,2&gt;
</pre>
<img alt="_images/output_30_1.png" src="_images/output_30_1.png" />
<p>The total cost is 36.518 M dollars, and we need to position the 3
electrical substations on : 8G, 3H, 5B.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">The K-Median Problem</a><ul>
<li><a class="reference internal" href="#to-begin-let-s-generate-a-random-set-of-points-in-the-plane-with-coordinates-ranging-from-1-to-100">To begin, let&#8217;s generate a random set of points in the plane, with coordinates ranging from 1 to 100.</a></li>
<li><a class="reference internal" href="#electrifying-example">Electrifying Example</a><ul>
<li><a class="reference internal" href="#references">References</a></li>
</ul>
</li>
</ul>
</li>
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">DOcplex.MP: Mathematical Programming Modeling for Python V1.0 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2016, IBM®.
    </div>
  </body>
</html>