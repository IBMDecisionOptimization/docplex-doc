<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
    
    <title>Maximizing the profit of an oil company &mdash; DOcplex.MP: Mathematical Programming Modeling for Python V2.0 documentation</title>
    
    <link rel="stylesheet" href="_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     'V2.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  false
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="DOcplex.MP: Mathematical Programming Modeling for Python V2.0 documentation" href="index.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">DOcplex.MP: Mathematical Programming Modeling for Python V2.0 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="maximizing-the-profit-of-an-oil-company">
<h1>Maximizing the profit of an oil company<a class="headerlink" href="#maximizing-the-profit-of-an-oil-company" title="Permalink to this headline">&para;</a></h1>
<p>This tutorial includes everything you need to set up the decision
optimization engines and build mathematical programming models.</p>
<p>When you finish this tutorial, you&#8217;ll have a foundational knowledge of
<em>Prescriptive Analytics</em>.</p>
<blockquote>
<div><p>This notebook is part of <a class="reference external" href="https://rawgit.com/IBMDecisionOptimization/docplex-doc/master/docs/index.html">Prescriptive Analytics for
Python</a>.</p>
<p>It requires a valid subscription to <strong>Decision Optimization on
Cloud</strong>. Try it for free
<a class="reference external" href="https://developer.ibm.com/docloud">here</a>.</p>
</div></blockquote>
<p>Table of contents:</p>
<ul class="simple">
<li><a class="reference internal" href="#describe-the-business-problem">Describe the business problem</a></li>
<li><a class="reference internal" href="#how-decision-optimization-can-help">How  decision optimization can help</a></li>
<li><a class="reference internal" href="#use-decision-optimization">Use decision optimization</a><ul>
<li><a class="reference internal" href="#step-1-download-the-library">Step 1: Download the library</a></li>
<li><a class="reference internal" href="#step-2-set-up-the-prescriptive-engine">Step 2: Set up the prescriptive engine</a></li>
<li><a class="reference internal" href="#step-3-model-the-data">Step 3: Model the data</a></li>
<li><a class="reference internal" href="#step-4-prepare-the-data">Step 4: Prepare the data</a></li>
<li><a class="reference internal" href="#step-5-set-up-the-prescriptive-model">Step 5: Set up the prescriptive model</a><ul>
<li><a class="reference internal" href="#define-the-decision-variables">Define the decision variables</a></li>
<li><a class="reference internal" href="#express-the-business-constraints">Express the business constraints</a></li>
<li><a class="reference internal" href="#express-the-objective">Express the objective</a></li>
<li><a class="reference internal" href="#solve-with-the-decision-optimization-solve-service">Solve with the Decision Optimization solve service</a></li>
</ul>
</li>
<li><a class="reference internal" href="#step-6-investigate-the-solution-and-then-run-an-example-analysis">Step 6: Investigate the solution and then run an example analysis</a></li>
</ul>
</li>
<li><a class="reference internal" href="#summary">Summary</a></li>
</ul>
<div class="section" id="describe-the-business-problem">
<h2>Describe the business problem<a class="headerlink" href="#describe-the-business-problem" title="Permalink to this headline">&para;</a></h2>
<ul class="simple">
<li>An oil company manufactures different types of gasoline and diesel.
Each type of gasoline is produced by blending different types of
crude oils that must be purchased. The company must decide how much
crude oil to buy in order to maximize its profit while respecting
processing capacities and quality levels as well as satisfying
customer demand.</li>
<li>Blending problems are a typical industry application of Linear
Programming (LP). LP represents real life problems mathematically
using an objective function to represent the goal that is to be
minimized or maximized, together with a set of linear constraints
which define the conditions to be satisfied and the limitations of
the real life problem. The function and constraints are expressed in
terms of decision variables and the solution, obtained from
optimization engines such as IBM&reg; ILOG&reg; CPLEX&reg;, provides the best
values for these variables so that the objective function is
optimized.</li>
<li>The oil-blending problem consists of calculating different blends of
gasoline according to specific quality criteria.</li>
<li>Three types of gasoline are manufactured: super, regular, and diesel.</li>
<li>Each type of gasoline is produced by blending three types of crude
oil: crude1, crude2, and crude3.</li>
<li>The gasoline must satisfy some quality criteria with respect to their
lead content and their octane ratings, thus constraining the possible
blendings.</li>
<li>The company must also satisfy its customer demand, which is 3,000
barrels a day of super, 2,000 of regular, and 1,000 of diesel.</li>
<li>The company can purchase 5,000 barrels of each type of crude oil per
day and can process at most 14,000 barrels a day.</li>
<li>In addition, the company has the option of advertising a gasoline, in
which case the demand for this type of gasoline increases by ten
barrels for every dollar spent.</li>
<li>Finally, it costs four dollars to transform a barrel of oil into a
barrel of gasoline.</li>
</ul>
</div>
<div class="section" id="how-decision-optimization-can-help">
<h2>How decision optimization can help<a class="headerlink" href="#how-decision-optimization-can-help" title="Permalink to this headline">&para;</a></h2>
<ul>
<li><p class="first">Prescriptive analytics technology recommends actions based on desired
outcomes, taking into account specific scenarios, resources, and
knowledge of past and current events. This insight can help your
organization make better decisions and have greater control of
business outcomes.</p>
</li>
<li><p class="first">Prescriptive analytics is the next step on the path to insight-based
actions. It creates value through synergy with predictive analytics,
which analyzes data to predict future outcomes.</p>
</li>
<li><div class="first line-block">
<div class="line">Prescriptive analytics takes that insight to the next level by
suggesting the optimal way to handle that future situation.
Organizations that can act fast in dynamic conditions and make
superior decisions in uncertain environments gain a strong
competitive advantage.</div>
<div class="line"><br /></div>
</div>
</li>
<li><p class="first">For example:</p>
<ul class="simple">
<li>Automate complex decisions and trade-offs to better manage limited
resources.</li>
<li>Take advantage of a future opportunity or mitigate a future risk.</li>
<li>Proactively update recommendations based on changing events.</li>
<li>Meet operational goals, increase customer loyalty, prevent threats
and fraud, and optimize business processes.</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="use-decision-optimization">
<h2>Use decision optimization<a class="headerlink" href="#use-decision-optimization" title="Permalink to this headline">&para;</a></h2>
<div class="section" id="step-1-download-the-library">
<h3>Step 1: Download the library<a class="headerlink" href="#step-1-download-the-library" title="Permalink to this headline">&para;</a></h3>
<p>Run the following code to install the Decision Optimization CPLEX
Modeling library. The <em>DOcplex</em> library contains the two modeling
packages, Mathematical Programming (docplex.mp) and Constraint
Programming (docplex.cp).</p>
<div class="code python highlight-python"><div class="highlight"><pre><span></span>import sys
try:
    import docplex.mp
except:
    if hasattr(sys, &#39;real_prefix&#39;):
        #we are in a virtual env.
        !pip install docplex
    else:
        !pip install --user docplex
</pre></div>
</div>
</div>
<div class="section" id="step-2-set-up-the-prescriptive-engine">
<h3>Step 2: Set up the prescriptive engine<a class="headerlink" href="#step-2-set-up-the-prescriptive-engine" title="Permalink to this headline">&para;</a></h3>
<ul class="simple">
<li>Subscribe to the <a class="reference external" href="https://developer.ibm.com/docloud">Decision Optimization on Cloud solve
service</a>.</li>
<li>Get the service URL and your personal API key and enter your
credentials here:</li>
</ul>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;ENTER YOUR URL HERE&quot;</span>
<span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;ENTER YOUR KEY HERE&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="step-3-model-the-data">
<h3>Step 3: Model the data<a class="headerlink" href="#step-3-model-the-data" title="Permalink to this headline">&para;</a></h3>
<ul class="simple">
<li>For each type of crude oil, there are capacities of what can be
bought, the buying price, the octane level, and the lead level.</li>
<li>For each type of gasoline or diesel, there is customer demand,
selling prices, and octane and lead levels.</li>
<li>There is a maximum level of production imposed by the factory&#8217;s limit
as well as a fixed production cost.</li>
<li>There are inventory costs for each type of final product and blending
proportions. All of these have actual values in the model.</li>
<li>The maginal production cost and maximum production are assumed to be
identical for all oil types.</li>
</ul>
<p>Input data comes as <em>NumPy</em> arrays with two dimensions.
<a class="reference external" href="http://www.numpy.org/">NumPy</a> is the fundamental package for
scientific computing with Python.</p>
<p>The first dimension of the <em>NumPy</em> array is the number of gasoline
types; and for each gasoline type, we have a <em>NumPy</em> array containing
capacity, price, octane and lead level, in that order.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>

<span class="n">gas_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;super&quot;</span><span class="p">,</span> <span class="s2">&quot;regular&quot;</span><span class="p">,</span> <span class="s2">&quot;diesel&quot;</span><span class="p">]</span>

<span class="n">gas_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">3000</span><span class="p">,</span> <span class="mi">70</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span>

<span class="n">oil_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;crude1&quot;</span><span class="p">,</span> <span class="s2">&quot;crude2&quot;</span><span class="p">,</span> <span class="s2">&quot;crude3&quot;</span><span class="p">]</span>

<span class="n">oil_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">5000</span><span class="p">,</span> <span class="mi">45</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span> <span class="p">[</span><span class="mi">5000</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">5000</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">3</span><span class="p">]])</span>

<span class="n">nb_gas</span>  <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">gas_names</span><span class="p">)</span>
<span class="n">nb_oils</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">oil_names</span><span class="p">)</span>
<span class="n">range_gas</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">nb_gas</span><span class="p">)</span>
<span class="n">range_oil</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">nb_oils</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;Number of gasoline types = {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nb_gas</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;Number of crude types = {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nb_oils</span><span class="p">))</span>

<span class="c1"># global data</span>
<span class="n">production_cost</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">production_max</span> <span class="o">=</span> <span class="mi">14000</span>
<span class="c1"># each $1 spent on advertising increases demand by 10.</span>
<span class="n">advert_return</span> <span class="o">=</span> <span class="mi">10</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span></span>Number of gasoline types = 3
Number of crude types = 3
</pre></div>
</div>
</div>
<div class="section" id="step-4-prepare-the-data">
<h3>Step 4: Prepare the data<a class="headerlink" href="#step-4-prepare-the-data" title="Permalink to this headline">&para;</a></h3>
<p><a class="reference external" href="http://pandas.pydata.org/">Pandas</a> is another Python library that we
use to store data. <em>pandas</em> contains data structures and data analysis
tools for the Python programming language.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>
<span class="n">gaspd</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([(</span><span class="n">gas_names</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="nb">int</span><span class="p">(</span><span class="n">gas_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]),</span><span class="nb">int</span><span class="p">(</span><span class="n">gas_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]),</span><span class="nb">int</span><span class="p">(</span><span class="n">gas_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">]),</span><span class="nb">int</span><span class="p">(</span><span class="n">gas_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">3</span><span class="p">]))</span>
                      <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">range_gas</span><span class="p">])</span>
<span class="n">oilpd</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([(</span><span class="n">oil_names</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="nb">int</span><span class="p">(</span><span class="n">oil_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]),</span><span class="nb">int</span><span class="p">(</span><span class="n">oil_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]),</span><span class="nb">int</span><span class="p">(</span><span class="n">oil_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">]),</span><span class="n">oil_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">3</span><span class="p">])</span>
                      <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">range_oil</span><span class="p">])</span>
<span class="n">gaspd</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="s1">&#39;demand&#39;</span><span class="p">,</span><span class="s1">&#39;price&#39;</span><span class="p">,</span><span class="s1">&#39;octane&#39;</span><span class="p">,</span><span class="s1">&#39;lead&#39;</span><span class="p">]</span>
<span class="n">oilpd</span><span class="o">.</span><span class="n">columns</span><span class="o">=</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="s1">&#39;capacity&#39;</span><span class="p">,</span><span class="s1">&#39;price&#39;</span><span class="p">,</span><span class="s1">&#39;octane&#39;</span><span class="p">,</span><span class="s1">&#39;lead&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>Use basic HTML and a stylesheet to format the data.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="n">CSS</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">body {</span>
<span class="s2">    margin: 0;</span>
<span class="s2">    font-family: Helvetica;</span>
<span class="s2">}</span>
<span class="s2">table.dataframe {</span>
<span class="s2">    border-collapse: collapse;</span>
<span class="s2">    border: none;</span>
<span class="s2">}</span>
<span class="s2">table.dataframe tr {</span>
<span class="s2">    border: none;</span>
<span class="s2">}</span>
<span class="s2">table.dataframe td, table.dataframe th {</span>
<span class="s2">    margin: 0;</span>
<span class="s2">    border: 1px solid white;</span>
<span class="s2">    padding-left: 0.25em;</span>
<span class="s2">    padding-right: 0.25em;</span>
<span class="s2">}</span>
<span class="s2">table.dataframe th:not(:empty) {</span>
<span class="s2">    background-color: #fec;</span>
<span class="s2">    text-align: left;</span>
<span class="s2">    font-weight: normal;</span>
<span class="s2">}</span>
<span class="s2">table.dataframe tr:nth-child(2) th:empty {</span>
<span class="s2">    border-left: none;</span>
<span class="s2">    border-right: 1px dashed #888;</span>
<span class="s2">}</span>
<span class="s2">table.dataframe td {</span>
<span class="s2">    border: 2px solid #ccf;</span>
<span class="s2">    background-color: #f4f4ff;</span>
<span class="s2">}</span>
<span class="s2">    table.dataframe thead th:first-child {</span>
<span class="s2">        display: none;</span>
<span class="s2">    }</span>
<span class="s2">    table.dataframe tbody th {</span>
<span class="s2">        display: none;</span>
<span class="s2">    }</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">IPython.core.display</span> <span class="kn">import</span> <span class="n">HTML</span>
<span class="n">HTML</span><span class="p">(</span><span class="s1">&#39;&lt;style&gt;{}&lt;/style&gt;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">CSS</span><span class="p">))</span>
</pre></div>
</div>
<style>
body {
    margin: 0;
    font-family: Helvetica;
}
table.dataframe {
    border-collapse: collapse;
    border: none;
}
table.dataframe tr {
    border: none;
}
table.dataframe td, table.dataframe th {
    margin: 0;
    border: 1px solid white;
    padding-left: 0.25em;
    padding-right: 0.25em;
}
table.dataframe th:not(:empty) {
    background-color: #fec;
    text-align: left;
    font-weight: normal;
}
table.dataframe tr:nth-child(2) th:empty {
    border-left: none;
    border-right: 1px dashed #888;
}
table.dataframe td {
    border: 2px solid #ccf;
    background-color: #f4f4ff;
}
    table.dataframe thead th:first-child {
        display: none;
    }
    table.dataframe tbody th {
        display: none;
    }
</style><p>Let&#8217;s display the data we just prepared.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">display</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;Gas data:&quot;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">gaspd</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;Oil data:&quot;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">oilpd</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span></span>Gas data:
</pre></div>
</div>
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>name</th>
      <th>demand</th>
      <th>price</th>
      <th>octane</th>
      <th>lead</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>super</td>
      <td>3000</td>
      <td>70</td>
      <td>10</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>regular</td>
      <td>2000</td>
      <td>60</td>
      <td>8</td>
      <td>2</td>
    </tr>
    <tr>
      <th>2</th>
      <td>diesel</td>
      <td>1000</td>
      <td>50</td>
      <td>6</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div><div class="highlight-python"><div class="highlight"><pre><span></span>Oil data:
</pre></div>
</div>
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>name</th>
      <th>capacity</th>
      <th>price</th>
      <th>octane</th>
      <th>lead</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>crude1</td>
      <td>5000</td>
      <td>45</td>
      <td>12</td>
      <td>0.5</td>
    </tr>
    <tr>
      <th>1</th>
      <td>crude2</td>
      <td>5000</td>
      <td>35</td>
      <td>6</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>crude3</td>
      <td>5000</td>
      <td>25</td>
      <td>8</td>
      <td>3.0</td>
    </tr>
  </tbody>
</table>
</div></div>
<div class="section" id="step-5-set-up-the-prescriptive-model">
<h3>Step 5: Set up the prescriptive model<a class="headerlink" href="#step-5-set-up-the-prescriptive-model" title="Permalink to this headline">&para;</a></h3>
<div class="section" id="create-the-docplex-model">
<h4>Create the DOcplex model<a class="headerlink" href="#create-the-docplex-model" title="Permalink to this headline">&para;</a></h4>
<p>A model is needed to store all the variables and constraints needed to
formulate the business problem and submit the problem to the solve
service.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">docplex.mp.model</span> <span class="kn">import</span> <span class="n">Model</span>

<span class="n">mdl</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;oil_blending&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="define-the-decision-variables">
<h4>Define the decision variables<a class="headerlink" href="#define-the-decision-variables" title="Permalink to this headline">&para;</a></h4>
<p>For each combination of oil and gas, we have to decide the quantity of
oil to use to produce a gasoline. A decision variable will be needed to
represent that amount. A matrix of continuous variables, indexed by the
set of oils and the set of gasolines needs to be created.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="n">blends</span> <span class="o">=</span> <span class="n">mdl</span><span class="o">.</span><span class="n">continuous_var_matrix</span><span class="p">(</span><span class="n">keys1</span><span class="o">=</span><span class="n">nb_oils</span><span class="p">,</span> <span class="n">keys2</span><span class="o">=</span><span class="n">nb_gas</span><span class="p">,</span> <span class="n">lb</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<p>We also have to decide how much should be spent in advertising for each
time of gasoline. To do so, we will create a list of continuous
variables, indexed by the gasolines.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="n">adverts</span> <span class="o">=</span> <span class="n">mdl</span><span class="o">.</span><span class="n">continuous_var_list</span><span class="p">(</span><span class="n">nb_gas</span><span class="p">,</span> <span class="n">lb</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="express-the-business-constraints">
<h4>Express the business constraints<a class="headerlink" href="#express-the-business-constraints" title="Permalink to this headline">&para;</a></h4>
<p>The business constraints are the following:</p>
<ul class="simple">
<li>The demand for each gasoline type must be satisfied. The total demand
includes the initial demand as stored in the data,plus a variable
demand caused by the advertising. This increase is assumed to be
proportional to the advertising cost.</li>
<li>The capacity constraint on each oil type must also be satisfied.</li>
<li>For each gasoline type, the octane level must be above a minimum
level, and the lead level must be below a maximum level.</li>
</ul>
<div class="section" id="demand">
<h5>Demand<a class="headerlink" href="#demand" title="Permalink to this headline">&para;</a></h5>
<ul class="simple">
<li>For each gasoline type, the total quantity produced must equal the
raw demand plus the demand increase created by the advertising.</li>
</ul>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="c1"># gasoline demand is numpy array field #0</span>
<span class="n">mdl</span><span class="o">.</span><span class="n">add_constraints</span><span class="p">(</span><span class="n">mdl</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">blends</span><span class="p">[</span><span class="n">o</span><span class="p">,</span> <span class="n">g</span><span class="p">]</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nb_oils</span><span class="p">))</span> <span class="o">==</span> <span class="n">gas_data</span><span class="p">[</span><span class="n">g</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">advert_return</span> <span class="o">*</span> <span class="n">adverts</span><span class="p">[</span><span class="n">g</span><span class="p">]</span>
                   <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nb_gas</span><span class="p">))</span>
<span class="n">mdl</span><span class="o">.</span><span class="n">print_information</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span></span>Model: oil_blending
 - number of variables: 12
   - binary=0, integer=0, continuous=12
 - number of constraints: 3
 -   LE=0, EQ=3, GE=0, RNG=0
 - parameters: defaults
</pre></div>
</div>
</div>
<div class="section" id="maximum-capacity">
<h5>Maximum capacity<a class="headerlink" href="#maximum-capacity" title="Permalink to this headline">&para;</a></h5>
<ul class="simple">
<li>For each type of oil, the total quantity used in all types of
gasolines must not exceed the maximum capacity for this oil.</li>
</ul>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="n">mdl</span><span class="o">.</span><span class="n">add_constraints</span><span class="p">(</span><span class="n">mdl</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">blends</span><span class="p">[</span><span class="n">o</span><span class="p">,</span><span class="n">g</span><span class="p">]</span> <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">range_gas</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">oil_data</span><span class="p">[</span><span class="n">o</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">range_oil</span><span class="p">)</span>
<span class="n">mdl</span><span class="o">.</span><span class="n">print_information</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span></span>Model: oil_blending
 - number of variables: 12
   - binary=0, integer=0, continuous=12
 - number of constraints: 6
 -   LE=3, EQ=3, GE=0, RNG=0
 - parameters: defaults
</pre></div>
</div>
</div>
<div class="section" id="octane-and-lead-levels">
<h5>Octane and Lead levels<a class="headerlink" href="#octane-and-lead-levels" title="Permalink to this headline">&para;</a></h5>
<ul class="simple">
<li>For each gasoline type, the octane level must be above a minimum
level, and the lead level must be below a maximum level.</li>
</ul>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="c1"># minimum octane level</span>
<span class="c1"># octane is numpy array field #2</span>
<span class="n">mdl</span><span class="o">.</span><span class="n">add_constraints</span><span class="p">(</span><span class="n">mdl</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">blends</span><span class="p">[</span><span class="n">o</span><span class="p">,</span><span class="n">g</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">oil_data</span><span class="p">[</span><span class="n">o</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">gas_data</span><span class="p">[</span><span class="n">g</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">range_oil</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span>
                   <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">range_gas</span><span class="p">)</span>

<span class="c1"># maximum lead  level</span>
<span class="c1"># lead level is numpy array field #3</span>
<span class="n">mdl</span><span class="o">.</span><span class="n">add_constraints</span><span class="p">(</span><span class="n">mdl</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">blends</span><span class="p">[</span><span class="n">o</span><span class="p">,</span><span class="n">g</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">oil_data</span><span class="p">[</span><span class="n">o</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">gas_data</span><span class="p">[</span><span class="n">g</span><span class="p">][</span><span class="mi">3</span><span class="p">])</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">range_oil</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">0</span>
                   <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">range_gas</span><span class="p">)</span>

<span class="n">mdl</span><span class="o">.</span><span class="n">print_information</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span></span>Model: oil_blending
 - number of variables: 12
   - binary=0, integer=0, continuous=12
 - number of constraints: 12
 -   LE=6, EQ=3, GE=3, RNG=0
 - parameters: defaults
</pre></div>
</div>
</div>
<div class="section" id="maximum-total-production">
<h5>Maximum total production<a class="headerlink" href="#maximum-total-production" title="Permalink to this headline">&para;</a></h5>
<ul class="simple">
<li>The total production must not exceed the maximum (here 14000).</li>
</ul>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="c1"># -- maximum global production</span>
<span class="n">mdl</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span><span class="n">mdl</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">blends</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">production_max</span><span class="p">)</span>

<span class="n">mdl</span><span class="o">.</span><span class="n">print_information</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span></span>Model: oil_blending
 - number of variables: 12
   - binary=0, integer=0, continuous=12
 - number of constraints: 13
 -   LE=7, EQ=3, GE=3, RNG=0
 - parameters: defaults
</pre></div>
</div>
</div>
</div>
<div class="section" id="express-the-objective">
<h4>Express the objective<a class="headerlink" href="#express-the-objective" title="Permalink to this headline">&para;</a></h4>
<ul class="simple">
<li>The objective or goal is to maximize profit, which is made from sales
of the final products minus total costs. The costs consist of the
purchase cost of the crude oils, production costs, and inventory
costs.</li>
<li>The model maximizes the net revenue, that is revenue minus oil cost
and production cost, to which we subtract the total advertising cost.</li>
<li>To define business objective, let&#8217;s define a few KPIs :<ul>
<li>Total advertising cost</li>
<li>Total Oil cost</li>
<li>Total production cost</li>
<li>Total revenue</li>
</ul>
</li>
</ul>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="c1"># KPIs</span>
<span class="n">total_advert_cost</span> <span class="o">=</span> <span class="n">mdl</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">adverts</span><span class="p">)</span>
<span class="n">mdl</span><span class="o">.</span><span class="n">add_kpi</span><span class="p">(</span><span class="n">total_advert_cost</span><span class="p">,</span> <span class="s2">&quot;Total advertising cost&quot;</span><span class="p">)</span>
<span class="n">total_oil_cost</span> <span class="o">=</span> <span class="n">mdl</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">blends</span><span class="p">[</span><span class="n">o</span><span class="p">,</span><span class="n">g</span><span class="p">]</span> <span class="o">*</span> <span class="n">oil_data</span><span class="p">[</span><span class="n">o</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">range_oil</span> <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">range_gas</span><span class="p">)</span>
<span class="n">mdl</span><span class="o">.</span><span class="n">add_kpi</span><span class="p">(</span><span class="n">total_oil_cost</span><span class="p">,</span> <span class="s2">&quot;Total Oil cost&quot;</span><span class="p">)</span>
<span class="n">total_production_cost</span> <span class="o">=</span> <span class="n">production_cost</span> <span class="o">*</span> <span class="n">mdl</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">blends</span><span class="p">)</span>
<span class="n">mdl</span><span class="o">.</span><span class="n">add_kpi</span><span class="p">(</span><span class="n">total_production_cost</span><span class="p">,</span> <span class="s2">&quot;Total production cost&quot;</span><span class="p">)</span>
<span class="n">total_revenue</span> <span class="o">=</span> <span class="n">mdl</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">blends</span><span class="p">[</span><span class="n">o</span><span class="p">,</span><span class="n">g</span><span class="p">]</span> <span class="o">*</span> <span class="n">gas_data</span><span class="p">[</span><span class="n">g</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nb_gas</span><span class="p">)</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nb_oils</span><span class="p">))</span>
<span class="n">mdl</span><span class="o">.</span><span class="n">add_kpi</span><span class="p">(</span><span class="n">total_revenue</span><span class="p">,</span> <span class="s2">&quot;Total revenue&quot;</span><span class="p">)</span>

<span class="c1"># finally the objective</span>
<span class="n">mdl</span><span class="o">.</span><span class="n">maximize</span><span class="p">(</span><span class="n">total_revenue</span> <span class="o">-</span> <span class="n">total_oil_cost</span> <span class="o">-</span> <span class="n">total_production_cost</span> <span class="o">-</span> <span class="n">total_advert_cost</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="solve-with-the-decision-optimization-solve-service">
<h4>Solve with the Decision Optimization solve service<a class="headerlink" href="#solve-with-the-decision-optimization-solve-service" title="Permalink to this headline">&para;</a></h4>
<p>We specify the <code class="docutils literal"><span class="pre">url</span></code> and <code class="docutils literal"><span class="pre">key</span></code> to use on the solve service.</p>
<p>We display the objective and KPI values after the solve by calling the
method report() on the model.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="k">assert</span> <span class="n">mdl</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">),</span> <span class="s2">&quot;Solve failed&quot;</span>
<span class="n">mdl</span><span class="o">.</span><span class="n">report</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span></span>* model solved with objective: 287750.000
* KPI: Total advertising cost=750.000
* KPI: Total Oil cost=487500.000
* KPI: Total production cost=54000.000
* KPI: Total revenue=830000.000
</pre></div>
</div>
</div>
</div>
<div class="section" id="step-6-investigate-the-solution-and-then-run-an-example-analysis">
<h3>Step 6: Investigate the solution and then run an example analysis<a class="headerlink" href="#step-6-investigate-the-solution-and-then-run-an-example-analysis" title="Permalink to this headline">&para;</a></h3>
<div class="section" id="displaying-the-solution">
<h4>Displaying the solution<a class="headerlink" href="#displaying-the-solution" title="Permalink to this headline">&para;</a></h4>
<p>First, get the KPIs values and store them in a <em>pandas</em> DataFrame.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="n">all_kpis</span> <span class="o">=</span> <span class="p">[(</span><span class="n">kp</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">kp</span><span class="o">.</span><span class="n">compute</span><span class="p">())</span> <span class="k">for</span> <span class="n">kp</span> <span class="ow">in</span> <span class="n">mdl</span><span class="o">.</span><span class="n">iter_kpis</span><span class="p">()]</span>
<span class="n">kpis_bd</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">all_kpis</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;kpi&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">])</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="n">blend_values</span> <span class="o">=</span> <span class="p">[</span> <span class="p">[</span> <span class="n">blends</span><span class="p">[</span><span class="n">o</span><span class="p">,</span><span class="n">g</span><span class="p">]</span><span class="o">.</span><span class="n">solution_value</span> <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">range_gas</span><span class="p">]</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">range_oil</span><span class="p">]</span>
<span class="n">total_gas_prods</span> <span class="o">=</span> <span class="p">[</span><span class="nb">sum</span><span class="p">(</span><span class="n">blend_values</span><span class="p">[</span><span class="n">o</span><span class="p">][</span><span class="n">g</span><span class="p">]</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">range_oil</span><span class="p">)</span> <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">range_gas</span><span class="p">]</span>

<span class="n">prods</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">gas_names</span><span class="p">,</span> <span class="n">total_gas_prods</span><span class="p">)</span>
<span class="n">prods_bd</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">prods</span><span class="p">)</span>
</pre></div>
</div>
<p>Let&#8217;s display some KPIs in pie charts using the Python package
<a class="reference external" href="http://matplotlib.org/">*matplotlib*</a>.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span></span>%matplotlib inline
import matplotlib.pyplot as plt
def display_pie(pie_values, pie_labels, colors=None,title=&#39;&#39;):
    plt.axis(&quot;equal&quot;)
    plt.pie(pie_values, labels=pie_labels, colors=colors, autopct=&quot;%1.1f%%&quot;)
    plt.title(title)
    plt.show()

display_pie( [kpnv[1] for kpnv in all_kpis], [kpnv[0] for kpnv in all_kpis],title=&#39;KPIs: Revenue - Oil Cost - Production Cost&#39;)
</pre></div>
</div>
<img alt="_images/oil_blending_41_0.png" src="_images/oil_blending_41_0.png" />
<div class="section" id="production">
<h5>Production<a class="headerlink" href="#production" title="Permalink to this headline">&para;</a></h5>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="n">display_pie</span><span class="p">(</span><span class="n">total_gas_prods</span><span class="p">,</span> <span class="n">gas_names</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="s2">&quot;goldenrod&quot;</span><span class="p">,</span> <span class="s2">&quot;lightGreen&quot;</span><span class="p">],</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Gasoline Total Production&#39;</span><span class="p">)</span>
</pre></div>
</div>
<img alt="_images/oil_blending_43_0.png" src="_images/oil_blending_43_0.png" />
<p>We see that the most produced gasoline type is by far regular.</p>
<p>Now, let&#8217;s plot the breakdown of oil blend quantities per gasoline type.
We are using a multiple bar chart diagram, displaying all blend values
for each couple of oil and gasoline type.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="n">sblends</span> <span class="o">=</span> <span class="p">[(</span><span class="n">gas_names</span><span class="p">[</span><span class="n">n</span><span class="p">],</span> <span class="n">oil_names</span><span class="p">[</span><span class="n">o</span><span class="p">],</span> <span class="nb">round</span><span class="p">(</span><span class="n">blends</span><span class="p">[</span><span class="n">o</span><span class="p">,</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">solution_value</span><span class="p">))</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">range_gas</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">range_oil</span><span class="p">]</span>

<span class="n">blends_bd</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">sblends</span><span class="p">)</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="n">f</span><span class="p">,</span> <span class="n">barplot</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>

<span class="n">bar_width</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="n">offset</span> <span class="o">=</span> <span class="mf">0.12</span>
<span class="n">rho</span> <span class="o">=</span> <span class="mf">0.7</span>

<span class="c1"># position of left-bar boundaries</span>
<span class="n">bar_l</span> <span class="o">=</span> <span class="p">[</span><span class="n">o</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">range_oil</span><span class="p">]</span>

<span class="n">mbar_w</span> <span class="o">=</span> <span class="mi">3</span><span class="o">*</span><span class="n">bar_width</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">offset</span><span class="o">-</span><span class="n">bar_width</span><span class="p">)</span>

<span class="n">tick_pos</span> <span class="o">=</span> <span class="p">[</span><span class="n">b</span><span class="o">*</span><span class="n">rho</span> <span class="o">+</span> <span class="n">mbar_w</span><span class="o">/</span><span class="mf">2.0</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">bar_l</span><span class="p">]</span>

<span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;olive&#39;</span><span class="p">,</span> <span class="s1">&#39;lightgreen&#39;</span><span class="p">,</span> <span class="s1">&#39;cadetblue&#39;</span><span class="p">]</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">range_oil</span><span class="p">:</span>
    <span class="n">barplot</span><span class="o">.</span><span class="n">bar</span><span class="p">([</span><span class="n">b</span><span class="o">*</span><span class="n">rho</span> <span class="o">+</span> <span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="n">offset</span><span class="p">)</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">bar_l</span><span class="p">],</span>
                <span class="n">blend_values</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">width</span><span class="o">=</span><span class="n">bar_width</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">oil_names</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">tick_pos</span><span class="p">,</span> <span class="n">gas_names</span><span class="p">)</span>
<span class="n">barplot</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;gasolines&quot;</span><span class="p">)</span>
<span class="n">barplot</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;blend&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper right&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Blend Repartition</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>


<span class="c1"># Set a buffer around the edge</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">tick_pos</span><span class="p">)</span><span class="o">+</span><span class="n">mbar_w</span> <span class="o">+</span><span class="mf">0.5</span><span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img alt="_images/oil_blending_46_0.png" src="_images/oil_blending_46_0.png" />
<p>Notice the missing bar for (crude2, diesel) which is expected since
blend[crude2, diesel] is zero in the solution.</p>
<p>We can check the solution value of blends for <em>crude2</em> and <em>diesel</em>,
remembering that crude2 has offset 1 and diesel has offset 2. Note how
the decision variable is automatically converted to a float here. This
would raise an exception if called before submitting a solve, as no
solution value would be present.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span></span><span class="k">print</span><span class="p">(</span><span class="s2">&quot;* value of blend[crude2, diesel] is </span><span class="si">%g</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">blends</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span></span>* value of blend[crude2, diesel] is 0
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="Permalink to this headline">&para;</a></h2>
<p>You learned how to set up and use IBM Decision Optimization CPLEX
Modeling for Python to formulate a Mathematical Programming model and
solve it with IBM Decision Optimization on Cloud.</p>
</div>
<div class="section" id="references">
<h2>References<a class="headerlink" href="#references" title="Permalink to this headline">&para;</a></h2>
<ul class="simple">
<li><a class="reference external" href="https://rawgit.com/IBMDecisionOptimization/docplex-doc/master/docs/index.html">CPLEX Modeling for Python
documentation</a></li>
<li><a class="reference external" href="https://developer.ibm.com/docloud/">Decision Optimization on
Cloud</a></li>
<li>Need help with DOcplex or to report a bug? Please go
<a class="reference external" href="https://developer.ibm.com/answers/smartspace/docloud">here</a>.</li>
<li>Contact us at <a class="reference external" href="mailto:dofeedback&#37;&#52;&#48;wwpdl&#46;vnet&#46;ibm&#46;com">dofeedback<span>&#64;</span>wwpdl<span>&#46;</span>vnet<span>&#46;</span>ibm<span>&#46;</span>com</a>.</li>
</ul>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Maximizing the profit of an oil company</a><ul>
<li><a class="reference internal" href="#describe-the-business-problem">Describe the business problem</a></li>
<li><a class="reference internal" href="#how-decision-optimization-can-help">How decision optimization can help</a></li>
<li><a class="reference internal" href="#use-decision-optimization">Use decision optimization</a><ul>
<li><a class="reference internal" href="#step-1-download-the-library">Step 1: Download the library</a></li>
<li><a class="reference internal" href="#step-2-set-up-the-prescriptive-engine">Step 2: Set up the prescriptive engine</a></li>
<li><a class="reference internal" href="#step-3-model-the-data">Step 3: Model the data</a></li>
<li><a class="reference internal" href="#step-4-prepare-the-data">Step 4: Prepare the data</a></li>
<li><a class="reference internal" href="#step-5-set-up-the-prescriptive-model">Step 5: Set up the prescriptive model</a><ul>
<li><a class="reference internal" href="#create-the-docplex-model">Create the DOcplex model</a></li>
<li><a class="reference internal" href="#define-the-decision-variables">Define the decision variables</a></li>
<li><a class="reference internal" href="#express-the-business-constraints">Express the business constraints</a><ul>
<li><a class="reference internal" href="#demand">Demand</a></li>
<li><a class="reference internal" href="#maximum-capacity">Maximum capacity</a></li>
<li><a class="reference internal" href="#octane-and-lead-levels">Octane and Lead levels</a></li>
<li><a class="reference internal" href="#maximum-total-production">Maximum total production</a></li>
</ul>
</li>
<li><a class="reference internal" href="#express-the-objective">Express the objective</a></li>
<li><a class="reference internal" href="#solve-with-the-decision-optimization-solve-service">Solve with the Decision Optimization solve service</a></li>
</ul>
</li>
<li><a class="reference internal" href="#step-6-investigate-the-solution-and-then-run-an-example-analysis">Step 6: Investigate the solution and then run an example analysis</a><ul>
<li><a class="reference internal" href="#displaying-the-solution">Displaying the solution</a><ul>
<li><a class="reference internal" href="#production">Production</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#summary">Summary</a></li>
<li><a class="reference internal" href="#references">References</a></li>
</ul>
</li>
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">DOcplex.MP: Mathematical Programming Modeling for Python V2.0 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2016-2017, IBM&reg;.
    </div>
  </body>
</html>